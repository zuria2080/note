function isChromeExtension(){return document.URL.indexOf("chrome-extension")>-1}function isEdgeExtension(){return document.URL.indexOf(EDGE_ID_DEV)>-1||document.URL.indexOf(EDGE_ID_PRO)>-1}function isEdgePro(){return document.URL.indexOf(EDGE_ID_PRO)>-1}function isChromePro(){return document.URL.indexOf(CHROME_ID_PRO)>-1}function isEdgeBrowser(){return navigator.userAgent.toLowerCase().indexOf("edg")>-1}function isMobile(){return/iphone|ipod|ipad|android|ie|blackberry|fennec/.test(navigator.userAgent.toLowerCase())}function isIOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function isSmallScreen(){return window.innerWidth<=1e3}function isDemoUser(e){return!(isChromeExtension()||isEdgeExtension())&&DEMO_USERS.indexOf(localStorage.id_usuario)>-1&&!(e&&"6"===tablonActual&&esTablonKanban()&&"0"===localStorage["columnaKanban"+e]||e&&isBugsIdeasUser()&&("0"===localStorage["columnaKanban"+e]||"1"===localStorage["columnaKanban"+e]))}function isBugsIdeasUser(){return!(isChromeExtension()||isEdgeExtension())&&BUG_IDEAS_USER===localStorage.id_usuario}function isKanbanBugsBoard(){return isDemoUser()&&"6"===tablonActual&&esTablonKanban()||isBugsIdeasUser()}if(function(e){e.fn.editInPlace=function(a){var o=e.extend({},e.fn.editInPlace.defaults,a);return function(e){if(e.url||e.callback)return;throw new Error("Need to set either url: or callback: option for the inline editor to work.")}(o),function(e){if(""===e)return;(new Image).src=e}(o.saving_image),this.each((function(){var a=e(this);a.data("editInPlace")||(a.data("editInPlace",!0),new t(o,a).init())}))},e.fn.editInPlace.defaults={url:"",bg_over:"#ffc",bg_out:"",hover_class:"",show_buttons:!1,save_button:'<button class="inplace_save">Save</button>',cancel_button:'<button class="inplace_cancel">Cancel</button>',params:"",field_type:"text",default_text:"(Click here to add text)",use_html:!1,textarea_rows:10,textarea_cols:25,select_text:"Choose new value",select_options:"",text_size:null,saving_text:void 0,saving_image:"",saving_animation_color:"transparent",value_required:!1,element_id:"element_id",update_value:"update_value",original_value:"original_value",original_html:"original_html",save_if_nothing_changed:!1,on_blur:"save",cancel:"",callback:null,callback_skip_dom_reset:!1,success:null,error:null,error_sink:function(e,t){alert(t)},preinit:null,postclose:null,delegate:null};function t(e,t){this.settings=e,this.dom=t,this.originalValue=null,this.didInsertDefaultText=!1,this.shouldDelayReinit=!1}function a(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function o(e){return null!=e&&0!==e.length}e.extend(t.prototype,{init:function(){this.setDefaultTextIfNeccessary(),this.connectOpeningEvents()},reinit:function(){this.shouldDelayReinit||(this.triggerCallback(this.settings.postclose,this.dom),this.triggerDelegateCall("didCloseEditInPlace"),this.markEditorAsInactive(),this.connectOpeningEvents())},setDefaultTextIfNeccessary:function(){""===this.dom.html()&&(this.dom.html(this.settings.default_text),this.didInsertDefaultText=!0)},connectOpeningEvents:function(){var t=this;this.dom.bind("mouseenter.editInPlace",(function(){t.addHoverEffect()})).bind("mouseleave.editInPlace",(function(){t.removeHoverEffect()})).bind("openEditor.editInPlace",(function(e){esTablonPapelera()&&!esPopup()||(t.openEditor(e),t.dblclick=!1)})).bind("dblclick.editInPlace",(function(a){if(isMobile())return!1;t.dblclick=!0;try{var o=parseInt(a.currentTarget.id.substr(5));esPopup()?t.scrollEditor=a.pageY+e("#postit"+o).scrollTop()-80:t.scrollEditor=a.pageY-e("#postit"+o).position().top+e("#texto"+o).scrollTop()-70,t.scrollEditor<200&&(t.scrollEditor=0)}catch(e){t.scrollEditor=0}t.openEditor(a),-1!=t.element.className.indexOf("classTransparent")&&(e(".classTransparent").each((function(){e(this).find(".pencilImg").click()})),e(".classTransparent").removeClass("classTransparent"))}))},disconnectOpeningEvents:function(){this.dom.unbind(".editInPlace")},addHoverEffect:function(){this.settings.hover_class?this.dom.addClass(this.settings.hover_class):this.dom.css("background-color",this.settings.bg_over)},removeHoverEffect:function(){this.settings.hover_class?this.dom.removeClass(this.settings.hover_class):this.dom.css("background-color",this.settings.bg_out)},openEditor:function(t){if((!esTablonPapelera()||esPopup())&&(localStorage.editandoTipo="",this.shouldOpenEditor(t))){var a=t.target;if(this.element=a,"tabLabel"!=a.className&&-1==a.className.indexOf("tabPaneles2")&&-1==a.className.indexOf("tabA")){for(esPopup()&&(this.medidasPopup=getPopupData(winId));a!=document&&-1==a.className.indexOf("postitNB");)a=a.parentNode;if(this.numPost=parseInt(a.id.substr(6)),isKanbanBugsBoard()&&"0"!==localStorage["columnaKanban"+this.numPost]&&"1"!==localStorage["columnaKanban"+this.numPost])return;if(this.tipo=localStorage["tipoA"+this.numPost],this.sinMarco=localStorage["sinMarco"+this.numPost],this.element=a,e(this.element).css("min-width",VALORES_POR_DEFECTO.MIN_WIDTH_EDITANDO_NOTA),!esPopup()&&!notaTieneZoom(this.numPost)){var o=parseInt(localStorage["width"+this.numPost]);o>260?e(this.element).width(o+90+"px"):e(this.element).width("450px")}esTablonKanban()&&e(this.element).css({"margin-left":0,"min-width":0,width:"100%"}).addClass("editing-post"),esPopup()||notaTieneZoom(this.numPost)||e(this.element).height("auto"),esPopup()||quitaMinimizado(this.numPost,!0),e(this.element).css("z-index","1000"),e("#texto"+this.numPost).html(localStorage["postit"+this.numPost]),document.getElementById("postit"+this.numPost).style.transform=""}if(this.settings.save_button='<div class="inplace_save btn waves-effect waves-light grey darken-1" title="CTRL+S">'+chrome.i18n.getMessage("aceptar")+"</div>",this.settings.cancel_button='<div class="inplace_cancel modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" title="CTRL+Q">'+chrome.i18n.getMessage("cancelar")+"</div>",this.disconnectOpeningEvents(),this.removeHoverEffect(),this.removeInsertedDefaultTextIfNeccessary(),this.saveOriginalValue(),this.markEditorAsActive(),-1==a.className.indexOf("tabLabel")&&-1==a.className.indexOf("tabPaneles2")&&-1==a.className.indexOf("tabA")){var n=this.numPost,i='<div class="selector-varios" id="selector'+this.numPost+'"><div class="sinMarcoDiv"><label class="sinMarcoCheckbox"><input type="checkbox" id="sinMarco'+n+'"/><span class="sinMarcoLabel">Sin Marco</span></label></div><img class="pinImgSelecEdit" src="appimg/pushpins/pushpin11.png"/><div class="selectorColor" id="selector'+this.numPost+'"><div id="idblanco'+n+'" class="idblanco2"></div><div id="idamarillo'+n+'" class="idamarillo2"></div><div id="idverde'+n+'" class="idverde2"></div><div id="idlila'+n+'" class="idlila2"></div><div id="idnaranja'+n+'" class="idnaranja2"></div><div id="idrosa'+n+'" class="idrosa2"></div><div id="idrojo'+n+'" class="idrojo2"></div><div id="idazul'+n+'" class="idazul2"></div><div id="idtransparente'+n+'" class="idtransparente2"></div><div id="notepad'+n+'" class="notepadBut"></div><div id="customColor'+n+'" class="customColor2"><svg width="24" height="24"><path d="M12 3a9 9 0 0 0 0 18 1.5 1.5 0 0 0 1.1-2.5c-.2-.3-.4-.6-.4-1 0-.8.7-1.5 1.5-1.5H16a5 5 0 0 0 5-5c0-4.4-4-8-9-8zm-5.5 9a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm3-4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm3 4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z" fill-rule="nonzero"></path></svg></div></div>',r='<div class="selectorPins">';localStorage["pushpin"+n]?r+='<img class="pinImgSelec" src="appimg/pushpins/pushpin'+localStorage["pushpin"+n]+'.png"/>':r+='<img class="pinImgSelec" src="appimg/pushpins/pushpin11.png"/>',r+='<img class="pinImgSelec" src="appimg/pushpins/pushpin11.png"/><img class="pinImgSelec" src="appimg/pushpins/pushpin21.png"/><img class="pinImgSelec" src="appimg/pushpins/pushpin31.png"/></div>',e("#postit"+n+" .bordesup").after(r),e("#postit"+n).find(".pinImgSelec").on("click",(function(e){clickImgSelec(e,n)})),esPopup()&&"true"==localStorage["sinMarco"+n]?(e(".parteSuperior").removeClass("parteSuperior2"),e("#parteSuperior"+this.numPost).after(i).height(30),e(".parteSuperior").css("visibility","visible"),e("#selectorColor"+this.numPost).css("margin-top","10px")):("true"!=localStorage["sinMarco"+n]&&localStorage["tipoA"+n]!=TIPO_NOTA.TRANSPARENTE||(e("#parteSuperior"+n).height(30),e("#fondoIconos"+n).hide()),e("#parteSuperior"+this.numPost).after(i)),esTablonKanban()&&e("#zoomImg"+this.numPost).hide(),isMobile()&&e("#parteSuperior"+this.numPost).hide(),e(".pinImgSelecEdit").attr("title",chrome.i18n.getMessage("selecPin")),e(".pinImgSelec:first-child").attr("title",chrome.i18n.getMessage("quitaPin")),e(".sinMarcoLabel").text(chrome.i18n.getMessage("sinMarco")),e("#idblanco"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.BLANCO,"postit"+n)})),e("#idamarillo"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.AMARILLO,"postit"+n)})),e("#idverde"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.VERDE,"postit"+n)})),e("#idlila"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.LILA,"postit"+n)})),e("#idnaranja"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.AMARILLO2,"postit"+n)})),e("#idrosa"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.ROSA,"postit"+n)})),e("#idrojo"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.ROJO,"postit"+n)})),e("#idazul"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.AZUL,"postit"+n)})),e("#idtransparente"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.TRANSPARENTE,"postit"+n)})),e("#notepad"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.LIBRETA,"postit"+n)})),e("#customColor"+this.numPost).css("background-color","#"+localStorage["tipoA"+n]),esPopup()||iniZoom(this.numPost),e(".customColor2").ColorPicker({color:"#"+localStorage["tipoA"+n],onSubmit:function(t,a,o,n){e(n).val(a),e(n).ColorPickerHide()},onBeforeShow:function(t,a,o,i){e(this).ColorPickerSetColor("#"+localStorage["tipoA"+n])},onChange:function(t,a,o,i){e("#customColor2").css("background-color","#"+a),cambioPostit(a,"postit"+n)}}).bind("keyup",(function(){e(this).ColorPickerSetColor(this.value)})),e("#sinMarco"+n).click((function(){localStorage["sinMarco"+n]=e("#sinMarco"+n).is(":checked"),e("#postit"+n).toggleClass("postitSinMarco"),e("#texto"+n).height("auto")})),"true"==localStorage["sinMarco"+n]?(e("#parteSuperior"+n).css("visibility","visible"),e("#sinMarco"+n).attr("checked",!0)):e("#sinMarco"+n).attr("checked",!1),e("#texto"+n).height("auto"),e("#pencilImg"+this.numPost).hide(),e("#postit"+n).attr("data-tipo",this.tipo),ponAlFrentePost(this.numPost);var s=this;esPopup()||(isSmallScreen()&&(e(this.element).css("min-width",0),"true"!=e("#postit"+this.numPost).attr("data-zoomed")&&zoomNota(null,this.numPost,!1,!0)),setTimeout((function(){isSmallScreen()||e("html, body").animate({scrollTop:e("#postit"+s.numPost).offset().top-100,scrollLeft:e("#postit"+s.numPost).offset().left-100},200,(function(){s.dblclick||muestraAyudaSnackbar("ayudaEditarNota")}))}),400))}this.replaceContentWithEditor()}},shouldOpenEditor:function(e){return!this.isClickedObjectCancelled(e.target)&&(!1!==this.triggerCallback(this.settings.preinit,this.dom)&&!1!==this.triggerDelegateCall("shouldOpenEditInPlace",!0,e))},removeInsertedDefaultTextIfNeccessary:function(){this.didInsertDefaultText&&this.dom.html()===this.settings.default_text&&(this.dom.html(""),this.didInsertDefaultText=!1)},isClickedObjectCancelled:function(t){return!!this.settings.cancel&&0!==e(t).parents().andSelf().filter(this.settings.cancel).length},saveOriginalValue:function(){this.settings.use_html?this.originalValue=this.dom.html():this.originalValue=a(this.dom.text())},restoreOriginalValue:function(){this.setClosedEditorContent(this.originalValue)},setClosedEditorContent:function(e){this.settings.use_html?this.dom.html(e):this.dom.text(e)},workAroundMissingBlurBug:function(){var e=this.dom.find(":input");this.dom.parents(":last").find(".editInPlace-active :input").not(e).blur()},replaceContentWithEditor:function(){var t=this.settings.show_buttons?this.settings.save_button+" "+this.settings.cancel_button:"",a=this.createEditorElement();if(this.dom.html('<form class="inplace_form" style="display: inline; margin: 0; padding: 0;"></form>').find("form").append(a).append(t),e(".inplace_field").css("background","transparent"),-1==this.element.className.indexOf("tabLabel")&&-1==this.element.className.indexOf("tabPaneles2")&&-1==this.element.className.indexOf("tabA")){crearEditor(this.numPost,function(){this.setInitialValue()}.bind(this));var o=this;setTimeout((function(){o.scrollEditor>0&&e("#postit"+o.numPost+" iframe").contents().find("html").animate({scrollTop:o.scrollEditor},300)}),400),this.continuaEditor()}else this.continuaEditor()},cambiaReabre:function(){console.log("cambia"),localStorage.reabriendoEditor="false"},continuaEditor:function(){this.workAroundMissingBlurBug(),this.connectClosingEventsToEditor(),this.triggerDelegateCall("didOpenEditInPlace")},createEditorElement:function(){if(-1===e.inArray(this.settings.field_type,["text","textarea","select"]))throw"Unknown field_type <fnord>, supported are 'text', 'textarea' and 'select'";var t=null;return"select"===this.settings.field_type?t=this.createSelectEditor():"text"===this.settings.field_type?t=e('<input type="text" '+this.inputNameAndClass()+' size="'+this.settings.text_size+'" />'):"textarea"===this.settings.field_type&&(t=e("<textarea "+this.inputNameAndClass()+' rows="'+this.settings.textarea_rows+'"  id="textAreaEdit'+this.numPost+'" cols="'+this.settings.textarea_cols+'" />')),t},setInitialValue:function(){var t=this.triggerDelegateCall("willOpenEditInPlace",this.originalValue),a=this.dom.find(":input");if(a.val(t),this.tipo,a.val()!==t&&a.val(""),-1==this.element.className.indexOf("tabLabel")&&-1==this.element.className.indexOf("tabPaneles2")&&-1==this.element.className.indexOf("tabA"))if(""!=localStorage["editando"+this.numPost]&&null!=localStorage["editando"+this.numPost]&&"undefined"!=localStorage["editando"+this.numPost]&&(t=localStorage["editando"+this.numPost],esPopup()||(e("html, body").animate({scrollTop:e(this.element).offset().top-150},200),e("html, body").animate({scrollLeft:e(this.element).offset().left-100},200))),null!=tinyMCE.get("textAreaEdit"+this.numPost)){tinyMCE.get("textAreaEdit"+this.numPost).setContent(t),tinyMCE.get("textAreaEdit"+this.numPost).focus(),cambiaAparenciaEditor(buscarTipo("postit"+this.numPost),"textAreaEdit"+this.numPost);var o=this;tinyMCE.get("textAreaEdit"+this.numPost).addShortcut("ctrl+q","",(function(){o.handleCancelEditor()}))}else{var n=this.numPost;o=this;intervalEd=setInterval((function(){console.log("voy haciendo en editor"),null!=tinyMCE.get("textAreaEdit"+n)&&(tinyMCE.get("textAreaEdit"+n).setContent(t),tinyMCE.get("textAreaEdit"+n).focus(),tinyMCE.get("textAreaEdit"+n).on("change",(function(e){localStorage["editando"+e.target.id.substr(12)]=e.level.content})),cambiaAparenciaEditor(buscarTipo("postit"+n),"textAreaEdit"+n),clearInterval(intervalEd),tinyMCE.get("textAreaEdit"+n).addShortcut("ctrl+q","",(function(){o.handleCancelEditor()})))}),50)}},inputNameAndClass:function(){return' name="inplace_value" class="inplace_field" '},createSelectEditor:function(){var t=e("<select"+this.inputNameAndClass()+'><option disabled="true" value="">'+this.settings.select_text+"</option></select>"),o=this.settings.select_options;e.isArray(o)||(o=o.split(","));for(var n=0;n<o.length;n++){var i=o[n];e.isArray(i)||(i=i.split(":"));var r=a(i[1]||i[0]),s=a(i[0]),l=e("<option>").val(r).text(s);t.append(l)}return t},connectClosingEventsToEditor:function(){var e=this;function t(t){return e.handleCancelEditor(t),!1}function a(t){return e.handleSaveEditor(t),!1}var o=this.dom.find("form");o.find(".inplace_field").focus().select(),o.find(".inplace_cancel").click(t),o.find(".inplace_save").click(a),this.settings.show_buttons||("save"===this.settings.on_blur?o.find(".inplace_field").blur(a):o.find(".inplace_field").blur(t)),o.keyup((function(e){if(27===e.which)return t()})),o.submit(a)},bindSubmitOnEnterInInput:function(){if("textarea"!==this.settings.field_type){var e=this;this.dom.find(":input").keyup((function(t){if(13===t.which)return e.dom.find("form").submit()}))}},handleCancelEditor:function(t){if(!1!==this.triggerDelegateCall("shouldCloseEditInPlace",!0,t)){if(-1==this.element.className.indexOf("tabLabel")&&-1==this.element.className.indexOf("tabPaneles2")&&-1==this.element.className.indexOf("tabA")){var a=tinyMCE.get("textAreaEdit"+this.numPost).getContent();a=this.triggerDelegateCall("willCloseEditInPlace",a),tinyMCE.get("textAreaEdit"+this.numPost).editorContainer.className.indexOf("mce-fullscreen")>-1&&tinyMCE.get("textAreaEdit"+this.numPost).execCommand("mceFullScreen"),tinyMCE.get("textAreaEdit"+this.numPost).ficherosSubidos&&borrarFicherosSubidos(tinyMCE.get("textAreaEdit"+this.numPost).ficherosSubidos,!0),tinyMCE.get("textAreaEdit"+this.numPost).remove(),localStorage["editando"+this.numPost]="",localStorage.editandoTipo="",quitaZoom(this.numPost),esPopup()||(refrescaNota(this.numPost),refrescaOrdenacion(2500))}else a=this.dom.find(":input").val();this.reinit(),esPopup()&&"true"==localStorage["sinMarco"+this.numPost]&&e(".parteSuperior").addClass("parteSuperior2"),esPopup()?notaWeb()?(nuevaNota()&&(localStorage.removeItem("postit"+this.numPost),localStorage.removeItem("tablon"+this.numPost),localStorage.removeItem("tipoA"+this.numPost),localStorage.removeItem("X"+this.numPost),localStorage.removeItem("Y"+this.numPost),localStorage.removeItem("width"+this.numPost),localStorage.removeItem("height"+this.numPost),localStorage.removeItem("treeId"+this.numPost),localStorage.removeItem("fecha"+this.numPost),localStorage.removeItem("updated"+this.numPost),localStorage.removeItem("calendar"+this.numPost),localStorage.removeItem("sinMarco"+this.numPost),localStorage.removeItem("userComp"+this.numPost),localStorage.removeItem("nickComp"+this.numPost),localStorage.removeItem("errorConexion"+this.numPost),localStorage.removeItem("rotacion"+this.numPost),localStorage.removeItem("pushpin"+this.numPost),localStorage.removeItem("notaWeb"+this.numPost)),chrome.runtime.sendMessage({cierraVentana:winId})):(resizeWindow(winId,this.medidasPopup.width,this.medidasPopup.height),window.moveTo(this.medidasPopup.X,this.medidasPopup.Y),e("#postit"+this.numPost).remove(),notaWeb()||muestraPostit(this.numPost),e(".postitPop").css("width","100%")):"true"==localStorage["sinMarco"+this.numPost]&&(e("#bordesup"+this.numPost).height(0),e("#parteSuperior"+this.numPost).height(0),e("#fondoIconos"+this.numPost).show(),e("#fondoIconos"+this.numPost).css("position","absolute")),ordenaPostitsKanban(),hightlightCode(),sendRealTime(this.numPost),restoreBoardZoom()}},handleSaveEditor:function(t){if(!1!==this.triggerDelegateCall("shouldCloseEditInPlace",!0,t)){if(-1==this.element.className.indexOf("tabLabel")&&-1==this.element.className.indexOf("tabPaneles2")&&-1==this.element.className.indexOf("tabA")){esPopup()||muestraAyudaSnackbar("dobleClickGuardar"),e("#texto"+this.numPost).height()>1600&&(e(this.element).scrollTop(0),e(this.element).css("overflow","hidden"));var a=tinyMCE.get("textAreaEdit"+this.numPost).getContent();localStorage["editando"+this.numPost]="",localStorage["tipoA"+this.numPost]=this.tipo,a=this.triggerDelegateCall("willCloseEditInPlace",a);try{tinyMCE.get("textAreaEdit"+this.numPost).remove()}catch(e){console.log(e)}}else a=this.dom.find(":input").val();var o=e("#urlAssign").is(":checked");if(this.settings.callback?this.handleSubmitToCallback(a):this.handleSubmitToServer(a),-1==this.element.className.indexOf("tabLabel")&&-1==this.element.className.indexOf("tabPaneles2")&&-1==this.element.className.indexOf("tabA")&&(e(this.element).width(localStorage["width"+this.numPost]+"px"),e(this.element).css("min-width",VALORES_POR_DEFECTO.MIN_WIDTH_NOTA),e(this.element).height("auto"),!tieneNotaAlturaAuto(this.numPost)&&e("#postit"+this.numPost).height()+30<parseInt(localStorage["height"+this.numPost])&&(localStorage["height"+this.numPost]=e("#postit"+this.numPost).height()),e("#selector"+this.numPost).remove(),localStorage["editando"+this.numPost]=""),this.markEditorAsInactive(),esPopup()&&"true"==localStorage["sinMarco"+this.numPost]?e(".parteSuperior").addClass("parteSuperior2"):"true"==localStorage["sinMarco"+this.numPost]&&(e("#bordesup"+this.numPost).height(0),e("#parteSuperior"+this.numPost).height(0),e("#fondoIconos"+this.numPost).show(),e("#fondoIconos"+this.numPost).css("position","absolute")),esPopup())if(notaWeb()){if(nuevaNota()){var n={postit:a,tipoA:localStorage["tipoA"+this.numPost],numPost:this.numPost,url:o?getHostFromUrl(paramUrl())+"*":paramUrl(),tabId:paramTabId()};chrome.runtime.sendMessage({creaNotaNuevaWeb:n})}else{var i={numPost:this.numPost,url:o?getHostFromUrl(paramUrl())+"*":paramUrl()};chrome.runtime.sendMessage({cambiaNota:i})}chrome.runtime.sendMessage({cierraVentana:winId})}else resizeWindow(winId,this.medidasPopup.width,this.medidasPopup.height),window.moveTo(this.medidasPopup.X,this.medidasPopup.Y);hightlightCode(),restoreBoardZoom()}},didForgetRequiredText:function(e){return this.settings.value_required&&(""===e||null==e)},isDisabledDefaultSelectChoice:function(){return this.dom.find("option").eq(0).is(":selected:disabled")},isUnchangedInput:function(e){return!this.settings.save_if_nothing_changed&&this.originalValue===e},showSaving:function(t){if(!this.settings.callback||!this.settings.callback_skip_dom_reset){var a=t;o(this.settings.saving_text)&&(a=this.settings.saving_text),o(this.settings.saving_image)&&(a=e("<img />").attr("src",this.settings.saving_image).attr("alt",a)),this.dom.html(a)}},handleSubmitToCallback:function(e){this.enableOrDisableAnimationCallbacks(!0,!1);var t=this.triggerCallback(this.settings.callback,this.id(),e,this.originalValue,this.settings.params,this.savingAnimationCallbacks());this.settings.callback_skip_dom_reset||(void 0===t?(this.reportError("Error: Failed to save value: "+e),this.restoreOriginalValue()):this.dom.html(t)),this.didCallNoCallbacks()&&(this.enableOrDisableAnimationCallbacks(!1,!1),this.reinit())},handleSubmitToServer:function(t){var a=this.settings.update_value+"="+encodeURIComponent(t)+"&"+this.settings.element_id+"="+this.dom.attr("id")+(this.settings.params?"&"+this.settings.params:"")+"&"+this.settings.original_html+"="+encodeURIComponent(this.originalValue)+"&"+this.settings.original_value+"="+encodeURIComponent(this.originalValue);this.enableOrDisableAnimationCallbacks(!0,!1),this.didStartSaving();var o=this;e.ajax({url:o.settings.url,type:"POST",data:a,dataType:"html",complete:function(e){o.didEndSaving()},success:function(e){var t=e||o.settings.default_text;o.dom.html(t),o.triggerCallback(o.settings.success,e)},error:function(e){o.dom.html(o.originalHTML),o.settings.error?o.triggerCallback(o.settings.error,e):o.reportError("Failed to save value: "+e.responseText||"Unspecified Error")}})},triggerCallback:function(e){if(e){var t=Array.prototype.slice.call(arguments,1);return e.apply(this.dom[0],t)}},triggerDelegateCall:function(t,a,o){if(!this.settings.delegate||!e.isFunction(this.settings.delegate[t]))return a;var n=this.settings.delegate[t](this.dom,this.settings,o);return void 0===n?a:n},reportError:function(e){this.triggerCallback(this.settings.error_sink,this.id(),e)},id:function(){return this.dom.attr("id")},markEditorAsActive:function(){this.dom.addClass("editInPlace-active")},markEditorAsInactive:function(){this.dom.removeClass("editInPlace-active")},savingAnimationCallbacks:function(){var e=this;return{didStartSaving:function(){e.didStartSaving()},didEndSaving:function(){e.didEndSaving()}}},enableOrDisableAnimationCallbacks:function(e,t){this.didStartSaving.enabled=e,this.didEndSaving.enabled=t},didCallNoCallbacks:function(){return this.didStartSaving.enabled&&!this.didEndSaving.enabled},assertCanCall:function(e){if(!this[e].enabled)throw new Error("Cannot call "+e+" now. See documentation for details.")},didStartSaving:function(){this.assertCanCall("didStartSaving"),this.shouldDelayReinit=!0,this.enableOrDisableAnimationCallbacks(!1,!0),this.startSavingAnimation()},didEndSaving:function(){this.assertCanCall("didEndSaving"),this.shouldDelayReinit=!1,this.enableOrDisableAnimationCallbacks(!1,!1),this.reinit(),this.stopSavingAnimation()},startSavingAnimation:function(){var e=this;this.dom.animate({backgroundColor:this.settings.saving_animation_color},400).animate({backgroundColor:"transparent"},400,"swing",(function(){setTimeout((function(){e.startSavingAnimation()}),10)}))},stopSavingAnimation:function(){this.dom.stop(!0).css({backgroundColor:""})},missingCommaErrorPreventer:""})}(jQuery),!isChromeExtension()){var chrome=chrome||{};chrome.permissions={},chrome.permissions.request=function(e,t){console.log(e),t&&t(!0)},chrome.permissions.contains=function(e,t){console.log(e),t&&t(!0)},chrome.i18n={},chrome.i18n.getMessage=function(e){return getMessage(e)},chrome.runtime={onMessage:{addListener:function(e){window.addEventListener("storage",(function(t){if("eventMessage"==t.key)try{console.log(localStorage.eventMessage),e(JSON.parse(localStorage.eventMessage))}catch(e){console.log(e)}}),!1),document.addEventListener("NoteBoardMessage",(t=>{e(t.detail)}))}},sendMessage:function(e){e={...e,noCache:(new Date).getTime()},localStorage.setItem("eventMessage",JSON.stringify(e)),document.dispatchEvent(new CustomEvent("NoteBoardMessage",{detail:{...e}}))},getURL:e=>(!isChromeExtension()&&e.indexOf("popup2.html")>-1&&(e=e.replace(".html",".php")),e),setUninstallURL:()=>{}},chrome.action={setBadgeText:()=>{},setTitle:()=>{},onClicked:{addListener:()=>{}}},chrome.windows={getAll:function(e){},onRemoved:{addListener:e=>{$(window).on("unload",(function(){e()}))}},create:function(e,t){var a=`toolbar=yes,scrollbars=yes,resizable=yes,top=${e.top},left=${e.left},width=${e.width},height=${e.height}`;window.open(e.url,"_blank",a).onload=t},update:(e,{width:t,height:a})=>{console.log(e),console.log(t),console.log(a)},getCurrent:()=>{}},chrome.tabs={create:function(e){window.open(e.url,"_blank")},onUpdated:{addListener:()=>{}},onRemoved:{addListener:()=>{}},onCreated:{addListener:()=>{}}},chrome.alarms={create:()=>{},onAlarm:{addListener:()=>{}}},chrome.extension={getBackgroundPage:function(){return{asignaNumeroTablon:asignaNumeroTablon,errorConexion:errorConexion,empiezaSincroPeriodica:empiezaSincroPeriodica,cierraPopup:cierraPopup,irAnotaPopup:irAnotaPopup}}},chrome.commands={onCommand:{addListener:()=>{}}},chrome.contextMenus={removeAll:()=>{},onClicked:{addListener:()=>{}}},getLocalStorage=async function(){return new Promise((e=>{e()}))},setAllLocalStorage=async function(){return new Promise((e=>{e()}))},setLocalStorage=async function(){return new Promise((e=>{e()}))}}function getServerUrl(){return isChromeExtension()?"https:/www.noteboardapp.com/":""}function isMovilApp(){return!1}const VALORES_POR_DEFECTO={BOARD_HEIGTH:2e3,TEMA:"colorGris",FONDO:"50",TABLONACTUAL:"1",FUENTE:"6",FONT_SIZE:"15px",MIN_WIDTH_NOTA:"270px",MIN_WIDTH_EDITANDO_NOTA:"590px",DIR_IMAGENES:"appimg/",NUEVA_NOTA:"nuevopost",KANBAN_HEIGHT:600},WEBNOTES_BOARD=-999,TIPO_NOTA={TABLONES:"9",BLANCO:"10",AMARILLO:"1",VERDE:"2",LILA:"3",AMARILLO2:"4",ROSA:"5",ROJO:"6",AZUL:"7",TRANSPARENTE:"8",LIBRETA:"80"},TIPOS_NOTAS_RANDOM=[TIPO_NOTA.BLANCO,TIPO_NOTA.AMARILLO,TIPO_NOTA.VERDE,TIPO_NOTA.LILA,TIPO_NOTA.AMARILLO2,TIPO_NOTA.ROSA,TIPO_NOTA.ROJO,TIPO_NOTA.AZUL],CALIDAD_CAPTURAS_PANTALLA={local:20,logged:70},NOTAS_MINIMIZADAS={height:50,width:200},TOP_BAR={NONE:"none",BUTTONS_UP:"buttons_up",BUTTONS_DOWN:"buttons_down",BOARDS:"boards"},DEMO_USERS=["4156","412833","214973","615023"],BUG_IDEAS_USER="615023",GOOGLE_CLIENT_ID_EDGE_DEV="409932428860-ccanb86ttarambra11kvigdd09m8e0i2.apps.googleusercontent.com",GOOGLE_CLIENT_ID_EDGE_PRO="409932428860-s4cdpc3b4dli4jhekvlv6knb71e6araa.apps.googleusercontent.com",GOOGLE_CLIENT_ID_CHROME_PRO="409932428860-5a35icpm6o2quue6r60a91rac5oqmqc8.apps.googleusercontent.com",EDGE_ID_DEV="bjandjchhgibkhdhbfkpoccciebajadj",EDGE_ID_PRO="ehnmbncdeiinoaojbfjldmghkhjhlkli",CHROME_ID_PRO="goficmpcgcnombioohjcgdhbaloknabb",MAX_CHROME_LOCAL_STORAGE_SIZE=524e4,CANVAS_WIDTH={mini:80,normal:125},fondosTablones=[{id:"50",color:"#ececec",className:"fondo50",visible:!0},{id:"0",imagen:"corcho.jpg",className:!1,color:!1,visible:!0},{id:"51",imagen:"patterns/pat15.jpg",visible:!0},{id:"1",imagen:"corcho3.jpg",visible:!0},{id:"2",imagen:"corcho4.jpg",visible:!1},{id:"29",imagen:"patterns/pat7.png",visible:!0},{id:"3",imagen:"cemento.jpg",visible:!1},{id:"24",imagen:"patterns/pat2.png",visible:!0},{id:"41",imagen:"fondos/shattered-island.gif",visible:!0},{id:"6",imagen:"ladrillos.jpg",visible:!1},{id:"7",imagen:"carton.jpg",visible:!0},{id:"9",imagen:"cuero2.jpg",visible:!1},{id:"10",imagen:"malla.jpg",visible:!1},{id:"11",imagen:"cuero.jpg",visible:!1},{id:"12",imagen:"fondoS1.jpg",visible:!1},{id:"13",imagen:"hixs_pattern_evolution.png",visible:!1},{id:"14",color:"#6C8136",className:"fondo14",visible:!1},{id:"15",color:"#1a1a1a",className:"fondo15",visible:!1},{id:"16",color:"#C80000",className:"fondo16",visible:!1},{id:"17",color:"#961C1C",className:"fondo17",visible:!1},{id:"18",color:"#b03",className:"fondo18",visible:!1},{id:"19",color:"#fff",className:"fondo19",visible:!1},{id:"21",imagen:"patterns/vintage-concrete.png",visible:!0},{id:"22",imagen:"flores.jpg",visible:!0},{id:"27",imagen:"patterns/pat5.png",visible:!1},{id:"30",imagen:"patterns/pat8.png",visible:!0},{id:"31",imagen:"patterns/pat9.png",visible:!0},{id:"34",imagen:"patterns/pat12.png",visible:!0},{id:"37",color:"#ededee",className:"fondo37",visible:!0},{id:"4",imagen:"madera.jpg",visible:!0},{id:"33",imagen:"patterns/pat11.png",visible:!0},{id:"35",imagen:"patterns/pat13.png",visible:!0},{id:"5",imagen:"purty_wood.png",visible:!0},{id:"26",imagen:"patterns/pat4.png",visible:!0},{id:"38",imagen:"fondos/alchemy.gif",visible:!0},{id:"40",imagen:"fondos/science.png",visible:!0},{id:"42",imagen:"patterns/intersection.png",visible:!0},{id:"44",imagen:"patterns/doodles.png",visible:!0},{id:"46",imagen:"patterns/playstation-pattern.png",visible:!0},{id:"47",imagen:"patterns/random_grey_variations.png",visible:!0},{id:"48",imagen:"fondos/motherboard.jpg",visible:!0},{id:"23",imagen:"manutsi.jpg",visible:!0},{id:"49",imagen:"fondos/matrix.jpg",visible:!0},{id:"100",imagen:"rejilla.jpg",visible:!0},{id:"20",imagen:"papelArrugado.jpg",visible:!0},{id:"8",imagen:"fuego.jpg",visible:!0},{id:"52",imagen:"fondos/colorBrick.jpg",visible:!0},{id:"53",imagen:"fondos/pexels.jpg",visible:!0},{id:"54",imagen:"fondos/abstract.jpg",visible:!0},{id:"55",imagen:"fondos/pintura.jpg",visible:!0}];function HayEspacios(e){return e.indexOf(" ")>-1}function cambiaContador(){var e=0;switch(null!=localStorage.contador&&"undefined"!=localStorage.contador||(localStorage.contador="1"),localStorage.contador){case"1":for(i=0;i<localStorage.totalPost;i++)(null!=localStorage["tablon"+i]&&"undefined"!=localStorage["tablon"+i]||1!=tablonActual)&&localStorage["tablon"+i]!=tablonActual||e++;break;case"2":e=localStorage.totalPost;break;case"3":e=0}e>0?chrome.action.setBadgeText({text:String(e)}):chrome.action.setBadgeText({text:""}),actualizaNombreTablon(tablonActual)}function refrescaNota(e){if(!esBackground())if(esPopup())$(".selector-varios").remove(),$(".textoNB").html(localStorage["postit"+e]);else{var t=$("#postit"+e).index();$("#postit"+e).remove(),muestraPostit(e,t),esTablonKanban()&&refrescaKanban(),refreshConnections(),hightlightCode()}}function muestraTodasLasNotas(){for(var e=localStorage.totalPost-1;e>=0;e--)muestraPostit(e);hazKanbanSortable(),refreshConnections(),hightlightCode()}function refrescaPantalla(e,t,a){if(!esBackground()&&!esPopup()){quitaZoomNotas(),e||muestraPaneles2(!1,!1),$(".sharePanel").remove(),t?$(".postitNB:not(#postitnuevo)").remove():$(".postitNB:not(#postitnuevo)").each((function(){var e=$(this).attr("data-numpost");parseInt(e)>=parseInt(localStorage.totalPost)&&$(this).remove()})),esTablonKanban()?inicializaKanban():borraKanban();for(var o=localStorage.totalPost-1;o>=0;o--)!t&&localStorage["editando"+o]&&e&&tinyMCE.get("textAreaEdit"+o)&&tinyMCE.get("textAreaEdit"+o).remove(),localStorage["editando"+o]&&!e||a&&$("#texto"+o).html()==localStorage["postit"+o]||($("#postit"+o).remove(),muestraPostit(o));esTabCompartido(tablonActual)?trataTablonComp():inicializaFriendsBot(),hazKanbanSortable(),refrescaKanban(),refrescaOrdenacion(),deslizaPostVisibles(null,!0),detectColorContrastBackground().then((()=>{refreshConnections(),$(".columna").css("borderColor",defaultColorContrastBackground)})),null==localStorage["fondo"+tablonActual]||"NaN"==localStorage["fondo"+tablonActual]||cambioTablon.sliding||cambiaFondoNum(localStorage["fondo"+tablonActual]),$(".ajaxloader").remove(),$("#Postits").imagesLoaded((function(){cambiaIcono()})),hightlightCode(),!e&&compruebaLimites(),cambiaIcono(),cambiaContador()}}function deslizaPostVisibles(e,t){var a=$(".paneles2").innerHeight()>10&&$(".paneles2").innerHeight()||$(".botones").innerHeight()||localStorage.previousHeight;a>10?localStorage.previousHeight=a:a=localStorage.previousHeight;var o=esTablonKanban()?30:0;if("down"==e)var n="+="+a+"px";else n="-="+a+"px";if(t){var i=parseInt($(".paneles2").innerHeight()+$(".titulo-kanban").height()+70+o)+"px";$("#canvasDiv").css("top",i)}else if($("#canvasDiv").animate({top:n}),esTablonKanban())$(".columna-wrapper").animate({"padding-top":n},(function(){$(".columna").height(window.innerHeight-$(".botones").height()-$(".titulo-kanban").height()-30)}));else for(var r=0;r<localStorage.totalPost;r++)(null!=localStorage["tablon"+r]&&"undefined"!=localStorage["tablon"+r]||1!=tablonActual)&&localStorage["tablon"+r]!=tablonActual||$("#postit"+r).animate({top:n});isSmallScreen()&&(compruebaCanvasPosEnMovil(500),compruebaCanvasPosEnMovil(2e3))}function muestraVotar(){if(isChromeExtension()){var e=isEdgeExtension()?"escribeReviewEdge":"escribeReview";"false"!=localStorage[e]&&sweetAlert({type:"info",text:chrome.i18n.getMessage(e),confirmText:chrome.i18n.getMessage("noMostrarMas"),cancel:!0,cancelText:chrome.i18n.getMessage("votar"),successCallback:function(){localStorage[e]="false"},cancelCallback:function(){isEdgeExtension()?window.open("https://microsoftedge.microsoft.com/addons/detail/note-board-sticky-notes/ehnmbncdeiinoaojbfjldmghkhjhlkli","_newtab"):window.open("https://chrome.google.com/webstore/detail/note-board/goficmpcgcnombioohjcgdhbaloknabb/reviews","_newtab")}})}}function pidePermiso(e,t){sweetAlert({text:chrome.i18n.getMessage(e),successCallback:function(){permisoOrigenes(t)}})}function permisoOrigenes(e){chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(function(t){t?(e&&creaFondo(),console.log("concedido")):console.log("no concedido")}))}function pidePermisoImagenes(e,t,a){"false"!=localStorage[e]&&sweetAlert({text:chrome.i18n.getMessage(e),successCallback:function(){permisoOrigenesImagenes(t,a)}})}function permisoOrigenesImagenes(e,t){chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(function(a){a?(abreFormularioAnexa(e,t),console.log("concedido")):console.log("no concedido")}))}function sendMessage(e){chrome.runtime.sendMessage(e)}function listenMessage(e,t){chrome.runtime.onMessage.addListener((function(a,o){for(var n in a)n==e&&t(a,o)}))}function formateaFecha(e){var t="",a=("0"+e.getFullYear()).slice(-2),o=("0"+parseInt(e.getMonth()+1)).slice(-2),n=("0"+e.getDate()).slice(-2);return t=idiomaEsp(navigator.language)?n+"-"+o+"-"+a:o+"-"+n+"-"+a,t+=" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}function idiomaEsp(e){return"es"==navigator.language||"ca"==navigator.language||"es-419"==navigator.language||"es-ES"==navigator.language}function buscarText(e){var t=new Array,a=document.createElement("div"),o=0;if(0!=e.indexOf(">")&&0!=e.indexOf("<")||(o=parseInt(e.substr(1))),o)for(var n=0==e.indexOf(">"),i=0;i<localStorage.totalPost;i++)"0"!=localStorage["tablon"+i]&&(n&&difFechas(localStorage["fecha"+i])>o&&t.push(i),!n&&difFechas(localStorage["fecha"+i])<o&&t.push(i));else for(i=0;i<localStorage.totalPost;i++){a.innerHTML=localStorage["postit"+i],a.innerText.toLowerCase().indexOf(e.toLowerCase())>-1&&t.push(i)}return t}function ponAlFrente(e,t){if(-1==e.target.className.indexOf("mce_")&&-1==e.target.className.indexOf("inplace")&&"calendar"!=e.target.className){var a=maxZindex();$("#postit"+t).css("z-index",a+1)}}function ponAlFrentePost(e){var t=maxZindex();$("#postit"+e).css("z-index",t+1)}function maxZindex(e=""){var t=10;return $(".postitNB:not(#postit"+e+")").each((function(e){var a=$(this);"postitnuevo"!=a.attr("id")&&"auto"!=a.css("z-index")&&t<parseInt(a.css("z-index"))&&(t=parseInt(a.css("z-index")))})),t}function colorLuminance(e,t){(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var a,o,n="#";for(o=0;o<3;o++)a=parseInt(e.substr(2*o,2),16),n+=("00"+(a=Math.round(Math.min(Math.max(0,a+a*t),255)).toString(16))).substr(a.length);return n}function esColorOscuro(e){return"white"===getContrastYIQ(e)}function getContrastYIQ(e){return(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3>=65?"black":"white"}function youtube_parser(e){var t=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);if(t&&11==t[7].length)return t[7];console.log("Url incorrecta")}function pausecomp(e){var t=new Date,a=null;do{a=new Date}while(a-t<e)}function validaURL(e){return/https?:\/\/(www\.)?[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi.test(e)}var imgs=new Array;function preloadImages(e){e=e||tablonActual;for(var t=0;t<localStorage.totalPost;t++)if(esNotaVisibleEnTablon(t,e)){imgs[t]=void 0;var a=document.createElement("DIV");a.innerHTML=localStorage["postit"+t];var o=a.querySelectorAll("img:not(.link-upload-img)");if(o.length>0&&(imgs[t]=new Image,imgs[t].src=o[0].src),localStorage["postit"+t]&&localStorage["postit"+t].indexOf('src="http://www.youtube.com/embed')>-1){var n=localStorage["postit"+t].indexOf('src="http://www.youtube.com')+5,i=localStorage["postit"+t].indexOf('"',n),r=localStorage["postit"+t].substring(n,i);imgs[t]=new Image,imgs[t].src="http://img.youtube.com/vi/"+youtube_parser(r)+"/0.jpg"}}}function closePaneles(e){"paneles"!=e&&($(".paneles").fadeOut(),$("#panelBotDiv").css({"box-shadow":"0 0 0px black inset"})),"searchPanel"!=e&&($(".searchPanel").fadeOut(),$("#searchBot").css({"box-shadow":"0 0 0px black inset"})),"fondos"!=e&&($(".fondos").fadeOut(),$("#cambFondo").css({"box-shadow":"0 0 0px black inset"})),"nicksComp"!=e&&($(".nicksComp").fadeOut(),$("#compBot").css({"box-shadow":"0 0 0px black inset"})),"panelFuentes"!=e&&($(".panelFuentes").fadeOut(),$("#cambF").css({"box-shadow":"0 0 0px black inset"}))}function mirarSiCerrar(e){$(".searchPanel").is(":visible")&&-1==numPostSearch&&0==$(e).closest(".searchPanel").length&&($(".searchPanel").fadeOut(),$("#searchBot").css({"box-shadow":"0 0 0px black inset"}),$(".searchResult").remove()),$(".fondos").is(":visible")&&0==$(e).closest(".fondos").length&&($(".fondos").fadeOut(),$("#cambFondo").css({"box-shadow":"0 0 0px black inset"})),$(".nicksComp").is(":visible")&&0==$(e).closest(".nicksComp").length&&($(".nicksComp").fadeOut(),$("#compBot").css({"box-shadow":"0 0 0px black inset"})),$(".panelFuentes").is(":visible")&&0==$(e).closest(".panelFuentes").length&&($(".panelFuentes").fadeOut(),$("#cambF").css({"box-shadow":"0 0 0px black inset"}))}function algunoPublico(){for(var e=1;e<=localStorage.numTablones;e++)if("true"==localStorage["publico"+e])return!0;return!1}function nombreTablon(e=tablonActual){return-999==e?chrome.i18n.getMessage("tablonWeb"):0==e?chrome.i18n.getMessage("papelera"):(null!=localStorage["tab"+e+"Label"]&&"undefined"!=localStorage["tab"+e+"Label"]&&""!=localStorage["tab"+e+"Label"]||(localStorage["tab"+e+"Label"]=chrome.i18n.getMessage("tablon")+e),localStorage["tab"+e+"Label"])}function ordenTablon(e){return null!=localStorage["ordenTablon"+e]&&"undefined"!=localStorage["ordenTablon"+e]?localStorage["ordenTablon"+e]:e}function wrapText(e,t){var a,o=new RegExp(t.replace(/[\\^$*+.?[\]{}()|]/,"\\$&"),"i"),n=[];e.normalize();for(var i=e.firstChild;null!=i;){if(i.nodeType==Node.TEXT_NODE){a="string"==typeof i.textContent?i.textContent:i.innerText;var r=o.exec(a);if(null!=r){var s=document.createDocumentFragment();r.index>0&&s.appendChild(document.createTextNode(r.input.substr(0,r.index)));var l=document.createElement("span");l.className="spanNoteBoard",l.appendChild(document.createTextNode(r[0])),s.appendChild(l),r.index+r[0].length<r.input.length&&s.appendChild(document.createTextNode(r.input.substr(r.index+r[0].length))),i.parentNode.replaceChild(s,i),i=l}}else if(i.nodeType==Node.ELEMENT_NODE&&null!=i.firstChild){n.push(i),i=i.firstChild;continue}for(;null!=i&&null==i.nextSibling;)i=n.pop();null!=i&&(i=i.nextSibling)}}function isValidDate(e){return e&&"undefined"!==e}function difFechas(e,t,a){if(!isValidDate(e)||t&&!isValidDate(t))return 0;try{if(e.indexOf("/")&&(e=e.replace(/\//g,"-")),1==e.indexOf("-")&&(e="0"+e),4==e.indexOf("-",3)&&(e=e.substr(0,3)+"0"+e.substr(3)),2==e.indexOf("-")){var o=e;e=idiomaEsp(navigator.language)?e.substr(6)+"-"+e.substr(3,2)+"-"+e.substr(0,2):e.substr(6)+"-"+e.substr(0,2)+"-"+e.substr(3,2)}a=a||"days";var n=36e5,i=24*n;e=new Date(e);var r=(t=t?new Date(t):new Date)-e;if(isNaN(r)){e=idiomaEsp(navigator.language)?o.substr(6)+"-"+o.substr(0,2)+"-"+o.substr(3,2):o.substr(6)+"-"+o.substr(3,2)+"-"+o.substr(0,2);r=t-(e=new Date(e))}if(isNaN(r))return NaN;switch(a){case"years":return t.getFullYear()-e.getFullYear();case"months":return 12*t.getFullYear()+t.getMonth()-(12*e.getFullYear()+e.getMonth());case"weeks":return Math.floor(r/6048e5);case"days":return Math.floor(r/i);case"hours":return Math.floor(r/n);case"minutes":return Math.floor(r/6e4);case"seconds":return Math.floor(r/1e3);default:return}}catch(e){return console.log(e),0}}function clickImgSelecEdit(e){$(this).parent().parent().find(".selectorPins").slideToggle();var t=$(this).parent().parent().find(".subSelectorPins");t.length>0&&t.is(":visible")&&t.slideUp()}function clickImgSelec(e,t){if(t>=0){var a=$("#postit"+t);$this=$(e.target)}else{a=$("#postitnuevo");$this=$(this)}var o=a.find(".pinImgSelec").index(e.target),n=$this.closest(".selectorPins").parent().find(".subSelectorPins");if(0==o&&a.find(".pinImg").remove(),0==o||$this.closest(".selectorPins").parent().find(".tipoPins"+o).length>0)n.slideUp((function(){$(this).remove()}));else{n.slideUp((function(){$(this).remove()}));for(var i='<div class="subSelectorPins tipoPins'+o+'" data-tipopin="'+o+'" data-postit="'+a.attr("id")+'">',r=1;r<=7;r++)i+='<img class="subPinImgSelec" src="appimg/pushpins/pushpin'+o+r+'.png">';i+="</div>",$this.closest(".selectorPins").after(i),$this.closest(".selectorPins").parent().find(".subSelectorPins").slideDown(),$(".subPinImgSelec").on("click",subClickImgSelec)}}function subClickImgSelec(e){var t=$(this).closest(".subSelectorPins").data("tipopin"),a=$(this).closest(".subSelectorPins").data("postit"),o=$("#"+a).find(".subPinImgSelec").index(e.target)+1;$("#"+a+" .pinImg").remove(),o>0&&$("#"+a).append('<img class="pinImg" data-pushpin="'+t+o+'" src="appimg/pushpins/pushpin'+t+o+'.png" />'),$(this).parent().parent().find(".pinImgSelec:first-child").attr("src","appimg/pushpins/pushpin"+t+o+".png")}function esTablonNotasWeb(e=tablonActual){return-999==e}function esTablonPapelera(e=tablonActual){return 0==e}function salSiPapelera(){return!!esTablonPapelera()&&(sweetAlert({type:"error",text:chrome.i18n.getMessage("salSiPapelera"),cancel:!1}),!0)}function inicializaPapelera(){esTablonPapelera()?($("#papelera").css({"box-shadow":"0 0 50px black inset"}),$("#botonVaciarPapelera").show()):($("#papelera").css({"box-shadow":"0 0 0px black inset"}),$("#botonVaciarPapelera").hide());for(var e=0;e<localStorage.totalPost;e++)if("0"==localStorage["tablon"+e])return void $("#papelera").find("img").attr("src","appimg/papeleraLlena.png");$("#papelera").find("img").attr("src","appimg/papelera.png"),$("#botonVaciarPapelera").hide()}function vaciarPapelera(e,t){if(t)vaciarPapeleraConfirmado(t);else{var a=chrome.i18n.getMessage("confirmarPapelera");idiomaEsp(navigator.language)&&(a="Â¿"+a),sweetAlert({type:"question",text:a,cancel:!0,successCallback:vaciarPapeleraConfirmado})}}function vaciarPapeleraConfirmado(e){for(var t=new Array,a=0;a<localStorage.totalPost;)"0"==localStorage["tablon"+a]&&(!e||difFechas(localStorage["fecha"+a])>e)?(isUserConnected()&&t.push(localStorage["treeId"+a]),borrarConfirmado(a,!1,!0)):a++;isUserConnected()&&t.length>0&&borraListaNotas(t)}function tirarPostitPapelera(e,t){if("nuevopost"!=e){muestraAyudaSnackbar("tiraPapelera"),$("#papelera").find("img").attr("src","appimg/papeleraLlena.png");var a=$("#postit"+e);borrarCalendar(e),a.css("z-index","998998998"),a.animate({top:"50",left:"50",zoom:"0",opacity:"0.3"},800,(function(){a.remove(),t&&t()})),sendRealTime(e,{delete:!0})}}function moverPostitTablon(e,t,a){var o=$("#postit"+e);o.css("z-index","998998998"),-999==t&&0==$("#tabPa2"+t).length&&muestraPaneles2(),esTablonCompartido(t)&&sendRealTime(e,{create:!0},t),esTablonCompartido(tablonActual)&&sendRealTime(e,{delete:!0},tablonActual),o.animate({top:$("#tabPa2"+t).offset().top,left:$("#tabPa2"+t).offset().left,opacity:"0.2"},400,(function(e){o.remove(),a&&a(),refrescaOrdenacion()}))}function notaEnPapelera(e){return"0"==localStorage["tablon"+e]}function borrarConfirmado(e,t,a){var o=localStorage["tablon"+e];for($(".sharePanel").remove(),!isUserConnected()||a||esNotaCompartida(e)||deleteNoteLogin(e),isUserConnected()||esNotaCompartida(e)||compruebaBorrarImagen(localStorage["postit"+e]),$("#postit"+e).remove(),borrarCalendar(e),borraPopupConfirmado(e),localStorage.totalPost--,i=e;i<localStorage.totalPost;i++)localStorage["postit"+i]=localStorage["postit"+(i+1)],localStorage["tipoA"+i]=localStorage["tipoA"+(i+1)],localStorage["tablon"+i]=localStorage["tablon"+(i+1)],localStorage["X"+i]=localStorage["X"+(i+1)],localStorage["Y"+i]=localStorage["Y"+(i+1)],localStorage["width"+i]=localStorage["width"+(i+1)],localStorage["height"+i]=localStorage["height"+(i+1)],localStorage["treeId"+i]=localStorage["treeId"+(i+1)],localStorage["fecha"+i]=localStorage["fecha"+(i+1)],localStorage["calendar"+i]=localStorage["calendar"+(i+1)],localStorage["sinMarco"+i]=localStorage["sinMarco"+(i+1)],null!=localStorage["updated"+(i+1)]?(localStorage["updated"+i]=localStorage["updated"+(i+1)],localStorage.removeItem("updated"+(i+1))):localStorage.removeItem("updated"+i),null!=localStorage["rotacion"+(i+1)]?(localStorage["rotacion"+i]=localStorage["rotacion"+(i+1)],localStorage.removeItem("rotacion"+(i+1))):localStorage.removeItem("rotacion"+i),null!=localStorage["pushpin"+(i+1)]?(localStorage["pushpin"+i]=localStorage["pushpin"+(i+1)],localStorage.removeItem("pushpin"+(i+1))):localStorage.removeItem("pushpin"+i),null!=localStorage["notaWeb"+(i+1)]?(localStorage["notaWeb"+i]=localStorage["notaWeb"+(i+1)],localStorage.removeItem("notaWeb"+(i+1))):localStorage.removeItem("notaWeb"+i),null!=localStorage["userComp"+(i+1)]?(localStorage["userComp"+i]=localStorage["userComp"+(i+1)],localStorage["nickComp"+i]=localStorage["nickComp"+(i+1)],localStorage.removeItem("userComp"+(i+1)),localStorage.removeItem("nickComp"+(i+1))):(localStorage.removeItem("userComp"+i),localStorage.removeItem("nickComp"+i)),null!=localStorage["errorConexion"+(i+1)]?(localStorage["errorConexion"+i]=localStorage["errorConexion"+(i+1)],localStorage.removeItem("errorConexion"+(i+1))):localStorage.removeItem("errorConexion"+i),null!=localStorage["columnaKanban"+(i+1)]?(localStorage["columnaKanban"+i]=localStorage["columnaKanban"+(i+1)],localStorage.removeItem("columnaKanban"+(i+1))):localStorage.removeItem("columnaKanban"+i),null!=localStorage["connections"+(i+1)]?(localStorage["connections"+i]=localStorage["connections"+(i+1)],localStorage.removeItem("connections"+(i+1))):localStorage.removeItem("connections"+i),null!=localStorage["minimizado"+(i+1)]?(localStorage["minimizado"+i]=localStorage["minimizado"+(i+1)],localStorage.removeItem("minimizado"+(i+1))):localStorage.removeItem("minimizado"+i),null!=imgs[i+1]?imgs[i]=imgs[i+1]:imgs[i]=void 0;updateConnectionsBorrado(e),refrescaPantalla(!1,!0),localStorage.removeItem("postit"+localStorage.totalPost),localStorage.removeItem("tablon"+localStorage.totalPost),localStorage.removeItem("tipoA"+localStorage.totalPost),localStorage.removeItem("X"+localStorage.totalPost),localStorage.removeItem("Y"+localStorage.totalPost),localStorage.removeItem("width"+localStorage.totalPost),localStorage.removeItem("height"+localStorage.totalPost),localStorage.removeItem("treeId"+localStorage.totalPost),localStorage.removeItem("fecha"+localStorage.totalPost),localStorage.removeItem("updated"+localStorage.totalPost),localStorage.removeItem("calendar"+localStorage.totalPost),localStorage.removeItem("sinMarco"+localStorage.totalPost),localStorage.removeItem("userComp"+localStorage.totalPost),localStorage.removeItem("nickComp"+localStorage.totalPost),localStorage.removeItem("errorConexion"+localStorage.totalPost),localStorage.removeItem("rotacion"+localStorage.totalPost),localStorage.removeItem("pushpin"+localStorage.totalPost),localStorage.removeItem("notaWeb"+localStorage.totalPost),localStorage.removeItem("columnaKanban"+localStorage.totalPost),localStorage.removeItem("connections"+localStorage.totalPost),imgs[localStorage.totalPost]=void 0,"0"!=o||esBackground()||inicializaPapelera(),"function"==typeof aplicaMasonry&&(preloadImages(),aplicaMasonry()),cambiaIcono(),cambiaContador()}function compruebaBorrarImagen(e){if(e){var t=e.indexOf("https://www.noteboardapp.com/users/");t>-1&&borrarImagen(e.substring(t,e.indexOf(".",t+30)+4)),(t=e.indexOf("https://noteboardapp.s3.amazonaws.com/users/"))>-1&&borrarFicherosAws(e,!0)}}function esNotaWeb(e){return null!=localStorage["notaWeb"+e]}function notaPerteneceUrl(e,t){if(!localStorage["notaWeb"+e])return!1;var a=localStorage["notaWeb"+e].split("||");return a[0].endsWith("/*")?getHostFromUrl(a[0]).replace(/(^\w+:|^)\/\//,"")==getHostFromUrl(t).replace(/(^\w+:|^)\/\//,""):a[0].replace(/(^\w+:|^)\/\//,"")==t.replace(/(^\w+:|^)\/\//,"")}function urlDeNotaWeb(e){return localStorage["notaWeb"+e]?localStorage["notaWeb"+e].split("||")[0]:""}function algunaNotaWeb(){for(var e=0;e<localStorage.totalPost;e++)if("-999"==localStorage["tablon"+e])return!0;return!1}function getPosicionNotaWeb(e){if(localStorage["notaWeb"+e]){var t=localStorage["notaWeb"+e].split("||");return{x:t[1],y:t[2]}}}function setPosicionNotaWeb(e,t,a){if(localStorage["notaWeb"+e]){var o=localStorage["notaWeb"+e].split("||");o[1]=t,o[2]=a,localStorage["notaWeb"+e]=o.join("||")}}function setUrlNotaWeb(e,t){if(localStorage["notaWeb"+e]){var a=localStorage["notaWeb"+e].split("||");a[0]=t,localStorage["notaWeb"+e]=a.join("||")}}async function modificaNotaWeb(e){var t=e.numPost;e.width&&(localStorage["width"+t]=e.width),e.height&&!tieneNotaAlturaAuto(t)&&(localStorage["height"+t]=e.height),e.left&&setPosicionNotaWeb(t,e.left,e.top),e.url&&setUrlNotaWeb(t,e.url),isUserConnected()&&updateNotaLogin(t),await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})}async function borraNotaWeb(e){var t=e.numPost;localStorage["tablon"+t]=0;var a=new Date;idiomaEsp(navigator.language)?localStorage["fecha"+t]=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear():localStorage["fecha"+t]=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear(),isUserConnected()&&updateNotaLogin(t),await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})}async function adjuntaHtmlWeb(e){var t=e.numPost,a=e.html;localStorage["postit"+t]+="<br>"+compruebaVideos(a),"auto"==localStorage["width"+t]&&(localStorage["width"+t]=$("#postit"+t).width()),$("#postit"+t).remove(),isUserConnected()&&updateNotaLogin(t),getCalendarMail(t)&&crearRegistroMail(t),await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})}function cierraVentana(){setTimeout((function(){window.close()}),3e3)}function puntoEnPostit(e,t,a){var o=$("#postit"+e);if(!o.is(":visible"))return!1;var n=parseInt(localStorage["X"+e]),i=parseInt(localStorage["Y"+e]),r=o.width(),s=o.height();return n<=t&&t<=n+r&&i<=a&&a<=i+s}function webkitBrowser(){return navigator.userAgent.toLowerCase().indexOf("webkit")>-1}function elementoEncima(e,t){var a=e.height()||30,o=e.offset().top,n=e.offset().left,i=o+a,r=n+e.width(),s=t.offset().top,l=t.offset().left,c=s+t.height(),d=l+t.width();return!(i<s||o>c||r<l||n>d)}function inicializaTema(e){(e||"default"==localStorage.seleccionTema)&&$("body").removeClass("metal piedra marmol lava colorNegro colorGris colorBlanco colorAzul colorVerde"),localStorage.seleccionTema&&("colorGris"!=localStorage.seleccionTema||e)&&"default"!=localStorage.seleccionTema&&($("body").addClass(localStorage.seleccionTema),$(".paneles2").css({"background-position":"right top"}),"colorBlanco"==localStorage.seleccionTema&&$(".boardsSwitch").css("filter","invert(1)"))}function ponTooltipPaneles2(){$(".tabPaneles2").each((function(){var e=$(this).attr("id").substr(6);"+"!=e&&$(this).tooltipster({content:'<div class="contenedor-tablon-tooltip"><div class="borrar-tablon-tooltip" id="borraTabToo'+e+'"><img src="appimg/removeWhite.png"></div><canvas id="canvasTooltip'+e+'" class="canvas-tooltip" width="125" height="100"></canvas></div>',contentCloning:!1,contentAsHTML:!0,theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:100,functionReady:function(){dibujaMaqueta("canvasTooltip"+e,e,125,100),$("#canvasTooltip"+e).off().on("click",(function(){clickTablon(null,!1,e)})),$("#borraTabToo"+e).off().on("click",(function(){borraTablon(e)})),$(".borrar-tablon-tooltip").attr("title",chrome.i18n.getMessage("borraTablon"))},interactive:!0})}))}function compruebaNotasWeb(){if(!isChromeExtension())return!1;for(var e=!1,t=0;t<localStorage.totalPost;t++)if(esNotaWeb(t)){e=!0;break}e&&(document.URL.indexOf("popup.html")>0||document.URL.indexOf("options.html")>0?chrome.permissions.contains({permissions:["tabs"],origins:["http://*/*","https://*/*"]},(function(e){e||sweetAlert({text:chrome.i18n.getMessage("notasWebPermisos"),successCallback:function(){chrome.permissions.request({permissions:["tabs"],origins:["http://*/*","https://*/*"]},(function(e){e&&console.log("aceptado")}))},cancel:!1,type:"warning"})})):sendMessage({mensBack:"compruebaNotasWeb"}))}function checkOverflow(e){var t=e.style.overflow;t&&"visible"!==t||(e.style.overflow="hidden");var a=e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight;return e.style.overflow=t,a}function postitNoVisibleEntero(e){return checkOverflow(document.getElementById("texto"+e))}function compruebaPostitDebajoDeOtros(){"true"==localStorage["masonry"+tablonActual]&&0===$(".pinnedNB").length||$(".postitNB").each((function(){var e=parseInt($(this).attr("id").substr(6));x=parseInt(localStorage["X"+e]),y=parseInt(localStorage["Y"+e]),widthPost=$("#postit"+e).width(),heightPost=$("#postit"+e).height(),$(".postitNB").each((function(){var t=parseInt($(this).attr("id").substr(6));if(t!=e&&puntoEnPostit(t,x,y)&&puntoEnPostit(t,x+widthPost,y)&&puntoEnPostit(t,x,y+heightPost)&&puntoEnPostit(t,x+widthPost,y+heightPost)){var a=maxZindex();$("#postit"+e).css("z-index",a+1)}}))}))}function limpiaNombreTablon(e){return e.replace(/\\/g,"").replace(/\"/g,"")}function clearSelection(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){window.getSelection().removeAllRanges()}}function creaTablonTemporal(){$("#postits-temp").remove(),cambioTablon.sliding=!0;var e=$("#Postits"),t=$(".tablonPostits");cambioTablon.haciaDerecha?e.after('<div class="Postits" id="Postits" ></div>'):e.before('<div class="Postits" id="Postits" ></div>'),e.removeAttr("id").addClass("postits-temp").attr("id","postits-temp").removeClass("Postits"),cambioTablon.haciaDerecha?(e.css("overflow","auto"),e.width(window.innerWidth)):($("#Postits").css("overflow","auto"),e.width(window.innerWidth)),$("#Postits").width(window.innerWidth),t.width(t.width()+window.innerWidth),t.width(t.width()+window.innerWidth+100),$(".postitNB",e).removeAttr("id").removeClass("postitNB"),cambioTablon.haciaDerecha||$(window).scrollLeft(window.innerWidth)}function borraTablonTemporal(e){var t=cambioTablon.haciaDerecha?window.innerWidth:0;esTablonOrdenado()&&ajustaNotasYPadding(),$("html").animate({scrollLeft:t,scrollTop:0},800,(function(){$("#postits-temp").remove(),$(".tablonPostits").width($("#Postits").width()),$("#Postits").css("overflow","visible").width(window.innerWidth),detectColorContrastBackground().then((()=>{refreshConnections(),$(".columna").css("borderColor",defaultColorContrastBackground)})),cambioTablon.sliding=!1,compruebaLimites(),window.scrollTo(0,0),cambiaIcono(!0),compruebaCanvasPosEnMovil(100),$("#Postits").css("background-image",""),cambiaFondoNum(localStorage["fondo"+e])}))}function elementInViewport(e){for(var t=e.offsetTop,a=e.offsetLeft,o=e.offsetWidth,n=e.offsetHeight;e.offsetParent;)t+=(e=e.offsetParent).offsetTop,a+=e.offsetLeft;return t>=window.pageYOffset&&a>=window.pageXOffset&&t+n<=window.pageYOffset+window.innerHeight&&a+o<=window.pageXOffset+window.innerWidth}function compruebaMinimapa(){hideMinimapa?($("#canvasMaqueta").hide(),$("#maquetaPant").hide()):($("#canvasMaqueta").show(),$("#maquetaPant").show())}function actualizaNombreTablon(e){document.getElementById("nombreTablon")&&(e=e||tablonActual||localStorage.tablonActual,document.getElementById("nombreTablon").innerText=`${nombreTablon(e)} - ${cuentaNotas(e)}`)}function cuentaNotas(e){for(var t=0,a=0;a<localStorage.totalPost;a++)esNotaVisibleEnTablon(a,e)&&t++;return t}function checkMaxLocalStorage(){try{return localStorage.pruebaMaximoAlcanzado="test".repeat(100),localStorage.removeItem("pruebaMaximoAlcanzado"),!0}catch(e){return!1}}function getLocalStorageSize(){return JSON.stringify(localStorage).length}function guardaTextoEnNota(e,t){try{localStorage["postit"+e]=t}catch(e){getLocalStorageSize()+t.length>524e4&&sweetAlert({type:"error",text:chrome.i18n.getMessage("noMasEspacio")}),console.log(e)}}function detectColorBackground(e){var t=document.createElement("img"),a=document.getElementById("Postits"),o=a.currentStyle||window.getComputedStyle(a,!1);o.backgroundImage.indexOf("://")>-1&&-1==o.backgroundImage.indexOf("noise")?(t.src=o.backgroundImage.slice(4,-1).replace(/"/g,""),t.onload=function(){$.adaptiveBackground.run({selector:t,success:function(t,a){e(colourBrightness(a.color))}})}):e(colourBrightness(o.backgroundColor))}function colourBrightness(e){var t=e.substring(4,e.length-1).replace(/ /g,"").split(",");return Math.round((299*parseInt(t[0])+587*parseInt(t[1])+114*parseInt(t[2]))/1e3)>125?"#333":"white"}jQuery.fn.sortElements=function(){var e=[].sort;return function(t,a){a=a||function(){return this};var o=this.map((function(){var e=a.call(this),t=e.parentNode,o=t.insertBefore(document.createTextNode(""),e.nextSibling);return function(){if(t===this)throw new Error("You can't sort elements if any one is a descendant of another.");t.insertBefore(this,o),t.removeChild(o)}}));return e.call(this,t).each((function(e){o[e].call(a.call(this))}))}}();var defaultColorContrastBackground="#333";function detectColorContrastBackground(){let e;return e=new Promise(((e,t)=>{detectColorBackground((t=>{e(defaultColorContrastBackground=t)}))})),e}function getRandomNumber(e,t){return Math.floor(Math.random()*(t+1-e))+e}function iniLocalStorageCaptureData(){localStorage.removeItem("imageSave"),localStorage.removeItem("capturaPantalla"),localStorage.removeItem("capturaVideo")}function isUserConnected(){return"true"==localStorage.sincroLogin}function resizeWindow(e,t,a){isChromeExtension()?chrome.runtime.sendMessage({resizeWindow:{winId:e,width:t,height:a}}):window.resizeTo(t,a)}function getRandomNoteType(){return TIPOS_NOTAS_RANDOM[getRandomNumber(0,TIPOS_NOTAS_RANDOM.length-1)]}function esBackground(){return document.URL.indexOf("background")>0}function traduceLiteralesHtml(){document.querySelectorAll("[data-locale]").forEach((e=>{e.innerText=chrome.i18n.getMessage(e.dataset.locale)}))}function tieneNotaAlturaAuto(e){return"auto"==localStorage["height"+e]}function getAlturaNota(e){return tieneNotaAlturaAuto(e)?$("#postit"+e)?.height()||(()=>{const t=localStorage["postit"+e].length/2;return 300>t?300:t})():parseInt(localStorage["height"+e])}function restaurarMedidasAutoNota(e){$("#postit"+e).height("auto"),$("#texto"+e).css("maxHeight","calc(95vh - 90px)")}function getBoardNumberParam(){return new URL(window.location.href).searchParams.get("boardNumber")}function setNewTab(e,t){localStorage["new-tab"]=JSON.stringify({numTab:e,hideBar:t})}function getNewTab(){let e=!1;if(localStorage["new-tab"])try{e=JSON.parse(localStorage["new-tab"])}catch(e){console.log(e)}return e}function getGridData(){var e=!1;if(localStorage["grid-drag"])try{e={x:localStorage["grid-drag"].split("x")[0],y:localStorage["grid-drag"].split("x")[1]}}catch(e){console.log(e)}return e}function addNopubli(){$noPubli=$("#cansadoAnun"),$noPubli.length&&($noPubli.html(chrome.i18n.getMessage("quitaAnuncios")),$noPubli.on("click",(()=>muestraMensajeHaztePremium())))}function isWebNotesBoard(e=tablonActual){return-999==e}function isFunction(e){return!(!e||"function"!=typeof e)}function addScalable(){isMobile()&&document.querySelector("meta[name=viewport]").setAttribute("content","width=device-width, initial-scale=1, user-scalable=yes")}function removeScalable(){isMobile()&&document.querySelector("meta[name=viewport]").setAttribute("content","width=device-width, initial-scale=1, user-scalable=no")}function getHashUrl(e){return e.substr(e.indexOf("#")+1)}function getLocaleDate(e){if(!e)return;const t=e.split("-");return new Date(t[1]+"/"+t[0]+"/"+t[2]).toLocaleDateString(navigator.language,{year:"numeric",month:"long",day:"numeric"})}function topBarHasBoards(){return localStorage.showTabs===TOP_BAR.BOARDS}function isServiceWorker(){return"ServiceWorkerGlobalScope"in self&&self instanceof ServiceWorkerGlobalScope}function crearEditor(e,t){var a,o,n,i;restaurarMedidasAutoNota(e),n=notaTieneZoom(e)?window.innerHeight-200:window.innerHeight-250,null!=e?(a="textAreaEdit"+e,o=getAlturaNota(e)+210,esPopup()&&(o=window.innerHeight+300,n=screen.height-250)):(a="textoAnun",o=300),esTablonKanban()&&!notaTieneZoom(e)?(n=VALORES_POR_DEFECTO.KANBAN_HEIGHT-250,i="spellchecker paste autolink autoresize print save preview code searchreplace directionality visualblocks visualchars fullscreen image link media codesample table charmap hr pagebreak nonbreaking anchor insertdatetime advlist lists wordcount imagetools textpattern emoticons"):i="spellchecker paste autolink autoresize print save preview code searchreplace directionality visualblocks visualchars fullscreen image link media codesample table charmap hr pagebreak nonbreaking anchor insertdatetime advlist lists wordcount imagetools textpattern help emoticons";var r="formatselect | bold italic strikethrough forecolor backcolor | link | numlist bullist | removeformat | alignleft aligncenter alignright alignjustify | outdent indent | ltr rtl | hr | check | code";isMobile()&&(r=chrome.i18n.getMessage("aceptar")+" | "+chrome.i18n.getMessage("cancelar")+" | "+r),tinyMCE.init({mode:"exact",language:"es-ES"==navigator.language?"es":"en-US"==navigator.language?"":navigator.language,elements:a,statusbar:!1,relative_urls:!1,remove_script_host:!1,convert_urls:!1,width:"100%",plugins:i,imagetools_cors_hosts:["www.noteboardapp.com"],imagetools_toolbar:"rotateleft rotateright | flipv fliph | imageoptions editimage",imagetools_proxy:"https://www.noteboardapp.com/proxy.php",dialog_type:"modal",codesample_languages:[{text:"HTML/XML",value:"markup"},{text:"JavaScript",value:"javascript"},{text:"CSS",value:"css"},{text:"PHP",value:"php"},{text:"Ruby",value:"ruby"},{text:"Python",value:"python"},{text:"Java",value:"java"},{text:"C",value:"c"},{text:"C#",value:"csharp"},{text:"C++",value:"cpp"},{text:"Sql",value:"sql"},{text:"Json",value:"json"}],nonbreaking_force_tab:!0,contextmenu:"link copy paste",min_height:o,max_height:n,forced_root_block:"p",force_br_newlines:!0,browser_spellcheck:!0,force_p_newlines:!1,image_advtab:!0,paste_data_images:!0,init_instance_callback:t,toolbar_drawer:"sliding",toolbar:r,toolbar_items_size:"small",font_formats:"Kalam=Kalam,Arial;Droid Sans=Droid Sans,Arial;Architects Daughter=Architects Daughter,Arial;Quando=Quando,Arial;Indie Flower=Indie Flower,Arial;Andale Mono=andale mono,times;Balsamiq Sans=Balsamiq Sans,times;Quattrocento Sans=Quattrocento Sans,Arial;Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Roboto=roboto;Karla=karla;Montserrat=montserrat;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats",setup:function(t){t.on("init",(function(a){if(localStorage.numeroNotaEnEdicion=e||VALORES_POR_DEFECTO.NUEVA_NOTA,esPopup()||notaTieneZoom(e))try{ajustaTamanyoVentanaEditarPopup(e);var o=$(a.target.editorContainer).find("iframe");o.height(window.innerHeight-o.position().top-getEditorToolsHeight()),$(window).on("resize",(function(){o.height(window.innerHeight-o.position().top-getEditorToolsHeight())}))}catch(e){console.log(e)}t.on("Remove",(function(e){var t=numeroNotaEditando();t!=localStorage.numeroNotaEnEdicion&&0!=t?localStorage.numeroNotaEnEdicion=t:localStorage.removeItem("numeroNotaEnEdicion")})),t.on("ExecCommand",(function(e){switch(e.command.toLowerCase()){case"copy":case"cut":case"paste":chrome.permissions.request({permissions:["clipboardRead"]});break;case"mceImageRotateLeft":case"mceImageRotateRight":case"mceImageFlipVertical":case"mceImageFlipHorizontal":case"mceEditImage":chrome.permissions.contains({origins:["https://www.noteboardapp.com/"]},(function(e){e||pidePermisoParaEditarImagenes()}))}}))})),t.on("Change",(function(t){(e||0===e)&&(localStorage["editando"+e]=t.level.content,sendRealTime(e,{texto:t.level.content}))})),t.ui.registry.addButton("check",{icon:"checkmark",tooltip:"checkbox",onAction:function(){t.insertContent('<input class="noteBoardCheck" type="checkbox"/>'),null!=e?cambiaAparenciaEditor(buscarTipo("postit"+e),"textAreaEdit"+e):cambiaAparenciaEditor(buscarTipo("postitnuevo"),"postitnuevo")}}),isMobile()&&(t.ui.registry.addButton(chrome.i18n.getMessage("aceptar"),{text:chrome.i18n.getMessage("aceptar"),title:chrome.i18n.getMessage("aceptar"),onAction:function(){"textoAnun"==t.id?$("#postitnuevo .inplace_save").click():$("#postit"+parseInt(t.id.substr(12))+" .inplace_save").click()}}),t.ui.registry.addButton(chrome.i18n.getMessage("cancelar"),{text:chrome.i18n.getMessage("cancelar"),title:chrome.i18n.getMessage("cancelar"),onAction:function(){"textoAnun"==t.id?$("#postitnuevo .inplace_cancel").click():$("#postit"+parseInt(t.id.substr(12))+" .inplace_cancel").click()}})),activaTooltipsEditor()},save_enablewhendirty:!1,save_onsavecallback:e=>{"textoAnun"==e.id?$("#postitnuevo .inplace_save").click():$("#postit"+parseInt(e.id.substr(12))+" .inplace_save").click()},content_css:"https://fonts.googleapis.com/css?family=Kalam|Montserrat|Indie+Flower|Droid+Sans|Architects+Daughter|Balsamiq+Sans|Quando|Quattrocento+Sans|Roboto|Karla",content_style:"p {margin: 0}"})}function getEditorToolsHeight(){return $(".selectorColor").height()+$(".tox-menubar").height()+$(".tox-toolbar").height()+100}function ajustaTamanyoVentanaEditarPopup(e){if(esPopup()){const a=100;var t=$("#postit"+e).outerWidth()>700?$("#postit"+e).outerWidth():700;resizeWindow(winId,t+30,$(".inplace_save").position().top+a<screen.height?$(".inplace_save").position().top+a:screen.height-a)}}function activarMod(){for(var e=0;e<localStorage.totalPost;e++)(null!=localStorage["tablon"+e]&&"undefined"!=localStorage["tablon"+e]||1!=tablonActual)&&localStorage["tablon"+e]!=tablonActual||""!=localStorage["editando"+e]&&null!=localStorage["editando"+e]&&"undefined"!=localStorage["editando"+e]&&$("#texto"+e).trigger("openEditor")}function editandoAlgunaNota(){return!1!==numeroNotaEditando()}function numeroNotaEditando(){for(var e=document.createElement("div"),t=0;t<localStorage.totalPost;t++)if(((null==localStorage["tablon"+t]||"undefined"==localStorage["tablon"+t])&&1==tablonActual||localStorage["tablon"+t]==tablonActual)&&(e.innerHTML=localStorage["editando"+t],""!=localStorage["editando"+t]&&null!=localStorage["editando"+t]&&"undefined"!=localStorage["editando"+t]&&""!=e.innerText))return t;return!1}function oscarGuardaContenido(e,t){"textoAnun"==e?localStorage.editando=t:localStorage["editando"+e.substr(12)]=t}function pidePermisoParaEditarImagenes(){sweetAlert({text:chrome.i18n.getMessage("permisoEditarImagenes"),successCallback:function(){chrome.permissions.request({origins:["https://www.noteboardapp.com/"]})},type:"warning"})}function estaEditorAbierto(e){return!!tinyMCE.get("textAreaEdit"+e)}function hayEdicionNuevaNotaPendiente(){if(document.URL.indexOf("newTab")>-1)return!1;var e={innertext:""};return localStorage.editando&&((e=document.createElement("div")).innerHTML=localStorage.editando),""!=localStorage.editando&&null!=localStorage.editando&&"undefined"!=localStorage.editando&&""!=e.innerText}function obtenEditor(e){return e===VALORES_POR_DEFECTO.NUEVA_NOTA&&tinyMCE.get("textoAnun")||tinyMCE.get("textAreaEdit"+e)}function activaTooltipsEditor(){var e={theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:150};$(".idtransparente2").attr("title",chrome.i18n.getMessage("colorTransparente")).tooltipster(e),$(".notepadBut").attr("title",chrome.i18n.getMessage("colorNotepad")).tooltipster(e),$(".customColor2").attr("title",chrome.i18n.getMessage("colorCustom")).tooltipster(e)}function activaTooltipsEditorNuevaNota(){if(!$("#idtransparente").hasClass("tooltipstered")){var e={theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:150};$("#idtransparente").attr("title",chrome.i18n.getMessage("colorTransparente")).tooltipster(e),$("#notepad").attr("title",chrome.i18n.getMessage("colorNotepad")).tooltipster(e),$("#customColor").attr("title",chrome.i18n.getMessage("colorCustom")).tooltipster(e)}}function addContentToEditor(e,t){var a=obtenEditor(e);a&&(a.insertContent(t),a.setContent(a.getContent().replace(/(\r\n|\n|\r)/gm,""),{format:"html"}))}function algunEditorAbierto(){return $('iframe[id^="textAre"]').length>0||$("#postitnuevo").is(":visible")}function aceptaEdicion(){$("#postitnuevo").is(":visible")?$(".inplace_save").click():$(".inplace_save:not(.nuevo_save)").click()}function initializeNewPostit(){if(0==$("#postitnuevo").length){var e=getNewPostit();$(".tablonPostits").append(e),document.getElementById("aceptar").innerText=chrome.i18n.getMessage("aceptar"),document.getElementById("borrar").innerText=chrome.i18n.getMessage("cancelar"),$("#botonborNuevo").on("click",borraPostitNuevo),$("#idblanco").on("click",(function(){cambioPostit(TIPO_NOTA.BLANCO,"postitnuevo")})),$("#idamarillo").on("click",(function(){cambioPostit(TIPO_NOTA.AMARILLO,"postitnuevo")})),$("#idverde").on("click",(function(){cambioPostit(TIPO_NOTA.VERDE,"postitnuevo")})),$("#idlila").on("click",(function(){cambioPostit(TIPO_NOTA.LILA,"postitnuevo")})),$("#idnaranja").on("click",(function(){cambioPostit(TIPO_NOTA.AMARILLO2,"postitnuevo")})),$("#idrosa").on("click",(function(){cambioPostit(TIPO_NOTA.ROSA,"postitnuevo")})),$("#idrojo").on("click",(function(){cambioPostit(TIPO_NOTA.ROJO,"postitnuevo")})),$("#idazul").on("click",(function(){cambioPostit(TIPO_NOTA.AZUL,"postitnuevo")})),$("#idtransparente").on("click",(function(){cambioPostit(TIPO_NOTA.TRANSPARENTE,"postitnuevo")})),$("#notepad").on("click",(function(){cambioPostit(TIPO_NOTA.LIBRETA,"postitnuevo")})),$("#sinMarcoNuevo").click((function(){$("#postitnuevo").toggleClass("postitSinMarco"),$("#textoAnun").height("auto")})),$(".sinMarcoLabel").text(chrome.i18n.getMessage("sinMarco")),$("#aceptar").on("click",guardaPostit),$("#borrar").on("click",borraPostitNuevo),$("#customColor").ColorPicker({onSubmit:function(e,t,a,o){$(o).val(t),$(o).ColorPickerHide()},onBeforeShow:function(e,t,a,o){$(this).ColorPickerSetColor("#0000ff")},onChange:function(e,t,a,o){$("#customColor").css("background-color","#"+t),cambioPostit(t,"postitnuevo")}}).bind("keyup",(function(){$(this).ColorPickerSetColor(this.value)})),$("#postitnuevo").resizable({minHeight:200,minWidth:390,resize:function(e,t){resizeEditor(e)}}),$(".postit0").draggable({distance:5,cancel:".inplace_save,.inplace_cancel",stack:".anuncios div",containment:".Postits"}),activaTooltipsEditorNuevaNota()}}function cierraPostitNuevo(){$("#postitnuevo").addClass("scale-down-center"),setTimeout((function(){$("#postitnuevo").hide(),$("#postitnuevo").removeClass("scale-down-center").removeClass("scale-up-center")}),150)}var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var e=/\blang(?:uage)?-(\w+)\b/i,t=0,a=_self.Prism={manual:_self.Prism&&_self.Prism.manual,util:{encode:function(e){return e instanceof o?new o(e.type,a.util.encode(e.content),e.alias):"Array"===a.util.type(e)?e.map(a.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e){switch(a.util.type(e)){case"Object":var t={};for(var o in e)e.hasOwnProperty(o)&&(t[o]=a.util.clone(e[o]));return t;case"Array":return e.map&&e.map((function(e){return a.util.clone(e)}))}return e}},languages:{extend:function(e,t){var o=a.util.clone(a.languages[e]);for(var n in t)o[n]=t[n];return o},insertBefore:function(e,t,o,n){var i=(n=n||a.languages)[e];if(2==arguments.length){for(var r in o=arguments[1])o.hasOwnProperty(r)&&(i[r]=o[r]);return i}var s={};for(var l in i)if(i.hasOwnProperty(l)){if(l==t)for(var r in o)o.hasOwnProperty(r)&&(s[r]=o[r]);s[l]=i[l]}return a.languages.DFS(a.languages,(function(t,a){a===n[e]&&t!=e&&(this[t]=s)})),n[e]=s},DFS:function(e,t,o,n){for(var i in n=n||{},e)e.hasOwnProperty(i)&&(t.call(e,i,e[i],o||i),"Object"!==a.util.type(e[i])||n[a.util.objId(e[i])]?"Array"!==a.util.type(e[i])||n[a.util.objId(e[i])]||(n[a.util.objId(e[i])]=!0,a.languages.DFS(e[i],t,i,n)):(n[a.util.objId(e[i])]=!0,a.languages.DFS(e[i],t,null,n)))}},plugins:{},highlightAll:function(e,t){var o={callback:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};a.hooks.run("before-highlightall",o);for(var n,i=o.elements||document.querySelectorAll(o.selector),r=0;n=i[r++];)a.highlightElement(n,!0===e,o.callback)},highlightElement:function(t,o,n){for(var i,r,s=t;s&&!e.test(s.className);)s=s.parentNode;s&&(i=(s.className.match(e)||[,""])[1].toLowerCase(),r=a.languages[i]),t.className=t.className.replace(e,"").replace(/\s+/g," ")+" language-"+i,s=t.parentNode,/pre/i.test(s.nodeName)&&(s.className=s.className.replace(e,"").replace(/\s+/g," ")+" language-"+i);var l={element:t,language:i,grammar:r,code:t.textContent};if(a.hooks.run("before-sanity-check",l),!l.code||!l.grammar)return l.code&&(l.element.textContent=l.code),void a.hooks.run("complete",l);if(a.hooks.run("before-highlight",l),o&&_self.Worker){var c=new Worker(a.filename);c.onmessage=function(e){l.highlightedCode=e.data,a.hooks.run("before-insert",l),l.element.innerHTML=l.highlightedCode,n&&n.call(l.element),a.hooks.run("after-highlight",l),a.hooks.run("complete",l)},c.postMessage(JSON.stringify({language:l.language,code:l.code,immediateClose:!0}))}else l.highlightedCode=a.highlight(l.code,l.grammar,l.language),a.hooks.run("before-insert",l),l.element.innerHTML=l.highlightedCode,n&&n.call(t),a.hooks.run("after-highlight",l),a.hooks.run("complete",l)},highlight:function(e,t,n){var i=a.tokenize(e,t);return o.stringify(a.util.encode(i),n)},tokenize:function(e,t){var o=a.Token,n=[e],i=t.rest;if(i){for(var r in i)t[r]=i[r];delete t.rest}e:for(var r in t)if(t.hasOwnProperty(r)&&t[r]){var s=t[r];s="Array"===a.util.type(s)?s:[s];for(var l=0;l<s.length;++l){var c=s[l],d=c.inside,u=!!c.lookbehind,p=!!c.greedy,m=0,g=c.alias;if(p&&!c.pattern.global){var h=c.pattern.toString().match(/[imuy]*$/)[0];c.pattern=RegExp(c.pattern.source,h+"g")}c=c.pattern||c;for(var f=0,b=0;f<n.length;b+=n[f].length,++f){var v=n[f];if(n.length>e.length)break e;if(!(v instanceof o)){c.lastIndex=0;var S=1;if(!(P=c.exec(v))&&p&&f!=n.length-1){if(c.lastIndex=b,!(P=c.exec(e)))break;for(var w=P.index+(u?P[1].length:0),_=P.index+P[0].length,$=f,y=b,C=n.length;C>$&&_>y;++$)w>=(y+=n[$].length)&&(++f,b=y);if(n[f]instanceof o||n[$-1].greedy)continue;S=$-f,v=e.slice(b,y),P.index-=b}if(P){u&&(m=P[1].length);_=(w=P.index+m)+(P=P[0].slice(m)).length;var P,k=v.slice(0,w),I=v.slice(_),T=[f,S];k&&T.push(k);var x=new o(r,d?a.tokenize(P,d):P,g,P,p);T.push(x),I&&T.push(I),Array.prototype.splice.apply(n,T)}}}}}return n},hooks:{all:{},add:function(e,t){var o=a.hooks.all;o[e]=o[e]||[],o[e].push(t)},run:function(e,t){var o=a.hooks.all[e];if(o&&o.length)for(var n,i=0;n=o[i++];)n(t)}}},o=a.Token=function(e,t,a,o,n){this.type=e,this.content=t,this.alias=a,this.length=0|(o||"").length,this.greedy=!!n};if(o.stringify=function(e,t,n){if("string"==typeof e)return e;if("Array"===a.util.type(e))return e.map((function(a){return o.stringify(a,t,e)})).join("");var i={type:e.type,content:o.stringify(e.content,t,n),tag:"span",classes:["token",e.type],attributes:{},language:t,parent:n};if("comment"==i.type&&(i.attributes.spellcheck="true"),e.alias){var r="Array"===a.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(i.classes,r)}a.hooks.run("wrap",i);var s=Object.keys(i.attributes).map((function(e){return e+'="'+(i.attributes[e]||"").replace(/"/g,"&quot;")+'"'})).join(" ");return"<"+i.tag+' class="'+i.classes.join(" ")+'"'+(s?" "+s:"")+">"+i.content+"</"+i.tag+">"},!_self.document)return _self.addEventListener?(_self.addEventListener("message",(function(e){var t=JSON.parse(e.data),o=t.language,n=t.code,i=t.immediateClose;_self.postMessage(a.highlight(n,a.languages[o],o)),i&&_self.close()}),!1),_self.Prism):_self.Prism;var n=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return n&&(a.filename=n.src,!document.addEventListener||a.manual||n.hasAttribute("data-manual")||("loading"!==document.readyState?window.requestAnimationFrame?window.requestAnimationFrame(a.highlightAll):window.setTimeout(a.highlightAll,16):document.addEventListener("DOMContentLoaded",a.highlightAll))),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism),Prism.languages.markup={comment:/<!--[\w\W]*?-->/,prolog:/<\?[\w\W]+?\?>/,doctype:/<!DOCTYPE[\w\W]+?>/i,cdata:/<!\[CDATA\[[\w\W]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\\1|\\?(?!\1)[\w\W])*\1|[^\s'">=]+))?)*\s*\/?>/i,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:('|")[\w\W]*?(\1)|[^\s>]+)/i,inside:{punctuation:/[=>"']/}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i},Prism.hooks.add("wrap",(function(e){"entity"===e.type&&(e.attributes.title=e.content.replace(/&amp;/,"&"))})),Prism.languages.xml=Prism.languages.markup,Prism.languages.html=Prism.languages.markup,Prism.languages.mathml=Prism.languages.markup,Prism.languages.svg=Prism.languages.markup,Prism.languages.css={comment:/\/\*[\w\W]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(;|(?=\s*\{))/i,inside:{rule:/@[\w-]+/}},url:/url\((?:(["'])(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1|.*?)\)/i,selector:/[^\{\}\s][^\{\};]*?(?=\s*\{)/,string:{pattern:/("|')(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1/,greedy:!0},property:/(\b|\B)[\w-]+(?=\s*:)/i,important:/\B!important\b/i,function:/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:]/},Prism.languages.css.atrule.inside.rest=Prism.util.clone(Prism.languages.css),Prism.languages.markup&&(Prism.languages.insertBefore("markup","tag",{style:{pattern:/(<style[\w\W]*?>)[\w\W]*?(?=<\/style>)/i,lookbehind:!0,inside:Prism.languages.css,alias:"language-css"}}),Prism.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|').*?\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:Prism.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,inside:Prism.languages.css}},alias:"language-css"}},Prism.languages.markup.tag)),Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\w\W]*?\*\//,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0}],string:{pattern:/(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[a-z0-9_\.\\]+/i,lookbehind:!0,inside:{punctuation:/(\.|\\)/}},keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,boolean:/\b(true|false)\b/,function:/[a-z0-9_]+(?=\()/i,number:/\b-?(?:0x[\da-f]+|\d*\.?\d+(?:e[+-]?\d+)?)\b/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/},Prism.languages.javascript=Prism.languages.extend("clike",{keyword:/\b(as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/,number:/\b-?(0x[\dA-Fa-f]+|0b[01]+|0o[0-7]+|\d*\.?\d+([Ee][+-]?\d+)?|NaN|Infinity)\b/,function:/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*(?=\()/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*\*?|\/|~|\^|%|\.{3}/}),Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^\/])\/(?!\/)(\[.+?]|\\.|[^\/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\\\|\\?[^\\])*?`/,greedy:!0,inside:{interpolation:{pattern:/\$\{[^}]+\}/,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}}}),Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{script:{pattern:/(<script[\w\W]*?>)[\w\W]*?(?=<\/script>)/i,lookbehind:!0,inside:Prism.languages.javascript,alias:"language-javascript"}}),Prism.languages.js=Prism.languages.javascript,Prism.languages.java=Prism.languages.extend("clike",{keyword:/\b(abstract|continue|for|new|switch|assert|default|goto|package|synchronized|boolean|do|if|private|this|break|double|implements|protected|throw|byte|else|import|public|throws|case|enum|instanceof|return|transient|catch|extends|int|short|try|char|final|interface|static|void|class|finally|long|strictfp|volatile|const|float|native|super|while)\b/,number:/\b0b[01]+\b|\b0x[\da-f]*\.?[\da-fp\-]+\b|\b\d*\.?\d+(?:e[+-]?\d+)?[df]?\b/i,operator:{pattern:/(^|[^.])(?:\+[+=]?|-[-=]?|!=?|<<?=?|>>?>?=?|==?|&[&=]?|\|[|=]?|\*=?|\/=?|%=?|\^=?|[?:~])/m,lookbehind:!0}}),Prism.languages.insertBefore("java","function",{annotation:{alias:"punctuation",pattern:/(^|[^.])@\w+/,lookbehind:!0}}),Prism.languages.json={property:/"(?:\\.|[^\\"])*"(?=\s*:)/gi,string:/"(?!:)(?:\\.|[^\\"])*"(?!:)/g,number:/\b-?(0x[\dA-Fa-f]+|\d*\.?\d+([Ee][+-]?\d+)?)\b/g,punctuation:/[{}[\]);,]/g,operator:/:/g,boolean:/\b(true|false)\b/gi,null:/\bnull\b/gi},Prism.languages.jsonp=Prism.languages.json,Prism.languages.less=Prism.languages.extend("css",{comment:[/\/\*[\w\W]*?\*\//,{pattern:/(^|[^\\])\/\/.*/,lookbehind:!0}],atrule:{pattern:/@[\w-]+?(?:\([^{}]+\)|[^(){};])*?(?=\s*\{)/i,inside:{punctuation:/[:()]/}},selector:{pattern:/(?:@\{[\w-]+\}|[^{};\s@])(?:@\{[\w-]+\}|\([^{}]*\)|[^{};@])*?(?=\s*\{)/,inside:{variable:/@+[\w-]+/}},property:/(?:@\{[\w-]+\}|[\w-])+(?:\+_?)?(?=\s*:)/i,punctuation:/[{}();:,]/,operator:/[+\-*\/]/}),Prism.languages.insertBefore("less","punctuation",{function:Prism.languages.less.function}),Prism.languages.insertBefore("less","property",{variable:[{pattern:/@[\w-]+\s*:/,inside:{punctuation:/:/}},/@@?[\w-]+/],"mixin-usage":{pattern:/([{;]\s*)[.#](?!\d)[\w-]+.*?(?=[(;])/,lookbehind:!0,alias:"function"}}),Prism.languages.php=Prism.languages.extend("clike",{keyword:/\b(and|or|xor|array|as|break|case|cfunction|class|const|continue|declare|default|die|do|else|elseif|enddeclare|endfor|endforeach|endif|endswitch|endwhile|extends|for|foreach|function|include|include_once|global|if|new|return|static|switch|use|require|require_once|var|while|abstract|interface|public|implements|private|protected|parent|throw|null|echo|print|trait|namespace|final|yield|goto|instanceof|finally|try|catch)\b/i,constant:/\b[A-Z0-9_]{2,}\b/,comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|\/\/.*)/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("php","class-name",{"shell-comment":{pattern:/(^|[^\\])#.*/,lookbehind:!0,alias:"comment"}}),Prism.languages.insertBefore("php","keyword",{delimiter:/\?>|<\?(?:php)?/i,variable:/\$\w+\b/i,package:{pattern:/(\\|namespace\s+|use\s+)[\w\\]+/,lookbehind:!0,inside:{punctuation:/\\/}}}),Prism.languages.insertBefore("php","operator",{property:{pattern:/(->)[\w]+/,lookbehind:!0}}),Prism.languages.markup&&(Prism.hooks.add("before-highlight",(function(e){"php"===e.language&&(e.tokenStack=[],e.backupCode=e.code,e.code=e.code.replace(/(?:<\?php|<\?)[\w\W]*?(?:\?>)/gi,(function(t){return e.tokenStack.push(t),"{{{PHP"+e.tokenStack.length+"}}}"})))})),Prism.hooks.add("before-insert",(function(e){"php"===e.language&&(e.code=e.backupCode,delete e.backupCode)})),Prism.hooks.add("after-highlight",(function(e){if("php"===e.language){for(var t,a=0;t=e.tokenStack[a];a++)e.highlightedCode=e.highlightedCode.replace("{{{PHP"+(a+1)+"}}}",Prism.highlight(t,e.grammar,"php").replace(/\$/g,"$$$$"));e.element.innerHTML=e.highlightedCode}})),Prism.hooks.add("wrap",(function(e){"php"===e.language&&"markup"===e.type&&(e.content=e.content.replace(/(\{\{\{PHP[0-9]+\}\}\})/g,'<span class="token php">$1</span>'))})),Prism.languages.insertBefore("php","comment",{markup:{pattern:/<[^?]\/?(.*?)>/,inside:Prism.languages.markup},php:/\{\{\{PHP[0-9]+\}\}\}/})),function(e){e.languages.sass=e.languages.extend("css",{comment:{pattern:/^([ \t]*)\/[\/*].*(?:(?:\r?\n|\r)\1[ \t]+.+)*/m,lookbehind:!0}}),e.languages.insertBefore("sass","atrule",{"atrule-line":{pattern:/^(?:[ \t]*)[@+=].+/m,inside:{atrule:/(?:@[\w-]+|[+=])/m}}}),delete e.languages.sass.atrule;var t=/((\$[-_\w]+)|(#\{\$[-_\w]+\}))/i,a=[/[+*\/%]|[=!]=|<=?|>=?|\b(?:and|or|not)\b/,{pattern:/(\s+)-(?=\s)/,lookbehind:!0}];e.languages.insertBefore("sass","property",{"variable-line":{pattern:/^[ \t]*\$.+/m,inside:{punctuation:/:/,variable:t,operator:a}},"property-line":{pattern:/^[ \t]*(?:[^:\s]+ *:.*|:[^:\s]+.*)/m,inside:{property:[/[^:\s]+(?=\s*:)/,{pattern:/(:)[^:\s]+/,lookbehind:!0}],punctuation:/:/,variable:t,operator:a,important:e.languages.sass.important}}}),delete e.languages.sass.property,delete e.languages.sass.important,delete e.languages.sass.selector,e.languages.insertBefore("sass","punctuation",{selector:{pattern:/([ \t]*)\S(?:,?[^,\r\n]+)*(?:,(?:\r?\n|\r)\1[ \t]+\S(?:,?[^,\r\n]+)*)*/,lookbehind:!0}})}(Prism),Prism.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},string:{pattern:/(^|[^@\\])("|')(?:\\?[\s\S])*?\2/,greedy:!0,lookbehind:!0},variable:/@[\w.$]+|@("|'|`)(?:\\?[\s\S])+?\1/,function:/\b(?:COUNT|SUM|AVG|MIN|MAX|FIRST|LAST|UCASE|LCASE|MID|LEN|ROUND|NOW|FORMAT)(?=\s*\()/i,keyword:/\b(?:ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR VARYING|CHARACTER (?:SET|VARYING)|CHARSET|CHECK|CHECKPOINT|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMN|COLUMNS|COMMENT|COMMIT|COMMITTED|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS|CONTAINSTABLE|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|DATA(?:BASES?)?|DATE(?:TIME)?|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITER(?:S)?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE(?: PRECISION)?|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE KEY|ELSE|ENABLE|ENCLOSED BY|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPE(?:D BY)?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|IDENTITY(?:_INSERT|COL)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTO|INVOKER|ISOLATION LEVEL|JOIN|KEYS?|KILL|LANGUAGE SQL|LAST|LEFT|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MODIFIES SQL DATA|MODIFY|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL(?: CHAR VARYING| CHARACTER(?: VARYING)?| VARCHAR)?|NATURAL|NCHAR(?: VARCHAR)?|NEXT|NO(?: SQL|CHECK|CYCLE)?|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READ(?:S SQL DATA|TEXT)?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEATABLE|REPLICATION|REQUIRE|RESTORE|RESTRICT|RETURNS?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE MODE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|START(?:ING BY)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED BY|TEXT(?:SIZE)?|THEN|TIMESTAMP|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNPIVOT|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?)\b/i,boolean:/\b(?:TRUE|FALSE|NULL)\b/i,number:/\b-?(?:0x)?\d*\.?[\da-f]+\b/,operator:/[-+*\/=%^~]|&&?|\|?\||!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|IN|LIKE|NOT|OR|IS|DIV|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,punctuation:/[;[\]()`,.]/};var posCompartidas=new Array;function inicializaLocalStorage(){for(var e=1;e<=localStorage.numTablones;e++)localStorage.removeItem("tab"+e+"Label"),localStorage.removeItem("publico"+e),localStorage.removeItem("ordenTablon"+e),localStorage.removeItem("masonry"+e),localStorage.removeItem("tablonKanban"+e);var t=0;localStorage.removeItem("treeId10000");for(e=0;e<localStorage.totalPost;e++)esNotaCompartida(e)&&guardaPosCompartido(e),null==localStorage["errorConexion"+e]&&null!=localStorage["treeId"+e]||null==localStorage["postit"+e]||(null==localStorage["treeId"+e]&&(localStorage["errorConexion"+e]="create"),e>t&&(muevePostit(e,t),localStorage.removeItem("errorConexion"+e)),t++,clearInterval(intervalErrorConexion),intervalErrorConexion=setInterval(intentaConexion,1e4)),null!=localStorage["errorConexion"+e]&&e==t-1||(localStorage.removeItem("postit"+e),localStorage.removeItem("tablon"+e),localStorage.removeItem("tipoA"+e),localStorage.removeItem("X"+e),localStorage.removeItem("Y"+e),localStorage.removeItem("width"+e),localStorage.removeItem("height"+e),localStorage.removeItem("treeId"+e),localStorage.removeItem("fecha"+e),localStorage.removeItem("updated"+e),localStorage.removeItem("calendar"+e),localStorage.removeItem("sinMarco"+e),localStorage.removeItem("userComp"+e),localStorage.removeItem("nickComp"+e),localStorage.removeItem("rotacion"+e),localStorage.removeItem("pushpin"+e),localStorage.removeItem("notaWeb"+e),localStorage.removeItem("columnaKanban"+e),localStorage.removeItem("connections"+e),localStorage.removeItem("minimizado"+e));localStorage.totalPost=t}function muevePostit(e,t){localStorage["postit"+t]=localStorage["postit"+e],localStorage["tipoA"+t]=localStorage["tipoA"+e],localStorage["tablon"+t]=localStorage["tablon"+e],localStorage["X"+t]=localStorage["X"+e],localStorage["Y"+t]=localStorage["Y"+e],localStorage["width"+t]=localStorage["width"+e],localStorage["height"+t]=localStorage["height"+e],localStorage["treeId"+t]=localStorage["treeId"+e],localStorage["fecha"+t]=localStorage["fecha"+e],localStorage["updated"+t]=localStorage["updated"+e],localStorage["calendar"+t]=localStorage["calendar"+e],localStorage["sinMarco"+t]=localStorage["sinMarco"+e],null!=localStorage["userComp"+e]?(localStorage["userComp"+t]=localStorage["userComp"+e],localStorage["nickComp"+t]=localStorage["nickComp"+e]):(localStorage.removeItem("userComp"+t),localStorage.removeItem("nickComp"+t)),null!=localStorage["errorConexion"+e]?localStorage["errorConexion"+t]=localStorage["errorConexion"+e]:localStorage.removeItem("errorConexion"+t),null!=localStorage["rotacion"+e]?localStorage["rotacion"+t]=localStorage["rotacion"+e]:localStorage.removeItem("rotacion"+t),null!=localStorage["pushpin"+e]?localStorage["pushpin"+t]=localStorage["pushpin"+e]:localStorage.removeItem("pushpin"+t),null!=localStorage["notaWeb"+e]?localStorage["notaWeb"+t]=localStorage["notaWeb"+e]:localStorage.removeItem("notaWeb"+t),null!=localStorage["columnaKanban"+e]?localStorage["columnaKanban"+t]=localStorage["columnaKanban"+e]:localStorage.removeItem("columnaKanban"+t),null!=localStorage["connections"+e]?localStorage["connections"+t]=localStorage["connections"+e]:localStorage.removeItem("connections"+t),null!=localStorage["minimizado"+e]?localStorage["minimizado"+t]=localStorage["minimizado"+e]:localStorage.removeItem("minimizado"+t)}function obtenerNickPublico(){var e=getServerUrl()+"api/obtenNickPublico.php";e+="?id_usuario="+localStorage.id_usuario,$.ajax({type:"GET",url:e,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess&&(localStorage.nickPublico=t.nickPublico)},error:function(e,t,a){console.log(t)}})}function logoutUsuario(){localStorage.removeItem("id_usuario"),localStorage.removeItem("token"),localStorage.removeItem("sincroLogin"),localStorage.removeItem("nick"),localStorage.removeItem("confirmado"),localStorage.removeItem("fbToken"),localStorage.removeItem("fbId"),localStorage.removeItem("googleId"),localStorage.sincroLogin=!1,document.getElementById("logoutForm").style.display="none",document.getElementById("loginForm").style.display="block"}function grabaNotaLogin(e){if(!isDemoUser(e)){if(e<1e4){"undefined"!=localStorage["tablon"+e]&&null!=localStorage["tablon"+e]||(localStorage["tablon"+e]=1),null!=localStorage["sinMarco"+e]&&"undefined"!=localStorage["sinMarco"+e]||(localStorage["sinMarco"+e]="false");var t={tipoA:localStorage["tipoA"+e],X:localStorage["X"+e],Y:localStorage["Y"+e],postit:localStorage["postit"+e],width:localStorage["width"+e],height:localStorage["height"+e],fecha:localStorage["fecha"+e],tablon:localStorage["tablon"+e],calendar:localStorage["calendar"+e],sinMarco:localStorage["sinMarco"+e],rotacion:localStorage["rotacion"+e],pushpin:localStorage["pushpin"+e],notaWeb:localStorage["notaWeb"+e],columnaKanban:localStorage["columnaKanban"+e],connections:localStorage["connections"+e],minimizado:localStorage["minimizado"+e]}}else{for(var a=new Array,o=new Array,n=new Array,i=new Array,r=new Array,s=new Array,l=1;l<=localStorage.numTablones;l++)null==localStorage["tab"+l+"Label"]&&(localStorage["tab"+l+"Label"]="undefined"),a.push(localStorage["tab"+l+"Label"]),o.push(localStorage["fondo"+l]),"true"==localStorage["publico"+l]?n.push(1):n.push(0),"true"==localStorage["masonry"+l]?r.push(1):r.push(0),i.push(ordenTablon(l)),localStorage["tablonKanban"+l]?s.push(localStorage["tablonKanban"+l]):s.push("");var c={tabLabels:a,tabBgs:o,tabPublico:n,tabOrden:i,tabMasonry:r,fuente:localStorage.fuente,size:localStorage.size,tabKanban:s};t={tipoA:TIPO_NOTA.TABLONES,X:0,Y:0,postit:JSON.stringify(c),width:0,height:0,rotacion:"",fecha:"",tablon:0,calendar:"",sinMarco:!1,pushpin:"",notaWeb:""}}var d="id_usuario="+localStorage.id_usuario;d+="&token="+localStorage.token,d+="&nota="+encodeURIComponent(JSON.stringify(t)),d+="&sid="+localStorage.sid,$.ajax({type:"POST",url:getServerUrl()+"api/createNote.php",data:d,cache:!1,success:function(a){var o=JSON.parse(a);o.isSuccess?(null!=localStorage["errorConexion"+e]&&(localStorage.removeItem("errorConexion"+e),e<1e4&&(localStorage.refrescaNota=e,sendMessage({mensBack:"refrescaNota"}))),localStorage["treeId"+e]=o.idNota,sendRealTime(e,{create:!0},localStorage["tablon"+e]),$("#postit"+e).length>0&&$("#postit"+e).attr("data-treeid",o.idNota),o.espacio&&(localStorage.espacio=o.espacio),1e4!=e||!registrando&&"true"!=localStorage.nuevoReg||(localStorage.removeItem("nuevoReg"),registrando=!1,chrome.tabs.create({url:GO_PREMIUM_URL+"?sessionId="+localStorage.sessionId}),modalInstance.close()),e<1e4&&localStorage["postit"+e].indexOf("data:image/")>0&&null!=o.postit&&(localStorage["postit"+e]=o.postit.replace(/<\/p>n<p>/gm,"</p>\n<p>"),refrescaNota(e))):(console.log("OK "+o.error),sendReportError(localStorage.id_usuario,e,encodeURIComponent(JSON.stringify(t))))},error:function(t,a,o){404===t.status?manageConnectionError(e,"create"):localStorage.removeItem("errorConexion"+e)}})}}function manageConnectionError(e,t,a=!0){esBackground()?errorConexion(e,t):(sendMessage({menstoBack:"errorConexion",numPost:e,operacion:t}),a&&muestraAyuda("mensErrorConexion"))}function updateNotaMemo(e){isUserConnected()&&updateNotaLoginMemo(e)}function updateNotaLoginMemo(e){e<1e4?(localStorage["updated"+e]="true",sendRealTime(e,localStorage["tablon"+e])):updateNotaLogin(e)}function updateNotaLogin(e){if(!isDemoUser(e)&&isUserConnected()){if("undefined"!=localStorage["tablon"+e]&&null!=localStorage["tablon"+e]||(localStorage["tablon"+e]=1),e<1e4){null!=localStorage["sinMarco"+e]&&"undefined"!=localStorage["sinMarco"+e]||(localStorage["sinMarco"+e]="false");var t={tipoA:localStorage["tipoA"+e],X:localStorage["X"+e],Y:localStorage["Y"+e],postit:localStorage["postit"+e],width:localStorage["width"+e],height:localStorage["height"+e],fecha:localStorage["fecha"+e],tablon:localStorage["tablon"+e],calendar:localStorage["calendar"+e],sinMarco:localStorage["sinMarco"+e],rotacion:localStorage["rotacion"+e],pushpin:localStorage["pushpin"+e],notaWeb:localStorage["notaWeb"+e],columnaKanban:localStorage["columnaKanban"+e],connections:localStorage["connections"+e],minimizado:localStorage["minimizado"+e]};sendRealTime(e,localStorage["tablon"+e])}else{for(var a=new Array,o=new Array,n=new Array,i=new Array,r=new Array,s=new Array,l=1;l<=localStorage.numTablones;l++)null==localStorage["tab"+l+"Label"]&&(localStorage["tab"+l+"Label"]="undefined"),a.push(localStorage["tab"+l+"Label"]),o.push(localStorage["fondo"+l]),"true"==localStorage["publico"+l]?n.push(1):n.push(0),"true"==localStorage["masonry"+l]?r.push(1):r.push(0),i.push(ordenTablon(l)),localStorage["tablonKanban"+l]?s.push(localStorage["tablonKanban"+l]):s.push("");var c={tabLabels:a,tabBgs:o,tabPublico:n,tabOrden:i,tabMasonry:r,fuente:localStorage.fuente,size:localStorage.size,tabKanban:s};t={tipoA:TIPO_NOTA.TABLONES,X:0,Y:0,postit:JSON.stringify(c),width:0,height:0,fecha:"",tablon:0,calendar:"",pushpin:"",sinMarco:!1}}if(localStorage["updated"+e]="false",null==localStorage["userComp"+e]||"R"==localStorage["userComp"+e])var d=localStorage.id_usuario,u="false";else d=localStorage["userComp"+e],u="true";var p="id_usuario="+d;p+="&token="+localStorage.token,p+="&id_nota="+localStorage["treeId"+e],p+="&nota="+encodeURIComponent(JSON.stringify(t)),p+="&sid="+localStorage.sid,p+="&compartido="+u,$.ajax({type:"POST",url:getServerUrl()+"api/updateNote.php",data:p,cache:!1,success:function(a){var o=JSON.parse(a);o.isSuccess?(o.espacio&&(localStorage.espacio=o.espacio),null!=localStorage["errorConexion"+e]&&(localStorage.removeItem("errorConexion"+e),e<1e4&&(localStorage.refrescaNota=e,sendMessage({mensBack:"refrescaNota"}))),e<1e4&&localStorage["postit"+e].indexOf("data:image/")>0&&null!=o.postit&&(localStorage["postit"+e]=o.postit.replace(/<\/p>n<p>/gm,"</p>\n<p>"),refrescaNota(e))):(console.log("OK "+o.error),sendReportError(localStorage.id_usuario,e,encodeURIComponent(JSON.stringify(t))))},error:function(t,a,o){404===t.status?manageConnectionError(e,"update"):localStorage.removeItem("errorConexion"+e)}})}}function deleteNoteLogin(e){if(!isDemoUser()){var t="id_usuario="+localStorage.id_usuario;t+="&token="+localStorage.token,t+="&id_nota="+localStorage["treeId"+e],t+="&sid="+localStorage.sid,$.ajax({type:"POST",url:getServerUrl()+"api/deleteNote.php",data:t,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess?t.espacio&&(localStorage.espacio=t.espacio):console.log("OK "+t.error)},error:function(e,t,a){console.log(t)}})}}function borraListaNotas(e){if(!isDemoUser()){var t="id_usuario="+localStorage.id_usuario;t+="&token="+localStorage.token,t+="&listaNotas="+encodeURIComponent(JSON.stringify(e)),t+="&sid="+localStorage.sid,$.ajax({type:"POST",url:getServerUrl()+"api/deleteListNotes.php",data:t,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess?t.espacio&&(localStorage.espacio=t.espacio):console.log("OK "+t.error)},error:function(e,t,a){console.log(t)}})}}function borrarImagen(e){var t="imgUrl="+encodeURIComponent(e);$.ajax({type:"POST",url:getServerUrl()+"api/deleteImage.php",data:t,cache:!1,success:function(e){if(!isUserConnected())try{restaEspacioServidor(JSON.parse(e).spaceFiles)}catch(e){console.log(e)}},error:function(e,t,a){console.log(t)}})}function borrarFicherosAws(e,t){if(e&&-1!=e.indexOf("noteboardapp")){var a="ficheros="+encodeURIComponent(e);$.ajax({type:"POST",url:getServerUrl()+"api/borraFichAws.php",data:a,cache:!1,success:function(e){if(t&&!isUserConnected())try{restaEspacioServidor(JSON.parse(e).spaceFiles)}catch(e){console.log(e)}}})}}let getNotesTry=0;async function sincronizaLogin(e,t,a){esBackground()&&!localStorage.id_usuario&&await getLocalStorage();var o=getServerUrl()+"api/getNotes2.php";const n=new URLSearchParams;n.append("id_usuario",localStorage.id_usuario),n.append("token",localStorage.token);try{n.append("stackTrace",(new Error).stack),n.append("getNotesTry",getNotesTry)}catch(e){console.log(e)}fetch(o,{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n}).then((o=>{if(!o.ok)throw getNotesTry<3&&(getNotesTry++,setTimeout((function(){sincronizaLogin(e,t,a)}),1e4*getNotesTry)),new Error("Network response was not ok");return o.json()})).then((async function(o){getNotesTry=0;var n=o;n.isSuccess&&(localStorage.sid=n.sid,localStorage.confirmado=n.confirmado,localStorage.publicCount=n.publicCount,null!=n.invitaciones?recibeInvitaciones(n.invitaciones):localStorage.removeItem("invitaciones"),null!=n.invEnviadas?recibeInvEnviadas(n.invEnviadas):localStorage.removeItem("invEnviadas"),e?t&&"function"==typeof muestraPostit?cargaNotasAdd(n,t,a):(cargaNotasAdd(n,!1,a),esBackground()&&await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})):(inicializaLocalStorage(),cargaNotas(n,t,a),esBackground()&&await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})),null!=n.comparticiones?recibeComparticiones(n.comparticiones):localStorage.removeItem("comparticiones"),vaciarPapelera({},30),compruebaPopups(),muestraPops(),!esBackground()&&($(".updateButton").is(":visible")||$("#progress").is(":visible")||$("#black_overlay-web-app").is(":visible"))&&(refrescaPantalla(!1,!0),refrescaOrdenacion(),$(".updateButton").find(".ajaxloader").remove()),esBackground()?(chrome.contextMenus.removeAll(initializeMenus),miraAgenda(),await setAllLocalStorage()):(sendMessage({menstoBack:"cambioMenu"}),muestraPaneles2(!1,!0),$("#black_overlay-web-app").fadeOut(400)),compruebaNotasWeb())})).catch((e=>{console.error("Error:",e)}))}function cargaNotas(e,t,a){var o=0;e.mail&&(localStorage.mail=e.mail),e.espacio&&(localStorage.espacio=e.espacio),e.premium&&(localStorage.premium=e.premium);let n=0;for(;e[n];){if(null!=e[n].postit)if(e[n].tipoA!=TIPO_NOTA.TABLONES){var i=localStorage.totalPost;localStorage["tipoA"+i]=e[n].tipoA,localStorage["X"+i]=e[n].X,localStorage["Y"+i]=e[n].Y,localStorage["postit"+i]=e[n].postit,localStorage["width"+i]=e[n].width,localStorage["height"+i]="0"==e[n].height?"auto":e[n].height,localStorage["fecha"+i]=e[n].fecha,localStorage["treeId"+i]=e[n].id_nota,localStorage["tablon"+i]=e[n].tablon,localStorage["calendar"+i]=e[n].calendar,localStorage["sinMarco"+i]="1"==e[n].sinMarco,e[n].rotacion&&(localStorage["rotacion"+i]=e[n].rotacion),e[n].pushpin&&(localStorage["pushpin"+i]=e[n].pushpin),e[n].notaWeb&&(localStorage["notaWeb"+i]=e[n].notaWeb),e[n].columnaKanban&&(localStorage["columnaKanban"+i]=e[n].columnaKanban),e[n].connections&&(localStorage["connections"+i]=e[n].connections),e[n].minimizado&&"0"!=e[n].minimizado&&(localStorage["minimizado"+i]="1"==e[n].minimizado),parseInt(e[n].tablon)>o&&"-999"!=e[n].tablon&&(o=parseInt(e[n].tablon)),null!=e[n].permisos&&("RW"==e[n].permisos?localStorage["userComp"+i]=e[n].userComp:localStorage["userComp"+i]="R",localStorage["nickComp"+i]=e[n].nickComp,recuperaPosCompartido(i)),localStorage.totalPost++}else{localStorage.treeId10000=e[n].id_nota;try{var r=JSON.parse(e[n].postit)}catch(t){try{r=JSON.parse(e[n].postit.replace("\\",""))}catch(e){console.log(e);r={tabLabels:[]}}}var s=r.tabLabels.length,l=localStorage.numTablones;if(null==localStorage.errorConexion10000||s>l){for(var c=1;c<=s;c++)localStorage["tab"+c+"Label"]=r.tabLabels[c-1],localStorage["fondo"+c]=r.tabBgs[c-1],null!=r.tabPublico&&1==r.tabPublico[c-1]?localStorage["publico"+c]="true":localStorage["publico"+c]="false",null!=r.tabMasonry&&1==r.tabMasonry[c-1]?localStorage["masonry"+c]="true":localStorage["masonry"+c]="false",null!=r.tabOrden&&(localStorage["ordenTablon"+c]=r.tabOrden[c-1]),null!=r.tabKanban&&r.tabKanban[c-1]&&"null"!=r.tabKanban[c-1]&&(localStorage["tablonKanban"+c]=r.tabKanban[c-1]);localStorage.removeItem("errorConexion10000")}else clearInterval(intervalErrorConexion),intervalErrorConexion=setInterval(intentaConexion,1e4),s=l;localStorage.numTablones=s}n++}if(o>localStorage.numTablones){for(var d=parseInt(localStorage.numTablones);d<o;d++)null!=localStorage["fondo"+(d+1)]&&"undefined"!=localStorage["fondo"+(d+1)]||(localStorage["fondo"+(d+1)]=0);localStorage.numTablones=o}t&&sendMessage({mensBack:"muestraNotas"}),a?muestraNotasAlCompartir():inicializaInvitaciones(),localStorage.totalPost>0&&(cambiaIcono(),cambiaContador()),("-999"!=localStorage.tablonActual||!algunaNotaWeb())&&parseInt(localStorage.tablonActual)>parseInt(localStorage.numTablones)&&(localStorage.tablonActual=localStorage.numTablones)}function cargaNotasAdd(e,t,a){for(var o=localStorage.totalPost,n=new Array,i=!1,r=0,s=0;s<o;s++)n[s]=!1;e.mail&&(localStorage.mail=e.mail),e.espacio&&(localStorage.espacio=e.espacio),e.premium&&(localStorage.premium=e.premium);let l=0;for(;e[l];){if(null!=e[l].postit)if(e[l].tipoA!=TIPO_NOTA.TABLONES){var c=!1;for(s=0;s<o;s++)localStorage["postit"+s]==e[l].postit&&(n[s]=!0,c=!0);if(!c){var d=localStorage.totalPost;localStorage["tipoA"+d]=e[l].tipoA,localStorage["X"+d]=e[l].X,localStorage["Y"+d]=e[l].Y,localStorage["postit"+d]=e[l].postit,localStorage["width"+d]=e[l].width,localStorage["height"+d]="0"==e[l].height?"auto":e[l].height,localStorage["fecha"+d]=e[l].fecha,localStorage["tablon"+d]=e[l].tablon,localStorage["treeId"+d]=e[l].id_nota,localStorage["calendar"+d]=e[l].calendar,localStorage["sinMarco"+d]="1"==e[l].sinMarco,e[l].rotacion&&(localStorage["rotacion"+d]=e[l].rotacion),e[l].pushpin&&(localStorage["pushpin"+d]=e[l].pushpin),e[l].notaWeb&&(localStorage["notaWeb"+d]=e[l].notaWeb),e[l].columnaKanban&&(localStorage["columnaKanban"+d]=e[l].columnaKanban),e[l].connections&&(localStorage["connections"+d]=e[l].connections),e[l].minimizado&&"0"!=e[l].minimizado&&(localStorage["minimizado"+d]="1"==e[l].minimizado),parseInt(e[l].tablon)>r&&"-999"!=e[l].tablon&&(r=parseInt(e[l].tablon)),null!=e[l].permisos&&("RW"==e[l].permisos?localStorage["userComp"+d]=e[l].userComp:localStorage["userComp"+d]="R",localStorage["nickComp"+d]=e[l].nickComp,recuperaPosCompartido(d)),localStorage.totalPost++,t&&muestraPostit(d)}}else{localStorage.treeId10000=e[l].id_nota;try{var u=JSON.parse(e[l].postit)}catch(t){try{u=JSON.parse(e[l].postit.replace("\\",""))}catch(e){console.log(e);u={tabLabels:[]}}}var p=u.tabLabels.length,m=localStorage.numTablones;if(null==localStorage.errorConexion10000||p>m){for(var g=1;g<=p;g++)localStorage["tab"+g+"Label"]=u.tabLabels[g-1],localStorage["fondo"+g]=u.tabBgs[g-1],null!=u.tabPublico&&1==u.tabPublico[g-1]?localStorage["publico"+g]="true":localStorage["publico"+g]="false",null!=u.tabMasonry&&1==u.tabMasonry[g-1]?localStorage["masonry"+g]="true":localStorage["masonry"+g]="false",null!=u.tabOrden&&(localStorage["ordenTablon"+g]=u.tabOrden[g-1]),null!=u.tabKanban&&u.tabKanban[g-1]&&"null"!=u.tabKanban[g-1]&&(localStorage["tablonKanban"+g]=u.tabKanban[g-1]);localStorage.removeItem("errorConexion10000")}else clearInterval(intervalErrorConexion),intervalErrorConexion=setInterval(intentaConexion,1e4),p=m;(null==localStorage.numTablones||p>localStorage.numTablones)&&(localStorage.numTablones=p),i=!0}l++}if(localStorage.totalPost>0&&(cambiaIcono(),cambiaContador()),r>localStorage.numTablones){for(s=parseInt(localStorage.numTablones);s<r;s++)null!=localStorage["fondo"+(s+1)]&&"undefined"!=localStorage["fondo"+(s+1)]||(localStorage["fondo"+(s+1)]=0);localStorage.numTablones=r}addNotasNuevas(n,o,i),inicializaInvitaciones(),esTabCompartido(localStorage.tablonActual)?trataTablonComp():inicializaFriendsBot(),t&&refrescaPantalla(!1,!0)}function addNotasNuevas(e,t,a){if(!isDemoUser()){for(var o=new Array,n=0,i=0;i<t;i++)if(!e[i]){"undefined"!=localStorage["tablon"+i]&&null!=localStorage["tablon"+i]||(localStorage["tablon"+i]=1),null!=localStorage["sinMarco"+i]&&"undefined"!=localStorage["sinMarco"+i]||(localStorage["sinMarco"+i]="false");var r={tipoA:localStorage["tipoA"+i],X:localStorage["X"+i],Y:localStorage["Y"+i],postit:localStorage["postit"+i],width:localStorage["width"+i],height:localStorage["height"+i],fecha:localStorage["fecha"+i],tablon:localStorage["tablon"+i],calendar:localStorage["calendar"+i],sinMarco:localStorage["sinMarco"+i],rotacion:localStorage["rotacion"+i],pushpin:localStorage["pushpin"+i],notaWeb:localStorage["notaWeb"+i],columnaKanban:localStorage["columnaKanban"+i],connections:localStorage["connections"+i],minimizado:localStorage["minimizado"+i]};localStorage["updated"+i]="false",o[n]=r,n++}if(n>0){var s="id_usuario="+localStorage.id_usuario;s+="&token="+localStorage.token,s+="&listaNotas="+encodeURIComponent(JSON.stringify(o)),numIntentos=0,llamadaCreate(s,e,t,a)}else a?updateNotaLoginMemo(1e4):grabaNotaLogin(1e4)}}var numIntentos,numIntentosMod;function llamadaCreate(e,t,a,o){$.ajax({type:"POST",url:getServerUrl()+"api/createListNotes.php",data:e,cache:!1,success:function(e){var n=JSON.parse(e),i=0;if(n.isSuccess){n.espacio&&(localStorage.espacio=n.espacio);for(var r=0;r<a;r++)t[r]||(localStorage["treeId"+r]=n.idNota[i],addTreeIdPopup(n.idNota[i],r),addTreeIdConnection(n.idNota[i],r),addTreeIdKanban(n.idNota[i],r),$("#postit"+r).attr("data-treeId",n.idNota[i]),localStorage["postit"+r].indexOf("data:image/")>0&&null!=n.postit[i]&&(localStorage["postit"+r]=n.postit[i].replace(/<\/p>n<p>/gm,"</p>\n<p>"),refrescaNota(r)),i++);o?updateNotaLoginMemo(1e4):grabaNotaLogin(1e4)}else localStorage.sincroLogin=!1},error:function(e,o,n){console.log("Error llamadaCreate");for(var i=0;i<a;i++)t[i]||(manageConnectionError(i,"create",!1),errorConexion(i,"create"));muestraAyuda("mensErrorConexion")}})}function grabaModificaciones(){if(!isDemoUser()){for(var e=new Array,t=!1,a=0,o=0;o<localStorage.totalPost;o++)if("true"==localStorage["updated"+o]){if(t=!0,"undefined"!=localStorage["tablon"+o]&&null!=localStorage["tablon"+o]||(localStorage["tablon"+o]=1),null==localStorage["userComp"+o]||"R"==localStorage["userComp"+o])var n=localStorage.id_usuario;else n=localStorage["userComp"+o];null!=localStorage["sinMarco"+o]&&"undefined"!=localStorage["sinMarco"+o]||(localStorage["sinMarco"+o]="false");var i={id_nota:localStorage["treeId"+o],tipoA:localStorage["tipoA"+o],X:localStorage["X"+o],Y:localStorage["Y"+o],postit:localStorage["postit"+o],width:localStorage["width"+o],height:localStorage["height"+o],fecha:localStorage["fecha"+o],tablon:localStorage["tablon"+o],calendar:localStorage["calendar"+o],sinMarco:localStorage["sinMarco"+o],rotacion:localStorage["rotacion"+o],pushpin:localStorage["pushpin"+o],usuario:n,notaWeb:localStorage["notaWeb"+o],columnaKanban:localStorage["columnaKanban"+o],connections:localStorage["connections"+o],minimizado:localStorage["minimizado"+o]};localStorage["updated"+o]="false",e[a]=i,a++}if("true"==localStorage.updated10000){var r=new Array,s=new Array,l=new Array,c=new Array,d=new Array,u=new Array;for(o=1;o<=localStorage.numTablones;o++)null==localStorage["tab"+o+"Label"]&&(localStorage["tab"+o+"Label"]="undefined"),r.push(localStorage["tab"+o+"Label"]),s.push(localStorage["fondo"+o]),"true"==localStorage["publico"+o]?l.push(1):l.push(0),"true"==localStorage["masonry"+o]?d.push(1):d.push(0),c.push(ordenTablon(o)),localStorage["tablonKanban"+o]?u.push(localStorage["tablonKanban"+o]):u.push("");var p={tabLabels:r,tabBgs:s,tabPublico:l,tabOrden:c,tabMasonry:d,fuente:localStorage.fuente,size:localStorage.size,tabKanban:u};i={id_nota:localStorage.treeId10000,tipoA:TIPO_NOTA.TABLONES,X:0,Y:0,rotacion:"",postit:JSON.stringify(p),width:0,height:0,fecha:"",tablon:0,calendar:"",pushpin:"",sinMarco:!1,usuario:localStorage.id_usuario};e[a]=i,t=!0,localStorage.updated10000="false"}if(t){var m="id_usuario="+localStorage.id_usuario;m+="&token="+localStorage.token,m+="&listaNotas="+encodeURIComponent(JSON.stringify(e)),m+="&sid="+localStorage.sid,numIntentosMod=0,llamadaUpdate(m)}}}function llamadaUpdate(e){$.ajax({type:"POST",url:getServerUrl()+"api/updateListNotes4.php",data:e,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess||console.log("Error:  "+t.error)},error:function(t,a,o){console.log(t),console.log("Error UpdateList"),++numIntentosMod<8?(console.log("Intento otra vez..."+numIntentosMod),setTimeout((function(){llamadaUpdate(e)}),1e4)):console.log("No quedan intentos, mala suerte")}})}function sendReportError(e,t,a){var o="id_usuario="+e;o+="&numPost="+t,o+="&nota="+a,o+="&localStorage="+escape(JSON.stringify(localStorage)),o+="&navigator="+encodeURIComponent(navigator.userAgent+"-"+navigator.platform+"-"+navigator.cookieEnabled+"-"+navigator.language),o+="&origen=extensiÃ³n",$.ajax({type:"POST",url:getServerUrl()+"api/sendReport.php",data:o,cache:!1,success:function(e){},error:function(e,t,a){console.log(t)}})}function sendReportErrorGetNotes(){var e="stackTrace="+(new Error).stack;e+="&version="+chrome.runtime.getManifest().version,e+="&navigator="+encodeURIComponent(navigator.userAgent+"-"+navigator.platform+"-"+navigator.cookieEnabled+"-"+navigator.language),e+="&origen=extensiÃ³n",$.ajax({type:"POST",url:getServerUrl()+"api/sendReportTrace.php",data:e,cache:!1,success:function(e){},error:function(e,t,a){console.log(t)}})}var intervalErrorConexion=0;function errorConexion(e,t){null==localStorage["errorConexion"+e]&&(localStorage["errorConexion"+e]=t,localStorage.refrescaNota=e,sendMessage({mensBack:"refrescaNota"}),clearInterval(intervalErrorConexion),intervalErrorConexion=setInterval(intentaConexion,1e4))}function intentaConexion(){var e=!1;if(isUserConnected()){for(var t=0;t<localStorage.totalPost;t++)e=reintentarSiError(t)||e;(e=reintentarSiError(1e4)||e)||clearInterval(intervalErrorConexion)}else clearInterval(intervalErrorConexion)}function reintentarSiError(e){var t=!1;if(null!=localStorage["errorConexion"+e])switch(t=!0,localStorage["errorConexion"+e]){case"create":grabaNotaLogin(e);break;case"update":e<1e4&&yaExisteNota(e)?grabaNotaLogin(e):updateNotaLogin(e)}return t}function yaExisteNota(e){for(var t=localStorage["treeId"+e],a=0;a<localStorage.totalPost;a++)if(t==localStorage["treeId"+a]&&a!=e)return!0;return!1}function creaSlides(){if(muestraAyuda("ayudaPresentacion","info"),0!=$("div[class^='fuente']").length){$("html,body").css({width:"100%",height:"100%",overflow:"hidden"});var e=document.createElement("DIV");e.className="reveal";var t="";0==$(".reveal").length&&(t+='<div class="slides">'),$("div[class^='fuente']").each((function(){t+="<section>"+$(this).html()+"</section>"})),t+="</div>",0==$(".reveal").length?(t+="</div>",$(e).html(t),$("body").append(e),inicializaReveal()):($(".slides").html(t),inicializaReveal(),Reveal.slide(0),Reveal.sync()),$("body").css("background-image",""),$(".containerNB").hide(),$(".slide .controls, .slide .progress").show(),Reveal.addEventListener("slidechanged",(function(e){$("img:visible").each((function(){var e=$(this);if(e.offset().top+e.height()>window.innerHeight||0==e.height()){var t=window.innerHeight-e.offset().top-50;0==e.height()&&e.height(200),0==e.width()&&e.width(200);var a=t/e.height();e.height(t),e.width(e.width()*a)}}))})),Reveal.addEventListener("ready",(function(e){$("img:visible").each((function(){var e=$(this);if(e.offset().top+e.height()>window.innerHeight||0==e.height()){var t=window.innerHeight-e.offset().top-50;0==e.height()&&e.height(200),0==e.width()&&e.width(200);var a=t/e.height();e.height(t),e.width(e.width()*a)}}))}))}else sweetAlert({text:chrome.i18n.getMessage("presentacionSinNotas"),type:"error",cancel:!1})}function inicializaReveal(){Reveal.initialize({autoSlide:5e3,height:window.innerHeight,margin:0,mouseWheel:!0,dependencies:[{src:"lib/reveal/plugin/markdown/marked.js"},{src:"lib/reveal/plugin/markdown/markdown.js"}],keyboard:{27:quitarSlides},loop:!0})}function quitarSlides(){$(".containerNB").show(),$("html,body").css({width:$("#Postits").width(),height:"auto",overflow:"auto"}),$(".slide .controls, .slide .progress").hide(),location.reload()}function activarPresentacion(){var e;$("#activarPresentacion").is(":checked")?(e=$("#urlPublica").attr("href")+"?slides",$(".iframeCode textarea").val($(".iframeCode textarea").val().replace("?embed","?embed&slides"))):(e=$("#urlPublica").attr("href").substr(0,$("#urlPublica").attr("href").indexOf("?slides")),$(".iframeCode textarea").val($(".iframeCode textarea").val().replace("?embed&slides","?embed"))),$("#urlPublica").text(e.substr(8)),$("#urlPublica").attr("href",e)}$(document).ready((function(){$("#slidesBot").on("click",creaSlides),$("#slidesBot").attr("title",chrome.i18n.getMessage("slidesBot"))}));var numPostEditar,tablonActual=1,hideBarTop=0,hideMinimapa="true"==localStorage.noMinimapa;isMobile()||$(document).on("click",'a[href^="http"]',(function(e){e.preventDefault(),-1==document.URL.indexOf("newTab")?"https://www.noteboardapp.com/subscribe"==$(this).attr("href")&&localStorage.token?window.open($(this).attr("href")+`?user=${localStorage.id_usuario}&token=${localStorage.token}`,"_blank"):window.open($(this).attr("href"),"_blank"):window.open($(this).attr("href"),"_self")})),$(document).ready((function(){isChromeExtension()||isIOS()?$(".botones .material-icons ").show():document.fonts.onloadingdone=function(){$(".botones .material-icons ").show()},hideMinimapa&&$("#flechaMap").addClass("abajo"),tablonActual=getBoardNumberParam()||parseInt(localStorage.tablonActual)||1,document.URL.indexOf("hideBar")>-1&&($(".botones").hide().height(0),$("#slider").hide(),hideMinimapa=!0,esTablonOrdenado()||esTablonKanban()||(hideBarTop=40)),document.URL.indexOf("welcome")>-1&&isChromeExtension()&&!isEdgeBrowser()&&sweetAlert({text:chrome.i18n.getMessage("welcomeAdvice"),cancel:!1,type:"info",width:700}),document.URL.indexOf("newTab")>-1&&($(".containerNB").append(`<a id="original-new-tab" class="original-new-tab btn-floating btn-large waves-effect waves-light green mdc-elevation--z10" title="${chrome.i18n.getMessage("originalNewTab")}"><i class="material-icons">tab</i></a>`),$("#original-new-tab").on("click",(()=>{localStorage["original-new-tab"]="true",isEdgeBrowser()?chrome.tabs.create({url:"edge://newtab/"}):chrome.tabs.create({url:"chrome://newtab/"})}))),tablonActual>parseInt(localStorage.numTablones)&&(localStorage.tablonActual=localStorage.numTablones,tablonActual=parseInt(localStorage.tablonActual)),compruebaMinimapa();try{$(".fixed-action-btn").floatingActionButton({hoverEnabled:!1})}catch(e){console.log(e)}$("#maquetaPant").draggable({containment:"#canvasMaqueta",stop:dragMaqueta}),$(window).on("unload",(function(){sendMessage({cierraPopup:!0})})),$(window).on("resize",(function(e){e.target===window&&(inicializaTablonMasonry(),editandoAlgunaNota()||refrescaKanban(),reduceTamanyoSiDosFilas(),refreshConnections(),$("#Postits").css({"background-size":"auto","background-position":"0 "+$(".botones").height()+"px"}),isSmallScreen()?initSmallScreen():removeSmallScreen())})),$(window).scroll((function(e){cambiaMaquetaPant(e)})),idiomaEsp(navigator.language)||$("#boardsImg").attr("src","appimg/boards-en.png"),listenMessage("mensBack",(function(e,t){"captura"==e.mensBack&&(muestraPostit(localStorage.totalPost-1),ponAlFrentePost(localStorage.totalPost-1),null!=localStorage.fuente&&"NaN"!=localStorage.fuente?cambiaFuente(localStorage.fuente):localStorage.fuente=1,compruebaLimites(),refrescaOrdenacion(),cambiaIcono()),"refrescaPantalla"==e.mensBack&&refrescaPantalla(),"muestraNotas"==e.mensBack&&(hayAlgunaNotaConZoom()||refrescaPantalla(!1,!1,!0),inicializaInvitaciones(),esTabCompartido(tablonActual)?trataTablonComp():inicializaFriendsBot(),inicializaPapelera(),refrescaOrdenacion()),"muestraNota"==e.mensBack&&iraNota(),"refrescaNota"==e.mensBack&&(refrescaNota(e.nota||localStorage.refrescaNota),localStorage.removeItem("refrescaNota"),compruebaLimites(),refrescaOrdenacion()),"seleccionTemaMod"==e.mensBack&&inicializaTema(!0),"compruebaNotasWeb"==e.mensBack&&compruebaNotasWeb(),"cambiaMinimapa"==e.mensBack&&(hideMinimapa="true"==localStorage.noMinimapa,compruebaMinimapa(),cambiaIcono()),"avisoEspacio"==e.mensBack&&muestraMensajeNohayEspacio(),"notaEnEdicion"==e.mensBack&&addContentToEditor(e.numPost,e.content)})),$(document).on("click",".fondo",(function(){var e=this.id.substr(5);"99"==e?nuevoFondo():localStorage["fondo"+tablonActual]!=e&&(localStorage["fondo"+tablonActual].indexOf("http")>-1&&!isUserConnected()&&compruebaBorrarImagen(localStorage["fondo"+tablonActual]),localStorage["fondo"+tablonActual]=e,cambiaFondoNum(e),grabaTablones(),cierraFondos())})),$(".tabPaneles2").on("click",clickTablon),$(document).on("dblclick","#Postits",(function(e){(0==e.target.className.indexOf("Postits")||e.target.className.indexOf("columna")>-1)&&(algunEditorAbierto()?aceptaEdicion():(clearSelection(),$("#postitnuevo").is(":visible")?$("#postitnuevo").hide():muestraEditorNuevaNota(e.pageX,e.pageY)))})),$(document).on("dblclick",".ui-resizable-handle",(function(e){restoreResize(e)})),$(document).on("click",".noteBoardCheck",(function(e){var t=$(e.target).closest(".postitNB").attr("data-numpost");isChromeExtension()?$(this).attr("checked")?$(this).attr("checked",!1):$(this).attr("checked",!0):$(this).attr("checked")?$(this).attr("checked",!0):$(this).attr("checked",!1),localStorage["postit"+t]=$("#texto"+t).html(),isUserConnected()&&!esNotaCompartida(t)&&updateNotaLogin(t),sendMessage({postMod:"cambioPost",numPost:t})})),$("#papelera").on("click",clickTablon),$("#cambF").on("click",abreFuentes),$("#subirF").on("click",(function(){tamanoFuente("+")})),$("#bajarF").on("click",(function(){tamanoFuente("-")})),$("#botonPost, #post-floating-button").on("click",muestraEditorNuevaNota),$("#cameraBot").on("click",muestraFormularioCamara),$("#optionsBot").on("click",(function(){isChromeExtension()?chrome.tabs.create({url:"options.html"}):chrome.tabs.create({url:"options.php"})})),$("#refreshBot").on("click",(function(){isUserConnected()?($("#black_overlay-web-app").show(),grabaModificaciones(),sincronizaLogin(!1,!0)):muestraAdvertenciaLogin("registrateParaSincro")})),$("#botonAnexa, #anexa-floating-button").on("click",anexaFichero),$("#botonchatgpt, #post-chatgpt").on("click",abreChatgpt),$("#post-embed-code").on("click",postEmbedCode),$("#cambFondo").on("click",cambiaFondo),$("#cerrar-web-app").on("click",(function(){grabaModificaciones(),window.open("./","_self")})),$("#lostPwd").on("click",enviaPassword),$("#tablonAdd").on("click",addBoard),$("#friendsBot").on("click",muestraUsuariosComp),$("#searchBot").on("click",searchPostit),$("#searchInput").on("keydown",userEnterText),$("#compBot").on("click",comparteTablon),$("#publicBot").on("click",abreFormPublico),$("#invitacionesBot").on("click",muestraInvitaciones),$("#ordenaBot").on("click",ordenaPostits),$("#dialog-confirm").on("click",".anulInvBut",anularInvitacion),$(".boardsSwitch").on("click",muestraFilaTablones),$(".mapSwitch").on("click",toggleMap),$(".pinImgSelec").on("click",clickImgSelec),$("body").on("click",".pinImgSelecEdit",clickImgSelecEdit),$("#botonVaciarPapelera").on("click",vaciarPapelera),inicializaPapelera(),inicializaTema(),inicializaInvitaciones(),inicializar(),isSmallScreen()&&initSmallScreen(),isMobile()?initMovil():($("html").kinetic({slowdown:.9,filterTarget:function(e){return $(e).hasClass("Postits")||$(e).hasClass("tablonPostits")||$(e).hasClass("columna")},moved:function(e){$("body").css("cursor","url('appimg/closeHand.png'),auto"),kineticUsado=!0},stopped:function(e,t){$("body").css("cursor","auto"),kineticUsado=!1}}),programaEventosRaton())}));var alturaPaneles2Aux,kineticUsado=!1;function inicializar(){if(preloadImages(),isDemoUser()&&!isChromeExtension()&&("6"==getBoardNumberParam()||isBugsIdeasUser()||sweetAlert({text:chrome.i18n.getMessage("demoUser"),cancel:!1,type:"warning"})),document.getElementById("botonVaciarPapelera").innerText=chrome.i18n.getMessage("botonVaciarPapelera"),$("#papelera").attr("title",chrome.i18n.getMessage("papelera")),$("#cambF").attr("title",chrome.i18n.getMessage("defaultFont")),$("#cambFondo").attr("title",chrome.i18n.getMessage("cambFondo")),$("#cambZoom").attr("title",chrome.i18n.getMessage("cambZoom")),$("#panelBotDiv").attr("title",chrome.i18n.getMessage("panelBotDiv")),$(".boardsSwitch").attr("title",chrome.i18n.getMessage("flechaMuestra")),$("#compBot").attr("title",chrome.i18n.getMessage("compartir")),$("#searchBot").attr("title",chrome.i18n.getMessage("searchBot")),$("#ordenaBot").attr("title",chrome.i18n.getMessage("ordenaAutomatico")),$("#publicBot").attr("title",chrome.i18n.getMessage("publicBot")),$("#ordenaBot").attr("title",chrome.i18n.getMessage("ordenaBot")),$("#friendsBot").attr("title",chrome.i18n.getMessage("friendsBot")),$("#optionsBot").attr("title",chrome.i18n.getMessage("optionsBot")),$("#refreshBot").attr("title",chrome.i18n.getMessage("refreshBot")),$("#kanbanBot").attr("title",chrome.i18n.getMessage("kanbanBot")),$("#pluginBot").attr("title",chrome.i18n.getMessage("pluginBot")),$("#stickersBot").attr("title",chrome.i18n.getMessage("stickersBot")),$("#anexaFichNuevo").attr("title",chrome.i18n.getMessage("anexaFichero")),$("#botonPost, #post-floating-button").attr("title",chrome.i18n.getMessage("nuevoPost")),$("#botonchatgpt, #post-chatgpt").attr("title",chrome.i18n.getMessage("nuevaNotaChatgpt")),$("#cameraBot").attr("title",chrome.i18n.getMessage("cameraBot")),$("#botonAnexa, #anexa-floating-button").attr("title",chrome.i18n.getMessage("botonAnexa")),$("#botonFoto, #image-floating-button").attr("title",chrome.i18n.getMessage("botonFoto")),$(".pinImgSelecEdit").attr("title",chrome.i18n.getMessage("selecPin")),$(".pinImgSelec:first-child").attr("title",chrome.i18n.getMessage("quitaPin")),$("#datosUsuarioBot").attr("title",chrome.i18n.getMessage("datosPerfilBot")),isChromeExtension()?$("#backupBot").attr("title",chrome.i18n.getMessage("backupBot")):$("#backupBot").hide(),$("#cerrar-web-app").attr("title",chrome.i18n.getMessage("salirWebApp")),webkitBrowser()||$("#backupBot").hide(),$(".top-bar-icons li, .btn-floating").tooltipster({theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:100,zIndex:50000001}),$("#datosUsuarioBot").on("click",mostrarDatosUsuario),$("#loginBot div").text(chrome.i18n.getMessage("loginBot")),$("#loginBot").on("click",(function(){loginModal()})),isUserConnected()&&(0!=localStorage.id_usuario&&null!=localStorage.id_usuario&&"undefined"!=localStorage.id_usuario||(localStorage.sincroLogin="false")),"false"!=localStorage.sincroLogin){var e=obtenerBotonLogin();$("#loginBot").html(e)}actualizaNombreTablon(),"true"==localStorage["publico"+tablonActual]?$("#publicBot").css({"box-shadow":"0 0 50px black inset","background-color":"initial"}):$("#publicBot").css({"box-shadow":"0 0 0px black inset"}),$("#panelBotDiv").on("click",abrePaneles),$("#canvasMaqueta").on("click touchstart",clickCanvas),document.getElementById("tab5LabelAdd")&&(document.getElementById("tab5LabelAdd").innerText=chrome.i18n.getMessage("labelAdd")),null==localStorage.totalPost&&(localStorage.totalPost=0),null!=localStorage.fuente&&"NaN"!=localStorage.fuente?cambiaFuente(localStorage.fuente):localStorage.fuente=2,null!=localStorage["fondo"+tablonActual]&&"NaN"!=localStorage["fondo"+tablonActual]?cambiaFondoNum(localStorage["fondo"+tablonActual]):localStorage["fondo"+tablonActual]=VALORES_POR_DEFECTO.FONDO,initializeTopBar(),esTablonKanban()?inicializaKanban():borraKanban(),muestraTodasLasNotas(),alturaPaneles2Aux=$(".paneles2").height(),setTimeout((function(){alturaPaneles2Aux!=$(".paneles2").height()&&refrescaPantalla()}),200),inicializaTablonMasonry(),null!=localStorage.numTablones&&"undefined"!=localStorage.numTablones||(localStorage.numTablones=5),hayEdicionNuevaNotaPendiente()&&(setTimeout(crearEditor,1200),setTimeout(muestraEditorNuevaNota,1800)),editandoAlgunaNota()&&setTimeout(activarMod,1500),$("body").on("click",(function(e){e.target.className&&e.target.className.indexOf&&(e.target.className.indexOf("Postits")>-1||e.target.className.indexOf("columna")>-1)?(cierraFuentes(),$(".nicksComp").fadeOut(),$(".searchPanel").fadeOut(),cierraFondos(),$("#panelBotDiv").css({"box-shadow":"0 0 0px black inset"}),$("#compBot").css({"box-shadow":"0 0 0px black inset"}),$("#searchBot").css({"box-shadow":"0 0 0px black inset"}),-1!=numPostSearch&&$("#texto"+numPostSearch).html(localStorage["postit"+numPostSearch]),kineticUsado||$(".classTransparent").removeClass("classTransparent"),kineticUsado=!1):mirarSiCerrar(e.target)})),algunaNotaWeb()&&addBoardNotasWeb(),esTabCompartido(tablonActual)?trataTablonComp():inicializaFriendsBot(),null!=localStorage.muestraNota&&setTimeout(iraNota,600),$("#Postits").imagesLoaded((function(){compruebaLimites(),cambiaIcono(!0)})),localStorage.totalPost>15&&(muestraVotar(),compruebaBackup()),detectColorContrastBackground().then((()=>{refreshConnections(),$(".columna").css("borderColor",defaultColorContrastBackground)})),checkBoardRealTime(tablonActual),showNewFeature("newversion3","boarddemo?boardNumber=4"),!isChromeExtension()&&addNopubli(),isMobile()&&muestraAyuda("ayudaMovil")}var kanbanOrigen,moviendo,tablonDest2,tablonDest3,heightWhenResizeStart,posicionXNuevaNota,columnaKanbanNuevaNota,hayYoutubeSpotify=!1;function dragStart(e,t){$("#postit"+t).draggable("option","iframeFix",!0).addClass("postitMoving"),moviendo=void 0,localStorage["rotacion"+t]&&(document.getElementById("postit"+t).style.transform="rotate("+localStorage["rotacion"+t]+"deg)"),$(e.target).find(".pinImg").css("opacity","0.5"),$("#sharePanel"+t).is(":visible")?$("#sharePanel"+t).remove():esTablonKanban()&&(kanbanOrigen=getColumnPostit(t))}function dragMove(e,t,a){t.position.top=Math.round(t.position.top/zoomGlobal),t.position.left=Math.round(t.position.left/zoomGlobal);$("#Postits").width(),$("#Postits").height();var o=$("#postit"+a).height(),n=$("#postit"+a).width();t.position.left<0&&(t.position.left=0),t.position.top<0&&(t.position.top=0);var i=topBarHasBoards()?$(".paneles2").height():0;localStorage["X"+a]=t.offset.left,localStorage["Y"+a]=t.offset.top-i;var r=$("#Postits"),s=r.height(),l=r.width();if(t.offset.top+o+50>s&&(r.height(t.offset.top+o+200),$(".Postits,.tablonPostits").height(t.offset.top+o+200)),t.offset.left+n+110>l&&(r.width(t.offset.left+n+200),$(".Postits,.tablonPostits").width(t.offset.left+n+200)),$("#"+e.target.id).hasClass("classTransparent")){var c=t.offset,d=$(this).data("prevLoc");d||(d=t.originalPosition),moveSelected(a,c.left-d.left,c.top-d.top,i),$(this).data("prevLoc",c)}cambiaIcono(),refreshConnections()}function dragEnd(e,t,a){$("#postit"+a).draggable("option","iframeFix",!1).removeClass("postitMoving");var o=maxZindex(a);$("#postit"+a).css("z-index",o+1),$(".fondoIconos").css("z-index","0");var n=topBarHasBoards()?$(".paneles2").height():0;localStorage["X"+a]=t.offset.left-zoomLeftAdjust,localStorage["Y"+a]=t.offset.top-n-zoomTopAdjust;var i=$(".botones").height()-n;localStorage["Y"+a]<i&&(localStorage["Y"+a]=i,"true"==localStorage["sinMarco"+a]&&$("#parteSuperior"+a).show(),$("#postit"+a).offset({top:$(".botones").height()})),$(e.target).find(".pinImg").css("opacity","1"),$(".classTransparent").each((function(){var e=$(this).attr("id").substr(6);localStorage["Y"+e]<i&&(localStorage["Y"+e]=i,"true"==localStorage["sinMarco"+e]&&$("#parteSuperior"+e).show(),$("#postit"+e).offset({top:$(".botones").height()}),updateNotaLoginMemo(e))})),moviendo=a,$(this).data("prevLoc",""),"true"==localStorage["masonry"+tablonActual]&&($(e.target).css({"margin-top":"10px","margin-left":"10px"}),aplicaMasonry()),esTablonKanban()&&(localStorage["columnaKanban"+a]=getColumnPostit(a),refrescaContadoresKanban()),isUserConnected()&&(updateNotaLoginMemo(a),$(".classTransparent").each((function(){updateNotaLoginMemo($(this).attr("id").substr(6))}))),compruebaPostitDebajoDeOtros(),refreshConnections()}function moverNotaOpc(e){abrirPantallaModal(obtenerFormularioMover(e),{onOpenStart:function(){$("#listaTablones option").sortElements((function(e,t){return parseInt($(e).attr("orden"))>parseInt($(t).attr("orden"))?1:-1})),$("#mover-nota").off().on("click",(function(){moverNotaConfirmado(parseInt($("#listaTablones").val()),e),modalInstance.close()}))},height:300,width:500})}function moverNota(e,t){var a;1e3==e?(e=0,a=$(".classTransparent").length>1?chrome.i18n.getMessage("confirmacionMoverVariasPapelera"):chrome.i18n.getMessage("confirmacionMoverPapelera")):(a=$(".classTransparent").length>1?chrome.i18n.getMessage("confirmacionMoverVarias"):chrome.i18n.getMessage("confirmacionMover"),a+=nombreTablon(e)),sweetAlert({text:a,successCallback:function(){moverNotaConfirmado(e,t)},cancelCallback:function(){$("#postit"+t).css("opacity","1")}})}function moverNotaConfirmado(e,t,a){var o=localStorage["tablon"+t];localStorage["tablon"+t]!=e&&($(".classTransparent").length>0&&$(".classTransparent").each((function(){var t=$(this).attr("id").substr(6);null==localStorage["userComp"+t]?mueveNotaPeroYa(o,e,t,a):$(this).removeClass("classTransparent")})),mueveNotaPeroYa(o,e,t,a),cambiaIcono(),cambiaContador())}function mueveNotaPeroYa(e,t,a,o){if(localStorage["tablon"+a]=t,localStorage["X"+a]=100,localStorage["Y"+a]=100,borraConnectionsPostit(a),refreshConnections(),localStorage.removeItem("columnaKanban"+a),refrescaContadoresKanban(),o){var n=new Date;idiomaEsp(navigator.language)?localStorage["fecha"+a]=n.getDate()+"/"+(n.getMonth()+1)+"/"+n.getFullYear():localStorage["fecha"+a]=n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear()}"0"==e&&inicializaPapelera(),$(".paneles2").is(":visible")&&0!=t?moverPostitTablon(a,t):$("#postit"+a).remove(),isUserConnected()&&updateNotaLoginMemo(a)}function moveSelected(e,t,a,o){$(".classTransparent").each((function(){var n=$(this);if(n.attr("id")!="postit"+e){var i=n.position(),r=Math.round(i.left/zoomGlobal),s=Math.round(i.top/zoomGlobal);r+t>0&&n.css("left",r+t),n.css("top",s+a);var l=n.attr("id").substr(6);r>0&&(localStorage["X"+l]=r),localStorage["Y"+l]=s-o}}))}function resizeStart(e,t,a){heightWhenResizeStart=tieneNotaAlturaAuto(a)?$("#postit"+a).height():0,hayYoutubeSpotify=isIframeEmbeded(localStorage["postit"+a]),localStorage["postit"+a].indexOf("<iframe")>-1&&$("#texto"+a).html("Resizing iframe").hide(),$("#postit"+a).css("z-index",maxZindex()+1).addClass("postitResizing").removeClass("postit-auto"),$("#texto"+a).css({"overflow-x":"inherit","overflow-y":"auto"})}function resizePostit(e,t){estaEditorAbierto(t)||(localStorage["width"+t]=$("#postit"+t).width(),localStorage["height"+t]=$("#postit"+t).height()),esSticker(t)&&$("#texto"+t).height(localStorage["height"+t]+"px"),refreshConnections(),cambiaIcono()}function resizePostitStop(e,t){heightWhenResizeStart&&Math.abs($("#postit"+t).height()-heightWhenResizeStart)<15?localStorage["height"+t]="auto":"true"!=localStorage["sinMarco"+t]&&muestraAyudaSnackbar("resizeToAutoHelp"),hayZoom()&&$("#postit"+t).offset({top:ui.position.top-zoomTopAdjust,left:ui.position.left-zoomLeftAdjust}),isUserConnected()&&!estaEditorAbierto(t)&&updateNotaLoginMemo(t),$(e.target).find(".pinImg").css("opacity","1"),"Resizing iframe"==$("#texto"+t).html()&&$("#texto"+t).html(localStorage["postit"+t]).show(),hayYoutubeSpotify&&!localStorage["editando"+t]&&resizeIframes(t,$("#postit"+t).width(),$("#postit"+t).height()),estaEditorAbierto(t)||refrescaNota(t),refrescaOrdenacion(),compruebaPostitDebajoDeOtros(),$("#postit"+t).removeClass("postitResizing"),hightlightCode()}function resizeEditor(e){$("#postitnuevo").height("auto")}function muestraEditorNuevaNota(e,t,a){if(!salSiPapelera()){if(!userHasSpace())return muestraMensajeNohayEspacio(),!1;initializeNewPostit(),columnaKanbanNuevaNota=a,posicionXNuevaNota=esTablonKanban()&&t?e:0,document.getElementById("capaContenedoraAnun").innerHTML="";var o=$("#postitnuevo");if(o.is(":visible"))return $("html, body").animate({scrollTop:$("#postitnuevo").offset().top-150,scrollLeft:$("#postitnuevo").offset().left-250},200),void o.fadeOut(1200);if(1!=zoomGlobal&&(e&&(e/=zoomGlobal,t/=zoomGlobal),iniZoom()),$("#postitnuevo").width(VALORES_POR_DEFECTO.MIN_WIDTH_EDITANDO_NOTA),o.show(),isSmallScreen()&&(zoomNota(null,"postitnuevo",!1,!0),o.css("min-width",0)),t){var n=$(".tablonPostits").height(),i=$(".tablonPostits").width();e+$("#postitnuevo").width()>i&&(e-=$("#postitnuevo").width()),e<0&&(e=10),t+$("#postitnuevo").height()>n&&(t-=$("#postitnuevo").height())}else muestraAyudaSnackbar("ayudaNuevaNota"),$("#postitnuevo").offset({top:$("html").scrollTop()+150,left:$("html").scrollLeft()+250});o.offset({top:t,left:e}).addClass("scale-up-center"),tinyMCE.get("textoAnun")?iniEditor():crearEditor(null,iniEditor)}}var imagenFondo,windowWidth,intentos=0;function iniEditor(){tinyMCE.get("textoAnun").setContent(""),cambiaAparenciaEditor(buscarTipo("postitnuevo"),"postitnuevo"),setTimeout((function(){cambiaAparenciaEditor(buscarTipo("postitnuevo"),"postitnuevo")}),500),cambioPostit(localStorage.colorNewNote||TIPO_NOTA.BLANCO,"postitnuevo"),""!=localStorage.editando&&null!=localStorage.editando&&"undefined"!=localStorage.editando&&tinyMCE.get("textoAnun").setContent(localStorage.editando),tinyMCE.get("textoAnun").focus(),tinyMCE.get("textoAnun").on("change",(function(e){localStorage.editando=e.level.content})),tinyMCE.get("textoAnun").addShortcut("ctrl+q","",(function(){localStorage.editando="",$("#postitnuevo").is(":visible")&&$("#postitnuevo").hide(),this.editorContainer.className.indexOf("mce-fullscreen")>-1&&this.execCommand("mceFullScreen")}))}function buscarTipo(e){return $("#"+e).attr("data-tipo")||"1"}function guardaPostit(e,t,a){if(isSmallScreen()&&quitaZoom("postitnuevo"),t){var o=e;a<$(".botones").height()&&(a=$(".botones").height()+10)}else o=tinyMCE.get("textoAnun").getContent();if(localStorage.editando="",""==o)return document.getElementById("capaContenedoraAnun").innerHTML="<font color='red'><big><b>"+chrome.i18n.getMessage("vacio")+"</font>",!1;o=compruebaVideos(o);var n=localStorage.totalPost;if(t)var i=getRandomNoteType();else i=buscarTipo("postitnuevo");var r=document.createElement("div");r.id="postit"+n,localStorage["sinMarco"+n]=$("#sinMarcoNuevo").is(":checked")||i==TIPO_NOTA.TRANSPARENTE,(o.indexOf("<iframe ")>-1||o.indexOf("<video ")>-1)&&(localStorage["sinMarco"+n]="true");var s=$("#postitnuevo .pinImg").data("pushpin")||0;if("true"==localStorage["sinMarco"+n]?i.length<2?r.className="postit"+i+" postitSinMarco postitNB":r.className="postit1 postitSinMarco postitNB":i.length<3?r.className="postit"+i+" postitNB":r.className="postit1 postitNB",r.innerHTML=`<div class="parteSuperior" id="parteSuperior${n}">\n\t\t\t\t<div class="bordesup" id="bordesup${n}"></div>\n\t\t</div>\n\t\t<div class="fuente${localStorage.fuente} textoNB"  id="texto${n}">${o}</div>\n\t\t<div class="clearfloat"></div>`,document.getElementById("Postits").appendChild(r),i.length>2){var l=colorLuminance(i,-.2);document.getElementById("postit"+n).style.background="linear-gradient(#"+i+", "+l+")"}var c=$("#postit"+n);c.width("auto"),s&&(localStorage["pushpin"+n]=s,c.addClass("pinnedNB"));var d=iframeWidth(n);if(d>0&&d>370?c.width(d):d>0&&d<370&&resizeIframes(n,$("#postit"+n).width(),$("#postit"+n).height()),t)var u=a,p=t;else u=$("#postitnuevo").offset().top,p=$("#postitnuevo").offset().left;c.offset({top:u,left:p}),document.getElementById("postitnuevo")&&(document.getElementById("postitnuevo").style.display="none"),guardaTextoEnNota(n,o),localStorage["tablon"+n]=tablonActual,localStorage["tipoA"+n]=i,localStorage["X"+n]=p;var m=topBarHasBoards()?$(".paneles2").height():0;localStorage["Y"+n]=u-m,localStorage["width"+n]="auto",(c.width()>500||esVideo(o))&&(localStorage["width"+n]=500),t&&(c.width(370),localStorage["width"+n]=370,$("#texto"+n+" *").each((function(e){$(this).width()>localStorage["width"+n]&&(c.width($(this).width()),localStorage["width"+n]=$(this).width())}))),localStorage["height"+n]="auto",esTablonKanban()&&(localStorage["columnaKanban"+n]=columnaKanbanNuevaNota||(posicionXNuevaNota?getColumnPosition(posicionXNuevaNota):0)),c.remove(),muestraPostit(n),esTablonKanban()&&guardaOrdenKanban(),ponAlFrentePost(n);var g=new Date;idiomaEsp(navigator.language)?localStorage["fecha"+n]=g.getDate()+"/"+(g.getMonth()+1)+"/"+g.getFullYear():localStorage["fecha"+n]=g.getMonth()+1+"/"+g.getDate()+"/"+g.getFullYear(),localStorage.totalPost++,isUserConnected()&&grabaNotaLogin(n),tinyMCE.get("textoAnun")&&tinyMCE.get("textoAnun").setContent(""),compruebaLimites(),refrescaKanban(),cambiaContador(),cambiaIcono(),aplicaMasonry(!0),hightlightCode()}function esNotaVisibleEnTablon(e,t){var a=localStorage["tablon"+e];return((null==a||"undefined"==a||parseInt(a)<0&&-999!=parseInt(a))&&1==t||a==t)&&(!esNotaCompartida(e)||isUserConnected())}function muestraPostit(e,t){if(esNotaVisibleEnTablon(e,tablonActual)){""!=localStorage["tipoA"+e]&&null!=localStorage["tipoA"+e]&&"undefined"!=localStorage["tipoA"+e]||(localStorage["tipoA"+e]=1);var a=localStorage["tipoA"+e];localStorage["postit"+e]||(localStorage["postit"+e]="");var o=localStorage["postit"+e];isSmallScreen()&&(o=changeIframesToLink(o));var n=document.createElement("div");n.id="postit"+e,localStorage["treeId"+e]&&(n.dataset.treeid=localStorage["treeId"+e]),n.dataset.numpost=e,"true"!=localStorage["sinMarco"+e]&&a!=TIPO_NOTA.TRANSPARENTE||isMobile()&&o.indexOf("<iframe")>-1?a.length<3?n.className="postit"+a+" postitConMarco postitNB":n.className="postit1 postitConMarco postitNB":a.length<3?n.className="postit"+a+" postitSinMarco postitNB":n.className="postit1 postitSinMarco postitNB",isMobile()&&(n.className+=" touch-screen");var i=esTablonKanban();if(localStorage["minimizado"+e]&&(n.className+=" postit-min"),n.innerHTML=`<div class="bordesup" id="bordesup${e}"></div>\n\t\t\t<div class="parteSuperior" id="parteSuperior${e}" data-numpost=${e}>\n\t\t\t\t<div class="fondoIconos tooltip" id="fondoIconos${e}"></div>\n\t\t\t\t<img class="rotateTool tooltip" draggable="false" id="rotateTool${e}" src="appimg/rotate.png"/>\n\t\t\t\t<img class="zoomTool tooltip" id="zoomImg${e}" src="appimg/zoomIn.png"/>\n\t\t\t\t<img class="minimizaTool tooltip" id="minimizaImg${e}" src="appimg/${localStorage["minimizado"+e]?"zoomIn.png":"zoomOut.png"}"/>\n\t\t\t\t<img class="connectImg tooltip" id="connectImg${e}" src="appimg/connect.png"/>\n\t\t\t\t${o.indexOf("<video")>-1?`<img class="pipVideo tooltip" id="pipVideo${e}" src="appimg/pip.png"/>`:""}\n\t\t\t\t<img class="creaPop tooltip" id="creaPop${e}" src="appimg/newtab.png"/>\n\t\t\t\t<img class="duplica tooltip" id="duplica${e}" src="appimg/duplicar.png"/>\n\t\t\t\t<i class="copiaPortapapeles material-icons tooltip" id="copiaPortapapeles${e}">content_paste</i>\n\t\t\t\t<img class="anexaFich tooltip" id="anexaFich${e}" src="appimg/clipNegro.png"/>\n\t\t\t\t<img class="share tooltip" id="share${e}" src="appimg/share2.png"/>\n\t\t\t\t<img class="calendar tooltip" id="calendar${e}" src="appimg/calendar.png"/>\n\t\t\t\t<img class="moverImg tooltip" id="moverImg${e}" src="appimg/tab.png"/>\n\t\t\t\t<img class="pencilImg tooltip" id="pencilImg${e}" src="appimg/pencil.png"/>\n\t\t\t\t${isMobile()?`<img class="botonborrar tooltip" id="borr${e}" src="appimg/remove.png"/>`:`<button type="button" class="botonborrar tooltip" id="borr${e}"><span class="lid"></span><span class="can"></span></button>`}\n\t\t\t</div>\n\t\t\t<div class="fuente${localStorage.fuente} textoNB"  id="texto${e}">${o}</div>\n\t\t\t</div>`,i&&$("#columna0").length>0){localStorage["columnaKanban"+e]&&"undefined"!=localStorage["columnaKanban"+e]||(localStorage["columnaKanban"+e]="0");var r=document.getElementById("columna"+localStorage["columnaKanban"+e]);r?r.appendChild(n):document.getElementById("columna0").appendChild(n),$("#postit"+e).addClass("postit-kanban")}else(t||0===t)&&$(".postitNB").length>0?0===t?$("#Postits").prepend(n):$(".Postits .postitNB:nth-child("+t+")").after(n):document.getElementById("Postits").appendChild(n);var s=$("#postit"+e);if(a==TIPO_NOTA.LIBRETA&&s.removeClass("postit1").addClass("postit80").addClass("notepad"),localStorage["pushpin"+e]&&(s.append('<img class="pinImg" data-pushpin="'+localStorage["pushpin"+e]+'" src="appimg/pushpins/pushpin'+localStorage["pushpin"+e]+'.png" />'),s.addClass("pinnedNB")),$("#texto"+e).css({"font-size":localStorage.size}),a.length>3){var l=colorLuminance(a,-.2);document.getElementById("postit"+e).style.background="linear-gradient(#"+a+", "+l+")",esColorOscuro(a)&&$("#parteSuperior"+e).addClass("fondoBlanco")}if(esTablonPapelera()){$("#creaPop"+e).remove(),$("#duplica"+e).remove(),$("#copiaPortapapeles"+e).remove(),$("#share"+e).remove(),$("#calendar"+e).remove(),$("#moverImg"+e).remove(),$("#anexaFich"+e).remove(),$("#connectImg"+e).remove();var c=$("#pencilImg"+e);c.attr("src","appimg/recycle.png"),c.on("click",(function(){moverNotaOpc(e)})),c.css({top:"5px",width:"17px"}),c.attr("title",chrome.i18n.getMessage("recicla")),$("#borr"+e).on("click",borraPostit)}else null!=localStorage["userComp"+e]&&($("#borr"+e).remove(),$("#moverImg"+e).remove(),$("#bordesup"+e).html('<div class="friendsDiv"><img src="appimg/friends.png"><label>'+localStorage["nickComp"+e]+"</label></div>"),"R"==localStorage["userComp"+e]&&($("#pencilImg"+e).remove(),$("#postit"+e).on("dblclick",(function(){muestraAyudaSnackbar("modoLectura")}))));if(localStorage["notaWeb"+e]&&($("#texto"+e).before('<div class="notaWebDiv"><a href="'+urlDeNotaWeb(e)+'" target="_blank">'+urlDeNotaWeb(e).split("?")[0]+"</a></div>"),"true"==localStorage["sinMarco"+e]&&$("#postit"+e).find(".notaWebDiv").css("position","absolute")),null!=localStorage["errorConexion"+e]&&($("#bordesup"+e).html('<div class="errorDiv"><label class="errorLabel">'+chrome.i18n.getMessage("errorConex")+"</label></div>"),$(".errorDiv").attr("title",chrome.i18n.getMessage("descErrorConex"))),i);else{"auto"==localStorage["width"+e]?(s.width("auto"),s.width()>500&&(localStorage["width"+e]=500,s.width(localStorage["width"+e]))):s.width(localStorage["width"+e]);var d=getGridData();s.draggable({cancel:".rotateTool,.inplace_save,.inplace_cancel,.connect-tool-input",handle:isMobile()&&".parteSuperior, .bordesup",scroll:!0,stack:".Postits div",distance:5,drag:function(t,a){dragMove(t,a,e)},start:function(t,a){dragStart(t,e)},stop:function(t,a){dragEnd(t,a,e)},grid:!!d&&[d.x,d.y]})}localStorage["Y"+e]<-50&&(localStorage["Y"+e]=100+Math.floor(100*Math.random())),resizeIframes(e,$("#postit"+e).width(),getAlturaNota(e));var u=$("#texto"+e);"true"==localStorage["sinMarco"+e]||esTablonKanban()?esSticker(e)||($("#bordesup"+e).height(0),u.height("auto")):"auto"!=localStorage["height"+e]&&"0"!=localStorage["height"+e]&&Number.isInteger(parseInt(localStorage["height"+e]))?s.height(localStorage["height"+e]+"px"):(s.height("auto"),s.addClass("postit-auto")),esSticker(e)&&(s.height(localStorage["height"+e]+"px"),u.height(localStorage["height"+e]+"px"),s.addClass("postitNB-sticker"),s.width()<250&&(s.find("#duplica"+e).remove(),s.find("#copiaPortapapeles"+e).remove(),s.find("#connectImg"+e).remove(),s.find("#anexaFich"+e).remove()));var p=$(".paneles2").height(),m=topBarHasBoards()?p:0;if(u.imagesLoaded((function(){checkOverflowPostit(e)})),s.css("z-index",e),i)s.height("auto");else{var g=cambioTablon.sliding&&cambioTablon.haciaDerecha?parseInt(localStorage["X"+e])+window.innerWidth:parseInt(localStorage["X"+e]),h=parseInt(localStorage["Y"+e])+m-hideBarTop;h<$(".botones").height()&&(h+=$(".botones").height()),d&&(g=Math.round(g/d.x)*d.x,h=Math.round(h/d.y)*d.y),s.offset({top:h,left:g}),s.resizable({minHeight:40,minWidth:120,start:function(t,a){resizeStart(t,a,e),$(".classTransparent").removeClass("classTransparent")},stop:function(t,a){resizePostitStop(t,e)},resize:function(t,a){resizePostit(t,e)}})}null!=localStorage["width"+e]&&"undefined"!=localStorage["width"+e]||(localStorage["width"+e]=s.width()),"R"!=localStorage["userComp"+e]&&hazEditable(e),programaEventos(e),compruebaListaDerecha(e),localStorage["rotacion"+e]&&(document.getElementById("postit"+e).style.transform="rotate("+localStorage["rotacion"+e]+"deg)"),cambioTablon.sliding||activaTooltipsNota(e)}else $("#postit"+e).remove();0==e&&(setTimeout((function(){compruebaPostitDebajoDeOtros()}),400),cambioTablon.sliding&&setTimeout((function(){activaTooltips()}),600),esTablonOrdenado()&&preparaTablonParaOrdenacion())}function checkOverflowPostit(e){var t=$("#postit"+e),a=$("#texto"+e);if("true"!=localStorage["sinMarco"+e]){var o=localStorage["tipoA"+e]==TIPO_NOTA.LIBRETA?150:130;(t.height()>window.innerHeight-o||esTablonKanban()&&t.height()>VALORES_POR_DEFECTO.KANBAN_HEIGHT-100||!tieneNotaAlturaAuto(e)&&a.height()-t.height()>10)&&(a.css({"overflow-x":"inherit","overflow-y":"auto","padding-right":"10px"}),t.css({"padding-right":"5px"}))}else{o=localStorage["tipoA"+e]==TIPO_NOTA.LIBRETA?170:150;t.height()>window.innerHeight-o||esTablonKanban()&&t.height()>VALORES_POR_DEFECTO.KANBAN_HEIGHT-100||!tieneNotaAlturaAuto(e)&&a.height()-t.height()>10?a.css({"overflow-x":"inherit","overflow-y":"auto"}):a.css({"overflow-y":"inherit"})}!tieneNotaAlturaAuto(e)&&a.height()-t.height()>10&&a.css("maxHeight",parseInt(localStorage["height"+e])-20+"px")}function compruebaLimites(){var e=$("#Postits");esTablonKanban()?refrescaKanban():(e.height(VALORES_POR_DEFECTO.BOARD_HEIGTH),$(".tablonPostits").height(VALORES_POR_DEFECTO.BOARD_HEIGTH).removeClass("tablon-kanban"),e.width()<window.innerWidth&&(e.width(window.innerWidth),$(".tablonPostits").width(window.innerWidth)),$(".postitNB").each((function(){var t=$(this),a=t.outerHeight(),o=t.outerWidth(),n=e.outerHeight(),i=e.outerWidth(),r=t.offset();r.top+a>n&&(e.height(r.top+a+100),$(".tablonPostits").height(r.top+a+100)),("true"!=localStorage["masonry"+tablonActual]||t.hasClass("pinnedNB"))&&r.left+o>i&&(e.width(r.left+o+200),$(".tablonPostits").width(r.left+o+200))}))),cambiaIcono(!0)}function clickParteSuperior(e){var t=$(this).data("numpost");switch(e.target.className.split(" ")[0]){case"zoomTool":zoomNota(e);break;case"minimizaTool":toggleMinimizaNota(t);break;case"pipVideo":pipVideo(e);break;case"anexaFich":anexaFichero(t);break;case"duplica":duplicaNota(t);break;case"copiaPortapapeles":copiaAPortapapeles(t);break;case"creaPop":creaPopupNota(t);break;case"share":sharePostit(t);break;case"calendar":showCalendar(t);break;case"moverImg":moverNotaOpc(t);break;case"connectImg":connectTool(t);break;case"pencilImg":$("#texto"+t).trigger("openEditor");break;case"botonborrar":case"lid":case"can":borraPostit(t)}}function programaEventos(e){$("#zoomImg"+e).attr("title",chrome.i18n.getMessage("zoomTool")),$("#minimizaImg"+e).attr("title",chrome.i18n.getMessage("zoomMini")),$("#pipVideo"+e).attr("title",chrome.i18n.getMessage("pipVideo")),$("#creaPop"+e).attr("title",chrome.i18n.getMessage("creaPop")),$("#duplica"+e).attr("title",chrome.i18n.getMessage("duplica")),$("#copiaPortapapeles"+e).attr("title",chrome.i18n.getMessage("copiaPortapapeles")),$("#connectImg"+e).attr("title",chrome.i18n.getMessage("connectTool")),$("#moverImg"+e).attr("title",chrome.i18n.getMessage("moverNota")),esTablonPapelera()?$("#pencilImg"+e).attr("title",chrome.i18n.getMessage("recicla")):$("#pencilImg"+e).attr("title",chrome.i18n.getMessage("botonEdit")),$("#anexaFich"+e).attr("title",chrome.i18n.getMessage("anexaFichero")),$("#share"+e).attr("title",chrome.i18n.getMessage("compartirNota")),$("#borr"+e).attr("title",chrome.i18n.getMessage("botonBorrar")),null!=localStorage["calendar"+e]&&""!=localStorage["calendar"+e]&&"undefined"!=localStorage["calendar"+e]?($("#calendar"+e).css("opacity","1"),$("#calendar"+e).attr("title",chrome.i18n.getMessage("aviso")+formateaFecha(getCalendarDate(e)))):$("#calendar"+e).attr("title",chrome.i18n.getMessage("programaAviso")),$("#postit"+e).find(".ui-resizable-se").hide(),isMobile()||($("#postit"+e).on("mouseenter",(function(){isConnectedTool($(this))||showParteSuperior(e)})),$("#postit"+e).on("mouseleave",(function(){hideParteSuperior(e)}))),$("#postit"+e).on("click",(function(t){if("connect-tool-input"==t.target.className)return!1;ponAlFrente(t,e),inicializaSeleccion(t,e),isMobile()&&($(".parteSuperior").css("visibility","hidden"),$(".ui-resizable-se").hide(),showParteSuperior(e))})),doubleTap(document.getElementById("postit"+e),(t=>{t.target.classList.contains("ui-resizable-handle")||(zoomNota(null,e),setTimeout((()=>{hideParteSuperior(e)}),500))})),doubleTap(document.querySelector("#postit"+e+" .ui-resizable-se"),(e=>{restoreResize(e)})),$("#rotateTool"+e).on("mousedown",onMouseDown),$("#rotateTool"+e).attr("title",chrome.i18n.getMessage("rotateTool")),$("#parteSuperior"+e).on("dblclick",(function(){zoomNota(null,e)}))}function toggleParteSuperior(e){"visible"==$("#parteSuperior"+e).css("visibility")?hideParteSuperior(e):showParteSuperior(e)}function showParteSuperior(e){$("#postit"+e).find(".ui-resizable-se").show(),$("#parteSuperior"+e).css("visibility","visible"),localStorage["tipoA"+e].length>1&&$("#bordesup"+e).addClass("bordeHover"),(elementoEncima($("#bordesup"+e),$("#canvasDiv"))||tinyMCE.get("textAreaEdit"+e))&&$("#canvasDiv").css("z-index",$("#postit"+e).css("z-index")-1)}function hideParteSuperior(e){$("#postit"+e).find(".ui-resizable-se").hide(),$("#parteSuperior"+e).css("visibility","hidden"),localStorage["tipoA"+e]&&localStorage["tipoA"+e].length>1&&$("#bordesup"+e).removeClass("bordeHover"),$("#canvasDiv").css("z-index","1000000")}function activaTooltips(){$(".tooltip",".postitNB").not("#postitnuevo").tooltipster({theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:150})}function activaTooltipsNota(e){var t={theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:150};$("#rotateTool"+e).tooltipster(t),$("#creaPop"+e).tooltipster(t),$("#duplica"+e).tooltipster(t),$("#share"+e).tooltipster(t),$("#calendar"+e).tooltipster(t),$("#moverImg"+e).tooltipster(t),$("#pencilImg"+e).tooltipster(t),$("#borr"+e).tooltipster(t),$("#anexaFich"+e).tooltipster(t),$("#pipVideo"+e).tooltipster(t),$("#zoomImg"+e).tooltipster(t),$("#minimizaImg"+e).tooltipster(t),$("#connectImg"+e).tooltipster(t),$("#copiaPortapapeles"+e).tooltipster(t)}function compruebaListaDerecha(e){localStorage["postit"+e].indexOf('<li dir="rtl" style="text-align: right')>-1&&$("#postit"+e).css("padding-right","35px")}function resetPostit(){tinyMCE.get("textoAnun").setContent(""),cambiaAparenciaEditor(buscarTipo("postitnuevo"),"postitnuevo"),quitaZoom("postitnuevo"),tinyMCE.get("textoAnun").focus(),localStorage.editando="",borrarFicherosSubidos()}function borraPostitNuevo(){resetPostit(),cierraPostitNuevo(),localStorage.editando=""}function borraPostit(e){try{localStorage["editando"+e]=""}catch(e){sweetAlert({type:"error",text:chrome.i18n.getMessage("noMasEspacio")})}if(esTablonPapelera()){var t=chrome.i18n.getMessage("confirmar");"S"==t.substring(0,1)&&(t="Â¿"+t),sweetAlert({text:t,successCallback:function(){borrarConfirmado(e)}})}else tirarPostitPapelera(e,(function(){moverNotaConfirmado("0",e,!0),aplicaMasonry()}))}function abreFuentes(e){$(".panelFuentes").is(":visible")?($("#fuente"+localStorage.fuente).addClass("selected"),$(".panelFuentes").fadeOut(),$("#cambF").css({"box-shadow":"0 0 0px black inset"})):($(".panelFuentes").fadeIn(),$(".panelFuentes").css({top:$("#cambF").height(),left:$("#cambF").position().left}),$("#cambF").css({"box-shadow":"0 0 50px black inset"}),$(".panelFuente").off().on("mouseenter",(function(){$(".textoNB").css("font-family",$(this).css("font-family"))})),$(".panelFuentes").off().on("mouseleave",(function(){$(".textoNB").css("font-family",""),cambiaFuente(localStorage.fuente),cierraFuentes()})),$(".panelFuente").on("click",(function(){$(".textoNB").css("font-family",""),null!=this.id&&cambiaFuente(this.id.substr(6)),algunoPublico()&&(localStorage.updated10000="true"),cierraFuentes()}))),e.stopPropagation(),closePaneles("panelFuentes")}function cierraFuentes(){$(".panelFuentes").fadeOut(),$("#cambF").css({"box-shadow":"0 0 0px black inset"})}function cambiaFuente(e){$(".panelFuente").removeClass("selected"),$("#fuente"+localStorage.fuente).css("background-color",""),$("#fuente"+e).addClass("selected"),localStorage.fuente=e,$(".textoNB").removeClass().addClass("fuente"+e).addClass("textoNB"),null!=localStorage.size&&$(".textoNB").css({"font-size":localStorage.size}),cambiaAparenciaEditor(buscarTipo("postitnuevo"),"postitnuevo")}function cambiaFondo(e){salSiPapelera()||(0===$(".fondo").length&&addSeleccionFondos(),$(".fondos").is(":visible")?cierraFondos():($("#cambFondo").css({"box-shadow":"0 0 50px black inset"}),$(".fondos").css({top:$("#cambFondo").height(),left:$("#cambFondo").position().left}),$(".fondos").fadeIn(),$(".fondo").off().on("mouseenter",(function(){$(this).hasClass("fondo99")?cambiaFondoNum(localStorage["fondo"+tablonActual]):$("body, #Postits").css({"background-image":$(this).css("background-image"),"background-color":$(this).css("background-color"),"background-size":"auto"})})),$(".fondos").off().on("mouseleave",(function(){cambiaFondoNum(localStorage["fondo"+tablonActual]),cambiaFondoNum(localStorage["fondo"+tablonActual],$("#Postits")),cierraFondos()}))),e.stopPropagation(),closePaneles("fondos"))}function cierraFondos(){$(".fondos").fadeOut(),$("#cambFondo").css({"box-shadow":"0 0 0px black inset"})}function addSeleccionFondos(){var e=`<div class="fondo fondo99" id="fondo99" title="prueba">${chrome.i18n.getMessage("fondo99")}</div>`;for(const t of fondosTablones)t.visible&&"99"!=t.id&&"100"!=t.id&&(e+=`<div class="fondo ${t.className?t.className:""}" id="fondo${t.id}"></div>`);for(fondo of($(".fondos").html(e),$("#fondo99").attr("title",chrome.i18n.getMessage("fondo99Ayuda")),$("#fondo99").tooltipster({theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:100,zIndex:50000001}),fondosTablones))fondo.visible&&fondo.imagen&&"99"!=fondo.id&&"100"!=fondo.id&&$("#fondo"+fondo.id).css("background-image",`url(${VALORES_POR_DEFECTO.DIR_IMAGENES}${fondo.imagenMini||fondo.imagen})`)}function cambiaFondoNum(e,t){t=t||$("body"),e="undefined"!=e&&e||VALORES_POR_DEFECTO.FONDO,esTablonPapelera()&&(e="100",$("#papelera").css({"box-shadow":"0 0 50px black inset"}));for(const e of fondosTablones)e.className&&t.removeClass(e.className);if(t.css({"background-size":"auto","background-position":"0 "+$(".botones").height()+"px"}),t.css({"background-size":"initial","background-position":"initial"}),imagenFondo="",e.indexOf("http")>-1)t.css("background-image",'url("'+e+'")'),e.indexOf("?cover")>-1&&t.css({"background-size":"cover","background-position":"center"}),chrome.permissions.contains({origins:["https://www.noteboardapp.com/"]},(function(t){imagenFondo=t?e:"appimg/corcho.jpg"}));else if("99"!=e){var a=fondosTablones.find((t=>t.id==e));a&&(a.imagen&&(imagenFondo=`${VALORES_POR_DEFECTO.DIR_IMAGENES}${a.imagen}`,t.css("background-image",`url(${imagenFondo})`)),a.className&&(t.css("background-image",""),t.addClass(a.className)))}else t.css("background-image","url("+localStorage.fondoCustom+")"),$("#maquetaPant").css("border-color","black"),chrome.permissions.contains({origins:["https://www.noteboardapp.com/"]},(function(e){imagenFondo=e?localStorage.fondoCustom:"appimg/corcho.jpg"}));$("#maquetaPant, .postit-min").css("border-color",defaultColorContrastBackground),detectColorContrastBackground().then((()=>{$("#maquetaPant, .postit-min").css("border-color",defaultColorContrastBackground),refreshConnections(),refrescaKanban(),cambiaIcono()})),cambiaIcono()}function imagenFondoNum(e){if((e="undefined"!=e&&e||VALORES_POR_DEFECTO.FONDO).indexOf("http")>-1)return e;"99"==e&&chrome.permissions.contains({origins:["https://www.noteboardapp.com/"]},(function(e){return e?localStorage.fondoCustom:"appimg/corcho.jpg"}));var t=fondosTablones.find((t=>t.id==e));return t.color?t.color:VALORES_POR_DEFECTO.DIR_IMAGENES+t.imagen}function tamanoFuente(e){for(i=0;i<localStorage.totalPost;i++)if((null==localStorage["tablon"+i]||"undefined"==localStorage["tablon"+i])&&1==tablonActual||localStorage["tablon"+i]==tablonActual){var t=$("#texto"+i).css("font-size");t="+"==e?Math.round(parseFloat(t.substring(0,4)))+1+"px":Math.round(parseFloat(t.substring(0,4)))-1+"px",$("#texto"+i).css({"font-size":t}),localStorage.size=t}cambiaAparenciaEditor(buscarTipo("postitnuevo"),"postitnuevo"),algunoPublico()&&(localStorage.updated10000="true")}function cambioPostit(e,t){if($("#"+t).removeClass("notepad").removeClass("postit0").removeClass("postit1").removeClass("postit2").removeClass("postit3").removeClass("postit4").removeClass("postit5").removeClass("postit6").removeClass("postit7").removeClass("postit8").removeClass("postit10"),e.length>3){var a=colorLuminance(e,-.2);document.getElementById(t).style.background="linear-gradient(#"+e+", "+a+")",esColorOscuro(e)?$("#"+t).find(".parteSuperior").addClass("fondoBlanco"):$("#"+t).find(".parteSuperior").removeClass("fondoBlanco")}else document.getElementById(t).style.background="",$("#"+t).addClass("postit"+e).find(".parteSuperior").removeClass("fondoBlanco");e==TIPO_NOTA.LIBRETA&&$("#"+t).addClass("notepad"),cambiaAparenciaEditor(e,t),localStorage.editandoTipo=e,$("#"+t).attr("data-tipo",e),"postitnuevo"===t&&(localStorage.colorNewNote=e)}function hazEditable(e){var t=Math.floor($("#postit"+e).height()/35);$("#texto"+e).editInPlace({bg_over:"transparent",field_type:"textarea",textarea_rows:t,show_buttons:!0,value_required:!0,use_html:!0,callback:function(t,a,o,n,i){a=compruebaVideos(a),getCalendarMail(e)&&crearRegistroMail(e);var r=$("#postit"+e+" .pinImg").data("pushpin")||0;return r?$("#postit"+e).addClass("pinnedNB"):$("#postit"+e).removeClass("pinnedNB"),(o!=a||(localStorage["pushpin"+e]||r)&&r!=localStorage["pushpin"+e]||localStorage.editandoTipo&&localStorage["tipoA"+e]!=localStorage.editandoTipo)&&(null!=localStorage.editandoTipo&&"undefined"!=localStorage.editandoTipo&&""!=localStorage.editandoTipo&&(localStorage["tipoA"+e]=localStorage.editandoTipo),guardaTextoEnNota(e,a),r?localStorage["pushpin"+e]=r:localStorage.removeItem("pushpin"+e),isUserConnected()&&updateNotaLogin(e)),quitaZoom(e),localStorage.editandoTipo="",refrescaNota(e),ponAlFrentePost(e),aplicaMasonry(!0),refrescaOrdenacion(2500),ordenaPostitsKanban(),cambiaIcono(),sendMessage({postMod:"cambioPost",numPost:e}),a}}),null!=localStorage["fecha"+e]&&"undefined"!=localStorage["fecha"+e]&&$("#bordesup"+e+",#fondoIconos"+e).mouseover((function(t){"errorDiv"!=t.target.className&&"errorLabel"!=t.target.className&&$("#tooltip2").show().html(`<span>${parseInt(e)+1}</span> - ${localStorage["fecha"+e]} - ${difFechas(localStorage["fecha"+e])} ${chrome.i18n.getMessage("dias")}`)})).mousemove((function(e){$("#tooltip2").css({top:e.pageY-10,left:e.pageX+15})})).mouseout((function(){$("#tooltip2").hide()}))}$(document).on("click",".parteSuperior",clickParteSuperior);var imgCanvas,imagenAnterior,canvasWidth=window.innerWidth<800?CANVAS_WIDTH.mini:CANVAS_WIDTH.normal,canvasHeight=90;function cambiaCanvasSize(){var e=$("#Postits"),t=canvasHeight;((canvasHeight=canvasWidth*e.height()/e.width())>600&&(canvasHeight=600),t!=canvasHeight)&&($("#canvasMaqueta").innerHeight(canvasHeight),document.getElementById("canvasMaqueta").height=canvasHeight)}function cambiaIcono(e,t){if(!cambioTablon.sliding&&!hideMinimapa)try{var a,o;e&&cambiaCanvasSize();var n=document.getElementById("canvas");if(!n)return;var i=document.getElementById("canvasMaqueta");if(a=n.getContext("2d"),o=i.getContext("2d"),""!=imagenFondo)imagenFondo!=imagenAnterior?((imgCanvas=new Image).onload=function(){a.drawImage(imgCanvas,0,0,canvasWidth,canvasHeight),o.drawImage(imgCanvas,0,0,canvasWidth,canvasHeight),dibujaNotas(n,a,i,o,t)},imgCanvas.src=imagenFondo,imagenFondo=imagenAnterior):(a.drawImage(imgCanvas,0,0,canvasWidth,canvasHeight),o.drawImage(imgCanvas,0,0,canvasWidth,canvasHeight),dibujaNotas(n,a,i,o,t));else{var r=imagenFondoNum(localStorage["fondo"+tablonActual]);a.clearRect(0,0,canvasWidth,canvasHeight),a.fillStyle=r,a.fillRect(0,0,canvasWidth,canvasHeight),o.clearRect(0,0,canvasWidth,canvasHeight),o.fillStyle=r,o.fillRect(0,0,canvasWidth,canvasHeight),dibujaNotas(n,a,i,o,t)}cambiaMaquetaPant()}catch(e){console.log(e)}}function dibujaNotas(e,t,a,o,n){var i=$("#Postits"),r=i.height(),s=i.width(),l=19/s,c=canvasWidth/s,d=canvasHeight/r,u=$("body"),p=Math.floor(u.scrollLeft()*l),m=Math.floor(u.scrollTop()*l);img=new Image;var g=esTablonKanban();dijujaLineasKanban(o,canvasHeight,canvasWidth);for(var h=0;h<localStorage.totalPost;h++)if(esNotaVisibleEnTablon(h,tablonActual)){switch(localStorage["tipoA"+h]){case TIPO_NOTA.AMARILLO:t.fillStyle="#F2F5A9",o.fillStyle="#F2F5A9";break;case TIPO_NOTA.VERDE:t.fillStyle="#2EFE9A",o.fillStyle="#2EFE9A";break;case TIPO_NOTA.LILA:t.fillStyle="#D8CEF6",o.fillStyle="#D8CEF6";break;case TIPO_NOTA.AMARILLO2:t.fillStyle="#F3F781",o.fillStyle="#F3F781";break;case TIPO_NOTA.ROSA:t.fillStyle="#ff43bd",o.fillStyle="#ff43bd";break;case TIPO_NOTA.ROJO:t.fillStyle="rgb(252, 91, 91)",o.fillStyle="rgb(252, 91, 91)";break;case TIPO_NOTA.AZUL:t.fillStyle="rgb(191, 192, 243)",o.fillStyle="rgb(191, 192, 243)";break;case TIPO_NOTA.TRANSPARENTE:t.fillStyle="rgba(255, 255, 255, 0.0)",o.fillStyle="rgba(255, 255, 255, 0.0)";break;case TIPO_NOTA.BLANCO:case TIPO_NOTA.LIBRETA:t.fillStyle="#FFFFFF",o.fillStyle="#FFFFFF";break;default:t.fillStyle="#"+localStorage["tipoA"+h],o.fillStyle="#"+localStorage["tipoA"+h]}var f=n?$("#postit"+h).offset().left:parseInt(localStorage["X"+h]),b=n?$("#postit"+h).offset().top:parseInt(localStorage["Y"+h]),v=Math.floor(f*l)-p,S=Math.floor(b*l)-m;if(localStorage["minimizado"+h])var w=NOTAS_MINIMIZADAS.width,_=NOTAS_MINIMIZADAS.height;else{if("auto"==localStorage["width"+h]||g)w=$("#postit"+h).outerWidth()-20;else w=localStorage["width"+h];_=$("#postit"+h).height()}var y=Math.floor(w*l);0==(C=Math.floor(_*l))&&(C=1),t.fillRect(v,S,y,C),localStorage["rotacion"+h]?(t.save(),t.translate(v+y/2,S+C/2),t.rotate(localStorage["rotacion"+h]*Math.PI/180),t.fillRect(-y/2,-C/2,y,C),t.restore()):t.fillRect(v,S,y,C);v=Math.floor((f+30)*c),S=Math.floor((b-30)*d),y=Math.floor(w*c);var C=Math.floor(_*d);localStorage["rotacion"+h]?(o.save(),o.translate(v+y/2,S+C/2),o.rotate(localStorage["rotacion"+h]*Math.PI/180),o.fillRect(-y/2,-C/2,y,C),o.restore()):o.fillRect(v,S,y,C),(localStorage["postit"+h].indexOf("<img")>-1||localStorage["postit"+h].indexOf('src="http://www.youtube.com/embed')>-1)&&(null!=imgs&&null!=imgs[h]&&imgs[h].complete?imgs[h].height>canvasHeight&&(localStorage["rotacion"+h]?(o.save(),o.translate(v+y/2,S+C/2),o.rotate(localStorage["rotacion"+h]*Math.PI/180),o.drawImage(imgs[h],-y/2,-C/2,y,C),o.restore()):o.drawImage(imgs[h],v,S,y,C)):(null!=imgs&&null!=imgs[h]||preloadImages(),null!=imgs[h]&&(imgs[h].onload=function(e,t,a,o,n,i){imgs[e].height>canvasHeight&&t.drawImage(imgs[e],a,o,n,i)}(h,o,v,S,y,C)),imgs[h]&&imgs[h].height>canvasHeight&&(localStorage["rotacion"+h]?(o.save(),o.translate(v+y/2,S+C/2),o.rotate(localStorage["rotacion"+h]*Math.PI/180),o.drawImage(imgs[h],-y/2,-C/2,y,C),o.restore()):o.drawImage(imgs[h],v,S,y,C))))}}function compruebaMaqueta(){var e=$("#maquetaPant"),t=$("#canvasDiv"),a=($(window),$(window).width(),t.width(),parseInt(t.css("top")),parseInt(e.css("left")));parseInt(e.css("top"))+e.height()>90&&$(window).scrollTop($(window).scrollTop()-500),a+e.width()>160&&$(window).scrollLeft($(window).scrollLeft()-500)}function cambiaMaquetaPant(e){var t=esTablonKanban()&&e?$(e.target).closest(".columna"):$("html");if(!cambioTablon.sliding&&!hideMinimapa){var a=$("#maquetaPant"),o=$(".Postits"),n=$(window),i=$("#canvasMaqueta"),r=topBarHasBoards()?$(".paneles2").height():0,s=n.width()/o.width(),l=(n.height()-$(".botones").height()+r)/o.height();a.width(s*i.width()/zoomGlobal),a.height(l*i.height()/zoomGlobal),a.width()>i.width()&&a.width(i.width()),a.height()>i.height()&&a.height(i.height());var c=i.width()/o.width(),d=i.height()/o.height(),u=t.scrollTop()*d/zoomGlobal;u+a.height()>i.height()&&(u=i.height()-a.height()),a.css({top:u+"px",left:t.scrollLeft()*c/zoomGlobal+"px"})}}function dragMaqueta(e,t){var a=$(".Postits"),o=a.height(),n=a.width(),i=parseInt(t.position.left*zoomGlobal/$("#canvasDiv").width()*n),r=parseInt(t.position.top*zoomGlobal/$("#canvasDiv").height()*o);$("html, body").animate({scrollTop:r,scrollLeft:i},100)}function clickCanvas(e){var t=$(".Postits"),a=t.height(),o=t.width(),n=e.clientX,i=e.clientY,r=$(window).width()-$("#canvasDiv").width()-20,s=i-parseInt($("#canvasDiv").css("top")),l=(n-r)*o*zoomGlobal/$("#canvasDiv").width(),c=s*a*zoomGlobal/$("#canvasDiv").height();$("html, body").animate({scrollTop:c,scrollLeft:l},100)}function cambiaAparenciaEditor(e,t){var a;switch(e){case TIPO_NOTA.AMARILLO:a="#fff4c7";break;case TIPO_NOTA.VERDE:a="#ddf2c9";break;case TIPO_NOTA.LILA:a="#efe2f4";break;case TIPO_NOTA.AMARILLO2:a="#f3e05d";break;case TIPO_NOTA.ROSA:a="#f5a4d8";break;case TIPO_NOTA.ROJO:a="rgb(252, 91, 91)";break;case TIPO_NOTA.AZUL:a="rgb(191, 192, 243)";break;case TIPO_NOTA.TRANSPARENTE:a="transparent";break;case TIPO_NOTA.BLANCO:case TIPO_NOTA.LIBRETA:a="#ffffff";break;default:a="#"+e}switch(localStorage.fuente){case"1":var o="'Kalam'";"http://fonts.googleapis.com/css?family=Kalam:400normal&subset=all";break;case"2":o="'Droid Sans'";"http://fonts.googleapis.com/css?family=Droid+Sans";break;case"3":o="'Architects Daughter'";"http://fonts.googleapis.com/css?family=Architects+Daughter:400normal&subset=all";break;case"4":o="'Quando', Arial, Helvetica, sans-serif";"https://fonts.googleapis.com/css?family=Quando:400normal&subset=all";break;case"5":o="'Indie Flower'";"http://fonts.googleapis.com/css?family=Indie+Flower";break;case"6":o="'Quattrocento Sans'";"http://fonts.googleapis.com/css?family=Quattrocento+Sans:400,700&subset=all";break;case"7":o="'Montserrat'";"http://fonts.googleapis.com/css?family=Montserrat:400normal&subset=all";break;case"8":o="'Roboto'";"http://fonts.googleapis.com/css?family=Roboto&display=swap";break;case"9":o="'Karla'";"http://fonts.googleapis.com/css?family=Karla&display=swap";break;case"10":o="'Balsamiq Sans'";"http://fonts.googleapis.com/css?family=Balsamiq+Sans&display=swap"}if("postitnuevo"!=t&&t.indexOf("postit")>-1){var n=parseInt(t.substr(6));t="textAreaEdit"+n}"postitnuevo"==t&&(t="textoAnun");for(var i=$(".fuente"+localStorage.fuente).css("line-height"),r=0;r<$("iframe").length;r++)if($("iframe")[r].id.indexOf("text")>-1){var s=$("iframe")[r].contentDocument;null==s||null!=t&&$("iframe")[r].id!=t+"_ifr"||($(s.body).addClass("textoNB"),$(s).find(".textoNB").css({"background-color":a,"font-family":o,"font-size":localStorage.size,"line-height":i}),webkitBrowser()?(s.styleSheets[0].insertRule("::-webkit-scrollbar { width: 12px; height: 12px;}",0),s.styleSheets[0].insertRule("::-webkit-scrollbar-track {-webkit-box-shadow: inset 0 0 6px #a1aca2;-webkit-border-radius: 3px;border-radius: 3px;}",0),s.styleSheets[0].insertRule("::-webkit-scrollbar-thumb { -webkit-border-radius: 3px;border-radius: 3px;background: #333;-webkit-box-shadow: inset 0 0 6px black;}",0),s.styleSheets[0].insertRule("::-webkit-scrollbar-thumb:window-inactive {background: #bbb8b6;} ",0),s.styleSheets[0].insertRule("::-webkit-scrollbar-track-piece {background-color: #d3cfcc;}",0),s.styleSheets[0].insertRule('[type="checkbox"].noteBoardCheck { position: relative; opacity: 1; pointer-events: auto;\ttop: 4px;\tmargin-right: 2px;display:inline-block; width: 16px;height: 16px;}',0)):s.styleSheets[0].insertRule("* {scrollbar-color: #333 #dfdfdf;}",0),$(s.body).find(".noteBoardCheck").on("click",(function(){$(this).attr("checked")?$(this).attr("checked",!1):$(this).attr("checked",!0)})))}}function grabaModisPorsiaca(){isUserConnected()&&grabaModificaciones()}function dibujaMaqueta(e,t,a,o){var n;a=a||35,o=o||35;var i=document.getElementById(e);if(null==localStorage["fondo"+t]||"undefined"==localStorage["fondo"+t])var r=imagenFondoNum(VALORES_POR_DEFECTO.FONDO);else r=imagenFondoNum(localStorage["fondo"+t]);if(n=i.getContext("2d"),-1==r.indexOf("#")){var s=new Image;s.onload=function(){n.drawImage(s,0,0,a,o),dibujaNotasMaqueta(n,t,a,o)},s.src=r}else n.clearRect(0,0,a,o),i.style.backgroundColor=r,dibujaNotasMaqueta(n,t,a,o)}var dibujaNotasMaquetaRetry=0;function dibujaNotasMaqueta(e,t,a,o){o=o||35;var n=(a=a||35)/("true"==localStorage["masonry"+t]?window.innerWidth:2500),r=o/2e3,s=!1,l=esTablonKanban(t);if(l){dijujaLineasKanban(e,o,a,t);var c=getKanbanColumnNumber(t),d=getKanbanWidths(t),u=getTotalWidth(d)}for(i=0;i<localStorage.totalPost;i++)if(esNotaVisibleEnTablon(i,t)){switch(localStorage["tipoA"+i]){case TIPO_NOTA.AMARILLO:e.fillStyle="#F2F5A9";break;case TIPO_NOTA.VERDE:e.fillStyle="#2EFE9A";break;case TIPO_NOTA.LILA:e.fillStyle="#D8CEF6";break;case TIPO_NOTA.AMARILLO2:e.fillStyle="#F3F781";break;case TIPO_NOTA.ROSA:e.fillStyle="#F2B9E3";break;case TIPO_NOTA.ROJO:e.fillStyle="rgb(252, 91, 91)";break;case TIPO_NOTA.AZUL:e.fillStyle="rgb(191, 192, 243)";break;case TIPO_NOTA.TRANSPARENTE:e.fillStyle="rgba(255, 255, 255, 0.0)";break;case TIPO_NOTA.BLANCO:case TIPO_NOTA.LIBRETA:e.fillStyle="#FFFFFF";break;default:e.fillStyle="#"+localStorage["tipoA"+i]}if(l)if(d&&d.length>0)var p=getParcialWidthByColumn(d,localStorage["columnaKanban"+i])*a/u+5,m=(d[localStorage["columnaKanban"+i]]*a/u-6)/n;else p=parseInt(localStorage["columnaKanban"+i])*a/c+5,m=(a/c-6)/n;else p=Math.floor((parseInt(localStorage["X"+i])+30)*n),m="auto"!=localStorage["width"+i]?localStorage["width"+i]:300;var g=Math.floor((localStorage["Y"+i]-30)*r),h=localStorage["height"+i]>70?localStorage["height"+i]:300,f=Math.floor(m*n),b=Math.floor(h*r);0==b&&(b=1),localStorage["rotacion"+i]?(e.save(),e.translate(p+f/2,g+b/2),e.rotate(localStorage["rotacion"+i]*Math.PI/180),e.fillRect(-f/2,-b/2,f,b),e.restore()):e.fillRect(p,g,f,b),(localStorage["postit"+i].indexOf("<img")>-1||localStorage["postit"+i].indexOf('src="http://www.youtube.com/embed')>-1)&&(null!=imgs&&null!=imgs[i]&&imgs[i].complete?imgs[i].height>canvasHeight&&(localStorage["rotacion"+i]?(e.save(),e.translate(p+f/2,g+b/2),e.rotate(localStorage["rotacion"+i]*Math.PI/180),e.drawImage(imgs[i],-f/2,-b/2,f,b),e.restore()):e.drawImage(imgs[i],p,g,f,b)):(null!=imgs&&null!=imgs[i]||preloadImages(t),null!=imgs[i]&&(imgs[i].onload=function(e,t,a,o,n,i){s=!0,imgs[t].height>canvasHeight&&e.drawImage(imgs[t],a,o,n,i)}(e,i,p,g,f,b)),imgs[i]&&imgs[i].height>canvasHeight&&(localStorage["rotacion"+i]?(e.save(),e.translate(p+f/2,g+b/2),e.rotate(localStorage["rotacion"+i]*Math.PI/180),e.drawImage(imgs[i],-f/2,-b/2,f,b),e.restore()):e.drawImage(imgs[i],p,g,f,b))))}s?setTimeout((()=>{++dibujaNotasMaquetaRetry>10?dibujaNotasMaquetaRetry=0:dibujaNotasMaqueta(e,t,a,o)}),300):dibujaNotasMaquetaRetry=0}function abrePaneles(e){if(document.getElementById("tablonAdd")){if(!$(".paneles").is(":visible")||1==e){for(var t=1;t<=localStorage.numTablones;t++){document.getElementById("tab"+t+"Label")||addBoardNum(t),document.getElementById("tab"+t+"Label").innerText=nombreTablon(t);var a=0;for(j=0;j<localStorage.totalPost;j++)(null!=localStorage["tablon"+j]&&"undefined"!=localStorage["tablon"+j]||1!=t)&&localStorage["tablon"+j]!=t||a++;esTabCompartido(t)?0==$("#tablon"+t).children(".friendsImg").length&&$("#tablon"+t).append('<img class="friendsImg" src="appimg/friends.png">'):$("#tablon"+t).children(".friendsImg").length>0&&$("#tablon"+t).children(".friendsImg").remove(),"true"==localStorage["publico"+t]?0==$("#tablon"+t).children(".publishImg").length&&$("#tablon"+t).append('<img class="publishImg" src="appimg/publish.png">'):$("#tablon"+t).children(".publishImg").length>0&&$("#tablon"+t).children(".publishImg").remove(),"true"==localStorage["masonry"+t]?0==$("#tablon"+t).children(".ordenaImg2").length&&$("#tablon"+t).append('<img class="ordenaImg2" src="appimg/masonry.png">'):$("#tablon"+t).children(".ordenaImg2").remove(),esTablonKanban(t)?0==$("#tablon"+t).children(".kanban-icon").length&&$("#tablon"+t).append('<i class="material-icons kanban-icon">view_week</i>'):$("#tablon"+t).children(".kanban-icon").length>0&&$("#tablon"+t).children(".kanban-icon").remove(),document.getElementById("cont"+t).innerText=a,$("#tab"+t+"Label").editInPlace({bg_over:"transparent",show_buttons:!1,value_required:!0,use_html:!1,text_size:30,callback:function(e,t,a,o,n){return t=limpiaNombreTablon(tablonActual),localStorage[$(this).attr("id")]=t,actualizaNombreTablon(),muestraPaneles2(),grabaTablones(),sendMessage({menstoBack:"cambioMenu"}),t}}),0==$("#tablon"+t).find(".editaTablon").length&&($("#tablon"+t).append('<img class="editaTablon" id="editaTablon'+t+'"src="appimg/pencilWhite.png">'),$("#editaTablon"+t).on("click touchstart",(async function(e){e.stopPropagation(),e.preventDefault();var t=parseInt(e.target.id.substr("editaTablon".length)),a=await promptFields({title:chrome.i18n.getMessage("boardRename")+nombreTablon(t)});a.value&&(localStorage["tab"+t+"Label"]=a.value,$("#tab"+t+"Label").text(a.value),$("#tabPa2"+t+" span").text(a.value),grabaTablones())})))}if(isMobile()||$(".paneles").sortable({stop:stopSort,items:".tablon:not(.noSortable)"}),$("#tablon-999").length>0){for(a=0,j=0;j<localStorage.totalPost;j++)((null==localStorage["tablon"+j]||"undefined"==localStorage["tablon"+j])&&isWebNotesBoard(t)||isWebNotesBoard(localStorage["tablon"+j]))&&a++;document.getElementById("cont-999").innerText=a,dibujaMaqueta("canvas-999",-999)}}1!=e&&($(".paneles").is(":visible")?(isSmallScreen()?panelHide(".paneles"):$(".paneles").fadeOut(),$("#panelBotDiv").css({"box-shadow":"0 0 0px black inset"})):($(".tablon").sortElements((function(e,t){return parseInt($(e).attr("orden"))>=parseInt($(t).attr("orden"))?1:-1})),$("#panelBotDiv").css({"box-shadow":"0 0 50px black inset"}),$(".paneles").css({top:$("#panelBotDiv").height(),left:$("#panelBotDiv").position().left}),isSmallScreen()?($(".paneles").addClass("panelesMov"),panelShow(".paneles")):$(".paneles").fadeIn()),e.stopPropagation(),closePaneles("paneles")),setTimeout(dibujaPaneles,700)}}function dibujaPaneles(){for(var e=1;e<=localStorage.numTablones;e++)dibujaMaqueta("canvas"+e,e)}function grabaTablones(){isUserConnected()&&(null==localStorage.treeId10000||"undefined"==localStorage.treeId10000?grabaNotaLogin(1e4):updateNotaLogin(1e4))}var cambioTablon={sliding:!1,haciaDerecha:!0};function clickTablon(e,t=!1,a){var o;if(isSmallScreen()&&panelHide(".paneles"),$(".sharePanel").remove(),this.id&&this.id.indexOf("tabPa2")>-1&&muestraAyudaSnackbar("helpTablones"),a?o=a:null!=this.id&&""!=this.id?"papelera"==this.id?(o=0,$("#postitnuevo").is(":visible")&&$("#postitnuevo").hide()):(o=this.id.substr(6),$("#papelera").css({"box-shadow":"0 0 0px black inset"}),$("#botonVaciarPapelera").hide()):o=tablonActual,"+"==o)addBoard();else if("Add"!=o&&tablonActual!=o||t){cambioTablon.haciaDerecha=parseInt($("#tabPa2"+o).attr("orden"))>parseInt($("#tabPa2"+tablonActual).attr("orden")),localStorage.tablonActual=o;var n=tablonActual;sendMessage({asignaNumeroTablon:!0,tablonActual:tablonActual=o}),actualizaNombreTablon(),masonryInterval&&clearInterval(masonryInterval),masonryTimeout&&clearInterval(masonryTimeout),"true"==localStorage.noEfectoSlide||esTablonKanban(o)?cambiaFondoNum(localStorage["fondo"+o]):(creaTablonTemporal(),cambiaFondoNum(localStorage["fondo"+n],$(".postits-temp")),cambiaFondoNum(localStorage["fondo"+o],$("#Postits")));var i=$("#Postits");i.css("padding-top",0),i.height(2e3),$(".tablonPostits").height(2e3),esTabCompartido(o)?trataTablonComp():inicializaFriendsBot(),esTablonKanban()?inicializaKanban():borraKanban(),refrescaPantalla(!0),"true"==localStorage["publico"+o]?$("#publicBot").css({"box-shadow":"0 0 50px black inset","background-color":"initial"}):$("#publicBot").css({"box-shadow":"0 0 0px black inset"}),$(".tabPaneles2").removeClass("activeBoard"),"0"!=tablonActual?$("#tabPa2"+tablonActual).addClass("activeBoard"):inicializaPapelera(),esTablonOrdenado()?$("#ordenaBot").addClass("selected"):$("#ordenaBot").removeClass("selected"),"true"==localStorage.noEfectoSlide||esTablonKanban(o)?(cambiaIcono(!0),$("#Postits").imagesLoaded((function(){compruebaLimites(),cambiaIcono(!0)})),$(".searchPanel").is(":visible")||$("html, body").animate({scrollTop:0,scrollLeft:0},100),$(window).scrollLeft(0),$(window).scrollTop(0)):borraTablonTemporal(o),cambiaContador(),checkBoardRealTime(o),restoreBoardZoom(tablonActual)}}function addBoard(){addBoardPremiumAllowed()&&(localStorage.numTablones++,localStorage["fondo"+localStorage.numTablones]=VALORES_POR_DEFECTO.FONDO,localStorage["ordenTablon"+localStorage.numTablones]=localStorage.numTablones,$("#cont"+localStorage.numTablones).css("margin-right",0),muestraPaneles2(),abrePaneles(!0),grabaTablones(),sendMessage({menstoBack:"cambioMenu"}))}function addBoardNum(e){var t='<div class="tablon" id="tablon'+e+'"><div class="tabLabel" id="tab'+e+'Label"></div><img class="borraTablon" id="borraTablon'+e+'"src="appimg/removeWhite.png"><label class="contLabel" id="cont'+e+'"></label><canvas class="tabCanvas" id="canvas'+e+'" width="35" height="35"></canvas></div>';$("#tablonAdd").before(t),$("#tablon"+e).on("click",clickTablon),$("#cont"+e).css("margin-right",0),$("#borraTablon"+e).off("click",borraTablonEvt),$("#borraTablon"+e).on("click",borraTablonEvt),$("#tablon"+e).attr("orden",ordenTablon(e))}function addBoardNotasWeb(){var e=-999,t='<div class="tablon noSortable" id="tablon-999"><div class="tabLabel" id="tab-999Label">'+nombreTablon(-999)+'</div><img class="borraTablon" id="borraTablon'+e+'"src="appimg/removeWhite.png"><label class="contLabel" id="cont'+e+'">4</label><canvas class="tabCanvas" id="canvas'+e+'" width="35" height="35"></canvas></div>';$("#tablonAdd").before(t),$("#tablon"+e).on("click",clickTablon),$("#cont"+e).css("margin-right",0),$("#borraTablon"+e).off("click",borraTablonEvt),$("#borraTablon"+e).on("click",borraTablonEvt),$("#tablon"+e).attr("orden",998)}function borraTablonEvt(e){e.stopPropagation(),borraTablon(e.target.id.substring("borraTablon".length))}function borraTablon(e){var t=chrome.i18n.getMessage("confirmarTab");idiomaEsp(navigator.language)&&(t="Â¿"+t),sweetAlert({text:t,successCallback:function(){borrarTablonConfirmado(parseInt(e))}})}function borrarTablonConfirmado(e){if(tablonActual=parseInt(tablonActual),esTabCompartido(e)&&deleteTablonCompartido(e),esTablonNotasWeb(e))localStorage.removeItem("fondo-999"),localStorage.removeItem("tab-999Label"),localStorage.removeItem("publico-999"),localStorage.removeItem("masonry-999"),localStorage.removeItem("ordenTablon-999"),localStorage.removeItem("tablonKanban-999"),esTablonNotasWeb(tablonActual)&&(tablonActual=localStorage.numTablones);else{for(var t=e;t<localStorage.numTablones;t++)localStorage["fondo"+t]=localStorage["fondo"+(t+1)],localStorage["tab"+t+"Label"]=localStorage["tab"+(t+1)+"Label"],localStorage["publico"+t]=localStorage["publico"+(t+1)],localStorage["masonry"+t]=localStorage["masonry"+(t+1)],localStorage["ordenTablon"+(t+1)]?localStorage["ordenTablon"+t]=localStorage["ordenTablon"+(t+1)]:localStorage.removeItem("ordenTablon"+t),localStorage["tablonKanban"+(t+1)]?localStorage["tablonKanban"+t]=localStorage["tablonKanban"+(t+1)]:localStorage.removeItem("tablonKanban"+t),esTabCompartido(t+1)&&updateCompartido(t+1,t);if(localStorage["new-tab"]){const t=getNewTab();e==t.numTab&&localStorage.removeItem("new-tab"),e<t.numTab&&setNewTab(parseInt(t.numTab)-1,t.hideBar)}$("#tablon"+localStorage.numTablones).remove(),localStorage.removeItem("fondo"+localStorage.numTablones),localStorage.removeItem("tab"+localStorage.numTablones+"Label"),localStorage.removeItem("publico"+localStorage.numTablones),localStorage.removeItem("masonry"+localStorage.numTablones),localStorage.removeItem("ordenTablon"+localStorage.numTablones),localStorage.removeItem("tablonKanban"+localStorage.numTablones),reinicializaOrdenTablones(),localStorage.numTablones--,0==localStorage.numTablones&&(localStorage.numTablones=1,localStorage.fondo1=VALORES_POR_DEFECTO.FONDO,localStorage.masonry1=!1)}if(tablonActual==e)var a=!0;else a=!1;tablonActual>=e&&tablonActual>1&&tablonActual--;for(t=0;t<localStorage.totalPost;)localStorage["tablon"+t]==e&&null==localStorage["userComp"+t]?($("#papelera").find("img").attr("src","appimg/papeleraLlena.png"),moverNotaConfirmado("0",t,!0)):(-999!=e&&parseInt(localStorage["tablon"+t])>e&&-999!=localStorage["tablon"+t]&&(localStorage["tablon"+t]=parseInt(localStorage["tablon"+t])-1,isUserConnected()&&null==localStorage["userComp"+t]&&updateNotaLoginMemo(t)),localStorage["tablon"+t]==e&&"-999"!=localStorage["tablon"+t]&&null!=localStorage["userComp"+t]&&$("#postit"+t).remove(),t++);reduceTamanyoSiDosFilas(),a&&clickTablon(null,!0),grabaTablones(),isUserConnected()&&grabaModificaciones(),muestraPaneles2(),sendMessage({menstoBack:"cambioMenu"})}function muestraPaneles2(e,t){if(topBarHasBoards()){e&&!t&&$(".paneles2").hide(),e||$(".paneles2").show();for(var a='<ul class="bottomBarNav">',o=1;o<=localStorage.numTablones;o++)esTabCompartido(o)?a+='<li class="tabPaneles2" orden="'+ordenTablon(o)+'" id="tabPa2'+o+'"><span class="tabA" href="#"><img src="appimg/friends.png">'+nombreTablon(o)+"</span></li>":a+='<li class="tabPaneles2" orden="'+ordenTablon(o)+'" id="tabPa2'+o+'"><span class="tabA" href="#">'+nombreTablon(o)+"</span></li>";algunaNotaWeb()&&(esTabCompartido(-999)?a+='<li class="tabPaneles2" orden="998" id="tabPa2-999"><span class="tabA" href="#"><img src="appimg/friends.png">'+nombreTablon(-999)+"</span></li>":a+='<li class="tabPaneles2" orden="998" id="tabPa2-999"><span class="tabA" href="#">'+nombreTablon(-999)+"</span></li>"),a+='<li class="tabPaneles2 add-tablon noSortable" orden="1000" id="tabPa2+"><span class="tabA" href="#">+</span></li>',a+='</ul><div class="clearfloat"></div>',$(".paneles2").html(a),$(".tabPaneles2").sortElements((function(e,t){return parseInt($(e).attr("orden"))>parseInt($(t).attr("orden"))?1:-1})),$(".bottomBarNav").sortable({containment:".paneles2",stop:stopSort2,items:".tabPaneles2:not(.noSortable)",distance:10});for(o=1;o<=localStorage.numTablones;o++)"true"==localStorage["publico"+o]?0==$("#tabPa2"+o).children(".publishImg2").length&&$("#tabPa2"+o+" span").append('<img class="publishImg2" src="appimg/publish.png">'):$("#tabPa2"+o).children(".publishImg2").length>0&&$("#tabPa2"+o).children(".publishImg2").remove(),"true"==localStorage["masonry"+o]?0==$("#tabPa2"+o).children(".ordenaImg2").length&&$("#tabPa2"+o+" span").append('<img class="ordenaImg2" src="appimg/masonry.png">'):$("#tabPa2"+o).children(".ordenaImg2").remove(),esTablonKanban(o)?0==$("#tabPa2"+o).children(".kanban-icon").length&&$("#tabPa2"+o+" span").append('<i class="material-icons kanban-icon">view_week</i>'):$("#tabPa2"+o).children(".kanban-icon").length>0&&$("#tabPa2"+o).children(".kanban-icon").remove();$("#tabPa2"+tablonActual).addClass("activeBoard"),$(".tabPaneles2").on("click",clickTablon),e?(deslizaPostVisibles("down"),$(".paneles2").slideDown((function(){recalculaPaddingMasonry(),reduceTamanyoSiDosFilas()}))):t&&(deslizaPostVisibles("down",!0),recalculaPaddingMasonry(),setTimeout((function(){deslizaPostVisibles("down",!0),recalculaPaddingMasonry()}),800)),$(".boardsSwitch").attr("title",chrome.i18n.getMessage("flechaOculta")),$(".tabPaneles2").editInPlace({bg_over:"",show_buttons:!1,value_required:!0,use_html:!1,text_size:30,callback:function(e,t,a,o,n){var i=parseInt($(this).attr("id").substr(6));return t=limpiaNombreTablon(t),localStorage["tab"+i+"Label"]=t,actualizaNombreTablon(),muestraPaneles2(),grabaTablones(),sendMessage({menstoBack:"cambioMenu"}),t}}),reduceTamanyoSiDosFilas(),ponTooltipPaneles2()}else $(".paneles2").is(":visible")&&(t?$(".paneles2").hide():($(".paneles2").slideUp((function(){$(".paneles2").html(""),recalculaPaddingMasonry()})),deslizaPostVisibles("up"))),$(".boardsSwitch").attr("title",chrome.i18n.getMessage("flechaMuestra"))}function reduceTamanyoSiDosFilas(){var e=$(".paneles2");e.hasClass("paneles2-dos-filas")||(e.height()>$(".tabPaneles2").height()+5?(e.addClass("paneles2-dos-filas"),e.height()>$(".tabPaneles2").height()+5&&e.removeClass("paneles2-dos-filas")):e.removeClass("paneles2-dos-filas"))}function initializeTopBar(){switch(localStorage.showTabs){case TOP_BAR.BUTTONS_UP:$("#flecha").removeClass("abajo");break;case TOP_BAR.BUTTONS_DOWN:$("#flecha").addClass("abajo");break;case TOP_BAR.NONE:$(".top-bar-icons-wrapper").hide(),$("#flecha").addClass("abajo");break;default:muestraPaneles2(!1,!0),$("#flecha").removeClass("abajo")}}function muestraFilaTablones(e){switch(e.stopPropagation(),localStorage.showTabs){case TOP_BAR.BUTTONS_UP:deslizaPostVisibles("up",!1),recalculaPaddingMasonry(),$(".top-bar-icons-wrapper").slideUp(),localStorage.showTabs=TOP_BAR.NONE,$("#flecha").addClass("abajo");break;case TOP_BAR.BUTTONS_DOWN:localStorage.showTabs=TOP_BAR.BOARDS,muestraPaneles2(!0),$("#flecha").removeClass("abajo");break;case TOP_BAR.NONE:deslizaPostVisibles("down",!1),recalculaPaddingMasonry(),$(".top-bar-icons-wrapper").slideDown(),localStorage.showTabs=TOP_BAR.BUTTONS_DOWN,$("#flecha").addClass("abajo");break;default:localStorage.showTabs=TOP_BAR.BUTTONS_UP,muestraPaneles2(!0),$("#flecha").removeClass("abajo")}}function toggleMap(e){e.stopPropagation(),hideMinimapa?(localStorage.noMinimapa="false",hideMinimapa=!1,cambiaIcono(),$("#flechaMap").removeClass("abajo"),$("#canvasMaqueta").slideDown(),$("#maquetaPant").slideDown()):($("#flechaMap").addClass("abajo"),$("#canvasMaqueta").slideUp(),$("#maquetaPant").slideUp(),localStorage.noMinimapa="true",hideMinimapa=!0)}function searchPostit(e){$(".searchPanel").is(":visible")?($("#searchBot").css({"box-shadow":"0 0 0px black inset"}),$(".searchPanel").fadeOut(),$(".searchResult").remove(),$("#texto"+numPostSearch).html(localStorage["postit"+numPostSearch])):($(".searchResult").remove(),$("#searchInput").attr("placeholder",chrome.i18n.getMessage("ayudaBusqueda")),$(".searchPanel").fadeIn(),$("#searchBot").css({"box-shadow":"0 0 50px black inset"}),$(".searchPanel").css({top:$("#searchBot").height(),left:$("#searchBot").position().left}),$("#searchInput").val(""),$("#searchInput").focus(),-1!=numPostSearch&&$("#texto"+numPostSearch).html(localStorage["postit"+numPostSearch])),e&&e.stopPropagation(),closePaneles("searchPanel")}var numPostRotando,numPostSearch=-1;function userEnterText(e){if(13==e.keyCode){var t=buscarText($("#searchInput").val());if(numPostSearch=t[0],!(t.length>0))return sweetAlert({type:"error",text:chrome.i18n.getMessage("textoNoEncontrado"),cancel:!1}),!1;if(mostrarNota(numPostSearch),t.length>1){$(".searchPanel").width("auto"),$(".searchResult").remove();var a="<div class ='searchResult'><div class='searchIconL'><img src='appimg/arrow-left-b.png'></div>";a+="<div class='searchNum'>1/"+t.length+"</div>",a+="<div class='searchIconR'><img src='appimg/arrow-right-b.png'></div></div>",$(".searchPanel").append(a),$(".searchIconL").on("click",(function(e){siguienteCoinci(t,"L")})),$(".searchIconR").on("click",(function(e){siguienteCoinci(t,"R")}))}else $("#searchBot").css({"box-shadow":"0 0 0px black inset"}),$(".searchPanel").fadeOut(),$(".searchResult").remove()}}function siguienteCoinci(e,t){var a=e.indexOf(numPostSearch);$("#texto"+numPostSearch).html(localStorage["postit"+numPostSearch]),"R"==t?++a>=e.length&&(a=0):--a<0&&(a=e.length-1),$(".searchNum").html(a+1+"/"+e.length),mostrarNota(numPostSearch=e[a])}function mostrarNota(e){if(localStorage["tablon"+e]!=tablonActual){var t=localStorage.noEfectoSlide;localStorage.noEfectoSlide="true","0"==localStorage["tablon"+e]?$("#papelera").click():clickTablon(null,!1,localStorage["tablon"+e]),localStorage.noEfectoSlide=t}ponAlFrentePost(e),$("html, body").animate({scrollTop:$("#postit"+e).offset().top-150,scrollLeft:$("#postit"+e).offset().left-100},200,(function(){$("#postit"+e).animate({opacity:.25},100,(function(){$("#postit"+e).animate({opacity:1},100,(function(){$("#postit"+e).animate({opacity:.25},100,(function(){$("#postit"+e).animate({opacity:1},100)}))}))}))})),$("#texto"+e).html(localStorage["postit"+e]),wrapText(document.getElementById("texto"+e),$("#searchInput").val())}function iraNota(e,t){if(null!=localStorage.muestraNota&&null==e&&(e=localStorage.muestraNota,localStorage.removeItem("muestraNota"),t=!0),localStorage["tablon"+e]!=tablonActual){var a=localStorage.noEfectoSlide;localStorage.noEfectoSlide="true",$("#tabPa2"+localStorage["tablon"+e]).click(),localStorage.noEfectoSlide=a}ponAlFrentePost(e),$("html, body").animate({scrollTop:$("#postit"+e).offset().top-150,scrollLeft:$("#postit"+e).offset().left-100},200,(function(){t&&$("#postit"+e).animate({opacity:.25},100,(function(){$("#postit"+e).animate({opacity:1},100,(function(){$("#postit"+e).animate({opacity:.25},100,(function(){$("#postit"+e).animate({opacity:1},100)}))}))}))}))}function sharePostit(e){if($("#sharePanel"+e).is(":visible"))$("#sharePanel"+e).remove();else{var t=$("#texto"+e).find("img").attr("src"),a=$("#texto"+e).find("a").attr("href"),o='<div class="sharePanel" id="sharePanel'+e+'">';o+='<img class="imgShare" id="mailShare'+e+'" src="appimg/mail.png" >',o+='<img class="imgShare" id="faceShare'+e+'" src="appimg/facebook.png" >',o+='<img class="imgShare" id="twitterShare'+e+'" src="appimg/twitter.png" >',o+='<img class="imgShare" id="linkedinShare'+e+'" src="appimg/linkedin.png" >',o+="</div>",$(".tablonPostits").append(o),$("#sharePanel"+e).offset({top:$("#share"+e).offset().top-60,left:$("#share"+e).offset().left}).show(),$("#faceShare"+e).on("click",(function(){var o="&name=Note Board&display=popup&description="+encodeURIComponent($("#texto"+e).text())+"&redirect_uri=https://www.noteboardapp.com/fbpublish.php";o+=null==t?"&picture=https://www.noteboardapp.com/appimg/NoteBoard.png":"&picture="+t;var n="https://www.facebook.com/dialog/feed?app_id=339270982866129"+(o+=null==a?"&link=https://www.noteboardapp.com":"&link="+a);window.open(n,"Publish","width=600,height=500,left=200,top=100,scrollbars=no"),$("#sharePanel"+e).remove()})),$("#twitterShare"+e).on("click",(function(){var t="https://twitter.com/intent/tweet?text="+encodeURIComponent($("#texto"+e).text())+"&lang=en";window.open(t,"Tweet",'width=600,height=300,left=200,top=150,scrollbars="no"'),$("#sharePanel"+e).remove()})),$("#linkedinShare"+e).on("click",(function(){var t="&source=NoteBoard&title=NoteBoard&mini=true";t+=null==a?"&url=https://www.noteboardapp.com":"&url="+a,href="http://www.linkedin.com/shareArticle?summary="+encodeURIComponent($("#texto"+e).text())+t,window.open(href,"Tweet",'width=600,height=400,left=200,top=150,scrollbars="no"'),$("#sharePanel"+e).remove()})),$("#mailShare"+e).on("click",(function(){abreFormMail(e,!0),$("#sharePanel"+e).remove()}))}}function adjuntarDatos(e,t){localStorage["postit"+t]+="<br>"+compruebaVideos(e),"auto"==localStorage["width"+t]&&(localStorage["width"+t]=$("#postit"+t).width()),$("#postit"+t).remove(),muestraPostit(t),isUserConnected()&&updateNotaLogin(t),getCalendarMail(t)&&crearRegistroMail(t)}function onMouseDown(e){numPostRotando=e.target.id.substr(10),currentYRotation=localStorage["rotacion"+numPostRotando]?-3*parseFloat(localStorage["rotacion"+numPostRotando]):0,previousY=e.clientY,distanceY=0,ponAlFrentePost(numPostRotando),$("body").on("mousemove",onMouseMove),$("body").on("mouseup",onMouseUp),$("body").css("cursor","n-resize")}document.addEventListener("dragover",(function(e){var t=$(e.target).closest(".postitNB");t.length>0?(t.css("opacity","0.6"),$(".Postits").css("opacity","1")):($(".Postits").css("opacity","0.6"),$(".postitNB").css("opacity","1")),e.stopPropagation(),e.preventDefault()}),!1),document.addEventListener("dragleave",(function(e){e.stopPropagation(),e.preventDefault(),$(".Postits").css("opacity","1"),$(".postitNB").css("opacity","1")}),!1),document.addEventListener("drop",(function(e){e.stopPropagation(),e.preventDefault(),$(".Postits").css("opacity","1"),$(".postitNB").css("opacity","1");var t=e.dataTransfer.getData("text/html");if(!(t.indexOf("postitNB")>-1)){0==t.length&&(t=e.dataTransfer.getData("Text"));var a=$(e.target).closest(".postitNB");if(a.length>0)adjuntarDatos(t,a.attr("id").substr(6));else guardaPostit(t,e.offsetX,e.offsetY,!0)}}),!1);var intervalInv,currentYRotation=0,previousY=0,distanceY=0;function onMouseMove(e){var t=e.clientY,a=currentYRotation+(t-previousY);currentYRotation=a;var o="rotate("+(a=-a/3)+"deg)";document.getElementById("postit"+numPostRotando).style.transform=o,distanceY=t-previousY,previousY=t,localStorage["rotacion"+numPostRotando]=a,refreshConnections(),cambiaIcono(),$("#postit"+numPostRotando).find(".rotateTool").show()}function onMouseUp(){if(document.getElementById("postit"+numPostRotando)){$("body").off("mousemove",onMouseMove),$("body").css("cursor","auto");var e=-currentYRotation/3;Math.abs(e)<2.5?(currentYRotation=0,document.getElementById("postit"+numPostRotando).style.transform="rotate(0deg)",localStorage.removeItem("rotacion"+numPostRotando)):localStorage["rotacion"+numPostRotando]=parseFloat(e.toFixed(4)),isUserConnected()&&null==localStorage["userComp"+numPostRotando]&&updateNotaLoginMemo(numPostRotando),cambiaIcono(),numPostRotando=-1,$("#postit"+numPostRotando).find(".rotateTool").hide()}}function stopSort(){reinicializaOrdenTablones(),muestraPaneles2(),grabaTablones()}function reinicializaOrdenTablones(){var e=1;$(".tabPaneles2:not(.add-tablon)").each((function(){var t=$(this).attr("id").substr(6);numTab=t.substr(6),localStorage["ordenTablon"+numTab]=e,$(this).attr("orden",e),e++}))}function stopSort2(){var e=1;$(".tabPaneles2").each((function(){numTab=$(this).attr("id").substr(6),localStorage["ordenTablon"+numTab]=e,$(this).attr("orden",e),$("#tablon"+numTab).attr("orden",e),e++})),grabaTablones()}function duplicaNota(e){var t=localStorage.totalPost;guardaTextoEnNota(t,localStorage["postit"+e]),localStorage["tipoA"+t]=localStorage["tipoA"+e],localStorage["tablon"+t]=localStorage["tablon"+e],localStorage["X"+t]=localStorage["X"+e],localStorage["Y"+t]=localStorage["Y"+e],localStorage["width"+t]=localStorage["width"+e],localStorage["height"+t]=localStorage["height"+e],localStorage["fecha"+t]=localStorage["fecha"+e],localStorage["calendar"+t]=localStorage["calendar"+e],localStorage["sinMarco"+t]=localStorage["sinMarco"+e],null!=localStorage["rotacion"+e]&&(localStorage["rotacion"+t]=localStorage["rotacion"+e]),null!=localStorage["pushpin"+e]&&(localStorage["pushpin"+t]=localStorage["pushpin"+e]),null!=localStorage["notaWeb"+e]&&(localStorage["notaWeb"+t]=localStorage["notaWeb"+e]),muestraPostit(t),esTablonKanban()||(localStorage["X"+t]=parseInt(localStorage["X"+t])+50,localStorage["Y"+t]=parseInt(localStorage["Y"+t])+30,$("#postit"+t).animate({top:"+=30",left:"+=100"},400,(function(){$("#postit"+t).css("z-index",maxZindex()+1)}))),isUserConnected()&&!esNotaCompartida(e)&&grabaNotaLogin(t),localStorage.totalPost++}function copiaAPortapapeles(e){var t,a=$("#texto"+e),o=a.css("background");a.css("background","none"),estaEditorAbierto(e)?((t=document.createElement("div")).innerHTML=obtenEditor(e).getContent(),t.style.color="transparent",t.id="temp-element",$("#Postits").append(t)):t=document.getElementById("texto"+e);try{if(document.selection)(n=document.body.createTextRange()).moveToElementText(t),n.select();else if(window.getSelection){var n;(n=document.createRange()).selectNode(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(n)}document.execCommand("copy"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),$("#temp-element").remove(),openSnackbar({text:chrome.i18n.getMessage("copiadoPortapapeles")})}catch(e){openSnackbar({text:chrome.i18n.getMessage("errorCopiaPortapapeles")})}a.css("background",o)}function postEmbedCode(){if(!salSiPapelera())return userHasSpace()?void abrirPantallaModal(obtenerFormularioEmbed(),{onOpenStart:function(){$("#textoEmbed").off().on("change",(function(){$("#previsualizacionEmbed").html($("#textoEmbed").val()),$("#aceptar-embed").removeClass("disabled")})),$("#iframeUrl").off().on("change",(function(){let e=$("#iframeUrl").val();-1==e.indexOf("http")&&(e="https://"+e,$("#iframeUrl").val(e));const t=`<iframe src="${$("#iframeUrl").val()}" width="100%" height="400"></iframe>`;$("#previsualizacionEmbed").html(t),$("#textoEmbed").val(t),$("#aceptar-embed").removeClass("disabled")})),$("#aceptar-embed").off().on("click",(function(){guardaNotaSubidaFichero($("#textoEmbed").val(),!0),modalInstance.close()}))},height:800}):(muestraMensajeNohayEspacio(),!1)}function pipVideo(e,t){t=t||e.target.id.substr(8);var a=document.querySelector("#postit"+t).querySelector("video");document.pictureInPictureElement===a?(document.exitPictureInPicture(),$("#pipVideo"+t).removeClass("active")):(a.requestPictureInPicture(),$("#pipVideo"+t).addClass("active"))}function pruebaIpn(){$.ajax({type:"POST",url:"http://localhost:8080/noteboardapp/subscription_ipn.php",data:"payer_id=W4936KRMAJ3ZN&ipn_track_id=3a7f8b7788b12&charset=windows-1252&payment_gross=&contact_phone=+34 646664312&verify_sign=Ai38-2NWNzEDBvUaYo2H33DKMOSlAzrnjGfN8gnbArVxOGHkkD5il6Kf&item_name=Note Board Yearly subscription user 214973&txn_type=subscr_signup&receiver_id=XL85U4ZKY8C6E&payment_fee=&mc_currency=EUR&transaction_subject=Note Board Yearly subscription user 214973&protection_eligibility=Eligible&payer_status=unverified&first_name=Osc&subscr_id=I-7GW9H3CP1Y19&mc_gross=0.50&payment_date=12:00:15 Aug 02, 2019 PDT&payment_status=Completed&business=payments@noteboardapp.com&last_name=Apps&txn_id=0SU9740285014760K&mc_fee=0.37&resend=true&payment_type=instant&notify_version=3.8&payer_email=oscappsdrbcn@gmail.com&receiver_email=payments@noteboardapp.com&residence_country=ES",cache:!1,success:function(e){console.log(e)},error:function(e,t,a){console.log(t)}})}function restoreResize(e){var t=$(e.target).closest(".postitNB").attr("data-numpost");"auto"!=localStorage["height"+t]&&(localStorage["height"+t]="auto",refrescaNota(t),updateNotaMemo(t),refrescaOrdenacion())}function inicializaInvitaciones(){invitacionesPorTratar()&&($("#invitacionesBot").show(),$("#compBot").attr("title",chrome.i18n.getMessage("compartir")),$("#invitacionesBot").attr("title",chrome.i18n.getMessage("invitacionesBot")),intervalInv=setInterval(parpadeaBotonInv,300))}function muestraNotasAlCompartir(){refrescaPantalla(null,!0),inicializaInvitaciones(),esTabCompartido(tablonActual)?trataTablonComp():inicializaFriendsBot(),muestraPaneles2(),cambiaIcono(),cambiaContador()}function esTablonCompartido(e){if(!isUserConnected()||!localStorage.comparticiones)return!1;for(var t=JSON.parse(localStorage.comparticiones),a=0;a<t.length&&t[a].tabComp!=e;)a++;return a<t.length}function getTablonCompartido(e){if(!isUserConnected()||!localStorage.comparticiones)return!1;for(var t=JSON.parse(localStorage.comparticiones),a=0;a<t.length&&t[a].tabComp!=e;)a++;return a<t.length&&t[a]}function comparteTablon(){if(!salSiPapelera())if(isUserConnected()){var e=obtenerFormularioInvitar();$("#listaTablones option").sortElements((function(e,t){return parseInt($(e).attr("orden"))>parseInt($(t).attr("orden"))?1:-1})),abrirPantallaModal(e,{onOpenStart:function(){$("#enviar-compartir").off().on("click",compartir),$("#pedir-url").off().on("click",pedirUrlCompartir)},height:700})}else muestraAdvertenciaLogin("hayQueLoguearse")}function compartir(){if(!isDemoUser()){var e=$("#userInvitado").val();if(""==e)return $("#userInvitado").focus(),void(idiomaEsp(navigator.language)?muestraMensajeModal("Informa el usuario al que quieres invitar por favor"):muestraMensajeModal("Informs the user that you want to invite please"));if(e!=localStorage.nick)if(-1==e.indexOf("@")&&yaCompartido(e,parseInt($("#listaTablones").val())))idiomaEsp(navigator.language)?muestraMensajeModal("TablÃ³n ya compartido con "+e):muestraMensajeModal("Board already shared with "+e);else if(e.indexOf("@")>-1&&!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\D{2,4})+$/.test(e))idiomaEsp(navigator.language)?muestraMensajeModal("Mail con formato incorrecto"):muestraMensajeModal("Wrong mail");else{muestraMensajeModal(""),$("#enviar-compartir i").addClass("loader");var t=$("#onlyRead").is(":checked")?"R":"RW",a="id_usuario="+localStorage.id_usuario;a+="&token="+localStorage.token,a+="&permisos="+t,a+="&userInvitado="+encodeURIComponent(e),a+="&nombreInvitador="+encodeURIComponent($("#nombreInvitador").val()),a+="&tablon="+parseInt($("#listaTablones").val()),a+="&textoCompartir="+encodeURIComponent($("#textoCompartir").val()),$.ajax({type:"POST",url:getServerUrl()+"api/invitar.php",data:a,cache:!1,success:function(a){var o=JSON.parse(a);$("#mensError").html(o.mens),o.isSuccess&&(addInvEnviadas(e,o.id_usuarioInv,parseInt($("#listaTablones").val()),$("#textoCompartir").val(),t),$("#dialog-confirm").fadeOut(1e3,(function(){modalInstance.close()})))},error:function(e,t,a){console.log(t)},complete:function(){$("#enviar-compartir i").removeClass("loader")}})}else idiomaEsp(navigator.language)?muestraMensajeModal("No puedes compartir contigo mismo, escribe el nombre de usuario o mail del usuario al que quieres invitar"):muestraMensajeModal("You can not share with yourself, type the user name or mail the user you want to invite")}}function pedirUrlCompartir(){if(!isDemoUser()){$("#pedir-url i").addClass("loader");var e="id_usuario="+localStorage.id_usuario;e+="&tablon="+parseInt($("#listaTablones").val()),e+="&permisos="+($("#onlyRead").is(":checked")?"R":"RW"),$.ajax({type:"POST",url:getServerUrl()+"api/getUrlShare.php",data:e,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess?($("#url-generada").val(t.url),document.getElementById("url-generada").select(),document.execCommand("copy"),window.getSelection().empty()):muestraMensajeModal(chrome.i18n.getMessage("errorShareUrl"))},error:function(e,t,a){muestraMensajeModal(chrome.i18n.getMessage("errorShareUrl"))},complete:function(){$("#pedir-url i").removeClass("loader")}})}}function anularInvitacion(){var e=parseInt($(this).attr("id").substr(7)),t=JSON.parse(localStorage.invEnviadas),a="id_usuario1="+localStorage.id_usuario;a+="&id_usuario2="+t[e].id_usuario2,a+="&mail2="+t[e].mail,a+="&tablon1="+t[e].tablon,$.ajax({type:"POST",url:getServerUrl()+"api/anularInv.php",data:a,cache:!1,success:function(t){var a=JSON.parse(t);if(a.isSuccess){var o=JSON.parse(localStorage.invEnviadas);o.splice(e,1),localStorage.invEnviadas=JSON.stringify(o),0==o.length?$("#tablaInvEnviadas").fadeOut():$("#lineaInv"+e).fadeOut((function(){$("#contenedorTabla").html(tablaInvitacionesEnviadas())}))}else alert(a.error)},error:function(e,t,a){console.log(t)}})}function recibeInvitaciones(e){for(var t=0;t<e.length;t++)e.tratada=!1,e.aceptada=!1;localStorage.invitaciones=JSON.stringify(e)}function recibeInvEnviadas(e){localStorage.invEnviadas=JSON.stringify(e)}function recibeComparticiones(e){for(var t=[],a=0;a<e.length;a++)contieneComp(e[a],t)||(t.push(e[a]),e[a].tabKanban&&(localStorage["tablonKanban"+e[a].tabComp]=JSON.stringify(e[a].tabKanban)));localStorage.comparticiones=JSON.stringify(t)}function muestraInvitaciones(){if(clearInterval(intervalInv),$("#invitacionesBot").css("background","linear-gradient(bottom, #E3B752 6%, #FFDC73 35%, #FFFF96 73%)"),invitacionesPorTratar()>0){var e=JSON.parse(localStorage.invitaciones),t='<div class="invitaciones">';t+='<div id="listaInv"><ul>';for(var a=0;a<e.length;a++)e[a].tratada||(t+='<li id="invitacion'+a+'">',t+=chrome.i18n.getMessage("user")+":<p> "+e[a].user,t+=' - <a href="mailto:'+e[a].mail+'">'+e[a].mail+"</a></p><br>",t+=chrome.i18n.getMessage("mensaje")+":<p> "+e[a].mensaje+"</p><br>","RW"==e[a].permisos?t+=chrome.i18n.getMessage("permisos")+": <p>"+chrome.i18n.getMessage("escLec")+"</p><br>":t+=chrome.i18n.getMessage("permisos")+": <p>"+chrome.i18n.getMessage("lec")+"</p><br>",t+=`<div class="input-field"><p>${chrome.i18n.getMessage("eligeTablonDestino")}</p>\n            <div class="input-field">\n              ${getSelectHtml({id:"listaTablones",label:chrome.i18n.getMessage("elijeDestino"),options:listaTablones(isAddBoardPremiumAllowed())})}\n            </div>\n          </div>`,t+='<button type="button" class="rechazarInv btn waves-effect waves-light red lighten-2" id="rechazarInv'+a+'">'+chrome.i18n.getMessage("rechazar")+"</button>",t+='<button type="button" class="aceptarInv accept-btn btn waves-effect waves-light" id="aceptarInv'+a+'">'+chrome.i18n.getMessage("aceptar")+"</button>",t+="<hr></li>");t+='</ul></div><div id="ajaxAnswer"></div></div>',$("#dialog-confirm").attr("title",chrome.i18n.getMessage("extName")),$("#dialog-confirm").html(t),$("#listaTablones option").sortElements((function(e,t){return parseInt($(e).attr("orden"))>parseInt($(t).attr("orden"))?1:-1})),abrirPantallaModal(t,{onOpenStart:function(){$("#enviar-compartir").on("click",compartir),$(".aceptarInv").on("click",aceptarInv),$(".rechazarInv").on("click",rechazarInv)},header:{title:chrome.i18n.getMessage("invitacionesPend")},buttons:{cancelButton:!0},height:580})}}function aceptarInv(){if(!isDemoUser()){var e=parseInt($(this).attr("id").substr(10)),t=JSON.parse(localStorage.invitaciones),a="id_usuario1="+t[e].id_usuario1;a+="&id_usuario2="+localStorage.id_usuario,a+="&nick1="+t[e].user,a+="&nick2="+localStorage.nick,a+="&tablon1="+t[e].tablon,a+="&tablon2="+$("#listaTablones").val(),a+="&token="+t[e].token,$("#ajaxAnswer").html('<img src="appimg/ajax-loader.gif"/>'),$.ajax({type:"POST",url:getServerUrl()+"api/aceptarInv.php",data:a,cache:!1,success:function(t){var a=JSON.parse(t);if(a.isSuccess){var o=JSON.parse(localStorage.invitaciones);o[e].tratada=!0,o[e].aceptada=!0,localStorage.invitaciones=JSON.stringify(o),parseInt($("#listaTablones").val())>parseInt(localStorage.numTablones)?(addBoard(),sweetAlert({type:"info",text:chrome.i18n.getMessage("newSharedBoard",[nombreTablon($("#listaTablones").val()),o[e].user]),cancel:!1,successCallback:function(){clickTablon(null,!1,$("#listaTablones").val())}})):sweetAlert({type:"info",text:chrome.i18n.getMessage("sharedBoard",[nombreTablon($("#listaTablones").val()),o[e].user]),cancel:!1}),localStorage.sincPeriodico="true",sendMessage({empiezaSincroPeriodica:!0}),grabaModificaciones(),sincronizaLogin(!1,!0,!0),0==invitacionesPorTratar()?($("#dialog-confirm").fadeOut(1400,(function(){modalInstance.close()})),$("#invitacionesBot").hide()):$("#invitacion"+e).remove()}else $("#ajaxAnswer").html(a.error);$("#ajaxAnswer").html("")},error:function(e,t,a){console.log(t)}})}}function rechazarInv(){var e=parseInt($(this).attr("id").substr(11)),t=JSON.parse(localStorage.invitaciones),a="id_usuario1="+t[e].id_usuario1;a+="&id_usuario2="+localStorage.id_usuario,a+="&nick1="+t[e].user,a+="&nick2="+localStorage.nick,a+="&tablon1="+t[e].tablon,a+="&token="+t[e].token,$.ajax({type:"POST",url:getServerUrl()+"api/rechazarInv.php",data:a,cache:!1,success:function(t){var a=JSON.parse(t);if(a.isSuccess){var o=JSON.parse(localStorage.invitaciones);o[e].tratada=!0,o[e].aceptada=!1,localStorage.invitaciones=JSON.stringify(o),0==invitacionesPorTratar()?($("#dialog-confirm").fadeOut(1400,(function(){modalInstance.close()})),$("#invitacionesBot").hide()):$("#invitacion"+e).remove()}else alert(a.error)},error:function(e,t,a){console.log(t)}})}function updateCompartido(e,t){if(!isDemoUser()){for(var a=JSON.parse(localStorage.comparticiones),o=0;o<a.length;o++)a[o].tabComp==e&&(a[o].tabComp=t);localStorage.comparticiones=JSON.stringify(a);var n="id_usuario="+localStorage.id_usuario;n+="&numTablon="+e,n+="&numNuevo="+t,$.ajax({type:"POST",url:getServerUrl()+"api/updateCompartir.php",data:n,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess?console.log("success"):alert(t.error)},error:function(e,t,a){console.log(t)}})}}function deleteTablonCompartido(e,t){if(!isDemoUser()){var a="id_usuario="+localStorage.id_usuario;a+="&numTablon="+e,$.ajax({type:"POST",url:getServerUrl()+"api/deleteTablonCompartido.php",data:a,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess?inicializaFriendsBot():alert(t.error)},error:function(e,t,a){console.log(t)}})}}function borrarCompartir(){var e=$(this).attr("id").substr(14);sweetAlert({text:chrome.i18n.getMessage("confirmarCompartirTab"),successCallback:function(){borrarCompartirConfirmado(e)},type:"warning"})}function borrarCompartirConfirmado(e){if(!isDemoUser()){var t=JSON.parse(localStorage.comparticiones),a="id_usuario="+localStorage.id_usuario;a+="&idUserComp="+t[e].id_usuarioComp,a+="&numTablon="+t[e].tabComp;var o=t[e].tabComp;$.ajax({type:"POST",url:getServerUrl()+"api/deleteCompartir.php",data:a,cache:!1,success:function(t){var a=JSON.parse(t);if(a.isSuccess){var n=JSON.parse(localStorage.comparticiones);n.splice(e,1),localStorage.comparticiones=JSON.stringify(n),esTabCompartido(o)?muestraUsuariosComp(null,!0):inicializaFriendsBot(),grabaModificaciones(),sincronizaLogin(!1,!0,!0),0==n.length&&localStorage.removeItem("comparticiones")}else console.log(a.error)},error:function(e,t,a){console.log(t)}})}}var mailModalInstance,numParp=0;function parpadeaBotonInv(){numParp++,"rgb(231, 91, 44)"==$("#invitacionesBot").css("background-color")?$("#invitacionesBot").css("background","linear-gradient(bottom, #E3B752 6%, #FFDC73 35%, #FFFF96 73%)"):$("#invitacionesBot").css("background","#E75B2C"),30==numParp&&(clearInterval(intervalInv),$("#invitacionesBot").css("background",""),$("#invitacionesBot").css("background-color",""))}function inicializaFriendsBot(){$("#friendsBot").hide(),$(".nicksComp").hide()}function trataTablonComp(){$("#friendsBot").show()}function muestraUsuariosComp(e,t){if(t||!$(".nicksComp").is(":visible")){for(var a='<div id="usuariosComp">'+chrome.i18n.getMessage("compartidoCon")+"</div>",o=JSON.parse(localStorage.comparticiones),n=0;n<o.length;n++)o[n].tabComp==tablonActual&&(a+='<div class="nickComp" id="nick'+n+'">'+o[n].nickComp,a+='<img class="borraCompartir" id="borraCompartir'+n+'"src="appimg/removeWhite.png">',a+='<label class="permCompartir">'+chrome.i18n.getMessage(o[n].permisos)+" </label>",a+="</div>");$(".nicksComp").html(a),$("#borraCompartir").attr("title",chrome.i18n.getMessage("borraCompartir")),$(".borraCompartir").on("click",borrarCompartir);var i=$("#friendsBot").position().left+$(".nicksComp").width();$(".nicksComp").css({top:$("#friendsBot").height(),left:i>window.innerWidth?$("#friendsBot").position().left-(i+10-window.innerWidth):$("#friendsBot").position().left}),$(".nicksComp").fadeIn()}else $(".nicksComp").fadeOut();e&&e.stopPropagation(),closePaneles("nicksComp")}function showCalendar(e){abrirPantallaModal(obtenerFormularioCalendar(),{onOpenStart:function(){inicializaCalendar(e)},width:600,maxHeight:"500px",minHeight:"480px",dialogElement:"dialog-calendar"})}function inicializaCalendar(e){var t=getCalendarDate(e);t?($("#crear-aviso").hide(),$("#modificar-aviso").show(),$("#borrar-aviso").show()):($("#crear-aviso").show(),$("#modificar-aviso").hide(),$("#borrar-aviso").hide()),$("#borrar-aviso").off().on("click",(function(){borrarCalendar(e),modalInstance.close()})),$("#crear-aviso, #modificar-aviso").off().on("click",(function(){crearCalendar(e),modalInstance.close()}));var a=t||new Date;$("#datepicker").val(a.getDate()+"."+(a.getMonth()+1)+"."+a.getFullYear()+" "+a.getHours()+":"+a.getMinutes()),jQuery("#datepicker").datetimepicker({format:"d.m.Y H:i",inline:!0,step:5,minDate:0,dayOfWeekStart:1}),$.datetimepicker.setLocale(window.navigator.language||navigator.browserLanguage),getCalendarPopup(e)||null==localStorage["calendar"+e]||$("#popupCalendarCheck").prop("checked",!1),getCalendarPeriodicidad(e)&&$("#periodicidad").val(getCalendarPeriodicidad(e)),getCalendarMail(e)&&$("#popupMailCheck").prop("checked",!0),$("#popupMailCheck").on("click",(function(){ocultaFormularioCalendar(),abreFormMail(e),compruebaCheckMail()})),compruebaCheckMail(),$("#dialog-calendar .tooltipstered").tooltipster({theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:150,zIndex:100000001})}function ocultaFormularioCalendar(){$("#dialog-calendar").hide()}function muestraFormularioCalendar(){$("#dialog-calendar").show()}function compruebaCheckMail(){$("#popupMailCheck").is(":checked")?$("#popupCalendarCheck").removeAttr("disabled"):($("#popupCalendarCheck").prop("checked",!0),$("#popupCalendarCheck").attr("disabled",!0))}function crearCalendar(e){var t=$("#datepicker").datetimepicker("getValue");setCalendarDate(e,t),$("#popupCalendarCheck").is(":checked")?setCalendarPopup(e,!0):setCalendarPopup(e,!1),grabaNotaCalendar(e),$("#periodicidad").val()||getCalendarPeriodicidad(e)?setCalendarPeriodicidad(e,$("#periodicidad").val()):getCalendarPush(e)&&(borraPush(e),setCalendarPush(e,"")),$("#popupMailCheck").is(":checked")?crearRegistroMail(e):getCalendarMail(e)&&(borraMail(e),setCalendarMail(e,"")),$("#calendar"+e).css("opacity","1"),$("#calendar"+e).tooltipster("content",chrome.i18n.getMessage("aviso")+formateaFecha(t))}function borrarCalendar(e){null!=localStorage["calendar"+e]&&""!=localStorage["calendar"+e]&&"undefined"!=localStorage["calendar"+e]&&(""!=getCalendarPush(e)&&borraPush(e),getCalendarMail(e)&&borraMail(e),localStorage.removeItem("calendar"+e),grabaNotaCalendar(e));$("#calendar"+e).length>0&&($("#calendar"+e).css("opacity","0.5"),$("#calendar"+e).tooltipster("content",chrome.i18n.getMessage("programaAviso")))}function setCalendar(e,t,a){var o=localStorage["calendar"+e];if(o&&-1==o.indexOf("{")&&(o=convierteFormatoViejo(o,e)),o&&"undefined"!=o)n=JSON.parse(o);else var n={};""==a||0==a?delete n[t]:n[t]=a,localStorage["calendar"+e]=JSON.stringify(n),grabaNotaCalendar(e)}function getCalendar(e,t){var a,o=localStorage["calendar"+e];if(o&&-1==o.indexOf("{")&&(o=convierteFormatoViejo(o,e)),!o||"undefined"==o)return"";try{a=JSON.parse(o)[t]||""}catch(e){a=""}return a}function getCalendarDate(e){var t=getCalendar(e,"fechaHora");return t&&(t=new Date(t)),t}function setCalendarDate(e,t){setCalendar(e,"fechaHora",t.toString())}function getCalendarPeriodicidad(e){var t=getCalendar(e,"peri");return"0"==t&&(t=""),t}function setCalendarPeriodicidad(e,t){setCalendar(e,"peri",t)}function getCalendarPopup(e){return getCalendar(e,"popup")}function setCalendarPopup(e,t){setCalendar(e,"popup",t)}function getCalendarNotifica(e){return getCalendar(e,"noti")}function setCalendarNotifica(e,t){setCalendar(e,"noti",t)}function getCalendarPush(e){return getCalendar(e,"idPush")}function setCalendarPush(e,t){setCalendar(e,"idPush",t)}function getCalendarMail(e){return getCalendar(e,"idMail")}function setCalendarMail(e,t){setCalendar(e,"idMail",t)}function grabaNotaCalendar(e){isUserConnected()&&updateNotaLoginMemo(e)}function actualizaFechaCalendar(e){var t=getCalendarPeriodicidad(e);if(t){var a=new Date,o=getCalendarDate(e),n=o.getHours(),i=o.getMinutes(),r=o.getDate();switch(t){case"1":o.setDate(o.getDate()+1);break;case"2":5==(new Date).getDay()?o.setDate(o.getDate()+3):o.setDate(o.getDate()+1);break;case"7":o.setDate(o.getDate()+7);break;case"30":o.setMonth(o.getMonth()+1)}o<a&&(o.setTime(a),o.setHours(n),o.setMinutes(i),"30"==t&&o.setDate(r)),setCalendarDate(e,o)}}function convierteFormatoViejo(e,t){if("undefined"==e)return localStorage.removeItem("calendar"+t),{};var a={};try{a.fechaHora=new Date(e.substr(0,16)),(e.length>16||"||popup"!=e.substr(16))&&"||"!=e.substring(16,1)&&(idPush=parseInt(e.substr(17,4)),Number.isInteger(idPush)&&(a.idPush=idPush),idMail=e.split("||")[1],"popup"==idMail&&(idMail=""),Number.isInteger(parseInt(idMail))&&(a.idMail=idMail))}catch(e){console.log(e)}return JSON.stringify(a)}function abreFormMail(e,t){chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(function(a){if(a){var o=obtenerFormularioMail(t);mailModalInstance=abrirPantallaModal(o,{onOpenStart:function(){insertaThumb(e),$("#enviar-mail").off().on("click",(function(){aceptaMail(),t&&crearRegistroMail(e,!0),compruebaCheckMail()})),$("#userDestino, #ccmail").off().on("dblclick",(function(){localStorage.mail&&$(this).val(localStorage.mail)})),t||$("#cancelar-mail").off().on("click",(function(){$("#popupMailCheck").attr("checked",!1),compruebaCheckMail(),mailModalInstance.close(),muestraFormularioCalendar()}))},newModalInstance:!0})}else $("#popupMailCheck").attr("checked",!1)}))}function aceptaMail(){if(""==document.getElementById("userDestino").value)return idiomaEsp(navigator.language)?document.getElementById("errorMail").innerHTML="<font color='red'>Falta informar email</font>":document.getElementById("errorMail").innerHTML="<font color='red'>Mail empty</font>",document.getElementById("userDestino").focus(),!1;for(var e=document.getElementById("userDestino").value.split(","),t=0;t<e.length;t++)if(!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\D{2,4})+$/.test(e[t]))return idiomaEsp(navigator.language)?document.getElementById("errorMail").innerHTML="<font color='red'>Alguno de los destinatarios es incorrecto</font>":document.getElementById("errorMail").innerHTML="<font color='red'>Some of the emails are not correct</font>",document.getElementById("userDestino").focus(),!1;if(""!=document.getElementById("ccmail").value){var a=document.getElementById("ccmail").value.split(",");for(t=0;t<a.length;t++)if(!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\D{2,4})+$/.test(a[t]))return idiomaEsp(navigator.language)?document.getElementById("errorMail").innerHTML="<font color='red'>Alguno de los destinatarios es incorrecto</font>":document.getElementById("errorMail").innerHTML="<font color='red'>Some of the emails are not correct</font>",document.getElementById("ccmail").focus(),!1}mailModalInstance.close(),muestraFormularioCalendar()}function insertaThumb(e){$("#thumbnailPost").html(localStorage["postit"+e]),$("#thumbnailPost").height()<100&&$("#thumbnailPost").css("zoom","1")}function crearRegistroMail(e,t,a){if(""!=$("#userDestino").val()){var o=localStorage["postit"+e];if(t)var n=new Date;else n=getCalendarDate(e);var i=n.getTime(),r=6e4*n.getTimezoneOffset();nd=new Date(i+r+72e5);var s=nd.getFullYear()+"-"+("0"+parseInt(nd.getMonth()+1)).slice(-2)+"-"+("0"+nd.getDate()).slice(-2);s+=" "+("0"+nd.getHours()).slice(-2)+":"+("0"+nd.getMinutes()).slice(-2);var l="&postit="+encodeURIComponent(o);if(l+="&calendar="+s,l+="&destino="+$("#userDestino").val(),l+="&ccmail="+$("#ccmail").val(),l+="&asunto="+$("#asunto").val(),l+="&textoMail="+$("#textoMail").val(),l+="&tipoA="+localStorage["tipoA"+e],l+="&sinMarco="+localStorage["sinMarco"+e],l+="&periodicidad="+getCalendarPeriodicidad(e),t||a)var c="";else c=getCalendarMail(e);if(t)d=getServerUrl()+"api/mail/sendMail.php";else if(c){var d=getServerUrl()+"api/mail/updateMail.php";l+="&idMail="+c}else var d=getServerUrl()+"api/mail/createMail.php";$.ajax({type:"POST",url:d,data:l,cache:!1,success:function(a){var o=JSON.parse(a);o.isSuccess&&!t&&d.indexOf("createMail")>-1&&setCalendarMail(e,o.idMail)},error:function(e,t,a){console.log(t)}})}}function borraMail(e){var t=getCalendarMail(e);if(""!=t){var a="idMail="+t;$.ajax({type:"POST",url:getServerUrl()+"api/mail/deleteMail.php",data:a,cache:!1,success:function(e){},error:function(e,t,a){console.log(t)}})}}function contieneComp(e,t){for(var a=0;a<t.length;a++)if(t[a].id_usuarioComp==e.id_usuarioComp&&t[a].tabComp==e.tabComp&&t[a].permisos==e.permisos)return!0;return!1}function invitacionesPorTratar(){if(null==localStorage.invitaciones)return 0;for(var e=JSON.parse(localStorage.invitaciones),t=0,a=0;a<e.length;a++)e[a].tratada||t++;return t}function yaCompartido(e,t){if(null==localStorage.comparticiones)return!1;for(var a=JSON.parse(localStorage.comparticiones),o=0;o<a.length;o++)if(a[o].nickComp==e&&a[o].tabComp==t)return!0;return!1}function esTabCompartido(e=tablonActual){if(null==localStorage.comparticiones||!isUserConnected())return!1;for(var t=JSON.parse(localStorage.comparticiones),a=0;a<t.length;a++)if(t[a].tabComp==e)return!0;return!1}function getTablonCompartidoLocal(e){if(!localStorage.comparticiones||!isUserConnected())return-1;for(var t=JSON.parse(localStorage.comparticiones),a=0;a<t.length;a++)if(t[a].tabCompRemoto==e)return t[a].tabComp;return-1}function esNotaCompartida(e){return!!localStorage["userComp"+e]}function borraComparticion(e){for(var t=JSON.parse(localStorage.comparticiones),a=0;a<t.length;a++)t[a].tabComp==e&&t.splice(a,1);localStorage.comparticiones=JSON.stringify(t)}function selectDeTablones(e,t){var a='<select id="listaTablones">';e?"0"!=tablonActual&&(a+='<option orden="'+ordenTablon(tablonActual)+'" value="'+tablonActual+'">'+nombreTablon(tablonActual)+"</option>"):a+='<option value="'+(parseInt(localStorage.numTablones)+1)+'">'+chrome.i18n.getMessage("labelAdd")+"</option>";for(var o=1;o<=localStorage.numTablones;o++)e&&o==tablonActual||(a+='<option orden="'+ordenTablon(o)+'" value="'+o+'">'+nombreTablon(o)+"</option>");return esNotaWeb(t)&&(a+='<option value="-999">'+nombreTablon(-999)+"</option>"),a+="</select>"}function listaTablones(e=!1,t=!1){var a,o=[];t&&o.push({text:chrome.i18n.getMessage("ultimoTablonActual"),value:0,orden:0,selected:!0}),e&&o.push({text:chrome.i18n.getMessage("labelAdd"),value:parseInt(localStorage.numTablones)+1});for(var n=1;n<=localStorage.numTablones;n++)o.push({text:nombreTablon(n),value:n,orden:parseInt(ordenTablon(n)),selected:0!=tablonActual||t?tablonActual==n:1==n});return algunaNotaWeb()&&o.push({text:nombreTablon(-999),value:"-999",orden:9999,selected:"-999"==tablonActual}),o.sort((a="orden",(e,t)=>e[a]>t[a]?1:t[a]>e[a]?-1:0))}function tablaInvitacionesEnviadas(){var e="";if(null==localStorage.invEnviadas)return e;var t=JSON.parse(localStorage.invEnviadas);if(0==t.length)return e;e="<table>",e+="<tr>",e+="<th>"+chrome.i18n.getMessage("tablon")+"</th>",e+="<th>"+chrome.i18n.getMessage("user")+"</th>",e+="<th>"+chrome.i18n.getMessage("permisos")+"</th>",e+="<th>"+chrome.i18n.getMessage("anular")+"</th>",e+="</th>";for(var a=0;a<t.length;a++)e+='<tr id="lineaInv'+a+'" title="'+t[a].mensaje+'">',null!=localStorage["tab"+t[a].tablon+"Label"]&&"undefined"!=localStorage["tab"+t[a].tablon+"Label"]?e+="<td>"+localStorage["tab"+t[a].tablon+"Label"]+"</td>":e+="<td>"+chrome.i18n.getMessage("tablon")+t[a].tablon+"</td>",""!=t[a].user?e+="<td>"+t[a].user+"</td>":t[a].mail.indexOf("@")>0?e+="<td>"+t[a].mail+"</td>":e+="<td>Facebook</td>",e+="<td>"+chrome.i18n.getMessage(t[a].permisos)+"</td>",e+='<td><button class="anulInvBut waves-effect waves-light btn-small teal lighten-2" id="anulInv'+a+'">'+chrome.i18n.getMessage("anularBot")+"</button></td>",e+="</tr>";return e+="</table>"}function addInvEnviadas(e,t,a,o,n){if(null==localStorage.invEnviadas)var i=new Array;else i=JSON.parse(localStorage.invEnviadas);var r={mail:e.indexOf("@")>-1?e:"",mensaje:o,permisos:n,tablon:a,user:-1==e.indexOf("@")?e:"",id_usuario2:t};i.push(r),localStorage.invEnviadas=JSON.stringify(i)}function eliminaCompartidos(){for(var e=0;e<localStorage.totalPost;)null!=localStorage["userComp"+e]?borrarConfirmado(e,!0):e++;localStorage.removeItem("comparticiones"),localStorage.removeItem("invitaciones"),localStorage.removeItem("invEnviadas"),inicializaFriendsBot()}function showAjaxGif(){$("#black_overlay").show()}function hideAjaxGif(){$("#black_overlay").hide()}function guardaPosCompartido(e){posCompartidas["X"+localStorage["treeId"+e]]=localStorage["X"+e],posCompartidas["Y"+localStorage["treeId"+e]]=localStorage["Y"+e]}function recuperaPosCompartido(e){null!=posCompartidas["X"+localStorage["treeId"+e]]&&(localStorage["X"+e]=posCompartidas["X"+localStorage["treeId"+e]],localStorage["Y"+e]=posCompartidas["Y"+localStorage["treeId"+e]])}var IFRAME_UPLOAD_HEIGHT=600,IFRAME_UPLOAD_WIDTH=600;function nuevoFondo(){!isDemoUser()||isChromeExtension()?(localStorage.removeItem("fondoCustom"),chrome.permissions.contains({origins:["https://www.noteboardapp.com/"]},(function(e){e?creaFondo():pidePermiso("permisoImagenesFondo",!0)}))):sweetAlert({text:chrome.i18n.getMessage("demoUserUpload"),cancel:!1,type:"warning"})}function creaFondo(){var e="";if(localStorage["fondo"+tablonActual].indexOf("http")>-1&&(e=localStorage["fondo"+tablonActual],$("#inputUrl").val(localStorage["fondo"+tablonActual])),abrirPantallaModal(obtenerFormularioFondos(e),{onOpenStart:function(){$("#aceptar-fondo").off().on("click",(function(){aceptarFondo(),modalInstance.close()})),$("#cancelar-fondo").off().on("click",(function(){cancelaImagen(e),localStorage["fondo"+tablonActual]!=$("#imagenFondoCustom").attr("src")&&borrarFicherosAws($("#imagenFondoCustom").attr("src")),modalInstance.close()})),e&&$("#aceptar-fondo").removeClass("disabled")},height:"70%",maxHeight:700}),null!=localStorage["fondo"+tablonActual]&&"undefined"!=localStorage["fondo"+tablonActual]&&localStorage["fondo"+tablonActual].indexOf("http")>-1){var t=localStorage["fondo"+tablonActual];t.indexOf("?cover")>-1&&($("#coverBg").attr("checked",!0),t=t.split("?")[0]),$("#inputUrl").val(t),$("#imagenFondoCustom").attr("src",decodeURIComponent(t)).height("auto")}$("#fileupload").fileupload({dataType:"json",url:"https://www.noteboardapp.com/api/subirAwsBackground.php",acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,add:function(e,t){$("#progress, #progress-ajax").show().css("display","block"),muestraMensajeModal(""),localStorage.id_usuario&&$("#usuario-imagen").val(localStorage.id_usuario),t.submit()},done:function(e,t){$("#progress #bar").css("width","100%"),$.each(t.result.files,(function(e,t){null==t.error?($("#imagenFondoCustom").attr("src",t.url).height("auto"),$("#imagenFondoCustom").imagesLoaded((function(){$("#progress-ajax").hide()})),localStorage.fondoCustom=t.url,$("#aceptar-fondo").removeClass("disabled"),localStorage.fondoSize=t.size):muestraMensajeModal(t.error)})),$("#progress, #progress-ajax").hide()},progressall:muestraProgreso}),$("#inputUrl").on("change",(function(){var e=$("#inputUrl").val();validaURL(e)?($("#imagenFondoCustom").attr("src",e),localStorage.fondoCustom=e,$("#aceptar-fondo").removeClass("disabled")):$("#mensErrorFondo").text(chrome.i18n.getMessage("urlIncorrecta"))})),$("#okBut").on("click",(function(){return!1}))}function aceptarFondo(){var e;if(null!=localStorage.fondoCustom&&"undefined"!=localStorage.fondoCustom)e=localStorage.fondoCustom;else{if(-1==$("#inputUrl").val().indexOf("http"))return;e=$("#inputUrl").val()}$("#coverBg").is(":checked")?e+="?cover":e.indexOf("?cover")&&(e=e.split("?")[0]),localStorage["fondo"+tablonActual]=e,isUserConnected()||sumaEspacioServidor(parseInt(localStorage.fondoSize)),localStorage.removeItem("fondoSize"),cambiaFondoNum(e),cambiaFondoNum(e,$("#Postits")),grabaTablones(),cambiaIcono()}function cancelaImagen(e){"appimg/corcho.jpg"==e?localStorage.removeItem("fondoCustom"):localStorage.fondoCustom=e}function anexaFichero(e){if(!isDemoUser(e)||isChromeExtension()){if(!salSiPapelera()){if(!userHasSpace())return muestraMensajeNohayEspacio(),!1;var t=!$.isNumeric(e)&&e!==VALORES_POR_DEFECTO.NUEVA_NOTA;chrome.permissions.contains({origins:["https://www.noteboardapp.com/"]},(function(a){a?abreFormularioAnexa(t,e):pidePermisoImagenes("permisoAnexarFicheros",t,e)}))}}else sweetAlert({text:chrome.i18n.getMessage("demoUserUpload"),cancel:!1,type:"warning"})}function guardaNotaSubidaFichero(e,t,a,o){a=a||500;var n=localStorage.totalPost,i=document.createElement("div");i.id="postit"+n;var r=1+Math.floor(7*Math.random());i.innerHTML=`<div class="parteSuperior" id="parteSuperior${n}">\n\t\t\t\t<div class="bordesup" id="bordesup${n}"></div>\n\t\t</div>\n\t\t<div class="fuente${localStorage.fuente} textoNB"  id="texto${n}">${e}</div>\n\t\t<div class="clearfloat"></div>`,document.getElementById("Postits").appendChild(i),$("#postit"+n).width(a),$("#borr"+n).on("click",borraPostit),$("#postit"+n).draggable({scroll:!0,stack:".Postits div",containment:".Postits",drag:function(e,t){moverPostit(e,t,n)},start:function(e,t){dragStart(e,n)},stop:function(e,t){dragEnd(e,t,n)}}),$("#postit"+n).resizable({minHeight:40,minWidth:120,start:function(e,t){dragStart(e,n)},stop:function(e,t){resizePostitStop(e,n)},resize:function(e,t){resizePostit(e,n)}}),$("#postit"+n).css("z-index","1002"),$("#texto"+n).css({"font-size":localStorage.size}),localStorage["postit"+n]=e,localStorage["tablon"+n]=tablonActual,localStorage["tipoA"+n]=r;var s=$("body").scrollTop()+100+Math.floor(100*Math.random()),l=$("body").scrollLeft()+150+Math.floor(100*Math.random());localStorage["X"+n]=l,localStorage["Y"+n]=s,localStorage["sinMarco"+n]=t,$("#postit"+n).offset({top:s,left:l}),localStorage["width"+n]=a,o&&(localStorage["height"+n]=o);var c=new Date;idiomaEsp(navigator.language)?localStorage["fecha"+n]=c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear():localStorage["fecha"+n]=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear(),localStorage.totalPost++,isUserConnected()&&grabaNotaLogin(n),$("#postit"+n).remove(),muestraPostit(n),cambiaIcono(),cambiaContador(),refrescaKanban(),aplicaMasonry(!0)}var postitChange,ficherosSubidos=[],totalFicherosASubir=0;function abreFormularioAnexa(e,t){abrirPantallaModal(obtenerFormularioAnexa(),{height:700,onOpenStart:function(){$("#aceptar-anexar").off().on("click",(function(){aceptarFichero(e,t),modalInstance.close()})),ficherosSubidos=[],totalFicherosASubir=0,e||$("#allInOne").attr("disabled",!0)},onCloseEnd:function(){borrarFicherosSubidos(ficherosSubidos),ficherosSubidos=[]}}),$("#fileupload").fileupload({dataType:"json",url:"https://www.noteboardapp.com/api/subirAwsFichero.php",add:function(e,t){totalFicherosASubir++,$("#progress, #progress-ajax").show().css("display","block"),muestraMensajeModal(""),localStorage.id_usuario&&$("#usuario-imagen").val(localStorage.id_usuario),t.submit()},done:function(e,t){$("#progress #bar").css("width","100%"),$.each(t.result.files,(function(e,t){if(null==t.error){if(ficherosSubidos.push({url:t.url,name:t.name,size:t.size}),$("#resultUpload0 img").attr("empty-image"))$("#resultUpload0").html(creaIframe(t.url,t.name,500,250)).show();else{var a=$(".resultUpload").length;$("#ficheros-subidos").append('<div id="resultUpload'+a+'" class="resultUpload"></div>'),$("#resultUpload"+a).html(creaIframe(t.url,t.name,500,250)).show()}0===--totalFicherosASubir&&($("#progress-ajax").hide(),$("#aceptar-anexar").removeClass("disabled"))}else totalFicherosASubir--,muestraMensajeModal(t.error)})),$("#ajaxAnswer").hide(),modalInstance.isOpen||borrarFicherosSubidos(ficherosSubidos)},progressall:muestraProgreso}),$("#inputUrl2").on("change",(function(){$("#mensErrorFondo2").text("");var e=$("#inputUrl2").val();validaURL(e)?($("#resultUpload0").html(creaIframe(decodeURIComponent(e),500,250)).show(),$("#aceptar-anexar").removeClass("disabled")):$("#mensErrorFondo2").text(chrome.i18n.getMessage("urlIncorrecta"))}))}function borrarFicherosSubidos(e,t=!1){if(e&&e.length>0)for(var a of e)borrarFicherosAws(a.url,t)}function muestraProgreso(e,t){var a=parseInt(t.loaded/t.total*85,10);$("#progress #bar").css("width",a+"%"),100==a&&$("#ajaxAnswer").html('<img src="appimg/ajax-loader.gif"/>')}function aceptarFichero(e,t){if(e)creaNotaFichero(ficherosSubidos);else{var a="",o=0;for(var n of ficherosSubidos)$("#crearIframe").is(":checked")&&(a+=creaIframe(n.url,n.name)),$("#anexarFichero").is(":checked")&&(a+=creaLinkFichero(n.url,n.name)),o+=n.size;if(0===ficherosSubidos.length){var i=$("#inputUrl2").val();validaURL(i)&&(a+=creaIframe(i))}var r=obtenEditor(t);if(null==r)localStorage["postit"+t]+=a,refrescaNota(t),refrescaOrdenacion(1e3),isUserConnected()&&updateNotaLogin(t);else{var s=r.getContent()+a;r.setContent(s),r.ficherosSubidos=ficherosSubidos}isUserConnected()||sumaEspacioServidor(o)}ficherosSubidos=[]}function creaNotaFichero(e,t){var a="",o=0;for(var n of e){var i="";$("#crearIframe").is(":checked")&&(i+=creaIframe(n.url,n.name)),$("#anexarFichero").is(":checked")&&(i+=creaLinkFichero(n.url,n.name)),$("#allInOne").is(":checked")?a+=i:guardaNota(i),o+=n.size}if($("#allInOne").is(":checked")&&(guardaNota(a),isUserConnected()||sumaEspacioServidor(o)),0===e.length){var r=$("#inputUrl2").val();validaURL(r)&&guardaNota(creaIframe(r))}}function guardaNota(e){$("#crearIframe").is(":checked")?guardaNotaSubidaFichero(e,!hayAlgunLink(e),hayContenidoEmbebido(e)?IFRAME_UPLOAD_WIDTH:0,hayContenidoEmbebido(e)?IFRAME_UPLOAD_HEIGHT:0):guardaNotaSubidaFichero(e,!1)}function hayAlgunLink(e){return e.indexOf("link-upload-file")>-1}function hayContenidoEmbebido(e){return e.indexOf("<iframe")>-1||e.indexOf("<video")>-1||e.indexOf("<img src")>-1}function creaIframe(e,t,a,o){var n="";a=a||IFRAME_UPLOAD_WIDTH,o=o||IFRAME_UPLOAD_HEIGHT;if(isExtensionFile(["doc","docx","xls","xlsx","ppt","pptx"],e))n=`<iframe class="iframeUploadFile" src="https://view.officeapps.live.com/op/view.aspx?src=${e}" width="${a}px" height="${o}px"></iframe>`;else if(isExtensionFile([],e))n=`<iframe class="iframeUploadFile" src="https://docs.google.com/viewer?url=${e}&embedded=true" width="${a}px" height="${o}px"></iframe>`;else if(isExtensionFile(["pdf"],e))n=`<iframe src="${e}" width="${a}px" height="${o}px"></iframe>`;else if(isExtensionFile(["avi","mp4","webm","mpeg4","3GPP","mov","mpegs","wmv","flv"],e))n=`<video class="iframeUploadFile" controls="controls" width="100%" height="${o}"><source src="${e}?wmode=transparent" type="video/mp4" /></video>`;else if(isExtensionFile(["js","html","css","java","php","json"],e))n=`<iframe class="iframeUploadFile" src="https://www.noteboardapp.com/showCodeFile.php?file=${e}&embedded=true" width="${a}px" height="${o}px"></iframe>`;else if(isExtensionFile(["jpg","png","gif"],e))n=`<img src="${e}" width="100%" />`;else if(isExtensionFile(["mp3","ogg","wav"],e)){var i="";e.toLowerCase().endsWith("mp3")?i="mpeg":e.toLowerCase().endsWith("ogg")?i="ogg":e.toLowerCase().endsWith("wav")&&(i="wav"),n=`<audio controls>\n\t\t\t<source src="${e}" type="audio/${i}">\n\t\t\t\tYour browser does not support the audio element.\n\t\t</audio>`}return n||$("#anexarFichero").is(":checked")||(n=creaLinkFichero(e,t)),n}function creaLinkFichero(e,t){return'<div class="link-upload-file"><img class="link-upload-img" src="https://www.noteboardapp.com/appimg/clipNegro.png"><a href="'+e+'">'+t+"</a></div>"}function isExtensionFile(e,t){for(var a=0;a<e.length&&!t.toLowerCase().endsWith(e[a]);)a++;return a<e.length}function obtenerFormularioInvitar(){var e=tablaInvitacionesEnviadas();if(idiomaEsp(navigator.language))var t=`\n      <div class="modal-header">\n        <div class="title-container"><i class="material-icons icono">share</i><h4 class="modal-title">Share Board</h4></div>\n      </div>\n      <div id="formCompartir" class="modal-content">\n      <div class="modal-instructions">\n        Comparte el tablÃ³n actual con permisos de <b>escritura y lectura</b> o sÃ³lo <b>lectura</b>.<br>\n        Puedes compartir creando un <b>enlace Ãºnico</b> que identifique tu tablÃ³n y enviarlo a quien quieras <b>o enviar invitaciones</b> de forma individual\n        a los usuarios que quieras que tendrÃ¡n que aceptar la invitaciÃ³n.\n      </div>\n\n      <form class="formulario-modal col s12">\n        <div class="section">\n        <div class="row">\n          <div class="col s6 input-field" id="nombreTab">\n            ${getSelectHtml({id:"listaTablones",label:"Selecciona tablÃ³n a compartir",options:listaTablones(!1)})}\n          </div>\n            <div class="switch col s6">\n             <label>Permitir lectura y escritura<input type="checkbox" id="onlyRead"><span class="lever"></span>SÃ³lo lectura</label>\n            </div>\n        </div>\n\n        <p>Cualquier usuario que reciba un enlace creado con el siguiente botÃ³n compartirÃ¡ el tablÃ³n seleccionado sin ningÃºn tipo de confirmaciÃ³n\n        (ideal para compartir con mucha gente). El enlace caducarÃ¡ a los 7 dÃ­as.</p>\n\n        <div class="row">\n          <div class="col s12">\n            <button class="accept-btn btn waves-effect waves-light" id="pedir-url" type="button" name="action">Obtener enlace para compartir y copiar a portapapeles\n              <i class="material-icons right">send</i>\n            </button>\n          </div>\n\n          <div class="col s12">\n            <div class="mdc-text-field mdc-text-field--outlined mdc-text-field--no-label nb-full-width">\n              <input type="text" id="url-generada" class="mdc-text-field__input" aria-label="Label" placeholder="Usa el botÃ³n superior para para generar la Url para compartir" readonly>\n              <div class="mdc-notched-outline">\n                <div class="mdc-notched-outline__leading"></div>\n                <div class="mdc-notched-outline__trailing"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <br>\n        <h3>MÃ©todo alternativo: enviar invitaciÃ³n que tiene que ser aceptada:</h3>\n\n        <div class="row">\n          <div class="col m6 s12">\n            ${getInputHtml({id:"userInvitado",label:"Usuario o mail destino",type:"email",icon:"contact_mail",helperLine:"Mail o nombre del usuario al que quieres invitar"})}\n          </div>\n\n          <div class="col m6 s12">\n            ${getInputHtml({id:"nombreInvitador",label:"Tu nombre",type:"text",icon:"account_circle",helperLine:"(opcional) Tu nombre por si se envia un mail a tu amigo"})}\n          </div>\n        </div>\n          <div class="row">\n            <div class="col s12">\n              <div class="mdc-text-field mdc-text-field--textarea mdc-text-field--outlined mdc-text-field--fullwidth">\n                <textarea id="textoCompartir" class="mdc-text-field__input" rows="3" cols="40"></textarea>\n                <div class="mdc-notched-outline">\n                  <div class="mdc-notched-outline__leading"></div>\n                  <div class="mdc-notched-outline__notch">\n                    <label for="textarea" class="mdc-floating-label">Si quieres puedes escribir aquÃ­ un texto que se aÃ±adirÃ¡ al mail de invitaciÃ³n</label>\n                  </div>\n                  <div class="mdc-notched-outline__trailing"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n          </div>\n        </form>\n          ${e?`<div id="tablaInvEnviadas"><h2>Invitaciones enviadas pendientes de aceptar</h2>${e}</div>`:""}\n        </div><div class="modal-footer">\n          <div id="mensaje-modal" class="mensaje-modal"></div>\n\n          <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar">Cancelar</a>\n          <button class="accept-btn btn waves-effect waves-light" id="enviar-compartir" type="submit" name="action">Enviar\n            <i class="material-icons right">send</i>\n          </button>\n        </div></div> `;else t=`\n      <div class="modal-header">\n        <div class="title-container"><i class="material-icons icono">share</i><h4 class="modal-title">Compartir TablÃ³n</h4></div>\n      </div>\n      <div id="formCompartir" class="modal-content">\n      <div class="modal-instructions">\n        Share the current board with <b> write and read permissions </b> or just <b> read </b>.<br>\n        You can share by creating a <b> unique link </b> that identifies your board and send it to whoever you want <b> or send invitations </b> individually\n        to the users you want who will have to accept the invitation.\n      </div>\n\n      <form class="formulario-modal col s12">\n        <div class="section">\n        <div class="row">\n          <div class="col s6 input-field" id="nombreTab">\n            ${getSelectHtml({id:"listaTablones",label:"Select board to share",options:listaTablones(!1)})}\n          </div>\n            <div class="switch col s6">\n             <label>Allow write and read<input type="checkbox" id="onlyRead"><span class="lever"></span>Only read</label>\n            </div>\n        </div>\n\n        <p>Any user who receives a link created with the following button will share the board selected without any confirmation\n        Â  (ideal to share with many people). The link will expire after 7 days.</p>\n\n        <div class="row">\n          <div class="col s12">\n            <button class="accept-btn btn waves-effect waves-light" id="pedir-url" type="button" name="action">Get link to share and copy to clipboard\n              <i class="material-icons right">send</i>\n            </button>\n          </div>\n\n          <div class="col s12">\n            <div class="mdc-text-field mdc-text-field--outlined mdc-text-field--no-label nb-full-width">\n              <input type="text" id="url-generada" class="mdc-text-field__input" aria-label="Label" placeholder="Use the upper button to generate the URL to share" readonly>\n              <div class="mdc-notched-outline">\n                <div class="mdc-notched-outline__leading"></div>\n                <div class="mdc-notched-outline__trailing"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <br>\n        <h3>Alternative method: send invitation that has to be accepted:</h3>\n\n        <div class="row">\n          <div class="col m6 s12">\n            ${getInputHtml({id:"userInvitado",label:"User name or email destination",type:"email",icon:"contact_mail",helperLine:"Email or name of the user you want to invite"})}\n          </div>\n\n          <div class="col m6 s12">\n            ${getInputHtml({id:"nombreInvitador",label:"Your name",type:"text",icon:"account_circle",helperLine:"(optional) Your name in case an email is sent to your friend"})}\n          </div>\n        </div>\n          <div class="row">\n            <div class="col s12">\n              <div class="mdc-text-field mdc-text-field--textarea mdc-text-field--outlined mdc-text-field--fullwidth">\n                <textarea id="textoCompartir" class="mdc-text-field__input" rows="3" cols="40"></textarea>\n                <div class="mdc-notched-outline">\n                  <div class="mdc-notched-outline__leading"></div>\n                  <div class="mdc-notched-outline__notch">\n                    <label for="textarea" class="mdc-floating-label">If you want you can write here a text that will be added to the invitation mail</label>\n                  </div>\n                  <div class="mdc-notched-outline__trailing"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n          </div>\n        </form>\n          ${e?`<div id="tablaInvEnviadas"><h2>Invitations sent pending acceptance</h2>${e}</div>`:""}\n        </div><div class="modal-footer">\n          <div id="mensaje-modal" class="mensaje-modal"></div>\n\n          <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar">Cancel</a>\n          <button class="accept-btn btn waves-effect waves-light" id="enviar-compartir" type="submit" name="action">Send\n            <i class="material-icons right">send</i>\n          </button>\n        </div></div> `;return t}function obtenerFormularioFondos(e){if(idiomaEsp(navigator.language))var t='<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">image</i>\n        <h4 class="modal-title">Usar imagen como fondo de tablÃ³n</h4>\n      </div>\n    </div>\n    <div id="formFondo" class="modal-content">\n      <div class="modal-instructions">\n        Selecciona una imagen de tu ordenador o arrÃ¡strala hasta aquÃ­ para usarla como fondo de tablÃ³n. TambiÃ©n puedes introducir la Url de una imagen.\n      </div>\n      <form id="formUser" class="formUser col s12">\n        <div class="row">\n          <div class="file-field input-field col s4">\n            <div class="btn">\n              <span>Selecciona fichero</span>\n              <input id="fileupload" name="fileupload" type="file">\n            </div>\n            <div class="file-path-wrapper">\n              <input class="file-path validate" type="text">\n            </div>\n          </div>\n          <div class="file-field input-field col s8">\n            <label>\n            <input id="coverBg" type="checkbox" name="coverBg" />\n              <span>ImÃ¡gen a pantalla entera sin repeticiÃ³n (no mosaico)</span>\n            </label>\n          </div>\n        </div>\n        <div class="row">\n          <div class="input-url mdc-text-field mdc-text-field--outlined mdc-text-field--with-leading-icon col s12">\n              <i class="material-icons mdc-text-field__icon">mode_edit</i>\n              <input type="text" id="inputUrl" class="mdc-text-field__input">\n              <div class="mdc-notched-outline">\n                <div class="mdc-notched-outline__leading"></div>\n                <div class="mdc-notched-outline__notch">\n                  <label for="inputUrl" class="mdc-floating-label">Opcionalmente si quieres introduce una URL en lugar de subir al servidor</label>\n                </div>\n                <div class="mdc-notched-outline__trailing"></div>\n              </div>\n            </div>\n        </div>\n        <input type="hidden" id="usuario-imagen" name="id_usuario">\n        <div class="row">\n          <div id="progress">\n            <div id="bar" style="width: 0%;"></div>\n          </div>\n          <img id="progress-ajax" src="appimg/ajax-loader2.gif">\n        </div>\n        <div class="row">\n          <img src="appimg/no-preview.png" id="imagenFondoCustom" width="200"/>\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n      <div id="mensaje-modal" class="mensaje-modal"></div>\n\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-fondo">Cancelar</a>\n      <button class="btn waves-effect waves-light grey darken-1 disabled" id="aceptar-fondo" type="submit" name="action">Aceptar\n      </button>\n    </div>';else t='<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">image</i>\n        <h4 class="modal-title">Use image as board background</h4>\n      </div>\n    </div>\n    <div id="formFondo" class="modal-content">\n      <div class="modal-instructions">\n        Select an image from your computer or drag it here to use it as a board background. You can also enter the URL of an image.\n      </div>\n      <form id="formUser" class="formUser col s12">\n        <div class="row">\n          <div class="file-field input-field col s4">\n            <div class="btn">\n              <span>Select file</span>\n              <input id="fileupload" name="fileupload" type="file">\n            </div>\n            <div class="file-path-wrapper">\n              <input class="file-path validate" type="text">\n            </div>\n          </div>\n          <div class="file-field input-field col s8">\n            <label>\n            <input id="coverBg" type="checkbox" name="coverBg" />\n              <span>Full-screen image without repetition (no mosaic)</span>\n            </label>\n          </div>\n        </div>\n        <div class="row">\n          <div class="input-url mdc-text-field mdc-text-field--outlined mdc-text-field--with-leading-icon col s12">\n              <i class="material-icons mdc-text-field__icon">mode_edit</i>\n              <input type="text" id="inputUrl" class="mdc-text-field__input">\n              <div class="mdc-notched-outline">\n                <div class="mdc-notched-outline__leading"></div>\n                <div class="mdc-notched-outline__notch">\n                  <label for="inputUrl" class="mdc-floating-label">Optionally if you want enter a URL instead of uploading to the server</label>\n                </div>\n                <div class="mdc-notched-outline__trailing"></div>\n              </div>\n            </div>\n        </div>\n        <input type="hidden" id="usuario-imagen" name="id_usuario">\n        <div class="row">\n          <div id="progress">\n            <div id="bar" style="width: 0%;"></div>\n          </div>\n          <img id="progress-ajax" src="appimg/ajax-loader2.gif">\n        </div>\n        <div class="row">\n          <img src="appimg/no-preview.png" id="imagenFondoCustom" width="200"/>\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n      <div id="mensaje-modal" class="mensaje-modal"></div>\n\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-fondo">Cancel</a>\n      <button class="btn waves-effect waves-light grey darken-1 disabled" id="aceptar-fondo" type="submit" name="action">Accept\n      </button>\n    </div>';return t}function obtenerFormularioAnexa(){if(idiomaEsp(navigator.language))var e='<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono" style="transform: rotate(45deg)">attach_file</i>\n        <h4 class="modal-title">Anexar fichero a una nota</h4>\n      </div>\n    </div>\n    <div id="formUpload" class="modal-content">\n      <div class="modal-instructions">\n        Selecciona un fichero de tu ordenador para anexarlo en una nota como un link o como contenido embebido si es posible. El fichero se subirÃ¡ a\n        www.noteboardapp.com y se borrarÃ¡ cuando deje de estar en alguna nota.<br>\n        TambiÃ©n se puede informar una URL de una imagen o de cualquier otro tipo para anexarlo en la nota (sin subirlo al servidor).\n      </div>\n      <form id="formUser" class="formUser col s12 m12 l6">\n        <div class="row">\n          <div class="file-field input-field col s12 m4 l3">\n            <div class="btn">\n              <span>Selecciona ficheros</span>\n              <input id="fileupload" name="fileupload" multiple type="file">\n            </div>\n            <div class="file-path-wrapper">\n              <input class="file-path validate" type="text">\n            </div>\n          </div>\n          <div class="col s12 m8 l9">\n            <div class="opciones"><label><input type="checkbox" id="crearIframe" checked /><span>Embeber contenido si es posible</span></label></div>\n            <div class="opciones"><label><input type="checkbox" id="anexarFichero"/><span>Fichero anexado con link</span></label></div>\n            <div class="opciones"><label><input type="checkbox" id="allInOne" checked /><span>Todos los ficheros en una sola nota</span></label></div>\n          </div>\n        </div>\n        <div class="row">\n\n          <div class="input-url mdc-text-field mdc-text-field--outlined mdc-text-field--with-leading-icon col s12">\n            <i class="material-icons mdc-text-field__icon">mode_edit</i>\n            <input type="text" id="inputUrl2" class="mdc-text-field__input">\n            <div class="mdc-notched-outline">\n              <div class="mdc-notched-outline__leading"></div>\n              <div class="mdc-notched-outline__notch">\n                <label for="inputUrl2" class="mdc-floating-label">Opcionalmente si quieres introduce una URL en lugar de subir al servidor</label>\n              </div>\n              <div class="mdc-notched-outline__trailing"></div>\n            </div>\n          </div>\n        </div>\n        <input type="hidden" id="usuario-file" name="id_usuario">\n        <div class="row">\n          <div id="progress">\n            <div id="bar" style="width: 0%;"></div>\n          </div>\n          <img id="progress-ajax" src="appimg/ajax-loader2.gif">\n        </div>\n        <div class="row">\n          <div id="ficheros-subidos">\n            <div id="resultUpload0" class="resultUpload"><img id="imagenSubida0" empty-image="true" src="appimg/no-preview.png" /></div>\n          </div>\n          <div id="ajaxAnswer"></div>\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n      <div id="mensaje-modal" class="mensaje-modal"></div>\n\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-anexar">Cancelar</a>\n      <button class="btn waves-effect waves-light grey darken-1 disabled" id="aceptar-anexar" type="submit" name="action">Aceptar\n      </button>\n    </div>';else e='<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono" style="transform: rotate(45deg)">attach_file</i>\n        <h4 class="modal-title">Attach file to a note</h4>\n      </div>\n    </div>\n    <div id="formUpload" class="modal-content">\n      <div class="modal-instructions">\n        Select a file from your computer to append it in a note as a link or as embedded content if possible.\n        The file will be uploaded to www.noteboardapp.com and will be deleted when it won\'t be in any note.<br>\n        You can also input an URL of an image or any other type to attach it in the note (without uploading to the server).\n      </div>\n      <form id="formUser" class="formUser col s12 m12 l6">\n        <div class="row">\n          <div class="file-field input-field col s12 m4 l3">\n            <div class="btn">\n              <span>Select files</span>\n              <input id="fileupload" name="fileupload" multiple type="file">\n            </div>\n            <div class="file-path-wrapper">\n              <input class="file-path validate" type="text">\n            </div>\n          </div>\n          <div class="col s12 m8 l9">\n            <div class="opciones"><label><input type="checkbox" id="crearIframe" checked/><span>Embed content if possible</span></label></div>\n            <div class="opciones"><label><input type="checkbox" id="anexarFichero"/><span>File attached with link</span></label></div>\n            <div class="opciones"><label><input type="checkbox" id="allInOne" checked /><span>All files in a single note</span></label></div>\n          </div>\n        </div>\n        <div class="row">\n\n          <div class="input-url mdc-text-field mdc-text-field--outlined mdc-text-field--with-leading-icon col s12">\n            <i class="material-icons mdc-text-field__icon">mode_edit</i>\n            <input type="text" id="inputUrl2" class="mdc-text-field__input">\n            <div class="mdc-notched-outline">\n              <div class="mdc-notched-outline__leading"></div>\n              <div class="mdc-notched-outline__notch">\n                <label for="inputUrl2" class="mdc-floating-label">Optionally if you want enter a URL instead of uploading to the server</label>\n              </div>\n              <div class="mdc-notched-outline__trailing"></div>\n            </div>\n          </div>\n        </div>\n        <input type="hidden" id="usuario-file" name="id_usuario">\n        <div class="row">\n          <div id="progress">\n            <div id="bar" style="width: 0%;"></div>\n          </div>\n          <img id="progress-ajax" src="appimg/ajax-loader2.gif">\n        </div>\n        <div class="row">\n          <div id="ficheros-subidos">\n            <div id="resultUpload0" class="resultUpload"><img id="imagenSubida0" empty-image="true" src="appimg/no-preview.png" /></div>\n          </div>\n          <div id="ajaxAnswer"></div>\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n      <div id="mensaje-modal" class="mensaje-modal"></div>\n\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-anexar">Cancel</a>\n      <button class="btn waves-effect waves-light grey darken-1 disabled" id="aceptar-anexar" type="submit" name="action">Accept\n      </button>\n    </div>';return e}function obtenerFormularioPublico(){var e;e=null!=localStorage["tab"+tablonActual+"Label"]&&"undefined"!=localStorage["tab"+tablonActual+"Label"]?localStorage["tab"+tablonActual+"Label"]:chrome.i18n.getMessage("tablon")+tablonActual;var t="www.noteboardapp.com/"+localStorage.nickPublico,a="true"==localStorage["publico"+tablonActual];if(idiomaEsp(navigator.language))var o=`<div class="modal-header">\n      <div class="title-container"><img src="appimg/publish.png" class="icono" />\n        <h4 class="modal-title">Publicar tablÃ³n</h4>\n      </div>\n    </div>\n    <div class="modal-content">\n      <div class="modal-instructions">\n        ${a?`El tablÃ³n ${e} <b>ya es pÃºblico</b>. Con esta opciÃ³n puedes volver a ponerlo con visibilidad a <b>PRIVADO</b>.`:`El tablÃ³n ${e} es privado. Con esta opciÃ³n cambiarÃ¡s su visibilidad a <b>PÃBLICO</b>.`}\n        <br>\n        Cuando un tablÃ³n es pÃºblico puede ser visto por cualquiera pero sin posibilidad de modificaciÃ³n, nadie podrÃ¡ cambiar el contenido de\n        tus notas excepto tÃº.<br><br>\n        Visita la <a href="https://www.noteboardapp.com/galleryPage" target="_blank">galeria</a> de la web para ver ejemplos de tablones pÃºblicos.\n        Tu web pÃºblica mostrarÃ¡ publicidad al menos que seas usuario premium.\n        Si quieres hacerte premium haz click en <a href="https://www.noteboardapp.com/paypalPage?idUsuario=' + localStorage['id_usuario'] + '" target="_blank">Premium</a>\n      </div>\n      <form id="formUser" class="formUser col s12">\n        <div class="row">\n          <h3>Tu URL pÃºblica es:\n          <a id="urlPublica" href="https://www.noteboardapp.com/${localStorage.nickPublico}" target="_blank">https://www.noteboardapp.com/${localStorage.nickPublico}</a></h3>\n          Si compartes este tablÃ³n tambiÃ©n puedes usar la url directa: <a href="https://www.noteboardapp.com/${localStorage.nickPublico}/${encodeURIComponent(nombreTablon())}" target="_blank">https://www.noteboardapp.com/${localStorage.nickPublico}/${encodeURIComponent(nombreTablon())}</a>\n        </div>\n        <div class="row">\n          <label>\n            <input type="checkbox" id="activarPresentacion" value="crearIframe"/>\n            <span>Compartir en <b>modo presentaciÃ³n</b> (se aÃ±ade el parÃ¡metro "slides" a la URL)</span>\n          </label>\n        </div>\n        <div class="row">\n          <div class="col s6">\n            ${tablonesPublicos()}\n          </div>\n          <div class="iframeCode input-field inline col s6">CÃ³digo si se desea insertar en web:\n            <input type="text" class="iframeSize" id="iframeWidth" value="700" maxlength="4" dir="">Ã<input type="text" class="iframeSize" id="iframeHeight" value="500" maxlength="4">\n            <textarea class="textSize"><iframe src="https://www.noteboardapp.com/${localStorage.nickPublico}?embed" width="700" height="500" frameborder="0" allowfullscreen="allowfullscreen"></iframe></textarea>\n          </div>\n        </div>\n        <div class="row">\n          <div class="socialIcons">\n              <h3>Comparte tu URL con tus amigos:</h3>\n              <a class="facebook" target="_blank" href="http://www.facebook.com/sharer/sharer.php?s=100&p[url]=${t}&p[images][0]=https://www.noteboardapp.com/NoteBoard.png&p[title]=My%20public%20Note%20Board&p[summary]=">f</a>\n              <a class="twitter" target="_blank" href="http://twitter.com/share?text=${encodeURIComponent(t)}&lang=en&url=">l</a>\n              <a class="google" target="_blank" href="https://plus.google.com/share?url=${t}">g</a>\n          </div>\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n    <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-anexar">Cancelar</a>\n      <button class="btn waves-effect waves-light grey darken-1" id="aceptar-publicar" type="submit" name="action">Publicar</button>\n      <button class="btn waves-effect waves-light grey darken-1" id="aceptar-privado" type="submit" name="action">Hacer privado</button>\n    </div>`;else o=`<div class="modal-header">\n      <div class="title-container"><img src="appimg/publish.png" class="icono" />\n        <h4 class="modal-title">Publish board</h4>\n      </div>\n    </div>\n    <div class="modal-content">\n      <div class="modal-instructions">\n        ${a?`The board ${e} <b>is already public</b>. With this option you can return it with visibility to <b> PRIVATE </b>.`:`The board ${e} is private.With this option you will change its visibility to <b> PUBLIC </b>.`}\n        <br>\n        When a board is public it can be seen by anyone but without the possibility of modification, nobody can change the content of your notes except you.<br><br>\n        Visit the web <a href="https://www.noteboardapp.com/galleryPage" target="_blank">gallery</a> to see examples of public boards.\n        Your public website will show advertising unless you are a premium user.\n        If you want to become a premium, click on <a href="https://www.noteboardapp.com/paypalPage?idUsuario=' + localStorage['id_usuario'] + '" target="_blank">Premium</a>\n      </div>\n      <form id="formUser" class="formUser col s12">\n        <div class="row">\n          <h3>Your public URL is:\n          <a id="urlPublica" href="https://www.noteboardapp.com/${localStorage.nickPublico}" target="_blank">https://www.noteboardapp.com/${localStorage.nickPublico}</a></h3>\n          If you share this board you can also use the direct url: <a href="https://www.noteboardapp.com/${localStorage.nickPublico}/${encodeURIComponent(nombreTablon())}" target="_blank">https://www.noteboardapp.com/${localStorage.nickPublico}/${encodeURIComponent(nombreTablon())}</a>\n        </div>\n        <div class="row">\n          <label>\n            <input type="checkbox" id="activarPresentacion" value="crearIframe"/>\n            <span>Share in <b> presentation mode</b> (the "slides" parameter is added to the URL)</span>\n          </label>\n        </div>\n        <div class="row">\n          <div class="col s6">\n            ${tablonesPublicos()}\n          </div>\n          <div class="iframeCode input-field inline col s6">Code if you want to embed in a website:\n            <input type="text" class="iframeSize" id="iframeWidth" value="700" maxlength="4" dir="">Ã<input type="text" class="iframeSize" id="iframeHeight" value="500" maxlength="4">\n            <textarea class="textSize"><iframe src="https://www.noteboardapp.com/${localStorage.nickPublico}?embed" width="700" height="500" frameborder="0" allowfullscreen="allowfullscreen"></iframe></textarea>\n          </div>\n        </div>\n        <div class="row">\n          <div class="socialIcons">\n              <h3>Share your URL with your friends:</h3>\n              <a class="facebook" target="_blank" href="http://www.facebook.com/sharer/sharer.php?s=100&p[url]=${t}&p[images][0]=https://www.noteboardapp.com/NoteBoard.png&p[title]=My%20public%20Note%20Board&p[summary]=">f</a>\n              <a class="twitter" target="_blank" href="http://twitter.com/share?text=${encodeURIComponent(t)}&lang=en&url=">l</a>\n              <a class="google" target="_blank" href="https://plus.google.com/share?url=${t}">g</a>\n          </div>\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n    <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-anexar">Cancel</a>\n      <button class="btn waves-effect waves-light grey darken-1" id="aceptar-publicar" type="submit" name="action">Publish</button>\n      <button class="btn waves-effect waves-light grey darken-1" id="aceptar-privado" type="submit" name="action">Make Private</button>\n    </div>`;return o}function tablonesPublicos(){var e='<div class="listaPublicos">';e+="<table>",e+="<tr>",e+="</th>";for(var t=!1,a=1;a<=localStorage.numTablones;a++)if("true"==localStorage["publico"+a]){t=!0;var o=nombreTablon(a);e+=`<tr><td><a href="https://www.noteboardapp.com/${localStorage.nickPublico}/${encodeURIComponent(o)}" target="_blank">${o}</a></td></tr>`}return t||(idiomaEsp(navigator.language)?e+="<tr><td>No tienes ningÃºn tablÃ³n pÃºblico</td></tr>":e+="<tr><td>You don't have public boards</td></tr>"),e+="</table></div>"}function tablonesCompartidos(){var e='<div class="listaPublicos">';e+="<table>",e+="<tr>",e+="</th>";for(var t=!1,a=1;a<=localStorage.numTablones;a++)esTabCompartido(a)&&(t=!0,e+=`<tr><td>${nombreTablon(a)}</td></tr>`);return t||(idiomaEsp(navigator.language)?e+="<tr><td>No tienes ningÃºn tablÃ³n compartido</td></tr>":e+="<tr><td>You don't have shared boards</td></tr>"),e+="</table></div>"}function obtenerFormularioProfile(){return idiomaEsp(navigator.language)?`<div class="modal-header">\n      <div class="title-container"><img src="appimg/login.png" class="icono" />\n        <h4 class="modal-title">Datos de usuario</h4>\n      </div>\n    </div>\n    ${isPremiumUser()?getPremiumRibbon():""}\n    ${localStorage.profilePicture?`\n    <div class="profilePictureBig">\n      <img src="${localStorage.profilePicture}">\n    </div>`:""}\n    <div id="formUser " class="modal-content profile-data">\n      <div class="row">\n        <h1 class="user-name">${isUserConnected()?`${localStorage.nick}</h1>`:"Usuario no registrado </h1><span>(las notas se guardan en local)</span>"}\n      </div>\n      <div class="row">\n        ${isNewPremiumUser()?'\n          <div class="progress progress-profile">\n            <div class="indeterminate"></div>\n          </div>\n        ':""}\n        <div class="datos-subs"></div>\n        <div class="espacio-usado">\n          <span class="espacio-titulo">Espacio usado en servidor.</span>\n          ${isUserConnected()?`\n            ${isPrePremiumUser()?'<i class="material-icons icono icono-ayuda" title="Espacio ocupado en el servidor. Como usuario premium antigÃ¼o sin subscripciÃ³n te corresponden 100 Mb, subscrÃ­bete si quieres mÃ¡s espacio">help</i>':'<i class="material-icons icono icono-ayuda" title="Espacio ocupado en el servidor">help</i>'}\n          `:'\n            <i class="material-icons icono icono-ayuda" title="Espacio ocupado en el servidor por la subida de ficheros">help</i>\n          '}\n          <span class="espacio-datos">${getUserSpaceKbMB()}/ ${getMaxUSerSpaceMB()} Mb</span>\n\n          <div role="progressbar" id="mdc-linear-progress" class="mdc-linear-progress">\n            <div class="mdc-linear-progress__buffering-dots"></div>\n            <div class="mdc-linear-progress__buffer"></div>\n            <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">\n              <span class="mdc-linear-progress__bar-inner"></span>\n            </div>\n            <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">\n              <span class="mdc-linear-progress__bar-inner"></span>\n            </div>\n          </div>\n\n          ${isNewPremiumUser()?"</br>":'<a href="https://www.noteboardapp.com/subscribe" target="_blank">Obtener mÃ¡s espacio en servidor</a>'}\n\n          ${isUserConnected()?"":`\n            <span class="espacio-titulo">Espacio usado en local</span>\n            <i class="material-icons icono icono-ayuda" title="Espacio ocupado en local, estÃ¡ limitado por el navegador, si se sobrepasa no podrÃ¡s seguir guardando notas, en ese caso registrate para guardarlas en el servidor. Ten en cuenta que las capturas de pantalla ocupan bastante espacio.">help</i>\n            <span class="espacio-datos">${parseInt(getLocalStorageSize()/KB)} / ${parseInt(524e4/KB)} Kb</span>\n\n            <div role="progressbar" id="mdc-linear-progress-local" class="mdc-linear-progress">\n              <div class="mdc-linear-progress__buffering-dots"></div>\n              <div class="mdc-linear-progress__buffer"></div>\n              <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">\n                <span class="mdc-linear-progress__bar-inner"></span>\n              </div>\n              <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">\n                <span class="mdc-linear-progress__bar-inner"></span>\n              </div>\n            </div>\n          `}\n        </div>\n\n        <div class="collection left">\n          <a href="#!" class="collection-item"><span class="badge">${localStorage.totalPost}</span>NÃºmero de Notas</a>\n          <a href="#!" class="collection-item"><span class="badge">${localStorage.numTablones}</span>NÃºmero de Tablones</a>\n        </div>\n      </div>\n      ${isUserConnected()?`\n        <div class="row">\n          <p>URL pÃºblica: <a href="https://www.noteboardapp.com/${localStorage.nickPublico}" target="_blank">https://www.noteboardapp.com/${localStorage.nickPublico}</a></p>\n          <div class="collection left">\n            <a href="#!" class="collection-item"><span class="badge">${localStorage.publicCount}</span>Accesos URL pÃºblica</a>\n          </div>\n        </div>\n        <div class="row">\n          <div class="listaTab"><h2>Tablones compartidos</h2> ${tablonesCompartidos()}</div>\n          <div class="listaTab"><h2>Tablones pÃºblicos</h2>${tablonesPublicos()}</div>\n        </div><br><br>\n      `:""}\n    </div>\n    <div class="modal-footer">\n      ${isChromeExtension()?"\n        "+(isUserConnected()?'\n          <button class="left btn waves-effect waves-light red lighten-2" id="profile-desconectar-borrar" type="button" name="action">Desconectar y borrar contenido local</button>\n          <button class="left btn waves-effect waves-light grey darken-1" id="profile-desconectar" type="button" name="action">Desconectar</button>\n          ':'\n          <button class="btn waves-effect waves-light red lighten-2 left" id="buttonBorrarNotas" type="button" name="action">Borrar Notas</button>\n          <button class="btn waves-effect waves-light red lighten-2 left" id="buttonBorrarNotasFicheros" type="button" name="action">Borrar Notas y ficheros</button>\n        '):""}\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancelar</a>\n    </div>`:`<div class="modal-header">\n      <div class="title-container"><img src="appimg/login.png" class="icono" />\n        <h4 class="modal-title">User profile</h4>\n      </div>\n    </div>\n    ${isPremiumUser()?getPremiumRibbon():""}\n    ${localStorage.profilePicture?`\n    <div class="profilePictureBig">\n      <img src="${localStorage.profilePicture}">\n    </div>`:""}\n    <div id="formUser " class="modal-content profile-data">\n      <div class="row">\n        <h1 class="user-name">${isUserConnected()?`${localStorage.nick}</h1>`:"Unregistered user </h1><span>(the notes are stored locally)</span>"}\n      </div>\n      <div class="row">\n        ${isNewPremiumUser()?'\n          <div class="progress progress-profile">\n            <div class="indeterminate"></div>\n          </div>\n        ':""}\n        <div class="datos-subs"></div>\n        <div class="espacio-usado">\n          <span class="espacio-titulo">Server space used</span>\n          ${isUserConnected()?`\n          ${isPrePremiumUser()?'<i class="material-icons icono icono-ayuda" title="Total server space used. As an old premium user without a subscription you have 100 Mb, subscribe if you want more space">help</i>':'<i class="material-icons icono icono-ayuda" title="Total server space used"">help</i>'}\n          `:'\n            <i class="material-icons icono icono-ayuda" title="Space used on the server by uploading files">help</i>\n          '}\n          <span class="espacio-datos">${getUserSpaceKbMB()}/ ${getMaxUSerSpaceMB()} Mb</span>\n\n          <div role="progressbar" id="mdc-linear-progress" class="mdc-linear-progress">\n            <div class="mdc-linear-progress__buffering-dots"></div>\n            <div class="mdc-linear-progress__buffer"></div>\n            <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">\n              <span class="mdc-linear-progress__bar-inner"></span>\n            </div>\n            <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">\n              <span class="mdc-linear-progress__bar-inner"></span>\n            </div>\n          </div>\n          ${isNewPremiumUser()?"</br>":'<a href="https://www.noteboardapp.com/subscribe" target="_blank">Get more serve space</a>'}\n\n\n          ${isUserConnected()?"":`\n            <span class="espacio-titulo">Space used locally</span>\n            <i class="material-icons icono icono-ayuda" title="Space occupied locally, is limited by the browser, if it is exceeded you will not be able to continue saving notes, in that case register to save them on the server. Keep in mind that screenshots take up a lot of space.">help</i>\n            <span class="espacio-datos">${parseInt(getLocalStorageSize()/KB)} / ${parseInt(524e4/KB)} Kb</span>\n\n            <div role="progressbar" id="mdc-linear-progress-local" class="mdc-linear-progress">\n              <div class="mdc-linear-progress__buffering-dots"></div>\n              <div class="mdc-linear-progress__buffer"></div>\n              <div class="mdc-linear-progress__bar mdc-linear-progress__primary-bar">\n                <span class="mdc-linear-progress__bar-inner"></span>\n              </div>\n              <div class="mdc-linear-progress__bar mdc-linear-progress__secondary-bar">\n                <span class="mdc-linear-progress__bar-inner"></span>\n              </div>\n            </div>\n          `}\n        </div>\n\n        <div class="collection left">\n          <a href="#!" class="collection-item"><span class="badge">${localStorage.totalPost}</span>Number of Notes</a>\n          <a href="#!" class="collection-item"><span class="badge">${localStorage.numTablones}</span>Number of Boards</a>\n        </div>\n      </div>\n      ${isUserConnected()?`\n        <div class="row">\n          <p>Public URL: <a href="https://www.noteboardapp.com/${localStorage.nickPublico}" target="_blank">https://www.noteboardapp.com/${localStorage.nickPublico}</a></p>\n          <div class="collection left">\n            <a href="#!" class="collection-item"><span class="badge">${localStorage.publicCount}</span>Public URL access</a>\n          </div>\n          </div>\n        <div class="row">\n          <div class="listaTab"><h2>Shared boards</h2> ${tablonesCompartidos()}</div>\n          <div class="listaTab"><h2>Public boards</h2>${tablonesPublicos()}</div>\n        </div><br><br>\n      `:""}\n    </div>\n    <div class="modal-footer">\n      ${isChromeExtension()?"\n        "+(isUserConnected()?'\n          <button class="left btn waves-effect waves-light red lighten-2" id="profile-desconectar-borrar" type="button" name="action">Disconnect and delete local content</button>\n          <button class="left btn waves-effect waves-light grey darken-1" id="profile-desconectar" type="button" name="action">Disconnect</button>\n          ':'\n          <button class="btn waves-effect waves-light red lighten-2 left" id="buttonBorrarNotas" type="button" name="action">Delete Notes</button>\n          <button class="btn waves-effect waves-light red lighten-2 left" id="buttonBorrarNotasFicheros" type="button" name="action">Delete Notes and Files</button>\n        '):""}\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancel</a>\n    </div>`}function obtenerFormularioMover(e){return idiomaEsp(navigator.language)?`<div class="modal-header">\n        <div class="title-container"><img src="appimg/${esTablonPapelera()?"recycle":"tab"}.png" class="icono icono-invertido" />\n          <h4 class="modal-title">Mover nota</h4>\n        </div>\n      </div>\n      <div class="modal-content">\n        <form id="formUser" class="formUser col s12">\n          <div class="row">\n            ${esTablonPapelera()?"<h3>Selecciona el tablÃ³n en el que quieres restaurar esta nota</h3>":"<h3>Selecciona el tablÃ³n al que quieres mover esta nota</h3>"}\n          </div>\n          <div class="col s6" id="nombreTab">\n            ${getSelectHtml({id:"listaTablones",label:"TablÃ³n",options:listaTablones()})}\n          </div>\n        </form>\n      </div>\n      <div class="modal-footer">\n        <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-anexar">Cancelar</a>\n        <button class="accept-btn btn waves-effect waves-light" id="mover-nota" type="button" name="action">Mover\n          <i class="material-icons right">send</i>\n        </button>\n      </div>`:`<div class="modal-header">\n      <div class="title-container"><img src="appimg/${esTablonPapelera()?"recycle":"tab"}.png" class="icono icono-invertido" />\n        <h4 class="modal-title">Move note</h4>\n      </div>\n    </div>\n    <div class="modal-content">\n      <form id="formUser" class="formUser col s12">\n        <div class="row">\n          ${esTablonPapelera()?"<h3>Select the board on which you want to restore this note</h3>":"<h3>Select the board you want to move this note to</h3>"}\n        </div>\n        <div class="col s6" id="nombreTab">\n          ${getSelectHtml({id:"listaTablones",label:"Board",options:listaTablones()})}\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-anexar">Cancel</a>\n      <button class="accept-btn btn waves-effect waves-light" id="mover-nota" type="button" name="action">Move\n        <i class="material-icons right">send</i>\n      </button>\n    </div>`}function obtenerFormularioMail(e){var t="";return idiomaEsp(navigator.language)?`<div class="modal-header">\n            <div class="title-container">\n            <i class="material-icons icono">email</i><h4 class="modal-title">Enviar Mail</h4>\n            </div>\n          </div>\n          <div class="modal-content">\n            <form id="formUser" class="formUser col s12">\n                <br>\n                <div class="input-field col s12">\n                  ${getInputHtml({id:"userDestino",label:"Email destinatario",type:"email",icon:"contact_mail",helperLine:t=localStorage.mail?"Haz doble click para copiar tu email":null})}\n                </div>\n                <div class="input-field col s12">\n                  ${getInputHtml({id:"ccmail",label:"Mails copia ( si mÃ¡s de uno sepÃ¡ralos con , )",type:"email",icon:"contact_mail",helperLine:t})}\n                </div>\n                <div class="input-field col s12">\n                  ${getInputHtml({id:"asunto",label:"Asunto",type:"text",icon:"mode_edit"})}\n                </div>\n\n                <div class="mdc-text-field mdc-text-field--textarea mdc-text-field--outlined mdc-text-field--fullwidth">\n                  <textarea id="textoMail" class="mdc-text-field__input" rows="5" cols="70"></textarea>\n                  <div class="mdc-notched-outline">\n                    <div class="mdc-notched-outline__leading"></div>\n                    <div class="mdc-notched-outline__notch">\n                      <label for="textarea" class="mdc-floating-label">Si quieres escribe aquÃ­ algÃºn texto para aÃ±adir al principio del mail antes de la nota anexa</label>\n                    </div>\n                    <div class="mdc-notched-outline__trailing"></div>\n                  </div>\n                </div>\n\n                <div id="errorMail"></div>\n\n                <br><h4>Nota a enviar</h4>\n                <div id="thumbnailPost"></div>\n            </form>\n          </div>\n          <div class="modal-footer">\n            <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-mail">Cerrar</a>\n            <button class="accept-btn btn waves-effect waves-light" id="enviar-mail" type="button" name="action">\n              ${e?'Enviar<i class="material-icons right">send</i>':"Aceptar"}\n            </button>\n          </div>`:`<div class="modal-header">\n        <div class="title-container">\n        <i class="material-icons icono">email</i><h4 class="modal-title">Send email</h4>\n        </div>\n      </div>\n      <div class="modal-content">\n        <form id="formUser" class="formUser col s12">\n            <br>\n            <div class="input-field col s12">\n              ${getInputHtml({id:"userDestino",label:"Email receiver",type:"email",icon:"contact_mail",helperLine:t=localStorage.mail?"Double click to copy your email":null})}\n            </div>\n            <div class="input-field col s12">\n              ${getInputHtml({id:"ccmail",label:'Mails copy (cc:), if more than one separate them with <span class="big-text">,</span>',type:"email",icon:"contact_mail",helperLine:t})}\n            </div>\n            <div class="input-field col s12">\n              ${getInputHtml({id:"asunto",label:"Subject",type:"text",icon:"mode_edit"})}\n            </div>\n\n            <div class="mdc-text-field mdc-text-field--textarea mdc-text-field--outlined mdc-text-field--fullwidth">\n              <textarea id="textoMail" class="mdc-text-field__input" rows="5" cols="70"></textarea>\n              <div class="mdc-notched-outline">\n                <div class="mdc-notched-outline__leading"></div>\n                <div class="mdc-notched-outline__notch">\n                  <label for="textarea" class="mdc-floating-label">If you want write here some text to add at the beginning of the mail before the attached note</label>\n                </div>\n                <div class="mdc-notched-outline__trailing"></div>\n              </div>\n            </div>\n\n            <div id="errorMail"></div>\n\n            <br><h4>Note to send</h4>\n            <div id="thumbnailPost"></div>\n        </form>\n      </div>\n      <div class="modal-footer">\n        <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-mail">Cancel</a>\n        <button class="accept-btn btn waves-effect waves-light" id="enviar-mail" type="button" name="action">\n          ${e?'Send<i class="material-icons right">send</i>':"Accept"}\n        </button>\n      </div>`}function obtenerFormularioCalendar(){return idiomaEsp(navigator.language)?`<div class="modal-header">\n          <div class="title-container"><img src="appimg/calendar.png" class="icono icono-invertido"" />\n            <h4 class="modal-title">Programar aviso</h4>\n          </div>\n        </div>\n        <div id="formFondo" class="modal-content">\n          <div class="modal-instructions">\n            Elige un dia/hora para que se <b>abra un popup</b> o una notificaciÃ³n de Chrome con esta nota. TambiÃ©n puedes programar el envio de un mail.\n          </div>\n          <form id="formUser" class="formCalendar col s12"><br>\n            <div class="row">\n              <input id="datepicker" class="datepicker" type="text"/>\n              <div class="opciones-calendar">\n                <div class="titulo">Tipos de Aviso</div>\n                  <div class="popupCalendar tooltipstered" title="Aviso abriendo una ventana con el contenido de la nota">\n                      <label><input id="popupCalendarCheck" type="checkbox" disabled checked><span>Popup</span></label>\n                  </div>\n                  <div class="opcionCal tooltipstered ultima" title="Envio de mail con el contenido de la nota">\n                    <label><input id="popupMailCheck" type="checkbox" /><span>Mail</span></label>\n                  </div>\n\n                  <div class="periodicidadCalendar tooltipstered" title="Selecciona periodicidad del aviso">\n                    ${getSelectHtml({id:"periodicidad",label:"Periodicidad",options:[{text:"Aviso Ãºnico",value:0,selected:!0},{text:"Diario",value:1},{text:"Laborables",value:2},{text:"Semanal",value:7},{text:"Mensual",value:30}]})}\n                  </div>\n                </div>\n            </div>\n\n          </form>\n        </div>\n        <div class="modal-footer">\n        <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-anexar">Cancelar</a>\n          <button class="btn waves-effect waves-light red lighten-2" id="borrar-aviso" type="button" name="action">Borrar aviso</button>\n          <button class="btn waves-effect waves-light grey darken-1" id="modificar-aviso" type="button" name="action">Modificar aviso</button>\n          <button class="btn waves-effect waves-light grey darken-1" id="crear-aviso" type="button" name="action">Crear aviso</button>\n        </div>`:`<div class="modal-header">\n        <div class="title-container"><img src="appimg/calendar.png" class="icono icono-invertido"" />\n          <h4 class="modal-title">Schedule reminder</h4>\n        </div>\n      </div>\n      <div class="modal-content">\n        <div class="modal-instructions">\n          Choose a day / time for <b> to open a popup </b> or a Chrome notification with this note. You can also schedule the sending of an email.\n        </div>\n        <form id="formUsedr" class="formUserd col s12"><br>\n          <div class="row">\n            <input id="datepicker" class="datepicker" type="text"/>\n            <div class="opciones-calendar">\n              <div class="titulo">Types or reminder</div>\n                <div class="popupCalendar tooltipstered" title="Reminder opening a window popup with the content of the note">\n                    <label><input id="popupCalendarCheck" type="checkbox" disabled checked><span>Popup</span></label>\n                </div>\n                <div class="opcionCal tooltipstered ultima" title="Send an email with the content of the note">\n                  <label><input id="popupMailCheck" type="checkbox" /><span>Mail</span></label>\n                </div>\n\n                <div class="periodicidadCalendar tooltipstered" title="Select reminder periodicity">\n                  ${getSelectHtml({id:"periodicidad",label:"Periodicity",options:[{text:"Single reminder",value:0,selected:!0},{text:"Daily",value:1},{text:"Working days",value:2},{text:"Weekly",value:7},{text:"Monthly",value:30}]})}\n                </div>\n              </div>\n          </div>\n\n        </form>\n      </div>\n      <div class="modal-footer">\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-anexar">Cancel</a>\n        <button class="btn waves-effect waves-light red lighten-2" id="borrar-aviso" type="button" name="action">Delete reminder</button>\n        <button class="btn waves-effect waves-light grey darken-1" id="modificar-aviso" type="button" name="action">Update reminder</button>\n        <button class="btn waves-effect waves-light grey darken-1" id="crear-aviso" type="button" name="action">Create reminder</button>\n      </div>`}function obtenerFormularioCalendarPlugin(){return idiomaEsp(navigator.language)?'<div class="modal-header">\n          <div class="title-container"><img src="appimg/calendar.png" class="icono icono-invertido"" />\n            <h4 class="modal-title">Programar aviso</h4>\n          </div>\n        </div>\n        <div id="formFondo" class="modal-content">\n          <div class="modal-instructions">\n            Elige un dia/hora para crear una cuenta atrÃ¡s\n          </div>\n          <form id="formUser" class="formCalendar col s12"><br>\n            <div class="row">\n              <input id="datepicker" class="datepicker" type="text"/>\n            </div>\n          </form>\n        </div>\n        <div class="modal-footer">\n        <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-anexar">Cancelar</a>\n          <button class="btn waves-effect waves-light grey darken-1" id="accept-date" type="button" name="action">Aceptar</button>\n        </div>':'<div class="modal-header">\n        <div class="title-container"><img src="appimg/calendar.png" class="icono icono-invertido"" />\n          <h4 class="modal-title">Schedule reminder</h4>\n        </div>\n      </div>\n      <div class="modal-content">\n        <div class="modal-instructions">\n          Choose a day / time for <b> to open a popup </b> or a Chrome notification with this note. You can also schedule the sending of an email.\n        </div>\n        <form id="formUsedr" class="formUserd col s12"><br>\n          <div class="row">\n            <input id="datepicker" class="datepicker" type="text"/>\n          </div>\n          </div>\n\n        </form>\n      </div>\n      <div class="modal-footer">\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-anexar">Cancel</a>\n        <button class="btn waves-effect waves-light grey darken-1" id="accept-date" type="button" name="action">Accept</button>\n      </div>'}function obtenerFormularioBackup(){return idiomaEsp(navigator.language)?'<div class="modal-header">\n          <div class="title-container"><img src="appimg/floppy.png" class="icono" />\n            <h4 class="modal-title">Crear copia de seguridad</h4>\n          </div>\n        </div>\n        <div class="modal-content">\n          <div class="modal-instructions">\n            Con esta opciÃ³n podrÃ¡s hacer <b>copias de seguridad de tus datos</b></br>\n            Si estÃ¡s logueado al recuperar las notas de una copia se aÃ±adirÃ¡n las notas del fichero sin borrar las anteriores, en este caso pueden salir notas duplicadas. Si trabajas en local los datos se sobreescriben completamente.\n          </div>\n          <form id="formUser" class="formBackup" class="col s12">\n            <div class="row">\n              <h2>Exportar</h2>\n              <p>Exporta a un fichero tus notas </p>\n              <button class="waves-effect waves-light btn" id="exportar-backup">Exportar</button>\n            </div>\n            <div class="row">\n              <hr>\n              <h2>Importar</h2>\n              <p><b>Â¡AtenciÃ³n!</b>, los datos se sobreescriben, <span class="backup-aviso">si no estas logueado perderÃ¡s las notas actuales</span></p>\n              <div class="file-field input-field col s12">\n                <div class="btn">\n                  <span>Selecciona fichero para importar</span>\n                  <input id="file-backup" name="fileupload" type="file" accept="text/plain" >\n                </div>\n                <div class="file-path-wrapper">\n                  <input class="file-path validate" type="text">\n                </div>\n              </div>\n            </div>\n            <div class="row">\n            <div id="message-backup"></div>\n              <div id="progress">\n                <div id="bar" style="width: 0%;"></div>\n              </div>\n            </div>\n          </form>\n        </div>\n        <div class="modal-footer">\n          <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-anexar">Cerrar</a>\n        </div>':'<div class="modal-header">\n        <div class="title-container"><img src="appimg/floppy.png" class="icono" />\n          <h4 class="modal-title">Create backup</h4>\n        </div>\n      </div>\n      <div class="modal-content">\n        <div class="modal-instructions">\n          With this option you can make <b>backup copies of your data</b></br>\n          If you are logged in, the notes of the file will be added without deleting the previous ones, in this case you can have duplicate notes. If you work in local mode the data is completely overwritten.\n        </div>\n        <form id="formUser" class="formBackup" class="col s12">\n          <div class="row">\n            <h2>Export</h2>\n            <p>Export your notes to a file</p>\n            <button class="waves-effect waves-light btn" id="exportar-backup">Export</button>\n          </div>\n          <div class="row">\n            <hr>\n            <h2>Importar</h2>\n            <p><b>Attention!</>, the data is overwritten, <span class="backup-aviso"> if you are not logged in, you will lose the current notes </span></p>\n            <div class="file-field input-field col s12">\n              <div class="btn">\n                <span>Choose file to import</span>\n                <input id="file-backup" name="fileupload" type="file" accept="text/plain" >\n              </div>\n              <div class="file-path-wrapper">\n                <input class="file-path validate" type="text">\n              </div>\n            </div>\n          </div>\n          <div class="row">\n          <div id="message-backup"></div>\n            <div id="progress">\n              <div id="bar" style="width: 0%;"></div>\n            </div>\n          </div>\n        </form>\n      </div>\n      <div class="modal-footer">\n        <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-anexar">Close</a>\n      </div>'}function obtenerFormularioEmbed(){if(idiomaEsp(navigator.language))var e=`<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">code</i>\n        <h4 class="modal-title">Crear nota con contenido incrustado</h4>\n      </div>\n    </div>\n    <div class="modal-content">\n      <div class="modal-instructions">\n        Crea nota con el contenido incrustado de otra web si sus medidas de seguridad lo permiten. Prueba a informar una URL y si en el Ã¡rea\n        de previsualizaciÃ³n muestra la pÃ¡gina podrÃ¡s crear la nota. Alternativamente tambiÃ©n puedes informar en el segundo campo el cÃ³digo concreto\n        a insertar con un iframe, hay webs (ej. youtube) que ofrecen una secciÃ³n de compartir contenido que informan el HTML a insertar con un iframe.<br>\n        <b>Usese con precauciÃ³n, notas con webs incrustadas puede relantizar la aplicaciÃ³n, en ese caso mejor borrar la nota.</b>\n      </div>\n      <form id="formUser" class="formUser col s12">\n        <div class="row">\n          ${getInputHtml({id:"iframeUrl",label:"Url de la pÃ¡gina a incrustar",type:"textemail",icon:"mode_edit",helperLine:"Url que se quiere intentar incrustar"})}\n        </div>\n        <div class="row">\n          <div class="mdc-text-field mdc-text-field--textarea mdc-text-field--outlined mdc-text-field--fullwidth">\n            <textarea id="textoEmbed" class="mdc-text-field__input" rows="3" cols="70"></textarea>\n            <div class="mdc-notched-outline">\n              <div class="mdc-notched-outline__leading"></div>\n              <div class="mdc-notched-outline__notch">\n                <label for="textarea" class="mdc-floating-label">Inserta cÃ³digo a embeber</label>\n              </div>\n              <div class="mdc-notched-outline__trailing"></div>\n            </div>\n            </div>\n            <div class="mdc-text-field-helper-line"><div class="mdc-text-field-helper-text">Si no informas URL puedes poner el cÃ³digo exacto a insertar con un iframe</div></div>\n        </div>\n        <div class="row">\n          <h4>PrevisualizaciÃ³n</h4>\n          <div id="previsualizacionEmbed" class="previsualizacion"></div>\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n      <button class="btn waves-effect waves-light grey darken-1 disabled" id="aceptar-embed" type="submit" name="action">Aceptar</button>\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancelar</a>\n    </div>`;else e=`<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">code</i>\n        <h4 class="modal-title">Create note with embeded content</h4>\n      </div>\n    </div>\n    <div class="modal-content">\n      <div class="modal-instructions">\n        Create a note with the embedded content of another website if its security measures allow it. Try to input a URL and if in the area\n      Â Â preview shows the page you can create the note. Alternatively you can also report the specific code in the second field\n        to insert with an iframe, there are websites (eg youtube) that offer a section to share content that inform the HTML to insert with an iframe. <br>\n        <b>Use with caution, notes with embedded websites can slow the application, in that case it is better to delete the note.</b>\n      </div>\n      <form id="formUser" class="formUser col s12">\n        <div class="row">\n          ${getInputHtml({id:"iframeUrl",label:"Url of the page to embed",type:"textemail",icon:"mode_edit",helperLine:"URL you want to try to embed"})}\n        </div>\n        <div class="row">\n          <div class="mdc-text-field mdc-text-field--textarea mdc-text-field--outlined mdc-text-field--fullwidth">\n            <textarea id="textoEmbed" class="mdc-text-field__input" rows="3" cols="70"></textarea>\n            <div class="mdc-notched-outline">\n              <div class="mdc-notched-outline__leading"></div>\n              <div class="mdc-notched-outline__notch">\n                <label for="textarea" class="mdc-floating-label">Insert code to embed</label>\n              </div>\n              <div class="mdc-notched-outline__trailing"></div>\n            </div>\n            </div>\n            <div class="mdc-text-field-helper-line"><div class="mdc-text-field-helper-text">If you do not input URL you can put the exact code to insert with an iframe</div></div>\n        </div>\n        <div class="row">\n          <h4>Preview</h4>\n          <div id="previsualizacionEmbed" class="previsualizacion"></div>\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n    <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancel</a>\n    <button class="btn waves-effect waves-light grey darken-1 disabled" id="aceptar-embed" type="submit" name="action">Accept</button>\n    </div>`;return e}function obtenerFormularioKanban(){if(idiomaEsp(navigator.language))var e=`<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">view_week</i>\n        <h4 class="modal-title">TablÃ³n Kanban</h4>\n      </div>\n      ${getPremiumRibbon()}\n    </div>\n    <div class="modal-content">\n      <div class="modal-instructions">\n        Esta opciÃ³n permite convertir un tablÃ³n en un tablero <a href="https://es.wikipedia.org/wiki/Kanban_(desarrollo)#targetText=Kanban%20es%20un%20m%C3%A9todo%20para,sobrecarguen%20los%20miembros%20del%20equipo." tarket="_blank">Kanban</a> para organizar las notas por columnas.<br>\n        En la <a href="https://www.noteboardapp.com/boarddemo?boardNumber=3" target="_blank">aplicaciÃ³n demo</a> puedes probar una tablÃ³n Kanban para ver cÃ³mo funciona.\n      </div>\n      <form id="formUser" class="formUser col s12">\n        <div class="row">\n          <p>Introduce las divisiones en columnas que quieras para el tablÃ³n Kanban.</p>\n          <p>Borra con "X", introduce nuevas escribiendo en "+Tag" y pulsando Enter o arrastra las etiquetas para cambiar el orden.</p>\n          <div id="chips" class="chips"></div>\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n    <button class="btn waves-effect waves-light red lighten-2" id="quitar-kanban" ${esTablonKanban()?"":"disabled"} type="submit" name="action">Quitar Kanban</button>\n    <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancelar</a>\n    <button class="btn waves-effect waves-light grey darken-1" id="aceptar-kanban" type="submit" name="action">Aceptar</button>\n    </div>`;else e=`<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">view_week</i>\n        <h4 class="modal-title">Kanban Board</h4>\n      </div>\n      ${getPremiumRibbon()}\n    </div>\n    <div class="modal-content">\n      <div class="modal-instructions">\n        This option allows you to convert a board into a <a href="https://es.wikipedia.org/wiki/Kanban_(desarrollo)#targetText=Kanban%20es%20un%20m%C3%A9todo%20para,sobrecarguen%20los%20miembros%20del%20equipo." tarket="_blank">Kanban</a> board to organize notes by columns.<br>\n        In the <a href="https://www.noteboardapp.com/boarddemo?boardNumber=3" target="_blank"> demo application </a> you can try a Kanban board to see how it works.\n      </div>\n      <form id="formUser" class="formUser col s12">\n        <div class="row">\n          <p>Enter the column divisions you want for the Kanban board.</p>\n          <p>Delete with "X", enter new writing "+ Tag" and pressing Enter or drag the labels to change the order.</p>\n          <div id="chips" class="chips"></div>\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n    <button class="btn waves-effect waves-light red lighten-2" id="quitar-kanban" ${esTablonKanban()?"":"disabled"} type="submit" name="action">Remove Kanban</button>\n    <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancel</a>\n    <button class="btn waves-effect waves-light grey darken-1" id="aceptar-kanban" type="submit" name="action">Accept</button>\n    </div>`;return e}function obtenerLoginForm(){return idiomaEsp(navigator.language)?`<div class="modal-header">\n        <div class="title-container"><img src="appimg/login.png" class="icono" />\n          <h4 class="modal-title">Login / Registro</h4>\n        </div>\n      </div>\n      <div class="modal-content login-content">\n        <div class="row">\n          <div class="col s12 m4 login-instructions">\n            <div class="logo-login"><img src="appimg/Note Board.png" /></div>\n            ${chrome.i18n.getMessage("confSincro")}\n          </div>\n          <form id="formLogin" class="col s12 m8">\n            ${isUserConnected()?`\n              <div class="user-connected"><span>${localStorage.nick}</span> ya estÃ¡s sincronizando tus notas en <a href="https:www.noteboardapp.com">www.noteboardapp.com</a></div>\n            `:`\n            <div id="campos-log">\n              <h2>Iniciar sesiÃ³n</h2>\n\n              <div class="alterna-form">\n                Â¿TodavÃ­a no tienes una cuenta? <a href="" class="buttonLoginRegistro">Registrate gratis</a>\n              </div>\n\n              ${getInputHtml({id:"nick",label:"Nombre de usuario o mail",type:"text",icon:"account_circle",helperLine:"Introduce tu usuario o el mail con el que te registrastes"})}\n              ${getInputHtml({id:"pwd",label:"Password",type:"password",icon:"account_circle",helperLine:"Introduce al menos 8 caracteres sin espacios"})}\n                <div class="g-recaptcha" id="recaptcha-container"\n                  data-sitekey="6LdU1v0mAAAAAHcCNxXVZt8KL0CXj1YHjT3nM8_4">\n                </div>\n\n              <a class="remind-password" href="https://www.noteboardapp.com/remindPassword" target="_blank">Â¿Olvidaste tu password?</a>\n            </div>\n\n            <div id="campos-reg">\n              <h2>Registro con email</h2>\n              <div class="alterna-form">\n                Â¿Ya tienes una cuenta? <a class="buttonLoginRegistro">Ir a Login</a>\n              </div>\n              ${getInputHtml({id:"signup",label:"Usuario o mail",type:"text",icon:"account_circle",helperLine:"Introduce tu nombre de usuario, sin espacios"})}\n              ${getInputHtml({id:"pwds",label:"Password",type:"password",icon:"mode_edit",helperLine:"Introduce al menos 8 caracteres sin espacios"})}\n              ${getInputHtml({id:"pwds2",label:"Confirma Password",type:"password",icon:"mode_edit",helperLine:"Introduce al menos 8 caracteres sin espacios"})}\n              ${getInputHtml({id:"email",label:"Email",type:"email",icon:"contact_mail",helperLine:"Introduce un mail vÃ¡lido"})}\n\n              <label class="politica">\n                <input type="checkbox" id="leida-politica" name="politica" />\n                <span>He leido la <a href="https://www.noteboardapp.com/policy">polÃ­tica de privacidad</a></span>\n              </label>\n            </div>\n            <button class="password-login waves-effect waves-light btn" type="submit" id="buttonSubmit">\n              <span>Login</span>\n              <i class="material-icons right">send</i>\n            </button>\n\n            <div class="separacion-social">\n              <span class="barra-separacion"></span>\n              <span class="texto-separacion">O</span>\n              <span class="barra-separacion"></span>\n            </div>\n\n            <div class="social-login">\n                <button id="buttonGoogle" type="button" class="col s12 social-button">\n                  <span class="social-button__icon">\n                    <svg viewBox="0 0 366 372" xmlns="http://www.w3.org/2000/svg"><path d="M125.9 10.2c40.2-13.9 85.3-13.6 125.3 1.1 22.2 8.2 42.5 21 59.9 37.1-5.8 6.3-12.1 12.2-18.1 18.3l-34.2 34.2c-11.3-10.8-25.1-19-40.1-23.6-17.6-5.3-36.6-6.1-54.6-2.2-21 4.5-40.5 15.5-55.6 30.9-12.2 12.3-21.4 27.5-27 43.9-20.3-15.8-40.6-31.5-61-47.3 21.5-43 60.1-76.9 105.4-92.4z" id="Shape" fill="#EA4335"/><path d="M20.6 102.4c20.3 15.8 40.6 31.5 61 47.3-8 23.3-8 49.2 0 72.4-20.3 15.8-40.6 31.6-60.9 47.3C1.9 232.7-3.8 189.6 4.4 149.2c3.3-16.2 8.7-32 16.2-46.8z" id="Shape" fill="#FBBC05"/><path d="M361.7 151.1c5.8 32.7 4.5 66.8-4.7 98.8-8.5 29.3-24.6 56.5-47.1 77.2l-59.1-45.9c19.5-13.1 33.3-34.3 37.2-57.5H186.6c.1-24.2.1-48.4.1-72.6h175z" id="Shape" fill="#4285F4"/><path d="M81.4 222.2c7.8 22.9 22.8 43.2 42.6 57.1 12.4 8.7 26.6 14.9 41.4 17.9 14.6 3 29.7 2.6 44.4.1 14.6-2.6 28.7-7.9 41-16.2l59.1 45.9c-21.3 19.7-48 33.1-76.2 39.6-31.2 7.1-64.2 7.3-95.2-1-24.6-6.5-47.7-18.2-67.6-34.1-20.9-16.6-38.3-38-50.4-62 20.3-15.7 40.6-31.5 60.9-47.3z" fill="#34A853"/></svg>\n                  </span>\n                  <span class="social-button__text">Login/Registro con Google</span>\n                </button>\n\n              <button id="fb-login" type="button" class="col s12 social-button social-button-facebook">\n                <span class="social-button__icon">\n                  <i class="material-icons"><div class="fb-logo"></div></i>\n                </span>\n                <span class="social-button__text">Login/Registro con Facebook</span>\n              </button>\n            </div>\n            `}\n\n          </form>\n        </div>\n        </div>\n      </div>\n      <div class="modal-footer">\n      ${isUserConnected()?'\n        <button class="left btn waves-effect waves-light red lighten-2" id="profile-desconectar-borrar" type="button" name="action">Desconectar y borrar contenido local</button>\n        <button class="left btn waves-effect waves-light grey darken-1" id="profile-desconectar" type="button" name="action">Desconectar</button>\n        ':'\n        <button class="btn waves-effect waves-light red lighten-2 left" id="buttonBorrarNotas" type="button" name="action">Borrar Notas</button>\n        <button class="btn waves-effect waves-light red lighten-2 left" id="buttonBorrarNotasFicheros" type="button" name="action">Borrar Notas y ficheros</button>\n      '}\n\n      <div id="mensaje-modal" class="mensaje-modal"></div>\n\n      ${isUserConnected()?"":'\n        <button class="btn waves-effect waves-light grey darken-1" id="buttonRegistro" type="submit" name="action">Ir a Registro</button>\n        '}\n        <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancelar</a>\n      </div>`:`<div class="modal-header">\n        <div class="title-container"><img src="appimg/login.png" class="icono" />\n          <h4 class="modal-title">Log in / Sign up</h4>\n        </div>\n      </div>\n      <div class="modal-content login-content">\n        <div class="row">\n          <div class="col s12 m4 login-instructions">\n            <div class="logo-login"><img src="appimg/Note Board.png" /></div>\n            ${chrome.i18n.getMessage("confSincro")}\n          </div>\n          <form id="formLogin" class="col s12 m8">\n            ${isUserConnected()?`\n              <div class="user-connected"><span>${localStorage.nick}</span> you are already synchronizing your notes in <a href="https:www.noteboardapp.com">www.noteboardapp.com</a></div>\n            `:`\n            <div id="campos-log">\n              <h2>Log in</h2>\n\n              <div class="alterna-form">\n                You still do not have an account? <a href="" class="buttonLoginRegistro">Sign up for free</a>\n              </div>\n\n              ${getInputHtml({id:"nick",label:"User name or email",type:"text",icon:"account_circle",helperLine:"Enter your username or the email you registered with"})}\n              ${getInputHtml({id:"pwd",label:"Password",type:"password",icon:"account_circle",helperLine:"Enter at least 8 characters without spaces"})}\n              \n                            \n                 <div class="g-recaptcha" id="recaptcha-container"\n                  data-sitekey="6LdU1v0mAAAAAHcCNxXVZt8KL0CXj1YHjT3nM8_4">\n                </div>\n\n              <a class="remind-password" href="https://www.noteboardapp.com/remindPassword" target="_blank">Forgot your password?</a>\n            </div>\n\n            <div id="campos-reg">\n              <h2>Sign up with email</h2>\n              <div class="alterna-form">\n                Do you already have an account? <a class="buttonLoginRegistro">Go to log in</a>\n              </div>\n              ${getInputHtml({id:"signup",label:"User name or email",type:"text",icon:"account_circle",helperLine:"Enter your username, without spaces"})}\n              ${getInputHtml({id:"pwds",label:"Password",type:"password",icon:"mode_edit",helperLine:"Enter at least 8 characters without spaces"})}\n              ${getInputHtml({id:"pwds2",label:"Confirm Password",type:"password",icon:"mode_edit",helperLine:"Enter at least 8 characters without spaces"})}\n              ${getInputHtml({id:"email",label:"Email",type:"email",icon:"contact_mail",helperLine:"Enter a valid email"})}\n\n              <label class="politica">\n                <input type="checkbox" id="leida-politica" name="politica" />\n                <span>I have read the <a href="https://www.noteboardapp.com/policy">privacy policy</a></span>\n              </label>\n            </div>\n            <button class="password-login waves-effect waves-light btn" type="submit" id="buttonSubmit">\n              <span>Login</span>\n              <i class="material-icons right">send</i>\n            </button>\n\n            <div class="separacion-social">\n              <span class="barra-separacion"></span>\n              <span class="texto-separacion">O</span>\n              <span class="barra-separacion"></span>\n            </div>\n\n            <div class="social-login">\n              <button id="buttonGoogle" type="button" class="col s12 social-button">\n                <span class="social-button__icon">\n                  <svg viewBox="0 0 366 372" xmlns="http://www.w3.org/2000/svg"><path d="M125.9 10.2c40.2-13.9 85.3-13.6 125.3 1.1 22.2 8.2 42.5 21 59.9 37.1-5.8 6.3-12.1 12.2-18.1 18.3l-34.2 34.2c-11.3-10.8-25.1-19-40.1-23.6-17.6-5.3-36.6-6.1-54.6-2.2-21 4.5-40.5 15.5-55.6 30.9-12.2 12.3-21.4 27.5-27 43.9-20.3-15.8-40.6-31.5-61-47.3 21.5-43 60.1-76.9 105.4-92.4z" id="Shape" fill="#EA4335"/><path d="M20.6 102.4c20.3 15.8 40.6 31.5 61 47.3-8 23.3-8 49.2 0 72.4-20.3 15.8-40.6 31.6-60.9 47.3C1.9 232.7-3.8 189.6 4.4 149.2c3.3-16.2 8.7-32 16.2-46.8z" id="Shape" fill="#FBBC05"/><path d="M361.7 151.1c5.8 32.7 4.5 66.8-4.7 98.8-8.5 29.3-24.6 56.5-47.1 77.2l-59.1-45.9c19.5-13.1 33.3-34.3 37.2-57.5H186.6c.1-24.2.1-48.4.1-72.6h175z" id="Shape" fill="#4285F4"/><path d="M81.4 222.2c7.8 22.9 22.8 43.2 42.6 57.1 12.4 8.7 26.6 14.9 41.4 17.9 14.6 3 29.7 2.6 44.4.1 14.6-2.6 28.7-7.9 41-16.2l59.1 45.9c-21.3 19.7-48 33.1-76.2 39.6-31.2 7.1-64.2 7.3-95.2-1-24.6-6.5-47.7-18.2-67.6-34.1-20.9-16.6-38.3-38-50.4-62 20.3-15.7 40.6-31.5 60.9-47.3z" fill="#34A853"/></svg>\n                </span>\n                <span class="social-button__text">Log in/Sign up with Google</span>\n              </button>\n\n              <button id="fb-login" type="button" class="col s12 social-button social-button-facebook">\n                <span class="social-button__icon">\n                  <i class="material-icons"><div class="fb-logo"></div></i>\n                </span>\n                <span class="social-button__text">Log in/Sign up with Facebook</span>\n              </button>\n            </div>\n            `}\n          </form>\n        </div>\n        </div>\n      </div>\n      <div class="modal-footer">\n      ${isUserConnected()?'\n        <button class="left btn waves-effect waves-light red lighten-2" id="profile-desconectar-borrar" type="button" name="action">Disconnect and delete local content</button>\n        <button class="left btn waves-effect waves-light grey darken-1" id="profile-desconectar" type="button" name="action">Disconnect</button>\n        ':'\n        <button class="btn waves-effect waves-light red lighten-2 left" id="buttonBorrarNotas" type="button" name="action">Delete notes</button>\n        <button class="btn waves-effect waves-light red lighten-2 left" id="buttonBorrarNotasFicheros" type="button" name="action">Delete Notes and Files</button>\n      '}\n\n      <div id="mensaje-modal" class="mensaje-modal"></div>\n\n      ${isUserConnected()?"":'\n        <button class="btn waves-effect waves-light grey darken-1" id="buttonRegistro" type="submit" name="action">Go to Sign up</button>\n        '}\n        <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancel</a>\n      </div>`}function obtenerFormularioPlugins(){return idiomaEsp(navigator.language)?`<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">power</i>\n        <h4 class="modal-title">Plugins</h4>\n      </div>\n    </div>\n    ${getPremiumRibbon()}\n    <div class="modal-content">\n      <div class="modal-instructions">\n        Esta opciÃ³n permite crear notas con plugins con diversas utilidades. Una vez aÃ±adido el plugin se pueden manipular como cualquier nota\n        moviÃ©ndola, cambiando el tamaÃ±o o editÃ¡ndola. Se iran aÃ±adiendo plugins nuevos periÃ³dicamente.\n      </div>\n      <form id="formUser" class="formUser col s12">\n        <div class="row lista-plugins">\n          ${listaPlugins("esp")}\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n    <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancelar</a>\n    </div>`:`<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">power</i>\n        <h4 class="modal-title">Plugins</h4>\n      </div>\n    </div>\n    ${getPremiumRibbon()}\n    <div class="modal-content">\n      <div class="modal-instructions">\n        This option allows you to create notes with plugins with various utilities. Once added the plugin can be manipulated like any note\n        moving it, resizing or editing it. New plugins will be added periodically.\n      </div>\n      <form id="formUser" class="formUser col s12">\n        <div class="row lista-plugins">\n          ${listaPlugins("ing")}\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n    <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancel</a>\n    </div>`}function obtenerFormularioStickers(){return idiomaEsp(navigator.language)?`<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">power</i>\n        <h4 class="modal-title">Stickers</h4>\n      </div>\n    </div>\n    <div class="modal-content">\n      <div class="modal-instructions">\n        Stickers para decorar o para relacionar notas. Se puede cambiar el tamaÃ±o, girar o borrar como cualquier otro tipo de nota.\n        Se irÃ¡n aÃ±adiendo nuevos periÃ³dicamente.\n      </div>\n      <form id="formUser" class="formUser col s12">\n        <div class="row lista-stickers">\n          ${listaStickers()}\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n    <button class="btn waves-effect waves-light lighten-2 left" id="showAttribution" type="button" name="action">CrÃ©ditos</button>\n    <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancelar</a>\n    </div>`:`<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">power</i>\n        <h4 class="modal-title">Stickers</h4>\n      </div>\n    </div>\n    <div class="modal-content">\n      <div class="modal-instructions">\n        Stickers to decorate or to relate notes. You can resize, rotate or erase like any other type of note.\n        New stickers will be added periodically.\n        </div>\n      <form id="formUser" class="formUser col s12">\n        <div class="row lista-stickers">\n          ${listaStickers()}\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n    <button class="btn waves-effect waves-light lighten-2 left" id="showAttribution" type="button" name="action">Credits</button>\n    <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancel</a>\n    </div>`}function obtenerFormularioCamara(){return idiomaEsp(navigator.language)?`<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">camera_alt</i>\n        <h4 class="modal-title">Camara</h4>\n      </div>\n    </div>\n    <div class="modal-content">\n      <div class="modal-instructions">\n        Crea una nota con una foto hecha con tu cÃ¡mara. MÃ¡s Ãºtil desde el mÃ³vil con la versiÃ³n web desde\n        <a href="https://www.noteboardapp.com">www.noteboardapp.com</a>\n      </div>\n      <form id="formUser" class="formUser col s12 m12 l6">\n        <div class="row">\n          ${isMobile()?'\n\n            <label id="hacer-foto-label" class="btn waves-effect waves-light lighten-2" for="fileupload">Hacer foto</label>\n            <input type="file" accept="image/*" capture="camera" id="fileupload" name="fileupload" caption style="display:none">\n\n            <input type="hidden" id="usuario-imagen" name="id_usuario">\n            <div class="row">\n              <div id="progress" class="progress-camara">\n                <div id="bar" style="width: 0%;"></div>\n              </div>\n              <img id="progress-ajax" src="appimg/ajax-loader2.gif">\n            </div>\n\n          ':`\n            <div id="buscando-camaras">\n              <p>Buscando cÃ¡maras...</p>\n              <div class="progress">\n                <div class="indeterminate"></div>\n              </div>\n            </div>\n            <h3 id="camara-no-encontrada">CÃ¡mara no encontrada</h3>\n            <p id="camara-sin-permiso">La aplicaciÃ³n no tiene permiso de acceso a la cÃ¡mara, si quieres puedes quitar el\n            bloqueo en ${isEdgeBrowser()?"edge":"chrome"}://settings/content/camera y volver a intentarlo.</p>\n            <button class="camera-button btn waves-effect waves-light lighten-2 left" id="hacer-foto" type="button" name="action">Hacer foto</button>\n            <button class="camera-button btn waves-effect waves-light lighten-2 left" id="repetir-foto" type="button" name="action">Repetir foto</button>\n            <button class="camera-button btn waves-effect waves-light lighten-3 left" id="cameras-selector" type="button" name="action">Cambia cÃ¡mara</button>\n            <video id="video-camera-capture" autoplay></video>\n            <canvas id="canvas-camera-capture"></canvas>\n          `}\n          <img id="foto-camera-capture" empty-image="true" src="" />\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancelar</a>\n      <button class="btn waves-effect waves-light grey darken-1 disabled" id="aceptar-captura" type="submit" name="action">Crear nota con foto\n    </div>`:`<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">camera_alt</i>\n        <h4 class="modal-title">Camara</h4>\n      </div>\n    </div>\n    <div class="modal-content">\n      <div class="modal-instructions">\n        Create a note with a photo taken with your camera. More useful from the mobile with the web version from\n        <a href="https://www.noteboardapp.com">www.noteboardapp.com</a>\n      </div>\n      <form id="formUser" class="formUser col s12 m12 l6">\n        <div class="row">\n          ${isMobile()?'\n\n          <label id="hacer-foto-label" class="btn waves-effect waves-light lighten-2" for="fileupload">Take photo</label>\n          <input type="file" accept="image/*" capture="camera" id="fileupload" name="fileupload" caption style="display:none">\n\n          <input type="hidden" id="usuario-imagen" name="id_usuario">\n          <div class="row">\n            <div id="progress" class="progress-camara">\n              <div id="bar" style="width: 0%;"></div>\n            </div>\n            <img id="progress-ajax" src="appimg/ajax-loader2.gif">\n          </div>\n\n        ':`\n          <div id="buscando-camaras">\n            <p>Searching cameras...</p>\n            <div class="progress">\n              <div class="indeterminate"></div>\n            </div>\n          </div>\n          <h3 id="camara-no-encontrada">Camera not found</h3>\n          <p id="camara-sin-permiso">\n          The application does not have permission to access the camera, if you want you can remove the\n          lock on ${isEdgeBrowser()?"edge":"chrome"}://settings/content/camera and try again.</p>\n          <button class="camera-button btn waves-effect waves-light lighten-2 left" id="hacer-foto" type="button" name="action">Take photo</button>\n          <button class="camera-button btn waves-effect waves-light lighten-2 left" id="repetir-foto" type="button" name="action">Repeat photo</button>\n          <button class="camera-button btn waves-effect waves-light lighten-3 left" id="cameras-selector" type="button" name="action">Change camera</button>\n          <video id="video-camera-capture" autoplay></video>\n          <canvas id="canvas-camera-capture"></canvas>\n        `}\n          <img id="foto-camera-capture" empty-image="true" src="" />\n        </div>\n      </form>\n    </div>\n    <div class="modal-footer">\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancel</a>\n      <button class="btn waves-effect waves-light grey darken-1 disabled" id="aceptar-captura" type="submit" name="action">Create photo note\n    </div>`}function getNewPostit(){return'\n    <div id="postitnuevo" class="postit0 postitNB" style=\'display:none;z-index:1001\'>\n      <form name="Postit">\n      <div class="bordesup"></div>\n      <div class="parteSuperior" data-numpost="nuevopost">\n        <img class="anexaFich" id="anexaFichNuevo" src="appimg/clipNegro.png"/>\n        <button type="button" class="botonborrar" id="botonborNuevo"><span class="lid"></span><span class="can"></span></button>\n      </div>\n      <div class="selectorPins">\n        <img class="pinImgSelec" src="appimg/pushpins/pushpin11.png"/>\n        <img class="pinImgSelec" src="appimg/pushpins/pushpin11.png"/>\n        <img class="pinImgSelec" src="appimg/pushpins/pushpin21.png"/>\n        <img class="pinImgSelec" src="appimg/pushpins/pushpin31.png"/>\n      </div>\n\n      <div class="selector-varios">\n        <div class="sinMarcoDiv">\n          <label class="sinMarcoCheckbox">\n            <input type="checkbox" id="sinMarcoNuevo"/>\n            <span class="sinMarcoLabel">Sin Marco</span>\n          </label>\n        </div>\n        <img class="pinImgSelecEdit" src="appimg/pushpins/pushpin11.png"/>\n        <div class="selectorColor">\n          <div id="idblanco"></div>\n          <div id="idamarillo"></div>\n          <div id="idverde"></div>\n          <div id="idlila"></div>\n          <div id="idnaranja"></div>\n          <div id="idrosa"></div>\n          <div id="idrojo"></div>\n          <div id="idazul"></div>\n          <div id="idtransparente"></div>\n          <div id="notepad"></div>\n          <div id="customColor"><svg width="24" height="24"><path d="M12 3a9 9 0 0 0 0 18 1.5 1.5 0 0 0 1.1-2.5c-.2-.3-.4-.6-.4-1 0-.8.7-1.5 1.5-1.5H16a5 5 0 0 0 5-5c0-4.4-4-8-9-8zm-5.5 9a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm3-4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm3 4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z" fill-rule="nonzero"></path></svg></div>\n        </div>\n      </div>\n      <div class="clearfloat"></div>\n      <textarea class="textoNB" id="textoAnun" name="textoAnun" cols="20" style="background: transparent;border: none"></textarea>\n      <button class="inplace_save nuevo_save btn waves-effect waves-light grey darken-1" type="button" title="CTRL+S" id="aceptar"></button>\n      <button class="inplace_cancel modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" type="button" title="CTRL+Q" id="borrar"></button>\n      </form>\n      <div id="capaContenedoraAnun" style=\'font-size:15px\'></div>\n      <div class="g-signin2" data-onsuccess="onSignIn"></div>\n    </div>'}function obtenerFormularioChatgpt(){if(idiomaEsp(navigator.language))var e=`<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">code</i>\n        <h4 class="modal-title">Crear nota con contenido generado por la IA chatGPT</h4>\n      </div>\n    </div>\n    <div class="modal-content">\n      <div class="modal-instructions">\n        Realiza una consulta con la inteligencia artificial <a href="https://openai.com/blog/chatgpt/">chatGPT</a> y si quieres guarda el resultado en una nota. \n        Para poder usarlo tendrÃ¡s que registrarte en <a href="https://chat.openai.com/">https://chat.openai.com</a> y estar logueado mientras lo uses desde Note Board.\n        Su uso por ahora es gratuito, en su pÃ¡gina web no han especificado cuando dejarÃ¡ de serlo. Para mÃ¡s informaciÃ³n consulta su \n        pÃ¡gina de <a href="https://help.openai.com/en/articles/6783457-chatgpt-faq">preguntas frecuentes</a>.\n      </div>\n      <div class="formUser col s12">\n      <div class="row">\n          <a href="https://chat.openai.com/" id="openai-link" class="blink-me" target="_blank">Haz login en chat.openai.com haciendo click aquÃ­</a>\n       </div>\n      <div class="row">\n          ${getInputHtml({id:"chatgptInput",label:"Texto para chatGPT",type:"text",icon:"mode_edit",helperLine:"Escribe texto para generar respuesta con chatGPT, pulsa enter o el botÃ³n inferior para enviar la consulta"})}\n        </div>\n        <div class="row">\n            <button class="btn waves-effect waves-light disabled" id="submit-chatgpt" type="button" name="submit-chatgpt">\n              <span>Enviar a chatGPT</span>\n              <i class="material-icons right">send</i>\n            </button>\n        </div>\n        <div class="row">\n            <div id="textoChatgpt"></div>\n        </div>\n      </div>\n    </div>\n    <div class="modal-footer">\n      <button class="btn waves-effect waves-light grey darken-1 disabled" id="aceptar-chatgpt" type="button" name="action">Crear Nota</button>\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancelar</a>\n    </div>`;else e=`<div class="modal-header">\n      <div class="title-container"><i class="material-icons icono">code</i>\n        <h4 class="modal-title">Create note with the AI chatGPT</h4>\n      </div>\n    </div>\n    <div class="modal-content">\n      <div class="modal-instructions">\n        Make a query to the artificial intelligence <a href="https://openai.com/blog/chatgpt/">chatGPT</a> and if you want save the result in a note.\n         In order to use it you will have to register at <a href="https://chat.openai.com/">https://chat.openai.com</a> and be logged in while using it from Note Board.\n         Its use for now is free, on their website they have not specified when it will cease to be. For more information consult their\n         <a href="https://help.openai.com/en/articles/6783457-chatgpt-faq">frequently asked questions</a> page.\n      </div>\n      <div class="formUser col s12">\n      <div class="row">\n          <a href="https://chat.openai.com/" id="openai-link" class="blink-me" target="_blank">Please login in chat.openai.com clicking here</a>\n       </div>\n      <div class="row">\n          ${getInputHtml({id:"chatgptInput",label:"Text for chatGPT",type:"text",icon:"mode_edit",helperLine:"Write Text to generate a response with chatGPT, press enter or the bottom button to send the query"})}\n        </div>\n        <div class="row">\n            <button class="btn waves-effect waves-light disabled" id="submit-chatgpt" type="button" name="submit-chatgpt">\n              <span>Send to chatGPT</span>\n              <i class="material-icons right">send</i>\n            </button>\n        </div>\n        <div class="row">\n            <div id="textoChatgpt"></div>\n        </div>\n      </div>\n    </div>\n    <div class="modal-footer">\n      <button class="btn waves-effect waves-light grey darken-1 disabled" id="aceptar-chatgpt" type="button" name="action">Create Note</button>\n      <a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2">Cancel</a>\n    </div>`;return e}function loginFacebook(){chrome.permissions.request({permissions:["tabs"],origins:["https://www.noteboardapp.com/"]},(function(e){e&&(chrome.runtime.sendMessage({loginFace:"login"}),FBNb.init("339270982866129"),FBNb.login(),FBNb.api("picture",(function(e){console.log("kkk"),console.log(e)})))}))}function getFBDataLogin(){FBNb.api("me?fields=id,name,friends,email",(function(e){}))}function esPopup(){return document.URL.indexOf("popup2.")>-1}function esPopupNotaWeb(){return document.URL.indexOf("popup2.")>-1&&document.URL.indexOf("abreEditando=true")>-1}function numeroNota(){return document.URL.indexOf("&")>-1?document.URL.substring(document.URL.indexOf("?numPost")+9,document.URL.indexOf("&")):document.URL.substr(document.URL.indexOf("?numPost")+9)}function abreEditando(){return document.URL.indexOf("abreEditando=true")>-1}function notaWeb(){return document.URL.indexOf("notaWeb=true")>-1}function nuevaNota(){return document.URL.indexOf("nuevaNota=true")>-1}function paramUrl(){return document.URL.indexOf("url=")>-1?document.URL.substring(document.URL.indexOf("url=")+4):""}function getHostFromUrl(e){try{const t=new URL(e);return`${t.protocol}//${t.hostname}/`}catch(t){return console.log(t),e}}function paramTabId(){return document.URL.indexOf("tabId=")>-1?document.URL.substring(document.URL.indexOf("tabId=")+6,document.URL.lastIndexOf("&")):""}async function creaPopupNota(e,t,a,o,n,i,r,s,l,c,d){esBackground()&&await getLocalStorage(),document.URL.indexOf("popup.html")>-1&&webkitBrowser()&&chrome.permissions.request({permissions:["background"]});var u=existePopup(e);if(t&&u)t&&chrome.windows.update(u,{drawAttention:!0});else{if(i=i||200,r=r||200,a=a||!1,o=o||!1,n=n||!1,c=c||0,d=d||"",s&&l)var p=s,m=l;else{if($("#postit"+e)?.length>0)var g=$("#postit"+e).width()+10,h=$("#postit"+e).height()+40;else g="auto"!=localStorage["width"+e]?parseInt(localStorage["width"+e]):450,h=getAlturaNota(e);if("true"==localStorage["sinMarco"+e])p=Math.round(g),m=Math.round(h-5);else p=Math.round(g+24),m=Math.round(h+50)}if(i=parseInt(i),r=parseInt(r),screen.height&&m>screen.height&&(m=screen.height-100),localStorage["treeId"+e]&&"undefined"!=localStorage["treeId"+e])var f=localStorage["treeId"+e];else f=0;var b={url:chrome.runtime.getURL("popup2.html?numPost="+e+"&abreEditando="+a+"&notaWeb="+o+"&nuevaNota="+n+"&tabId="+c+"&url="+d),top:i,left:r,width:p,height:m,type:"popup"};chrome.windows.create(b,(function(a){if(isChromeExtension()){if(a.height=500,localStorage.popups)var n=JSON.parse(localStorage.popups);else n=new Array;n.push({winId:a.id,numPost:e,width:p,height:m,X:r,Y:i,treeId:f,notaWeb:o,tabId:c}),localStorage.popups=JSON.stringify(n),t&&chrome.windows.update(a.id,{drawAttention:!0}),esBackground()&&setLocalStorage(["popups"])}}))}}function muestraPops(){chrome.windows.getAll((function(e){if(localStorage.popups)for(var t=JSON.parse(localStorage.popups),a=0;a<t.length;a++)if(-1==JSON.stringify(e).indexOf('"id":'+t[a].winId)){var o={url:chrome.runtime.getURL("popup2.html?numPost="+t[a].numPost),top:t[a].Y,left:t[a].X,width:t[a].width,height:t[a].height,type:"popup"};!function(e){chrome.windows.create(o,(async function(t){var a=JSON.parse(localStorage.popups);a[e].winId=t.id,localStorage.popups=JSON.stringify(a),esBackground()&&await setLocalStorage(["popups"])}))}(a)}}))}function borraPopupConfirmado(e){if(localStorage.popups){for(var t=JSON.parse(localStorage.popups),a=new Array,o=0;o<t.length;o++)t[o].numPost==e&&(a.push(o),sendMessage({unpopup:"unpopup",winId:t[o].winId})),t[o]&&t[o].numPost>e&&t[o].numPost--;for(o=0;o<a.length;o++)t.splice(a[o],1);localStorage.popups=JSON.stringify(t)}}function borraPopupWindow(e){if(localStorage.popups)for(var t=JSON.parse(localStorage.popups),a=0;a<t.length;a++)if(t[a].winId==e)return t[a].notaWeb&&t[a].tabId&&chrome.tabs.sendMessage(t[a].tabId,{muestraNotas:"muestraNotas"}),t.splice(a,1),localStorage.popups=JSON.stringify(t),void setLocalStorage(["popups"])}function compruebaPopups(){if(localStorage.popups){for(var e=JSON.parse(localStorage.popups),t=new Array,a=0;a<e.length;a++)if(0!=e[a].treeId&&e[a].treeId!=localStorage["treeId"+e[a].numPost]){for(var o=0;o<localStorage.totalPost&&e[a].treeId!=localStorage["treeId"+o];)o++;e[a].treeId==localStorage["treeId"+o]?e[a].numPost=o:(t.push(a),chrome.windows.remove(e[a].winId))}for(a=0;a<t.length;a++)e.splice(t[a],1);localStorage.popups=JSON.stringify(e)}}function addTreeIdPopup(e,t){if(localStorage.popups){for(var a=JSON.parse(localStorage.popups),o=0;o<a.length;o++)a[o].numPost==t&&(a[o].treeId=e);localStorage.popups=JSON.stringify(a)}}function getPopupData(e){if(isChromeExtension()){if(!localStorage.popups)return{width:0,height:0};for(var t=JSON.parse(localStorage.popups),a=0;a<t.length;a++)if(t[a].winId==e)return{width:t[a].width,height:t[a].height,X:t[a].X,Y:t[a].Y}}return{width:window.innerWidth,height:window.innerHeight,X:window.screenX,Y:window.screenY}}function setPopupPos(e,t,a){if(localStorage.popups)for(var o=JSON.parse(localStorage.popups),n=0;n<o.length;n++)if(o[n].winId==e)return o[n].X=t,o[n].Y=a,void(localStorage.popups=JSON.stringify(o))}function setPopupSize(e,t,a){if(localStorage.popups)for(var o=JSON.parse(localStorage.popups),n=0;n<o.length;n++)if(o[n].winId==e)return o[n].width=t,o[n].height=a,void(localStorage.popups=JSON.stringify(o))}function existePopup(e){if(!localStorage.popups)return!1;for(var t=JSON.parse(localStorage.popups),a=0;a<t.length;a++)if(t[a].numPost==e)return t[a].winId;return!1}function abreFormPublico(){salSiPapelera()||(isWebNotesBoard()?sweetAlert({type:"error",text:chrome.i18n.getMessage("webNotesPublish"),cancel:!1}):isUserConnected()?abrirPantallaModal(obtenerFormularioPublico(),{height:650,onOpenStart:function(){"true"==localStorage["publico"+tablonActual]?($("#aceptar-publicar").hide(),$("#aceptar-privado").show()):($("#aceptar-publicar").show(),$("#aceptar-privado").hide()),$("#aceptar-publicar").off().on("click",hazPublico),$("#aceptar-privado").off().on("click",quitaPublico),$(".iframeSize").on("input",(function(){$("#iframeWidth").val()>200&&$("#iframeHeight").val()>200&&$(".textSize").text('<iframe src="https://www.noteboardapp.com/'+localStorage.nickPublico+'?embed" width="'+$("#iframeWidth").val()+'" height="'+$("#iframeHeight").val()+'" frameborder="0" allowfullscreen="allowfullscreen"></iframe>')})),$("#activarPresentacion").on("click",activarPresentacion)}}):muestraAdvertenciaLogin("loguearseParaPublicar"))}function hazPublico(){"true"!=localStorage["publico"+tablonActual]&&(localStorage["publico"+tablonActual]="true",$("#publicBot").css({"box-shadow":"0 0 50px black inset","background-color":"initial"}),grabaTablones()),modalInstance.close(),muestraPaneles2(!1,!1)}function quitaPublico(){"true"==localStorage["publico"+tablonActual]&&(localStorage["publico"+tablonActual]="false",$("#publicBot").css({"box-shadow":"0 0 0px black inset"}),grabaTablones()),modalInstance.close(),muestraPaneles2(!1,!1)}function backupDialogo(){abrirPantallaModal(obtenerFormularioBackup(),{onOpenStart:function(){$("#exportar-backup").off().on("click",backupExportar),document.getElementById("file-backup").addEventListener("change",handleFileSelect,!1)}})}function backupExportar(){try{iniLocalStorageCaptureData();var e=JSON.stringify(localStorage),t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download","noteBoardBackup.txt"),t.style.display="none",t.click(),localStorage.avisoBackup="false"}catch(e){console.log(e)}}function handleFileSelect(e){var t=document.getElementById("file-backup").files[0];progressBar(10);var a=new FileReader;a.onload=function(e){try{progressBar(30);var t=parseStringUntilNotError(a.result,33);if(t!==Object(t))throw $("#message-backup").text(chrome.i18n.getMessage("backupError")),"No es posible el parseo";progressBar(50);var o=localStorage.sincroLogin;localStorage.clear(),writeLocalStorage(t),"true"==o?(sincronizaLogin(!0,!0),progressBar(100),$("#message-backup").text(chrome.i18n.getMessage("backupSuccess"))):(progressBar(100),localStorage.sincroLogin="false",location.reload())}catch(e){progressBar(0),$("#message-backup").text(chrome.i18n.getMessage("backupError")),console.log(e)}},a.readAsText(t)}function writeLocalStorage(e){Object.keys(e).forEach((function(t){localStorage.setItem(t,e[t])}))}function parseStringUntilNotError(e,t){var a,o=0,n=/\d+/g,i=e.length;if(0!=e.indexOf('{"'))return!1;for(;a!==Object(a)&&Number.isInteger(o)&&o<=i;)try{a=JSON.parse(e)}catch(t){o=parseInt(t.toString().match(n)),e=e.substr(0,o-1)+e.substr(o+1)}return a}function progressBar(e){$("#progress, #progress-ajax").show().css("display","block"),$("#progress #bar").css("width",e+"%")}function compruebaBackup(){if(!isChromeExtension())return!1;var e="avisoBackup";"true"!=localStorage.sincroLogin&&"false"!=localStorage[e]&&"false"!=localStorage[e]&&abrirPantallaModal(chrome.i18n.getMessage(e),{icon:"info",buttons:{cancelButton:!0,list:[{text:chrome.i18n.getMessage("noMostrarMas"),callback:function(){localStorage[e]="false",modalInstance.close()}},{text:chrome.i18n.getMessage("backupNow"),color:"red lighten-2",callback:function(){backupExportar(),modalInstance.close()}}]},onOpenStart:function(){$(".hacer-backup-aviso").on("click",backupDialogo)},height:500,width:700})}function initRealTime(){if("undefined"!=typeof firebase&&isPremiumUser()){if(0===firebase.apps.length){firebase.initializeApp({apiKey:"AIzaSyAX48wcrExFdN--o728Pdrc8CPED_SdQ0E",authDomain:"note-board-web.firebaseapp.com",databaseURL:"https://note-board-web.firebaseio.com",projectId:"note-board-web",storageBucket:"note-board-web.appspot.com",messagingSenderId:"1053127044847"});firebase.database()}else firebase.database().goOnline()}}function checkBoardRealTime(e){if("undefined"!=typeof firebase&&isPremiumUser())try{esTablonCompartido(e)?(initRealTime(),listenRealTime(e)):firebase.apps.length>0&&(firebase.database().goOffline(),postitChange&&postitChange.off())}catch(e){console.log(e)}}function sendRealTime(e,t,a=tablonActual){if("undefined"!=typeof firebase&&isPremiumUser()&&isUserConnected()&&esTablonCompartido(a)&&localStorage["treeId"+e])try{(a!=tablonActual&&!esTablonCompartido(tablonActual)||esBackground()&&checkBoardRealTime(a))&&initRealTime();for(var o=(t=t||{}).texto||localStorage["postit"+e],n=JSON.parse(localStorage.comparticiones),i=0;i<n.length;i++)if(n[i].tabComp==a){var r={postit:o,tipoA:localStorage["tipoA"+e],X:localStorage["X"+e],Y:localStorage["Y"+e],width:localStorage["width"+e]||0,height:localStorage["height"+e]||0,treeId:localStorage["treeId"+e]||0,fecha:localStorage["fecha"+e]||"",calendar:localStorage["calendar"+e]||"",sinMarco:localStorage["sinMarco"+e]||"",rotacion:localStorage["rotacion"+e]||"",pushpin:localStorage["pushpin"+e]||"",columnaKanban:localStorage["columnaKanban"+e]||"",connections:localStorage["connections"+e]||"",create:t.create||!1,delete:t.delete||!1,tabKanban:esTablonKanban(a)?localStorage["tablonKanban"+a]:""};t.create&&(r={...r,userComp:"RW"==n[i].permisos?localStorage.id_usuario:"R",nickComp:localStorage.nick}),firebase.database().ref("users/"+n[i].id_usuarioComp+"/board/"+n[i].tabCompRemoto+"/treeId/"+localStorage["treeId"+e]).set(r)}}catch(e){console.log(e)}}function listenRealTime(e){if("undefined"!=typeof firebase&&isPremiumUser()){var t=localStorage.id_usuario;postitChange&&postitChange.off(),(postitChange=firebase.database().ref("users/"+t+"/board/"+e)).on("value",(function(n){try{var i=n.val();if(!i)return;for(const n in i.treeId){var r=i.treeId[n];if(r.delete)a(r.treeId);else if(r.create){var s=localStorage.totalPost;o(r.treeId)||(informaLocalStorage(s,r,e),localStorage.totalPost++,muestraPostit(s))}else if(r&&r.treeId)for(var l=0;l<localStorage.totalPost;l++)if(localStorage["treeId"+l]==r.treeId){informaLocalStorage(l,r),estaEditorAbierto(l)?obtenEditor(l).setContent(localStorage["postit"+l]):refrescaNota(l);break}r.tabKanban&&(localStorage["tablonKanban"+e]=r.tabKanban),deleteRealTime(t,e,r.treeId)}}catch(e){console.log(e)}}))}function a(e){for(var t=0;t<localStorage.totalPost;t++)if(localStorage["treeId"+t]==e){borrarConfirmado(t);break}}function o(e){for(var t=0;t<localStorage.totalPost;t++)if(localStorage["treeId"+t]==e)return!0;return!1}}function informaLocalStorage(e,t,a){localStorage["postit"+e]=t.postit,localStorage["tipoA"+e]=t.tipoA,localStorage["X"+e]=t.X,localStorage["Y"+e]=t.Y,localStorage["width"+e]=t.width,localStorage["height"+e]=t.height,localStorage["sinMarco"+e]=t.sinMarco,localStorage["rotacion"+e]=t.rotacion,localStorage["pushpin"+e]=t.pushpin,localStorage["treeId"+e]=t.treeId,localStorage["columnaKanban"+e]=t.columnaKanban,t.connections&&(localStorage["connections"+e]=t.connections),t.create&&(localStorage["tablon"+e]=a,localStorage["userComp"+e]=t.userComp,localStorage["nickComp"+e]=t.nickComp)}function deleteRealTime(e,t,a){firebase.database().ref("users/"+e+"/board/"+t+"/treeId/"+a).remove()}
/*! tooltipster v4.2.2 */!function(){var e="https://graph.facebook.com/v4.0/",t="",a={_uid:"",init:function(e,a){e,t=a||""},getUser:function(e){a.api("/me",(function(t){t&&t.id&&(localStorage._uid=t.id,a._uid=t.id,e&&e(t))}))},getMissingPermissions:function(e){var o=[];a.api("me/permissions",(function(a){if(a&&!a.error&&a.data&&a.data[0]){for(var n=t.replace(/\s/g,"").split(","),i=0;i<n.length;i++)n[i]in a.data[0]||n[i]in{friends_checkins:1,user_checkins:1,friends_status:1,user_status:1,offline_access:1}||o.push(n[i]);e&&e(o)}}))},getAccessToken:function(){if(null==localStorage.fbToken)return!1;var e=((new Date).getTime()-localStorage.timeLogin)/1e3;return console.log("Time Loged: "+e/60+" minutes"),console.log("Time to expire: "+localStorage.fbExpires/60+" minutes"),!(e>localStorage.fbExpires)&&localStorage.fbToken},setAccessToken:function(e){!1===e?localStorage.removeItem("fbToken"):localStorage.fbToken=e},getUserID:function(){return localStorage._uid||a._uid},login:function(){window.open("https://www.facebook.com/dialog/oauth?client_id=339270982866129&response_type=token&redirect_uri=http://www.facebook.com/connect/login_success.html&scope=email","Facebook Login","width=900,height=500,left=200,top=150,scrollbars=no")},inviteFriends:function(e,t,a,o,n,i){e=e.substring(0,60);var r="https://www.facebook.com/dialog/apprequests?app_id=339270982866129&message="+encodeURIComponent(e)+"&display=popup&redirect_uri=https://www.noteboardapp.com/api/sendRequestFb.php?invitation="+t+"|"+a+"|"+o+"|"+n+"|"+i;window.open(r,"Invite Friends","width=800,height=500,left=100,top=100,scrollbars=no")},api:function(t){var o=Array.prototype.slice.call(arguments,1),n=!1,i={},r="get";for(var s in o)switch(typeof o[s]){case"function":n=o[s];break;case"object":i=o[s];break;case"string":r=o[s].toLowerCase()}if(!t&&!i.batch)return n&&n(!1);i.method=r,i.access_token=this.getAccessToken(),$.get(e+t,i,(function(e){e&&e.error&&e.error.type&&("Invalid OAuth access token."==e.error.message||e.error.message.indexOf("Error validating access token")>-1)?a.login():"function"==typeof n&&n(e)}),"json")},objectFromURL:function(e){if(-1==e.indexOf("facebook.com"))return e},setFbObject:function(e){a.fbObject=e},feed:function(e,t){var a="https://www.facebook.com/dialog/feed?app_id=339270982866129&link="+encodeURIComponent(e)+"&name="+encodeURIComponent(document.title)+"&display=popup&description="+encodeURIComponent(t)+"&redirect_uri=http://www.zocalosquare.com/api/sendRequestFb.php";window.open(a,"Publish","width=600,height=500,left=200,top=100,scrollbars=no")}};window.FBNb=a}(),$(document).ready((function(){$("#backupBot").on("click",backupDialogo)})),function(e,t){"function"==typeof define&&define.amd?define(["jquery"],(function(e){return t(e)})):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery)}(0,(function(e){function t(e){this.$container,this.constraints=null,this.__$tooltip,this.__init(e)}function a(t,a){var o=!0;return e.each(t,(function(e,n){return void 0===a[e]||t[e]!==a[e]?(o=!1,!1):void 0})),o}function o(t){var a=t.attr("id"),o=a?r.window.document.getElementById(a):null;return o?o===t[0]:e.contains(r.window.document.body,t[0])}var n={animation:"fade",animationDuration:350,content:null,contentAsHTML:!1,contentCloning:!1,debug:!0,delay:300,delayTouch:[300,500],functionInit:null,functionBefore:null,functionReady:null,functionAfter:null,functionFormat:null,IEmin:6,interactive:!1,multiple:!1,parent:null,plugins:["sideTip"],repositionOnScroll:!1,restoration:"none",selfDestruction:!0,theme:[],timer:0,trackerInterval:500,trackOrigin:!1,trackTooltip:!1,trigger:"hover",triggerClose:{click:!1,mouseleave:!1,originClick:!1,scroll:!1,tap:!1,touchleave:!1},triggerOpen:{click:!1,mouseenter:!1,tap:!1,touchstart:!1},updateAnimation:"rotate",zIndex:9999999},i="undefined"!=typeof window?window:null,r={hasTouchCapability:!(!i||!("ontouchstart"in i||i.DocumentTouch&&i.document instanceof i.DocumentTouch||i.navigator.maxTouchPoints)),hasTransitions:function(){if(!i)return!1;var e=(i.document.body||i.document.documentElement).style,t="transition",a=["Moz","Webkit","Khtml","O","ms"];if("string"==typeof e[t])return!0;t=t.charAt(0).toUpperCase()+t.substr(1);for(var o=0;o<a.length;o++)if("string"==typeof e[a[o]+t])return!0;return!1}(),IE:!1,semVer:"4.2.2",window:i},s=function(){this.__$emitterPrivate=e({}),this.__$emitterPublic=e({}),this.__instancesLatestArr=[],this.__plugins={},this._env=r};s.prototype={__bridge:function(t,a,o){if(!a[o]){var i=function(){};i.prototype=t;var r=new i;r.__init&&r.__init(a),e.each(t,(function(e,t){0!=e.indexOf("__")&&(a[e]?n.debug&&console.log("The "+e+" method of the "+o+" plugin conflicts with another plugin or native methods"):(a[e]=function(){return r[e].apply(r,Array.prototype.slice.apply(arguments))},a[e].bridged=r))})),a[o]=r}return this},__setWindow:function(e){return r.window=e,this},_getRuler:function(e){return new t(e)},_off:function(){return this.__$emitterPrivate.off.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_on:function(){return this.__$emitterPrivate.on.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_one:function(){return this.__$emitterPrivate.one.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_plugin:function(t){var a=this;if("string"==typeof t){var o=t,n=null;return o.indexOf(".")>0?n=a.__plugins[o]:e.each(a.__plugins,(function(e,t){return t.name.substring(t.name.length-o.length-1)=="."+o?(n=t,!1):void 0})),n}if(t.name.indexOf(".")<0)throw new Error("Plugins must be namespaced");return a.__plugins[t.name]=t,t.core&&a.__bridge(t.core,a,t.name),this},_trigger:function(){var e=Array.prototype.slice.apply(arguments);return"string"==typeof e[0]&&(e[0]={type:e[0]}),this.__$emitterPrivate.trigger.apply(this.__$emitterPrivate,e),this.__$emitterPublic.trigger.apply(this.__$emitterPublic,e),this},instances:function(t){var a=[];return e(t||".tooltipstered").each((function(){var t=e(this),o=t.data("tooltipster-ns");o&&e.each(o,(function(e,o){a.push(t.data(o))}))})),a},instancesLatest:function(){return this.__instancesLatestArr},off:function(){return this.__$emitterPublic.off.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},on:function(){return this.__$emitterPublic.on.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},one:function(){return this.__$emitterPublic.one.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},origins:function(t){return e((t?t+" ":"")+".tooltipstered").toArray()},setDefaults:function(t){return e.extend(n,t),this},triggerHandler:function(){return this.__$emitterPublic.triggerHandler.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this}},e.tooltipster=new s,e.Tooltipster=function(t,a){this.__callbacks={close:[],open:[]},this.__closingTime,this.__Content,this.__contentBcr,this.__destroyed=!1,this.__$emitterPrivate=e({}),this.__$emitterPublic=e({}),this.__enabled=!0,this.__garbageCollector,this.__Geometry,this.__lastPosition,this.__namespace="tooltipster-"+Math.round(1e6*Math.random()),this.__options,this.__$originParents,this.__pointerIsOverOrigin=!1,this.__previousThemes=[],this.__state="closed",this.__timeouts={close:[],open:null},this.__touchEvents=[],this.__tracker=null,this._$origin,this._$tooltip,this.__init(t,a)},e.Tooltipster.prototype={__init:function(t,a){var o=this;if(o._$origin=e(t),o.__options=e.extend(!0,{},n,a),o.__optionsFormat(),!r.IE||r.IE>=o.__options.IEmin){var i=null;if(void 0===o._$origin.data("tooltipster-initialTitle")&&(void 0===(i=o._$origin.attr("title"))&&(i=null),o._$origin.data("tooltipster-initialTitle",i)),null!==o.__options.content)o.__contentSet(o.__options.content);else{var s,l=o._$origin.attr("data-tooltip-content");l&&(s=e(l)),s&&s[0]?o.__contentSet(s.first()):o.__contentSet(i)}o._$origin.removeAttr("title").addClass("tooltipstered"),o.__prepareOrigin(),o.__prepareGC(),e.each(o.__options.plugins,(function(e,t){o._plug(t)})),r.hasTouchCapability&&e(r.window.document.body).on("touchmove."+o.__namespace+"-triggerOpen",(function(e){o._touchRecordEvent(e)})),o._on("created",(function(){o.__prepareTooltip()}))._on("repositioned",(function(e){o.__lastPosition=e.position}))}else o.__options.disabled=!0},__contentInsert:function(){var e=this,t=e._$tooltip.find(".tooltipster-content"),a=e.__Content;return e._trigger({type:"format",content:e.__Content,format:function(e){a=e}}),e.__options.functionFormat&&(a=e.__options.functionFormat.call(e,e,{origin:e._$origin[0]},e.__Content)),"string"!=typeof a||e.__options.contentAsHTML?t.empty().append(a):t.text(a),e},__contentSet:function(t){return t instanceof e&&this.__options.contentCloning&&(t=t.clone(!0)),this.__Content=t,this._trigger({type:"updated",content:t}),this},__destroyError:function(){throw new Error("This tooltip has been destroyed and cannot execute your method call.")},__geometry:function(){var t=this,a=t._$origin,o=t._$origin.is("area");if(o){var n=t._$origin.parent().attr("name");a=e('img[usemap="#'+n+'"]')}var i=a[0].getBoundingClientRect(),s=e(r.window.document),l=e(r.window),c=a,d={available:{document:null,window:null},document:{size:{height:s.height(),width:s.width()}},window:{scroll:{left:r.window.scrollX||r.window.document.documentElement.scrollLeft,top:r.window.scrollY||r.window.document.documentElement.scrollTop},size:{height:l.height(),width:l.width()}},origin:{fixedLineage:!1,offset:{},size:{height:i.bottom-i.top,width:i.right-i.left},usemapImage:o?a[0]:null,windowOffset:{bottom:i.bottom,left:i.left,right:i.right,top:i.top}}};if(o){var u=t._$origin.attr("shape"),p=t._$origin.attr("coords");if(p&&(p=p.split(","),e.map(p,(function(e,t){p[t]=parseInt(e)}))),"default"!=u)switch(u){case"circle":var m=p[0],g=p[1],h=p[2],f=g-h,b=m-h;d.origin.size.height=2*h,d.origin.size.width=d.origin.size.height,d.origin.windowOffset.left+=b,d.origin.windowOffset.top+=f;break;case"rect":var v=p[0],S=p[1],w=p[2],_=p[3];d.origin.size.height=_-S,d.origin.size.width=w-v,d.origin.windowOffset.left+=v,d.origin.windowOffset.top+=S;break;case"poly":for(var $=0,y=0,C=0,P=0,k="even",I=0;I<p.length;I++){var T=p[I];"even"==k?(T>C&&(C=T,0===I&&($=C)),$>T&&($=T),k="odd"):(T>P&&(P=T,1==I&&(y=P)),y>T&&(y=T),k="even")}d.origin.size.height=P-y,d.origin.size.width=C-$,d.origin.windowOffset.left+=$,d.origin.windowOffset.top+=y}}for(t._trigger({type:"geometry",edit:function(e){d.origin.size.height=e.height,d.origin.windowOffset.left=e.left,d.origin.windowOffset.top=e.top,d.origin.size.width=e.width},geometry:{height:d.origin.size.height,left:d.origin.windowOffset.left,top:d.origin.windowOffset.top,width:d.origin.size.width}}),d.origin.windowOffset.right=d.origin.windowOffset.left+d.origin.size.width,d.origin.windowOffset.bottom=d.origin.windowOffset.top+d.origin.size.height,d.origin.offset.left=d.origin.windowOffset.left+d.window.scroll.left,d.origin.offset.top=d.origin.windowOffset.top+d.window.scroll.top,d.origin.offset.bottom=d.origin.offset.top+d.origin.size.height,d.origin.offset.right=d.origin.offset.left+d.origin.size.width,d.available.document={bottom:{height:d.document.size.height-d.origin.offset.bottom,width:d.document.size.width},left:{height:d.document.size.height,width:d.origin.offset.left},right:{height:d.document.size.height,width:d.document.size.width-d.origin.offset.right},top:{height:d.origin.offset.top,width:d.document.size.width}},d.available.window={bottom:{height:Math.max(d.window.size.height-Math.max(d.origin.windowOffset.bottom,0),0),width:d.window.size.width},left:{height:d.window.size.height,width:Math.max(d.origin.windowOffset.left,0)},right:{height:d.window.size.height,width:Math.max(d.window.size.width-Math.max(d.origin.windowOffset.right,0),0)},top:{height:Math.max(d.origin.windowOffset.top,0),width:d.window.size.width}};"html"!=c[0].tagName.toLowerCase();){if("fixed"==c.css("position")){d.origin.fixedLineage=!0;break}c=c.parent()}return d},__optionsFormat:function(){return"number"==typeof this.__options.animationDuration&&(this.__options.animationDuration=[this.__options.animationDuration,this.__options.animationDuration]),"number"==typeof this.__options.delay&&(this.__options.delay=[this.__options.delay,this.__options.delay]),"number"==typeof this.__options.delayTouch&&(this.__options.delayTouch=[this.__options.delayTouch,this.__options.delayTouch]),"string"==typeof this.__options.theme&&(this.__options.theme=[this.__options.theme]),null===this.__options.parent?this.__options.parent=e(r.window.document.body):"string"==typeof this.__options.parent&&(this.__options.parent=e(this.__options.parent)),"hover"==this.__options.trigger?(this.__options.triggerOpen={mouseenter:!0,touchstart:!0},this.__options.triggerClose={mouseleave:!0,originClick:!0,touchleave:!0}):"click"==this.__options.trigger&&(this.__options.triggerOpen={click:!0,tap:!0},this.__options.triggerClose={click:!0,tap:!0}),this._trigger("options"),this},__prepareGC:function(){var t=this;return t.__options.selfDestruction?t.__garbageCollector=setInterval((function(){var a=(new Date).getTime();t.__touchEvents=e.grep(t.__touchEvents,(function(e,t){return a-e.time>6e4})),o(t._$origin)||t.close((function(){t.destroy()}))}),2e4):clearInterval(t.__garbageCollector),t},__prepareOrigin:function(){var e=this;if(e._$origin.off("."+e.__namespace+"-triggerOpen"),r.hasTouchCapability&&e._$origin.on("touchstart."+e.__namespace+"-triggerOpen touchend."+e.__namespace+"-triggerOpen touchcancel."+e.__namespace+"-triggerOpen",(function(t){e._touchRecordEvent(t)})),e.__options.triggerOpen.click||e.__options.triggerOpen.tap&&r.hasTouchCapability){var t="";e.__options.triggerOpen.click&&(t+="click."+e.__namespace+"-triggerOpen "),e.__options.triggerOpen.tap&&r.hasTouchCapability&&(t+="touchend."+e.__namespace+"-triggerOpen"),e._$origin.on(t,(function(t){e._touchIsMeaningfulEvent(t)&&e._open(t)}))}if(e.__options.triggerOpen.mouseenter||e.__options.triggerOpen.touchstart&&r.hasTouchCapability){t="";e.__options.triggerOpen.mouseenter&&(t+="mouseenter."+e.__namespace+"-triggerOpen "),e.__options.triggerOpen.touchstart&&r.hasTouchCapability&&(t+="touchstart."+e.__namespace+"-triggerOpen"),e._$origin.on(t,(function(t){!e._touchIsTouchEvent(t)&&e._touchIsEmulatedEvent(t)||(e.__pointerIsOverOrigin=!0,e._openShortly(t))}))}if(e.__options.triggerClose.mouseleave||e.__options.triggerClose.touchleave&&r.hasTouchCapability){t="";e.__options.triggerClose.mouseleave&&(t+="mouseleave."+e.__namespace+"-triggerOpen "),e.__options.triggerClose.touchleave&&r.hasTouchCapability&&(t+="touchend."+e.__namespace+"-triggerOpen touchcancel."+e.__namespace+"-triggerOpen"),e._$origin.on(t,(function(t){e._touchIsMeaningfulEvent(t)&&(e.__pointerIsOverOrigin=!1)}))}return e},__prepareTooltip:function(){var t=this,a=t.__options.interactive?"auto":"";return t._$tooltip.attr("id",t.__namespace).css({"pointer-events":a,zIndex:t.__options.zIndex}),e.each(t.__previousThemes,(function(e,a){t._$tooltip.removeClass(a)})),e.each(t.__options.theme,(function(e,a){t._$tooltip.addClass(a)})),t.__previousThemes=e.merge([],t.__options.theme),t},__scrollHandler:function(t){var a=this;if(a.__options.triggerClose.scroll)a._close(t);else if(o(a._$origin)&&o(a._$tooltip)){if(t.target===r.window.document)a.__Geometry.origin.fixedLineage||a.__options.repositionOnScroll&&a.reposition(t);else{var n=a.__geometry(),i=!1;if("fixed"!=a._$origin.css("position")&&a.__$originParents.each((function(t,a){var o=e(a),r=o.css("overflow-x"),s=o.css("overflow-y");if("visible"!=r||"visible"!=s){var l=a.getBoundingClientRect();if("visible"!=r&&(n.origin.windowOffset.left<l.left||n.origin.windowOffset.right>l.right))return i=!0,!1;if("visible"!=s&&(n.origin.windowOffset.top<l.top||n.origin.windowOffset.bottom>l.bottom))return i=!0,!1}return"fixed"!=o.css("position")&&void 0})),i)a._$tooltip.css("visibility","hidden");else if(a._$tooltip.css("visibility","visible"),a.__options.repositionOnScroll)a.reposition(t);else{var s=n.origin.offset.left-a.__Geometry.origin.offset.left,l=n.origin.offset.top-a.__Geometry.origin.offset.top;a._$tooltip.css({left:a.__lastPosition.coord.left+s,top:a.__lastPosition.coord.top+l})}}a._trigger({type:"scroll",event:t})}return a},__stateSet:function(e){return this.__state=e,this._trigger({type:"state",state:e}),this},__timeoutsClear:function(){return clearTimeout(this.__timeouts.open),this.__timeouts.open=null,e.each(this.__timeouts.close,(function(e,t){clearTimeout(t)})),this.__timeouts.close=[],this},__trackerStart:function(){var e=this,t=e._$tooltip.find(".tooltipster-content");return e.__options.trackTooltip&&(e.__contentBcr=t[0].getBoundingClientRect()),e.__tracker=setInterval((function(){if(o(e._$origin)&&o(e._$tooltip)){if(e.__options.trackOrigin){var n=e.__geometry(),i=!1;a(n.origin.size,e.__Geometry.origin.size)&&(e.__Geometry.origin.fixedLineage?a(n.origin.windowOffset,e.__Geometry.origin.windowOffset)&&(i=!0):a(n.origin.offset,e.__Geometry.origin.offset)&&(i=!0)),i||(e.__options.triggerClose.mouseleave?e._close():e.reposition())}if(e.__options.trackTooltip){var r=t[0].getBoundingClientRect();r.height===e.__contentBcr.height&&r.width===e.__contentBcr.width||(e.reposition(),e.__contentBcr=r)}}else e._close()}),e.__options.trackerInterval),e},_close:function(t,a,o){var n=this,i=!0;if(n._trigger({type:"close",event:t,stop:function(){i=!1}}),i||o){a&&n.__callbacks.close.push(a),n.__callbacks.open=[],n.__timeoutsClear();var s=function(){e.each(n.__callbacks.close,(function(e,a){a.call(n,n,{event:t,origin:n._$origin[0]})})),n.__callbacks.close=[]};if("closed"!=n.__state){var l=!0,c=(new Date).getTime()+n.__options.animationDuration[1];if("disappearing"==n.__state&&c>n.__closingTime&&(l=!1),l){n.__closingTime=c,"disappearing"!=n.__state&&n.__stateSet("disappearing");var d=function(){clearInterval(n.__tracker),n._trigger({type:"closing",event:t}),n._$tooltip.off("."+n.__namespace+"-triggerClose").removeClass("tooltipster-dying"),e(r.window).off("."+n.__namespace+"-triggerClose"),n.__$originParents.each((function(t,a){e(a).off("scroll."+n.__namespace+"-triggerClose")})),n.__$originParents=null,e(r.window.document.body).off("."+n.__namespace+"-triggerClose"),n._$origin.off("."+n.__namespace+"-triggerClose"),n._off("dismissable"),n.__stateSet("closed"),n._trigger({type:"after",event:t}),n.__options.functionAfter&&n.__options.functionAfter.call(n,n,{event:t,origin:n._$origin[0]}),s()};r.hasTransitions?(n._$tooltip.css({"-moz-animation-duration":n.__options.animationDuration[1]+"ms","-ms-animation-duration":n.__options.animationDuration[1]+"ms","-o-animation-duration":n.__options.animationDuration[1]+"ms","-webkit-animation-duration":n.__options.animationDuration[1]+"ms","animation-duration":n.__options.animationDuration[1]+"ms","transition-duration":n.__options.animationDuration[1]+"ms"}),n._$tooltip.clearQueue().removeClass("tooltipster-show").addClass("tooltipster-dying"),n.__options.animationDuration[1]>0&&n._$tooltip.delay(n.__options.animationDuration[1]),n._$tooltip.queue(d)):n._$tooltip.stop().fadeOut(n.__options.animationDuration[1],d)}}else s()}return n},_off:function(){return this.__$emitterPrivate.off.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_on:function(){return this.__$emitterPrivate.on.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_one:function(){return this.__$emitterPrivate.one.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_open:function(t,a){var n=this;if(!n.__destroying&&o(n._$origin)&&n.__enabled){var i=!0;if("closed"==n.__state&&(n._trigger({type:"before",event:t,stop:function(){i=!1}}),i&&n.__options.functionBefore&&(i=n.__options.functionBefore.call(n,n,{event:t,origin:n._$origin[0]}))),!1!==i&&null!==n.__Content){a&&n.__callbacks.open.push(a),n.__callbacks.close=[],n.__timeoutsClear();var s,l=function(){"stable"!=n.__state&&n.__stateSet("stable"),e.each(n.__callbacks.open,(function(e,t){t.call(n,n,{origin:n._$origin[0],tooltip:n._$tooltip[0]})})),n.__callbacks.open=[]};if("closed"!==n.__state)s=0,"disappearing"===n.__state?(n.__stateSet("appearing"),r.hasTransitions?(n._$tooltip.clearQueue().removeClass("tooltipster-dying").addClass("tooltipster-show"),n.__options.animationDuration[0]>0&&n._$tooltip.delay(n.__options.animationDuration[0]),n._$tooltip.queue(l)):n._$tooltip.stop().fadeIn(l)):"stable"==n.__state&&l();else{if(n.__stateSet("appearing"),s=n.__options.animationDuration[0],n.__contentInsert(),n.reposition(t,!0),r.hasTransitions?(n._$tooltip.addClass("tooltipster-"+n.__options.animation).addClass("tooltipster-initial").css({"-moz-animation-duration":n.__options.animationDuration[0]+"ms","-ms-animation-duration":n.__options.animationDuration[0]+"ms","-o-animation-duration":n.__options.animationDuration[0]+"ms","-webkit-animation-duration":n.__options.animationDuration[0]+"ms","animation-duration":n.__options.animationDuration[0]+"ms","transition-duration":n.__options.animationDuration[0]+"ms"}),setTimeout((function(){"closed"!=n.__state&&(n._$tooltip.addClass("tooltipster-show").removeClass("tooltipster-initial"),n.__options.animationDuration[0]>0&&n._$tooltip.delay(n.__options.animationDuration[0]),n._$tooltip.queue(l))}),0)):n._$tooltip.css("display","none").fadeIn(n.__options.animationDuration[0],l),n.__trackerStart(),e(r.window).on("resize."+n.__namespace+"-triggerClose",(function(t){var a=e(document.activeElement);(a.is("input")||a.is("textarea"))&&e.contains(n._$tooltip[0],a[0])||n.reposition(t)})).on("scroll."+n.__namespace+"-triggerClose",(function(e){n.__scrollHandler(e)})),n.__$originParents=n._$origin.parents(),n.__$originParents.each((function(t,a){e(a).on("scroll."+n.__namespace+"-triggerClose",(function(e){n.__scrollHandler(e)}))})),n.__options.triggerClose.mouseleave||n.__options.triggerClose.touchleave&&r.hasTouchCapability){n._on("dismissable",(function(e){e.dismissable?e.delay?(p=setTimeout((function(){n._close(e.event)}),e.delay),n.__timeouts.close.push(p)):n._close(e):clearTimeout(p)}));var c=n._$origin,d="",u="",p=null;n.__options.interactive&&(c=c.add(n._$tooltip)),n.__options.triggerClose.mouseleave&&(d+="mouseenter."+n.__namespace+"-triggerClose ",u+="mouseleave."+n.__namespace+"-triggerClose "),n.__options.triggerClose.touchleave&&r.hasTouchCapability&&(d+="touchstart."+n.__namespace+"-triggerClose",u+="touchend."+n.__namespace+"-triggerClose touchcancel."+n.__namespace+"-triggerClose"),c.on(u,(function(e){if(n._touchIsTouchEvent(e)||!n._touchIsEmulatedEvent(e)){var t="mouseleave"==e.type?n.__options.delay:n.__options.delayTouch;n._trigger({delay:t[1],dismissable:!0,event:e,type:"dismissable"})}})).on(d,(function(e){!n._touchIsTouchEvent(e)&&n._touchIsEmulatedEvent(e)||n._trigger({dismissable:!1,event:e,type:"dismissable"})}))}n.__options.triggerClose.originClick&&n._$origin.on("click."+n.__namespace+"-triggerClose",(function(e){n._touchIsTouchEvent(e)||n._touchIsEmulatedEvent(e)||n._close(e)})),(n.__options.triggerClose.click||n.__options.triggerClose.tap&&r.hasTouchCapability)&&setTimeout((function(){if("closed"!=n.__state){var t="",a=e(r.window.document.body);n.__options.triggerClose.click&&(t+="click."+n.__namespace+"-triggerClose "),n.__options.triggerClose.tap&&r.hasTouchCapability&&(t+="touchend."+n.__namespace+"-triggerClose"),a.on(t,(function(t){n._touchIsMeaningfulEvent(t)&&(n._touchRecordEvent(t),n.__options.interactive&&e.contains(n._$tooltip[0],t.target)||n._close(t))})),n.__options.triggerClose.tap&&r.hasTouchCapability&&a.on("touchstart."+n.__namespace+"-triggerClose",(function(e){n._touchRecordEvent(e)}))}}),0),n._trigger("ready"),n.__options.functionReady&&n.__options.functionReady.call(n,n,{origin:n._$origin[0],tooltip:n._$tooltip[0]})}if(n.__options.timer>0){p=setTimeout((function(){n._close()}),n.__options.timer+s);n.__timeouts.close.push(p)}}}return n},_openShortly:function(e){var t=this,a=!0;if("stable"!=t.__state&&"appearing"!=t.__state&&!t.__timeouts.open&&(t._trigger({type:"start",event:e,stop:function(){a=!1}}),a)){var o=0==e.type.indexOf("touch")?t.__options.delayTouch:t.__options.delay;o[0]?t.__timeouts.open=setTimeout((function(){t.__timeouts.open=null,t.__pointerIsOverOrigin&&t._touchIsMeaningfulEvent(e)?(t._trigger("startend"),t._open(e)):t._trigger("startcancel")}),o[0]):(t._trigger("startend"),t._open(e))}return t},_optionsExtract:function(t,a){var o=this,n=e.extend(!0,{},a),i=o.__options[t];return i||(i={},e.each(a,(function(e,t){var a=o.__options[e];void 0!==a&&(i[e]=a)}))),e.each(n,(function(t,a){void 0!==i[t]&&("object"!=typeof a||a instanceof Array||null==a||"object"!=typeof i[t]||i[t]instanceof Array||null==i[t]?n[t]=i[t]:e.extend(n[t],i[t]))})),n},_plug:function(t){var a=e.tooltipster._plugin(t);if(!a)throw new Error('The "'+t+'" plugin is not defined');return a.instance&&e.tooltipster.__bridge(a.instance,this,a.name),this},_touchIsEmulatedEvent:function(e){for(var t=!1,a=(new Date).getTime(),o=this.__touchEvents.length-1;o>=0;o--){var n=this.__touchEvents[o];if(!(a-n.time<500))break;n.target===e.target&&(t=!0)}return t},_touchIsMeaningfulEvent:function(e){return this._touchIsTouchEvent(e)&&!this._touchSwiped(e.target)||!this._touchIsTouchEvent(e)&&!this._touchIsEmulatedEvent(e)},_touchIsTouchEvent:function(e){return 0==e.type.indexOf("touch")},_touchRecordEvent:function(e){return this._touchIsTouchEvent(e)&&(e.time=(new Date).getTime(),this.__touchEvents.push(e)),this},_touchSwiped:function(e){for(var t=!1,a=this.__touchEvents.length-1;a>=0;a--){var o=this.__touchEvents[a];if("touchmove"==o.type){t=!0;break}if("touchstart"==o.type&&e===o.target)break}return t},_trigger:function(){var t=Array.prototype.slice.apply(arguments);return"string"==typeof t[0]&&(t[0]={type:t[0]}),t[0].instance=this,t[0].origin=this._$origin?this._$origin[0]:null,t[0].tooltip=this._$tooltip?this._$tooltip[0]:null,this.__$emitterPrivate.trigger.apply(this.__$emitterPrivate,t),e.tooltipster._trigger.apply(e.tooltipster,t),this.__$emitterPublic.trigger.apply(this.__$emitterPublic,t),this},_unplug:function(t){var a=this;if(a[t]){var o=e.tooltipster._plugin(t);o.instance&&e.each(o.instance,(function(e,o){a[e]&&a[e].bridged===a[t]&&delete a[e]})),a[t].__destroy&&a[t].__destroy(),delete a[t]}return a},close:function(e){return this.__destroyed?this.__destroyError():this._close(null,e),this},content:function(e){var t=this;if(void 0===e)return t.__Content;if(t.__destroyed)t.__destroyError();else if(t.__contentSet(e),null!==t.__Content){if("closed"!==t.__state&&(t.__contentInsert(),t.reposition(),t.__options.updateAnimation))if(r.hasTransitions){var a=t.__options.updateAnimation;t._$tooltip.addClass("tooltipster-update-"+a),setTimeout((function(){"closed"!=t.__state&&t._$tooltip.removeClass("tooltipster-update-"+a)}),1e3)}else t._$tooltip.fadeTo(200,.5,(function(){"closed"!=t.__state&&t._$tooltip.fadeTo(200,1)}))}else t._close();return t},destroy:function(){var t=this;if(t.__destroyed)t.__destroyError();else{"closed"!=t.__state&&t.option("animationDuration",0)._close(null,null,!0),t._trigger("destroy"),t.__destroyed=!0,t._$origin.removeData(t.__namespace).off("."+t.__namespace+"-triggerOpen"),e(r.window.document.body).off("."+t.__namespace+"-triggerOpen");var a=t._$origin.data("tooltipster-ns");if(a)if(1===a.length){var o=null;"previous"==t.__options.restoration?o=t._$origin.data("tooltipster-initialTitle"):"current"==t.__options.restoration&&(o="string"==typeof t.__Content?t.__Content:e("<div></div>").append(t.__Content).html()),o&&t._$origin.attr("title",o),t._$origin.removeClass("tooltipstered"),t._$origin.removeData("tooltipster-ns").removeData("tooltipster-initialTitle")}else a=e.grep(a,(function(e,a){return e!==t.__namespace})),t._$origin.data("tooltipster-ns",a);t._trigger("destroyed"),t._off(),t.off(),t.__Content=null,t.__$emitterPrivate=null,t.__$emitterPublic=null,t.__options.parent=null,t._$origin=null,t._$tooltip=null,e.tooltipster.__instancesLatestArr=e.grep(e.tooltipster.__instancesLatestArr,(function(e,a){return t!==e})),clearInterval(t.__garbageCollector)}return t},disable:function(){return this.__destroyed?(this.__destroyError(),this):(this._close(),this.__enabled=!1,this)},elementOrigin:function(){return this.__destroyed?void this.__destroyError():this._$origin[0]},elementTooltip:function(){return this._$tooltip?this._$tooltip[0]:null},enable:function(){return this.__enabled=!0,this},hide:function(e){return this.close(e)},instance:function(){return this},off:function(){return this.__destroyed||this.__$emitterPublic.off.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},on:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.on.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},one:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.one.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},open:function(e){return this.__destroyed?this.__destroyError():this._open(null,e),this},option:function(t,a){return void 0===a?this.__options[t]:(this.__destroyed?this.__destroyError():(this.__options[t]=a,this.__optionsFormat(),e.inArray(t,["trigger","triggerClose","triggerOpen"])>=0&&this.__prepareOrigin(),"selfDestruction"===t&&this.__prepareGC()),this)},reposition:function(e,t){var a=this;return a.__destroyed?a.__destroyError():"closed"!=a.__state&&o(a._$origin)&&(t||o(a._$tooltip))&&(t||a._$tooltip.detach(),a.__Geometry=a.__geometry(),a._trigger({type:"reposition",event:e,helper:{geo:a.__Geometry}})),a},show:function(e){return this.open(e)},status:function(){return{destroyed:this.__destroyed,enabled:this.__enabled,open:"closed"!==this.__state,state:this.__state}},triggerHandler:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.triggerHandler.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this}},e.fn.tooltipster=function(){var t=Array.prototype.slice.apply(arguments),a="You are using a single HTML element as content for several tooltips. You probably want to set the contentCloning option to TRUE.";if(0===this.length)return this;if("string"==typeof t[0]){var o="#*$~&";return this.each((function(){var n=e(this).data("tooltipster-ns"),i=n?e(this).data(n[0]):null;if(!i)throw new Error("You called Tooltipster's \""+t[0]+'" method on an uninitialized element');if("function"!=typeof i[t[0]])throw new Error('Unknown method "'+t[0]+'"');this.length>1&&"content"==t[0]&&(t[1]instanceof e||"object"==typeof t[1]&&null!=t[1]&&t[1].tagName)&&!i.__options.contentCloning&&i.__options.debug&&console.log(a);var r=i[t[0]](t[1],t[2]);return r!==i||"instance"===t[0]?(o=r,!1):void 0})),"#*$~&"!==o?o:this}e.tooltipster.__instancesLatestArr=[];var i=t[0]&&void 0!==t[0].multiple,r=i&&t[0].multiple||!i&&n.multiple,s=t[0]&&void 0!==t[0].content,l=s&&t[0].content||!s&&n.content,c=t[0]&&void 0!==t[0].contentCloning,d=c&&t[0].contentCloning||!c&&n.contentCloning,u=t[0]&&void 0!==t[0].debug,p=u&&t[0].debug||!u&&n.debug;return this.length>1&&(l instanceof e||"object"==typeof l&&null!=l&&l.tagName)&&!d&&p&&console.log(a),this.each((function(){var a=!1,o=e(this),n=o.data("tooltipster-ns"),i=null;n?r?a=!0:p&&(console.log("Tooltipster: one or more tooltips are already attached to the element below. Ignoring."),console.log(this)):a=!0,a&&(i=new e.Tooltipster(this,t[0]),n||(n=[]),n.push(i.__namespace),o.data("tooltipster-ns",n),o.data(i.__namespace,i),i.__options.functionInit&&i.__options.functionInit.call(i,i,{origin:this}),i._trigger("init")),e.tooltipster.__instancesLatestArr.push(i)})),this},t.prototype={__init:function(t){this.__$tooltip=t,this.__$tooltip.css({left:0,overflow:"hidden",position:"absolute",top:0}).find(".tooltipster-content").css("overflow","auto"),this.$container=e('<div class="tooltipster-ruler"></div>').append(this.__$tooltip).appendTo(r.window.document.body)},__forceRedraw:function(){var e=this.__$tooltip.parent();this.__$tooltip.detach(),this.__$tooltip.appendTo(e)},constrain:function(e,t){return this.constraints={width:e,height:t},this.__$tooltip.css({display:"block",height:"",overflow:"auto",width:e}),this},destroy:function(){this.__$tooltip.detach().find(".tooltipster-content").css({display:"",overflow:""}),this.$container.remove()},free:function(){return this.constraints=null,this.__$tooltip.css({display:"",height:"",overflow:"visible",width:""}),this},measure:function(){this.__forceRedraw();var e=this.__$tooltip[0].getBoundingClientRect(),t={size:{height:e.height||e.bottom,width:e.width||e.right}};if(this.constraints){var a=this.__$tooltip.find(".tooltipster-content"),o=this.__$tooltip.outerHeight(),n=a[0].getBoundingClientRect(),i={height:o<=this.constraints.height,width:e.width<=this.constraints.width&&n.width>=a[0].scrollWidth-1};t.fits=i.height&&i.width}return r.IE&&r.IE<=11&&t.size.width!==r.window.document.documentElement.clientWidth&&(t.size.width=Math.ceil(t.size.width)+1),t}};var l=navigator.userAgent.toLowerCase();-1!=l.indexOf("msie")?r.IE=parseInt(l.split("msie")[1]):-1!==l.toLowerCase().indexOf("trident")&&-1!==l.indexOf(" rv:11")?r.IE=11:-1!=l.toLowerCase().indexOf("edge/")&&(r.IE=parseInt(l.toLowerCase().split("edge/")[1]));var c="tooltipster.sideTip";return e.tooltipster._plugin({name:c,instance:{__defaults:function(){return{arrow:!0,distance:6,functionPosition:null,maxWidth:null,minIntersection:16,minWidth:0,position:null,side:"top",viewportAware:!0}},__init:function(e){var t=this;t.__instance=e,t.__namespace="tooltipster-sideTip-"+Math.round(1e6*Math.random()),t.__previousState="closed",t.__options,t.__optionsFormat(),t.__instance._on("state."+t.__namespace,(function(e){"closed"==e.state?t.__close():"appearing"==e.state&&"closed"==t.__previousState&&t.__create(),t.__previousState=e.state})),t.__instance._on("options."+t.__namespace,(function(){t.__optionsFormat()})),t.__instance._on("reposition."+t.__namespace,(function(e){t.__reposition(e.event,e.helper)}))},__close:function(){this.__instance.content()instanceof e&&this.__instance.content().detach(),this.__instance._$tooltip.remove(),this.__instance._$tooltip=null},__create:function(){var t=e('<div class="tooltipster-base tooltipster-sidetip"><div class="tooltipster-box"><div class="tooltipster-content"></div></div><div class="tooltipster-arrow"><div class="tooltipster-arrow-uncropped"><div class="tooltipster-arrow-border"></div><div class="tooltipster-arrow-background"></div></div></div></div>');this.__options.arrow||t.find(".tooltipster-box").css("margin",0).end().find(".tooltipster-arrow").hide(),this.__options.minWidth&&t.css("min-width",this.__options.minWidth+"px"),this.__options.maxWidth&&t.css("max-width",this.__options.maxWidth+"px"),this.__instance._$tooltip=t,this.__instance._trigger("created")},__destroy:function(){this.__instance._off("."+self.__namespace)},__optionsFormat:function(){var t=this;if(t.__options=t.__instance._optionsExtract(c,t.__defaults()),t.__options.position&&(t.__options.side=t.__options.position),"object"!=typeof t.__options.distance&&(t.__options.distance=[t.__options.distance]),t.__options.distance.length<4&&(void 0===t.__options.distance[1]&&(t.__options.distance[1]=t.__options.distance[0]),void 0===t.__options.distance[2]&&(t.__options.distance[2]=t.__options.distance[0]),void 0===t.__options.distance[3]&&(t.__options.distance[3]=t.__options.distance[1]),t.__options.distance={top:t.__options.distance[0],right:t.__options.distance[1],bottom:t.__options.distance[2],left:t.__options.distance[3]}),"string"==typeof t.__options.side){t.__options.side=[t.__options.side,{top:"bottom",right:"left",bottom:"top",left:"right"}[t.__options.side]],"left"==t.__options.side[0]||"right"==t.__options.side[0]?t.__options.side.push("top","bottom"):t.__options.side.push("right","left")}6===e.tooltipster._env.IE&&!0!==t.__options.arrow&&(t.__options.arrow=!1)},__reposition:function(t,a){var o,n=this,i=n.__targetFind(a),r=[];n.__instance._$tooltip.detach();var s=n.__instance._$tooltip.clone(),l=e.tooltipster._getRuler(s),c=!1,d=n.__instance.option("animation");switch(d&&s.removeClass("tooltipster-"+d),e.each(["window","document"],(function(o,d){var u=null;if(n.__instance._trigger({container:d,helper:a,satisfied:c,takeTest:function(e){u=e},results:r,type:"positionTest"}),1==u||0!=u&&0==c&&("window"!=d||n.__options.viewportAware))for(o=0;o<n.__options.side.length;o++){var p={horizontal:0,vertical:0},m=n.__options.side[o];"top"==m||"bottom"==m?p.vertical=n.__options.distance[m]:p.horizontal=n.__options.distance[m],n.__sideChange(s,m),e.each(["natural","constrained"],(function(e,o){if(u=null,n.__instance._trigger({container:d,event:t,helper:a,mode:o,results:r,satisfied:c,side:m,takeTest:function(e){u=e},type:"positionTest"}),1==u||0!=u&&0==c){var s={container:d,distance:p,fits:null,mode:o,outerSize:null,side:m,size:null,target:i[m],whole:null},g=("natural"==o?l.free():l.constrain(a.geo.available[d][m].width-p.horizontal,a.geo.available[d][m].height-p.vertical)).measure();if(s.size=g.size,s.outerSize={height:g.size.height+p.vertical,width:g.size.width+p.horizontal},"natural"==o?a.geo.available[d][m].width>=s.outerSize.width&&a.geo.available[d][m].height>=s.outerSize.height?s.fits=!0:s.fits=!1:s.fits=g.fits,"window"==d&&(s.fits?s.whole="top"==m||"bottom"==m?a.geo.origin.windowOffset.right>=n.__options.minIntersection&&a.geo.window.size.width-a.geo.origin.windowOffset.left>=n.__options.minIntersection:a.geo.origin.windowOffset.bottom>=n.__options.minIntersection&&a.geo.window.size.height-a.geo.origin.windowOffset.top>=n.__options.minIntersection:s.whole=!1),r.push(s),s.whole)c=!0;else if("natural"==s.mode&&(s.fits||s.size.width<=a.geo.available[d][m].width))return!1}}))}})),n.__instance._trigger({edit:function(e){r=e},event:t,helper:a,results:r,type:"positionTested"}),r.sort((function(e,t){if(e.whole&&!t.whole)return-1;if(!e.whole&&t.whole)return 1;if(e.whole&&t.whole){var a=n.__options.side.indexOf(e.side);return(o=n.__options.side.indexOf(t.side))>a?-1:a>o?1:"natural"==e.mode?-1:1}if(e.fits&&!t.fits)return-1;if(!e.fits&&t.fits)return 1;if(e.fits&&t.fits){var o;a=n.__options.side.indexOf(e.side);return(o=n.__options.side.indexOf(t.side))>a?-1:a>o?1:"natural"==e.mode?-1:1}return"document"==e.container&&"bottom"==e.side&&"natural"==e.mode?-1:1})),(o=r[0]).coord={},o.side){case"left":case"right":o.coord.top=Math.floor(o.target-o.size.height/2);break;case"bottom":case"top":o.coord.left=Math.floor(o.target-o.size.width/2)}switch(o.side){case"left":o.coord.left=a.geo.origin.windowOffset.left-o.outerSize.width;break;case"right":o.coord.left=a.geo.origin.windowOffset.right+o.distance.horizontal;break;case"top":o.coord.top=a.geo.origin.windowOffset.top-o.outerSize.height;break;case"bottom":o.coord.top=a.geo.origin.windowOffset.bottom+o.distance.vertical}"window"==o.container?"top"==o.side||"bottom"==o.side?o.coord.left<0?a.geo.origin.windowOffset.right-this.__options.minIntersection>=0?o.coord.left=0:o.coord.left=a.geo.origin.windowOffset.right-this.__options.minIntersection-1:o.coord.left>a.geo.window.size.width-o.size.width&&(a.geo.origin.windowOffset.left+this.__options.minIntersection<=a.geo.window.size.width?o.coord.left=a.geo.window.size.width-o.size.width:o.coord.left=a.geo.origin.windowOffset.left+this.__options.minIntersection+1-o.size.width):o.coord.top<0?a.geo.origin.windowOffset.bottom-this.__options.minIntersection>=0?o.coord.top=0:o.coord.top=a.geo.origin.windowOffset.bottom-this.__options.minIntersection-1:o.coord.top>a.geo.window.size.height-o.size.height&&(a.geo.origin.windowOffset.top+this.__options.minIntersection<=a.geo.window.size.height?o.coord.top=a.geo.window.size.height-o.size.height:o.coord.top=a.geo.origin.windowOffset.top+this.__options.minIntersection+1-o.size.height):(o.coord.left>a.geo.window.size.width-o.size.width&&(o.coord.left=a.geo.window.size.width-o.size.width),o.coord.left<0&&(o.coord.left=0)),n.__sideChange(s,o.side),a.tooltipClone=s[0],a.tooltipParent=n.__instance.option("parent").parent[0],a.mode=o.mode,a.whole=o.whole,a.origin=n.__instance._$origin[0],a.tooltip=n.__instance._$tooltip[0],delete o.container,delete o.fits,delete o.mode,delete o.outerSize,delete o.whole,o.distance=o.distance.horizontal||o.distance.vertical;var u,p,m,g=e.extend(!0,{},o);if(n.__instance._trigger({edit:function(e){o=e},event:t,helper:a,position:g,type:"position"}),n.__options.functionPosition){var h=n.__options.functionPosition.call(n,n.__instance,a,g);h&&(o=h)}l.destroy(),"top"==o.side||"bottom"==o.side?(u={prop:"left",val:o.target-o.coord.left},p=o.size.width-this.__options.minIntersection):(u={prop:"top",val:o.target-o.coord.top},p=o.size.height-this.__options.minIntersection),u.val<this.__options.minIntersection?u.val=this.__options.minIntersection:u.val>p&&(u.val=p),m=a.geo.origin.fixedLineage?a.geo.origin.windowOffset:{left:a.geo.origin.windowOffset.left+a.geo.window.scroll.left,top:a.geo.origin.windowOffset.top+a.geo.window.scroll.top},o.coord={left:m.left+(o.coord.left-a.geo.origin.windowOffset.left),top:m.top+(o.coord.top-a.geo.origin.windowOffset.top)},n.__sideChange(n.__instance._$tooltip,o.side),a.geo.origin.fixedLineage?n.__instance._$tooltip.css("position","fixed"):n.__instance._$tooltip.css("position",""),n.__instance._$tooltip.css({left:o.coord.left,top:o.coord.top,height:o.size.height,width:o.size.width}).find(".tooltipster-arrow").css({left:"",top:""}).css(u.prop,u.val),n.__instance._$tooltip.appendTo(n.__instance.option("parent")),n.__instance._trigger({type:"repositioned",event:t,position:o})},__sideChange:function(e,t){e.removeClass("tooltipster-bottom").removeClass("tooltipster-left").removeClass("tooltipster-right").removeClass("tooltipster-top").addClass("tooltipster-"+t)},__targetFind:function(e){var t={},a=this.__instance._$origin[0].getClientRects();a.length>1&&(1==this.__instance._$origin.css("opacity")&&(this.__instance._$origin.css("opacity",.99),a=this.__instance._$origin[0].getClientRects(),this.__instance._$origin.css("opacity",1)));if(a.length<2)t.top=Math.floor(e.geo.origin.windowOffset.left+e.geo.origin.size.width/2),t.bottom=t.top,t.left=Math.floor(e.geo.origin.windowOffset.top+e.geo.origin.size.height/2),t.right=t.left;else{var o=a[0];t.top=Math.floor(o.left+(o.right-o.left)/2),o=a.length>2?a[Math.ceil(a.length/2)-1]:a[0],t.right=Math.floor(o.top+(o.bottom-o.top)/2),o=a[a.length-1],t.bottom=Math.floor(o.left+(o.right-o.left)/2),o=a.length>2?a[Math.ceil((a.length+1)/2)-1]:a[a.length-1],t.left=Math.floor(o.top+(o.bottom-o.top)/2)}return t}}}),e})),$(document).ready((function(){if($("#slider").length>0){if($("#slider").slider({max:3,min:.3,value:1,step:.05,slide:slideFunc,stop:slideStop}),$("#slider").on("dblclick",(()=>{changeZoom(1),localStorage.removeItem("zoomTablon"+tablonActual)})),isMobile()&&"undefined"!=typeof Hammer){var e=new Hammer(document.getElementById("slider"));e.get("tap").set({enable:!0,taps:2}),e.on("tap",(function(){changeZoom(1),localStorage.removeItem("zoomTablon"+tablonActual)}))}restoreBoardZoom()}}));var zoomAnt,zoomTabHeight,zoomTabWidth,zoomMaxHeight,zoomScrollTop,zoomScrollLeft,zoomGlobal=1,zoomTopAdjust=0,zoomLeftAdjust=0;function slideFunc(e,t){0!==$(".ui-slider-handle").length&&(1!==(zoomGlobal=t.value)||isTransformActive()?(e&&(localStorage["zoomTablon"+tablonActual]=zoomGlobal),$("#nivelZoom").show(),$("#nivelZoom").text("ZOOM: "+parseInt(100*zoomGlobal)+"%"),$(".ui-slider-handle").html("<span>"+parseInt(100*zoomGlobal)+"%</span>"),1==zoomGlobal?(zoomTopAdjust=0,zoomLeftAdjust=0):(zoomTopAdjust=20/zoomGlobal,zoomLeftAdjust=5/zoomGlobal),$("#Postits").css({transform:"scale("+zoomGlobal+")","transform-origin":"top left",top:zoomTopAdjust,left:zoomLeftAdjust}),zoomGlobal>.8&&1!=zoomGlobal?$(".parteSuperior img, .parteSuperior i, .parteSuperior button").css({transform:"scale("+1/zoomGlobal+")","transform-origin":"top center"}):$(".parteSuperior img, .parteSuperior i, .parteSuperior button").css({transform:"none"}),esTablonKanban()&&1!=zoomGlobal&&setTimeout((()=>{$(".tablonPostits").width($("#Postits").width()*zoomGlobal),$(".tablonPostits").height($("#Postits").height()*zoomGlobal)}),800),cambiaMaquetaPant(),refreshConnections()):$(".ui-slider-handle").html("<span>"+parseInt(100*zoomGlobal)+"%</span>"))}function isTransformActive(){var e=document.querySelector("#Postits");try{return"none"!=(window.getComputedStyle(e,null)&&window.getComputedStyle(e,null).getPropertyValue("transform"))}catch(e){console.log(e)}}function slideStop(){inicializaTablonMasonry(),refreshConnections(),muestraAyudaSnackbar("helpZoomDblClick"),$("#nivelZoom").fadeOut(600)}function iniZoom(e){0!==$(".ui-slider-handle").length&&hayZoom()&&(changeZoom(1),e&&iraNota(e,!1))}function changeZoom(e){0!==$(".ui-slider-handle").length&&(slideFunc(null,{value:e}),$("#slider").slider("value",e),$("#nivelZoom").hide())}function hayZoom(){return 1!=zoomGlobal}function restoreBoardZoom(e=tablonActual){localStorage["zoomTablon"+e]?changeZoom(localStorage["zoomTablon"+e]):changeZoom(1)}function restoreBoardScroll(){null!=zoomScrollLeft&&null!=zoomScrollTop&&window.scrollTo(zoomScrollLeft,zoomScrollTop)}function hayAlgunaNotaConZoom(){return $("#Postits").find("[data-zoomed='true']").length>0}function zoomNota(e,t,a,o){if(t=t||e&&e.target.id.substr(7)){if("postitnuevo"==t)var n=$("#postitnuevo");else n=$("#postit"+t);if(0!=n.length){if("true"==n.attr("data-zoomed")||a)"true"==n.attr("data-zoomed")&&(quitaZoom(t),$("#floating-button").show(),$(".columna").show(),$(".leader-line").show(),$(".minimizaTool").show(),restoreBoardScroll(),isMobile&&(isChromeExtension()||removeScalable(),window.location.hash=""));else{muestraAyudaSnackbar("ayudaZoom","info"),iniZoom(),$(".postitNB").each((function(){$(this).attr("id")!="postit"+t&&"postitnuevo"!=$(this).attr("id")&&$(this).hide()})),zoomScrollTop=$(document).scrollTop(),zoomScrollLeft=$(document).scrollLeft(),window.scrollTo(0,0),n.attr("data-zoomed","true"),$(".botones, #canvasDiv, .btn-crea-nota").hide(),esTablonKanban()&&n.prependTo("#Postits"),n.addClass("zoomed"),zoomTabHeight=$(".tablonPostits").height(),zoomTabWidth=$(".tablonPostits").width(),document.getElementById("texto"+t)&&(document.getElementById("texto"+t).style.height=""),$(".tablonPostits").width(window.innerWidth-14),$("#Postits").width(window.innerWidth-14),"postitnuevo"!=t&&(esTablonKanban()||n.draggable("disable"),n.removeClass("ui-state-disabled")),$("#zoomImg"+t).attr("src","appimg/zoomOut.png"),$("#borr"+t).hide(),$("#moverImg"+t).hide(),$("#connectImg"+t).hide(),"true"==localStorage["masonry"+localStorage.tablonActual]&&$("#Postits").css("padding-top",0);var i=$("#texto"+t);zoomMaxHeight=i.css("maxHeight"),i.css("maxHeight","50000px"),!o&&n.height()<window.innerHeight&&n.height(window.innerHeight),o?($(".tablonPostits").height(window.innerHeight),$("#Postits").height(window.innerHeight)):($(".tablonPostits").height(n.height()),$("#Postits").height(n.height())),n.find(".nuevoLink").length&&(i.removeClass("classTransparent"),n.find(".nuevoLink").remove()),$("#floating-button").hide(),$(".columna").hide(),$(".leader-line").hide(),$(".minimizaTool").hide(),isMobile()&&hideParteSuperior(t),$(document).on("keyup",(function(e){27==e.keyCode&&quitaZoom(t)})),isMobile()&&(isChromeExtension()||addScalable(),window.location.hash="zoomed")}resizeIframes(t,window.innerWidth,$("#postit"+t).height()),hightlightCode(),$("#grupoIconosSinMarco"+t).hide()}}}function quitaZoom(e){if(!esPopup()){if("postitnuevo"==e)var t=$("#postitnuevo");else{t=$("#postit"+e);esTablonKanban()||t.draggable("enable")}removeScalable(),t.attr("data-zoomed")&&(t.attr("data-zoomed","false"),$(".botones, #canvasDiv, .btn-crea-nota, .minimizaTool").show(),$(".tablonPostits").width(zoomTabWidth),$("#Postits").width(zoomTabWidth),$(".tablonPostits").height(zoomTabHeight),$("#Postits").height(zoomTabHeight),$(".columna").show(),$(".leader-line").show(),$(".postitNB").each((function(){$(this).attr("id")!="postit"+e&&"postitnuevo"!=$(this).attr("id")&&$(this).show()})),zoomMaxHeight&&$("texto"+e).css("maxHeight",zoomMaxHeight),recalculaPaddingMasonry(),"postitnuevo"!=e?(refrescaNota(e),refrescaOrdenacion(),ordenaPostitsKanban()):t.hide(),$(document).off("keyup"),t.removeClass("zoomed"),restoreBoardZoom(),restoreBoardScroll())}}function quitaZoomNotas(){removeScalable(),$("[data-zoomed=true]").each((function(e){if(0==$("iframe[id *= textAreaE]").length){if("postitnuevo"==$(this).attr("id"))var t="postitnuevo";else t=$(this).attr("id").substr(6);quitaZoom(t)}})),restoreBoardScroll(),window.location.hash=""}function notaTieneZoom(e){return $("#postit"+e).attr("data-zoomed")}function toggleMinimizaNota(e){$("#postit"+e).hasClass("postit-min")?quitaMinimizado(e):aplicaMinimizado(e),updateNotaMemo(e),cambiaIcono()}function aplicaMinimizado(e){$("#postit"+e).addClass("postit-min").css("border-color",defaultColorContrastBackground),$("#minimizaImg"+e).attr("src","appimg/zoomIn.png"),localStorage["minimizado"+e]="true",setTimeout((function(){refreshConnections(),refrescaOrdenacion()}),400)}function quitaMinimizado(e,t){$("#postit"+e).hasClass("postit-min")&&($("#postit"+e).removeClass("postit-min"),$("#minimizaImg"+e).attr("src","appimg/zoomOut.png"),!t&&localStorage.removeItem("minimizado"+e),setTimeout((function(){$("#postit"+e).height()>1500&&refrescaNota(e),refreshConnections(),refrescaOrdenacion()}),400),restoreBoardZoom())}var modalInstance,DEFAULT_KANBAN=["Todo","Doing","Done"];function muestraDialogoKanban(){salSiPapelera()||abrirPantallaModal(obtenerFormularioKanban(),{onOpenStart:function(){var e={data:crearTagData(getKanbanList()),placeholder:"Introduce mÃ¡s Columnas",secondaryPlaceholder:"+Tag",limit:8};M.Chips.init(document.getElementById("chips"),e),$("#quitar-kanban").off().on("click",quitarTablonKanban),$("#aceptar-kanban").off().on("click",hazTablonKanban),$(".chips").sortable()},height:"60%",minHeight:380,maxHeight:450,maxWidth:750})}function crearTagData(e){return e.map((e=>({tag:e})))}function getKanbanList(e=tablonActual){var t=[];try{if(esTablonKanban(tablonActual))t=JSON.parse(localStorage["tablonKanban"+e]).kanbanList;else t=DEFAULT_KANBAN}catch(e){console.log(e)}return t}function getKanbanWidths(e=tablonActual){var t=[];try{if(esTablonKanban(e))t=JSON.parse(localStorage["tablonKanban"+e]).widths}catch(e){console.log(e)}return t}function quitarTablonKanban(){localStorage.removeItem("tablonKanban"+tablonActual),modalInstance.close(),quitarColumnaKanbanPostis(tablonActual),borraKanban(),refrescaPantalla(),grabaTablones()}function hazTablonKanban(e){if(isPremiumUser()){var t=getSortedChipsData();localStorage["tablonKanban"+tablonActual]=JSON.stringify({kanbanList:t,kanbanOrder:[]}),modalInstance.close(),inicializaKanban(),refrescaPantalla(),grabaTablones()}else muestraMensajeHaztePremium()}function getSortedChipsData(){var e=[];return $("#chips").find("i").remove(),$(".chip").each((function(){e.push($(this).text())})),e}function esTablonKanban(e=tablonActual){return!esPopup()&&!!localStorage["tablonKanban"+e]}function esTablonKanbanCompartido(e=tablonActual){var t=getTablonCompartido(e);return t&&t.tabKanban}function inicializaKanban(){if(esTablonKanban()){$("#kanbanBot").addClass("selected"),quitaMasonry(),$(".columna-wrapper").remove();var e=getKanbanList(),t=e.length;quitaMasonry();for(var a=0;a<t;a++)$("#Postits").append(`\n      <div class="columna-wrapper">\n        <div class="titulo-kanban teal darken-3">\n          ${e[a]}\n          <span class="contenedor-contador-kanban">\n            - <span class="contador-kanban">${numeroNotasEnColumna(a)}</span>\n          </span>\n          <a class="add-kanba-note btn-floating btn-small waves-effect waves-light teal lighten-1 right mdc-elevation--z10"\n            data-col="${a}" title="${chrome.i18n.getMessage("addKanbanNote")}">\n            <i class="material-icons">add</i>\n          </a>\n        </div>\n        <div class="columna" data-colid = ${a} id="columna${a}"></div>\n      </div>\n    `);isChromeExtension()?$(".columna-wrapper").width(100/t-1+"%"):$(".columna-wrapper").width(100/t+"%");var o=getKanbanWidths();if(o){for(a=0;a<o.length;a++)o[a]&&$(".columna-wrapper").eq(a).width(o[a]);$("#Postits, .tablonPostits").width(getTotalWidth(o))}else $("#Postits, .tablonPostits").width(($(".columna-wrapper").width()+1)*t);$(".columna-wrapper").resizable({minWidth:400,resize:kanbanResize,stop:function(){grabaTablones(),muestraAyudaSnackbar("helpKanbanResize")}}),asignaPosicionTituloKanban(),$(".columna-wrapper").css("borderColor",defaultColorContrastBackground),$(".add-kanba-note").on("click",(function(e){muestraEditorNuevaNota(e.pageX-$(".columna").width(),e.pageY+$(".titulo-kanban ").height(),$(this).data("col"))})),$(".columna-wrapper .titulo-kanban").first().on("dblclick",mueveNotaRandom),$(".columna").off().on("scroll",(function(e){refreshConnections(),cambiaMaquetaPant(e)})),$(".columna-wrapper .ui-resizable-handle").on("dblclick",(function(e){borraWidths(),isChromeExtension()?$(".columna-wrapper").width(100/t-1+"%"):$(".columna-wrapper").width(100/t+"%"),refrescaKanban(),refreshConnections(),grabaTablones(),cambiaIcono(!1,!0)})),isKanbanBugsBoard()&&($(".add-kanba-note").hide(),$(".add-kanba-note")[0].style.display="block",$(".add-kanba-note")[1].style.display="block")}else $("#kanbanBot").removeClass("selected")}function borraKanban(){$(".columna").length>0&&$(".columna-wrapper").remove(),$("#kanbanBot").removeClass("selected")}function refrescaKanban(){if(esTablonKanban()&&!cambioTablon.sliding){if($(".columna").height(window.innerHeight-$(".botones").height()-$(".titulo-kanban").height()-30),$("#Postits").height(window.innerHeight),getKanbanWidths())getTotalWidth()<window.innerWidth?$(".tablonPostits").width(window.innerWidth):$(".tablonPostits").width(getTotalWidth()),isChromeExtension(),$(".tablonPostits").height(window.innerHeight).addClass("tablon-kanban");else isChromeExtension()?$(".tablonPostits").width(window.innerWidth-3).height(window.innerHeight-3).addClass("tablon-kanban"):$(".tablonPostits").width(window.innerWidth).height(window.innerHeight).addClass("tablon-kanban"),$("#Postits").width($(".tablonPostits").width()).width(($(".columna").width()+1)*$(".columna").length);$(".titulo-kanban").show(),$(".columna-wrapper").css("borderColor",defaultColorContrastBackground),refrescaContadoresKanban(),asignaPosicionTituloKanban(),ordenaPostitsKanban()}}function asignaPosicionTituloKanban(){const e=isMovilApp()?-5:5;$(".columna-wrapper").css("padding-top",$(".botones").height()+e)}function getMaxPostitWidth(){return parseInt($("#Postits").outerWidth()/$(".columna").length)-80}function getColumnPostit(e){return parseInt($("#postit"+e).closest(".columna").attr("data-colid"))}function getColumnPosition(e){return parseInt(e/($(".tablonPostits").width()/$(".columna").length))}function getLeftCoordColum(e){return parseInt($(".tablonPostits").outerWidth()/$(".columna").length*e)}function getKanbanColumnNumber(e=tablonActual){return getKanbanList(e).length}function quitarColumnaKanbanPostis(e=tablonActual){for(var t=0;t<localStorage.totalPost;t++)localStorage["tablon"+t]==e&&(localStorage.removeItem("columnaKanban"+t),isUserConnected()&&null==localStorage["userComp"+t]&&updateNotaLoginMemo(t))}function coordenadaXEnTablonKanban(e){var t=parseInt(localStorage["X"+e]),a=parseInt(localStorage["columnaKanban"+e]);if(getColumnPostit(e)!=a)t=a?getLeftCoordColum(a)+20:20;else{var o=$("#columna0").width();t+$("#postit"+e).outerWidth()>o*(a+1)&&(t=getLeftCoordColum(a)+20)}return t}function ajustaPostistSegunColumna(){if(esTablonKanban()){for(var e=0;e<localStorage.totalPost;e++)if(localStorage["tablon"+e]==tablonActual){var t=coordenadaXEnTablonKanban(e);t!=localStorage["X"+e]&&(localStorage["X"+e]=t,updateNotaMemo(e),$("#postit"+e).offset({left:t}))}refreshConnections()}}function refrescaContadoresKanban(){$(".titulo-kanban").each((function(e){$(this).find(".contador-kanban").text(numeroNotasEnColumna(e))}))}function numeroNotasEnColumna(e,t=tablonActual){for(var a=0,o=0;o<localStorage.totalPost;o++)localStorage["tablon"+o]==t&&localStorage["columnaKanban"+o]==e&&a++;return a}function dijujaLineasKanban(e,t,a,o=tablonActual){if(esTablonKanban(o)){e.fillStyle=defaultColorContrastBackground;var n=getKanbanList(o).length,i=getKanbanWidths(o);if(i)for(var r=getTotalWidth(i),s=0,l=0;l<n-1;l++)s+=a*i[l]/r,e.fillRect(s,0,1,t);else{var c=a/n;for(l=1;l<n;l++)e.fillRect(c*l,0,1,t)}}}function ajustaPostitsMaxWidth(e){$(".postitNB").each((function(){if($(this).attr("id")){var t=parseInt($(this).attr("id").substr(6));localStorage["width"+t]>e&&(localStorage["width"+t]=e,updateNotaMemo(t))}}))}function hazKanbanSortable(){$(".columna").sortable({handle:isMobile()&&".parteSuperior, .bordesup",connectWith:!isKanbanBugsBoard()&&".columna",items:".postitNB",start:function(e,t){removeConnections(),sortStart(e,t)},stop:function(e,t){sortEnd(e,t)},cancel:".editing-post, input",scroll:!0,opacity:.7,create:guardaPosicionesPostits})}function sortStart(e,t){var a=t.item[0].id.substr(6);$("#postit"+a).addClass("postitMoving")}function sortEnd(e,t){var a=t.item[0].id.substr(6);$("#postit"+a).removeClass("postitMoving");var o=topBarHasBoards()?$(".paneles2").height():0;localStorage["X"+a]=parseInt(t.offset.left),localStorage["Y"+a]=parseInt(t.offset.top-o),localStorage["columnaKanban"+a]=getColumnPostit(a),updateNotaMemo(a),$(".classTransparent").each((function(){var e=$(this).attr("id").substr(6);e!=a?(localStorage["columnaKanban"+e]=getColumnPostit(a),$("#postit"+e).remove(),muestraPostit(e),updateNotaMemo(e)):$(this).css("opacity","1")})),$(".classTransparent").removeClass("classTransparent"),refrescaContadoresKanban(),guardaOrdenKanban(),isUserConnected()&&esTabCompartido()&&sendRealTime(a,localStorage["tablon"+a]),refreshConnections(),cambiaIcono(!1,!0)}function guardaOrdenKanban(e=tablonActual){if(localStorage["tablonKanban"+e]){for(var t=JSON.parse(localStorage["tablonKanban"+e]),a=isUserConnected()?"data-treeid":"data-numpost",o=0;o<t.kanbanList.length;o++)t.kanbanOrder[o]=$("#columna"+o).sortable("toArray",{attribute:a});localStorage["tablonKanban"+e]=JSON.stringify(t),grabaTablones()}}function ordenaPostitsKanban(){if(localStorage["tablonKanban"+tablonActual]){var e=JSON.parse(localStorage["tablonKanban"+tablonActual]),t=isUserConnected()?"data-treeid":"data-numpost";function a(a,n){return e.kanbanOrder[o].indexOf($(a).attr(t))>e.kanbanOrder[o].indexOf($(n).attr(t))?1:-1}for(var o=0;o<e.kanbanList.length;o++)e.kanbanOrder[o]&&$("#columna"+o+" .postitNB").sortElements(a)}}function guardaPosicionesPostits(e){setTimeout((function(){$(e.target).find(".postitNB").each((function(){var e=$(this).attr("data-numpost"),t=parseInt($(this).position().left)+parseInt($(this).css("margin-left")),a=parseInt($(this).position().top);t==localStorage["X"+e]&&a==localStorage["Y"+e]||(localStorage["X"+e]=t,localStorage["Y"+e]=a)})),cambiaIcono(!1,!0)}),1e3)}function mueveNotaRandom(){var e=$("#columna0 .postitNB");if(0!=e.length){var t=getRandomNumber(0,e.length-1),a=$(e[t]).data("numpost");localStorage["columnaKanban"+a]=1,refrescaNota(a)}}function addTreeIdKanban(e,t){try{for(var a=0;a<localStorage.numTablones;a++)if(localStorage["tablonKanban"+a]){var o=JSON.parse(localStorage["tablonKanban"+a]);o.kanbanOrder=JSON.parse(JSON.stringify(o.kanbanOrder).replace(`"${t}"`,`"${e}"`)),localStorage["tablonKanban"+a]=JSON.stringify(o)}}catch(e){console.log(e)}}function kanbanResize(e,t){guardaWidhtKanban($(e.target).index(),t.size.width),$("#Postits").width(getTotalWidth()),refreshConnections(),cambiaIcono(!1,!0)}function guardaWidhtKanban(e,t){if(localStorage["tablonKanban"+tablonActual]){var a=JSON.parse(localStorage["tablonKanban"+tablonActual]);a.widths||(a.widths=[]),$(".columna-wrapper").each((function(o){a.widths[o]=o===e?t:$(this).width(),$(this).width($(this).width())})),localStorage["tablonKanban"+tablonActual]=JSON.stringify(a)}}function getTotalWidth(e){var t=0;if(e=e||getKanbanWidths())for(var a of e)t+=a+1;return t}function getParcialWidthByColumn(e,t){e=e||getKanbanWidths();for(var a=0,o=0;o<e.length&&o<t;)a+=e[o]+1,o++;return a}function borraWidths(){if(esTablonKanban(tablonActual)){var e=JSON.parse(localStorage["tablonKanban"+tablonActual]);delete e.widths,localStorage["tablonKanban"+tablonActual]=JSON.stringify(e)}}function abrirPantallaModal(e,t){t.zindex=t.zindex||1e7;var a=t.dialogElement||"dialog-confirm";if(t.buttons&&(e=anyadirBotonesYIcono(e,t.buttons,t.icon,t.center)),t.header&&(e=anyadirHeader(e,t.header)),$("#"+a).html(e),M.Modal.init(document.getElementById(a),{onOpenStart:function(){$(".modal-overlay").css("z-index",t.zindex),$(".botones, .tablonPostits").addClass("blur-effect"),$("#"+a).css({"z-index":t.zindex+1}),t.height&&$(".modal.modal-fixed-footer").height(t.height),t.width&&$(".modal.modal-fixed-footer").width(t.width),t.maxWidth&&$(".modal.modal-fixed-footer").css("max-width",t.maxWidth),t.maxHeight&&$(".modal.modal-fixed-footer").css("max-height",t.maxHeight),t.minHeight&&$(".modal.modal-fixed-footer").css("min-height",t.minHeight),t.onOpenStart&&t.onOpenStart(),$("select").formSelect(),initMaterializeComponents(),t.buttons&&asignaCallbacksBotones(t.buttons)},onOpenEnd:function(){M.updateTextFields(),$(".modal-overlay").css("z-index",t.zindex),$(".btn-crea-nota").hide(),t.height&&$(".modal.modal-fixed-footer").height(t.height),t.width&&$(".modal.modal-fixed-footer").width(t.width),t.maxHeight&&$(".modal.modal-fixed-footer").css("max-height",t.maxHeight),t.onOpenEnd&&t.onOpenEnd(),t.icon&&$(".modal-content").css("top","0"),activarClaseActivaInputs(),$("#movilAdd").length>0&&$(".modal").addClass("adds-movil"),isMobile()&&(window.location.hash="modal")},onCloseEnd:function(){t.onCloseEnd&&t.onCloseEnd(),$(".botones, .tablonPostits").removeClass("blur-effect"),$(".btn-crea-nota").show(),isMobile()&&(window.location.hash="")},opacity:.5}),t.newModalInstance){var o=M.Modal.getInstance(document.getElementById(a));return o.open(),o}(modalInstance=M.Modal.getInstance(document.getElementById(a))).open()}function anyadirHeader(e,t){return`\n    <div class="modal-header">\n      <div class="title-container">\n        ${t.icon?`<i class="material-icons icono">${t.icon}</i>`:""}\n        <h4 class="modal-title">${t.title}</h4>\n      </div>\n    </div>\n    ${e}\n    `}function anyadirBotonesYIcono(e,t,a,o){var n="",i="";if(t.list)for(var r=0;r<t.list.length;r++)n+=`<button class="btn waves-effect waves-light ${t.list[r].color?t.list[r].color:"grey darken-1"} " id="button${r}">${t.list[r].text}</button>`;if(a){var s="";switch(a){case"info":s='<span class="swal2-icon-text">i</span>';break;case"question":s='<span class="swal2-icon-text">x</span>';break;case"error":s='<span class="swal2-x-mark"><span class="swal2-x-mark-line-left"></span><span class="swal2-x-mark-line-right"></span></span>'}i=`<div class="swal2-icon swal2-${a} swal2-animate-${a}-icon" style="display: flex;">${s}</div>`}return`\n    <div class="modal-content modal-custom ${o?"center":""}">\n      ${i}\n      ${e}\n    </div>\n    <div class="modal-footer">\n      ${n}\n      ${t.cancelButton?`<a href="#!" class="modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" id="cancelar-fondo">${chrome.i18n.getMessage("cancelar")}</a>`:""}\n    </div>`}function asignaCallbacksBotones(e){if(e.list)for(var t=0;t<e.list.length;t++)$("#button"+t).on("click",e.list[t].callback)}function sweetAlert(e){swal({html:e.text,type:e.type||"question",buttonsStyling:!1,width:e.width,confirmButtonText:e.confirmText||chrome.i18n.getMessage("aceptar"),confirmButtonClass:e.confirmButtonClass||"btn waves-effect waves-light grey darken-1",showCancelButton:!1!==e.cancel,cancelButtonText:e.cancelText||chrome.i18n.getMessage("cancelar"),cancelButtonClass:"btn waves-effect waves-light black-text grey lighten-3",backdrop:"rgba(0,0,0,0.7)",onOpen:function(){$(".botones, .tablonPostits").addClass("blur-effect"),e.text.length>400&&$(".swal2-popup #swal2-content").addClass("leftAlign")},onClose:function(){$(".botones, .tablonPostits").removeClass("blur-effect")}}).then((function(t){t.value?e.successCallback&&e.successCallback():e.cancelCallback&&e.cancelCallback()}))}function initMaterializeComponents(){const e=document.querySelectorAll(".mdc-text-field"),t=document.querySelectorAll(".mdc-select");for(const t of e)if($(t).find("input").length>0||$(t).find("textarea").length>0)try{mdc.textField.MDCTextField.attachTo(t)}catch(e){console.log(e)}for(const e of t)try{mdc.select.MDCSelect.attachTo(e),$(e).find(".mdc-notched-outline__notch").width("auto")}catch(e){console.log(e)}}function openSnackbar({text:e="",action:t="",action2:a="",action2Callback:o=(()=>{}),actionCallback:n=(()=>{}),dismiss:i=!0,dismissCallback:r=(()=>{}),stacked:s=!1,timeout:l=0}={}){var c=`<div class="mdc-snackbar ${s?"mdc-snackbar--stacked":""}" id="mdc-snackbar">\n    <div class="mdc-snackbar__surface">\n    <div class="mdc-snackbar__label"\n      role="status"\n      aria-live="polite">\n      ${e}\n    </div>\n    <div class="mdc-snackbar__actions">\n      ${a?`<button type="button" id="mdc-snackbar_action2" class="mdc-button mdc-snackbar__action2">${a}</button>`:""}\n      ${t?`<button type="button" class="mdc-button mdc-snackbar__action">${t}</button>`:""}\n      ${i?'<button type="button" class="mdc-icon-button mdc-snackbar__dismiss material-icons">close</button>':""}\n    </div>\n      </div>\n    </div>`;$("body").append(c);var d=document.getElementById("mdc-snackbar"),u=new(0,mdc.snackbar.MDCSnackbar)(d);l&&(u.timeoutMs=l),u.open(),a&&$("#mdc-snackbar_action2",d).on("click",(()=>{isFunction(o)&&o()})),d.addEventListener("MDCSnackbar:closed",(e=>{switch(e.detail.reason){case"action":isFunction(n)&&n();break;case"dismiss":isFunction(r)&&r()}$("#mdc-snackbar").remove()}))}function muestraMensajeModal(e){$(".mensaje-modal").text(e).fadeOut(500).fadeIn(500)}function getInputHtml({id:e,label:t,type:a,icon:o,helperLine:n}){return`\n    <div class="mdc-text-field nb-full-width mdc-text-field--outlined mdc-text-field--with-leading-icon">\n    ${o?'<i class="material-icons mdc-text-field__icon">'+o+"</i>":""}\n    <input id="${e}" type=${a} name="${e}" class="mdc-text-field__input" />\n    <div class="mdc-notched-outline">\n      <div class="mdc-notched-outline__leading"></div>\n      <div class="mdc-notched-outline__notch">\n        <label class="mdc-floating-label">${t}</label>\n      </div>\n      <div class="mdc-notched-outline__trailing"></div>\n    </div>\n  </div>\n  ${n?'<div class="mdc-text-field-helper-line"><div class="mdc-text-field-helper-text">'+n+"</div></div>":""}\n  `}function getOptionsHtml(e){let t="";for(const a of e)t+=`<li class="mdc-list-item ${a.selected?"mdc-list-item--selected":""}" data-value="${a.value}">\n                ${a.text}\n            </li>`;return t}function getSelectHtml({id:e,label:t,options:a}){return`<div class="mdc-select mdc-select--outlined nb-select-width">\n  <input id="${e}" type="hidden" name="${e}">\n  <i class="mdc-select__dropdown-icon"></i>\n  <div class="mdc-select__selected-text"></div>\n  <div class="mdc-select__menu mdc-menu mdc-menu-surface nb-select-width">\n    <ul class="mdc-list">\n      ${getOptionsHtml(a)}\n    </ul>\n  </div>\n  <div class="mdc-notched-outline">\n    <div class="mdc-notched-outline__leading"></div>\n    <div class="mdc-notched-outline__notch">\n      <label class="mdc-floating-label mdc-floating-label--float-above" style="">${t}</label>\n    </div>\n    <div class="mdc-notched-outline__trailing"></div>\n  </div>\n  </div>`}function activarClaseActivaInputs(){$("input[type=text], input[type=password], input[type=email], input[type=url], input[type=tel], input[type=number], input[type=search], input[type=date], input[type=time], textarea",".modal-content").each((function(e,t){$(this).val()&&($(this).parent().find(".mdc-notched-outline").addClass("mdc-notched-outline--notched"),$(this).parent().find("label").addClass("mdc-floating-label--float-above"))}))}function muestraAyudaSnackbar(e){"false"!=localStorage[e]&&openSnackbar({text:chrome.i18n.getMessage(e),action:chrome.i18n.getMessage("noMostrarMas"),actionCallback:()=>{localStorage[e]="false"}})}function showNewFeature(e,t,a){"false"!=localStorage[e]&&(a?abrirPantallaModal(chrome.i18n.getMessage(e),{icon:"info",buttons:{cancelButton:!0,list:[{text:chrome.i18n.getMessage("masInfo"),callback:function(){chrome.tabs.create({url:"https://www.noteboardapp.com/"+t}),localStorage[e]="false",modalInstance.close()}},{text:chrome.i18n.getMessage("noMostrarMas"),callback:function(){localStorage[e]="false",modalInstance.close()}}]},height:500,width:750}):openSnackbar({text:chrome.i18n.getMessage(e),action:chrome.i18n.getMessage("noMostrarMas"),action2:chrome.i18n.getMessage("masInfo"),action2Callback:()=>{chrome.tabs.create({url:"https://www.noteboardapp.com/"+t})},actionCallback:()=>{localStorage[e]="false"},stacked:!0,timeout:8e3}))}function muestraAyuda(e,t="info"){"false"!=localStorage[e]&&sweetAlert({type:t,text:chrome.i18n.getMessage(e),confirmText:chrome.i18n.getMessage("noVolverMostrar"),cancel:!0,cancelText:chrome.i18n.getMessage("aceptar"),successCallback:function(){localStorage[e]="false"}})}async function promptFields(e={}){return await Swal.fire({title:e.title||"no title",input:e.inputType||"text",showCancelButton:!0})}function getCalendarDateModal(){return new Promise((e=>{abrirPantallaModal(obtenerFormularioCalendarPlugin(),{onOpenStart:function(){var t=new Date;$("#datepicker").val(t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes()),jQuery("#datepicker").datetimepicker({format:"d.m.Y H:i",inline:!0,step:5,minDate:0,dayOfWeekStart:1}),$.datetimepicker.setLocale(window.navigator.language||navigator.browserLanguage),$("#accept-date").off().on("click",(()=>{const t=$("#datepicker").datetimepicker("getValue").toLocaleString("en-US",{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1});e({dismiss:!1,value:t}),modalInstance.close()}))},width:350,maxHeight:"450px",minHeight:"450px",dialogElement:"dialog-calendar"})}))}function connectTool(e){if(1!==$(".postitNB").length)if(isConnectedTool())removeConnectTool();else{$(".postitNB:not(#postit"+e+")").each((function(){$(this).append('<div class="transparent-layer"></div>').append(getConnectToolHtml(e,$(this).attr("id").substr(6))).addClass("postit-overflow-visible")})),$(".connect-tool").each((function(){var e=$(this).closest(".postitNB");$(this).css({top:(e.height()-$(this).height())/2,left:(e.width()-$(this).width())/2})})),$(".connect-tool button").on("click",(function(){var t=$(this).closest(".postitNB"),a=t.attr("id").substr(6),o=t.find(".connect-tool-input").val();isConnected(e,a)?(removeConnection(e,a),changeConnectButtonText(a,chrome.i18n.getMessage("conectar")),refreshConnections()):(addConnection(e,a,o),drawConnection(e,a,null,o),changeConnectButtonText(a,chrome.i18n.getMessage("desconectar")))})),$(".connect-tool input").on("keyup",(function(t){var a=$(this).closest(".postitNB"),o=a.attr("id").substr(6),n=$(this).val();isConnected(e,o)?("Enter"===t.key&&removeConnectTool(),updateConnection(e,o,n),refreshConnections()):"Enter"===t.key&&(a.find(".connect-tool button").click(),removeConnectTool())})),$("body").off().on("click",(function(e){("Postits"==e.target.className||e.target.className.indexOf("columna")>-1)&&removeConnectTool()}))}else sweetAlert({type:"error",text:chrome.i18n.getMessage("connectionSoloUna"),cancel:!1})}function isConnectedTool(e){return e&&e.find(".connect-tool").length>0||!e&&$(".connect-tool").length>0}function removeConnectTool(){$(".connect-tool").remove(),$(".transparent-layer").remove(),$(".postitNB").removeClass("postit-overflow-visible")}function changeConnectButtonText(e,t){$("#postit"+e).find(".connect-tool button").text(t)}function getConnectToolHtml(e,t){var a=getConnection(e,t);return`<div class="connect-tool">\n      <button class="waves-effect waves-light btn" type="text">${a?chrome.i18n.getMessage("desconectar"):chrome.i18n.getMessage("conectar")}</button>\n      <input type="text" class="connect-tool-input" placeholder="${chrome.i18n.getMessage("escribeEtiqueta")}" value="${a&&a.tag?a.tag:""}">\n  </div>`}function isConnected(e,t){return getConnection(e,t)}function getConnection(e,t){if(!localStorage["connections"+e])return!1;for(var a=JSON.parse(localStorage["connections"+e]),o=0;o<a.length;o++)if(coincidenLosIds(a[o],t))return a[o];return!1}function coincidenLosIds(e,t){return e.id&&localStorage["treeId"+t]&&e.id==localStorage["treeId"+t]||t==e.num}function addConnection(e,t,a){var o;(o=localStorage["connections"+e]?JSON.parse(localStorage["connections"+e]):[]).push({num:t,id:localStorage["treeId"+t]||"",tag:a||""}),localStorage["connections"+e]=JSON.stringify(o),updateNotaMemo(e)}function updateConnection(e,t,a){var o=JSON.parse(localStorage["connections"+e]),n=getIndexConnection(o,t);n>=0&&(o[n].tag=a),localStorage["connections"+e]=JSON.stringify(o),updateNotaMemo(e)}function addTreeIdConnection(e,t){for(i=0;i<localStorage.totalPost;i++)if(localStorage["connections"+i]){var a=JSON.parse(localStorage["connections"+i]);a.forEach((a=>{a.num==t&&(a.id=e)})),localStorage["connections"+i]=JSON.stringify(a)}}function removeConnection(e,t){if(!localStorage["connections"+e])return!1;var a=JSON.parse(localStorage["connections"+e]),o=getIndexConnection(a,t);o>=0&&a.splice(o,1),localStorage["connections"+e]=JSON.stringify(a),updateNotaMemo(e)}function getIndexConnection(e,t){for(var a=0;a<e.length&&!coincidenLosIds(e[a],t);)a++;return a<e.length&&a}function updateConnectionsBorrado(e){for(i=0;i<localStorage.totalPost;i++)if(localStorage["connections"+i]){var t=JSON.parse(localStorage["connections"+i]);t=t.map((t=>(t.num>e&&(t.num=t.num-1),t))),localStorage["connections"+i]=JSON.stringify(t),updateNotaMemo(i)}}function refreshConnections(){for($(".leader-line").remove(),i=0;i<localStorage.totalPost;i++){if(localStorage["tablon"+i]==tablonActual&&localStorage["connections"+i])JSON.parse(localStorage["connections"+i]).forEach((e=>{drawConnection(i,e.num,e.id,e.tag)}))}}function removeConnections(){$(".leader-line").remove()}function borraConnectionsPostit(e){for(localStorage.removeItem("connections"+e),i=0;i<localStorage.totalPost;i++)if(localStorage["connections"+i]){for(var t=JSON.parse(localStorage["connections"+i]),a=!1,o=0;o<t.length;)coincidenLosIds(t[o],e)?(t.splice(o,1),a=!0):o++;a&&(localStorage["connections"+i]=JSON.stringify(t),updateNotaMemo(i))}}function drawConnection(e,t,a,o){var n=document.getElementById("postit"+e);if(a)var i=document.querySelector('.postitNB[data-treeid="'+a+'"]');else i=document.getElementById("postit"+t);n&&i&&(n.offsetLeft<i.offsetLeft?new LeaderLine({start:n,end:i,color:defaultColorContrastBackground,middleLabel:o?LeaderLine.pathLabel(o,{color:defaultColorContrastBackground,outlineColor:"none",fontWeight:600,backgroundColor:"white"}):""}):new LeaderLine({start:i,end:n,color:defaultColorContrastBackground,middleLabel:o?LeaderLine.pathLabel(o,{color:defaultColorContrastBackground,outlineColor:"none",fontWeight:600,backgroundColor:"white"}):"",startPlug:"arrow1",endPlug:"behind"}),changeZindexConnectionLastLine(e))}function changeZindexConnectionLastLine(e){$(".leader-line").last().css("z-index",$("#postit"+e).css("z-index"))}function isFloat(e){return e===+e&&e!==(0|e)}function isInteger(e){return e===+e&&e===(0|e)}function showConnections(){for(i=0;i<localStorage.totalPost;i++)if(localStorage["connections"+i]){var e=JSON.parse(localStorage["connections"+i]);console.log(e)}}$(document).ready((function(){$("#kanbanBot").on("click",muestraDialogoKanban)}));var controlKey=!1,shiftKey=!1;function inicializaSeleccion(e,t){controlKey&&(e.preventDefault(),$("#postit"+t).css("opacity",""),$("#postit"+t).hasClass("classTransparent")?$("#postit"+t).removeClass("classTransparent"):$("#postit"+t).addClass("classTransparent")),shiftKey||$("#postit"+t).attr("data-zoomed")||(document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges())}$(document).ready((function(){$(document).on("keyup keydown",(function(e){var t=controlKey,a=shiftKey,o=navigator.platform.toUpperCase().indexOf("MAC")>=0;controlKey=e.ctrlKey||e.metaKey&&o,shiftKey=e.shiftKey,!controlKey||"F"!=e.key&&"f"!=e.key||(controlKey=!1),controlKey&&t||shiftKey&&a||(controlKey?$(".postitNB").css("cursor","copy"):t&&$(".postitNB").css("cursor","move"),shiftKey?($(".postitNB").css("cursor","text"),esTablonKanban()?$(".columna").sortable("disable"):$(".postitNB").draggable("disable"),$(".ui-state-disabled").removeClass("ui-state-disabled")):a&&($(".postitNB").css("cursor","move"),esTablonKanban()?$(".columna").sortable("enable"):$(".postitNB").draggable("enable")))}))}));var registrando,origenSeleccion={},dibujandoSeleccion=!1,cuadradoDibujado=!1;function programaEventosRaton(){$("body").on("mousedown","#Postits",(function(e){0!=e.button&&(e.preventDefault(),e.stopPropagation(),origenSeleccion={offsetX:e.pageX,offsetY:e.pageY},dibujandoSeleccion=!0,cuadradoDibujado=!1)})),$("body").on("mousemove","#Postits, .columna",(function(e){dibujandoSeleccion&&(dibujaCuadrado(origenSeleccion.offsetX,origenSeleccion.offsetY,e.pageX,e.pageY),seleccionaPostistsEnArea())})),$("body").on("mouseup","#Postits, .columna",(function(e){dibujandoSeleccion&&(e.preventDefault(),e.stopPropagation(),dibujandoSeleccion=!1,borraCuadrado())})),$("body").on("contextmenu","#Postits, .columna",(function(e){if(cuadradoDibujado)return cuadradoDibujado=!1,!1}))}function dibujaCuadrado(e,t,a,o){var n,i,r,s;0==$("#cuadrado-seleccion").length&&($("#Postits").append('<div id="cuadrado-seleccion"></div>'),$("#cuadrado-seleccion").css({borderColor:defaultColorContrastBackground,zIndex:maxZindex()})),a>=e&&o>=t?(n=e,i=t,r=a-e,s=o-t):a>=e&&o<=t?(n=e,i=o,r=a-e,s=t-o):a<=e&&o>=t?(n=a,i=t,r=e-a,s=o-t):a<=e&&o<=t&&(n=a,i=o,r=e-a,s=t-o),$("#cuadrado-seleccion").offset({left:n,top:i}).width(r).height(s),r>5&&(cuadradoDibujado=!0)}function borraCuadrado(){$("#cuadrado-seleccion").remove()}function seleccionaPostistsEnArea(){var e,t,a,o;esTablonKanban()?(e=$("#cuadrado-seleccion").offset().left-20,t=$("#cuadrado-seleccion").offset().top-20,a=$("#cuadrado-seleccion").width()-20,o=$("#cuadrado-seleccion").height()):(e=$("#cuadrado-seleccion").offset().left,t=$("#cuadrado-seleccion").offset().top,a=$("#cuadrado-seleccion").width(),o=$("#cuadrado-seleccion").height()),$(".postitNB:not(#postitnuevo)").each((function(){var n=$(this);n.offset().top>=t&&n.offset().top<=t+o&&n.offset().left>=e&&n.offset().left<=e+a&&n.offset().top+n.height()>=t&&n.offset().top+n.height()<=t+o&&n.offset().left+n.width()>=e&&n.offset().left+n.width()<=e+a?n.addClass("classTransparent"):n.removeClass("classTransparent")}))}function mostrarDatosUsuario(){abrirPantallaModal(obtenerFormularioProfile(),{height:700,onOpenStart:function(){getPremiumSubscriptionHtml().then((e=>{$(".progress-profile").remove(),$(".datos-subs").append(e),$("#buttonUnsubscribe").on("click",(function(){chrome.tabs.create({url:"https://www.paypal.com/cgi-bin/webscr?cmd=_subscr-find&alias=XL85U4ZKY8C6E"})})),$("#buttonUnsubscribeCard").on("click",(function(){gotoManageStripe()}))}));var e=mdc.linearProgress.MDCLinearProgress;(new e(document.getElementById("mdc-linear-progress")).progress=getUserSpacePercent(),isUserConnected())?($("#profile-desconectar-borrar").on("click",(function(){logoutIni(),modalInstance.close()})),$("#profile-desconectar").on("click",(function(){logout(),modalInstance.close()}))):(new e(document.getElementById("mdc-linear-progress-local")).progress=getLocalStorageSize()/KB/(524e4/KB),$("#buttonBorrarNotas").off().on("click",borrarTodoConfirm),$("#buttonBorrarNotasFicheros").off().on("click",borrarTodoFicherosConfirm));$(".icono-ayuda").tooltipster({theme:["tooltipster-noir","tooltipster-noir-customized"],side:"right",delay:150,zIndex:99999999,maxWidth:300})}})}function updateLoginData(){isUserConnected()?($(this).append('<img class="ajaxloader" src="appimg/ajax-loader.gif" width="75">'),grabaModificaciones(),sincronizaLogin(!1,!0)):muestraAdvertenciaLogin("registrateParaSincro")}function loginModal(e){abrirPantallaModal(obtenerLoginForm(),{height:700,onOpenStart:function(){if(e?($("#campos-log").hide(),$("#campos-reg").show()):($("#campos-log").show(),$("#campos-reg").hide()),isUserConnected())$("#profile-desconectar-borrar").on("click",(function(){logoutIni(),modalInstance.close()})),$("#profile-desconectar").on("click",(function(){logout(),modalInstance.close()}));else{$("#buttonGoogle").off().on("click",(function(){$("#buttonGoogle").attr("disabled",!0),chrome.permissions.request({permissions:["identity","identity.email"]},(async function(e){if(!leidaPolitica())return $("#buttonGoogle").attr("disabled",!1),!1;var t=await decideSiBorrarNotas();if(t&&"close"==t.dismiss)return $("#buttonGoogle").attr("disabled",!1),!1;loginLocalGoogle()}))})),$("#buttonSubmit").off().on("click",(function(){return chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(async function(e){if(e)if($("#campos-log").is(":visible")){var t=await decideSiBorrarNotas();if(t&&"close"==t.dismiss)return!1;loginUsuario((function(){""==$("#mensaje-modal").html()&&(localStorage.sincroLogin=!0,sincroAceptada2(),$("#fb-login").unbind("click"),modalInstance.close())}))}else registraUsuario();else muestraMensajeModal(chrome.i18n.getMessage("loginSinPermisos"))})),!1})),$("#buttonRegistro, .alterna-form").off().on("click",(function(){return muestraMensajeModal(""),$("#campos-reg").is(":visible")?($("#campos-log").slideDown(),$("#campos-reg").slideUp(),$("#buttonSubmit span").text("Login"),$("#buttonRegistro").text(chrome.i18n.getMessage("irRegistro"))):($("#campos-log").slideUp(),$("#campos-reg").slideDown(),$("#buttonRegistro").text(chrome.i18n.getMessage("irLogin")),$("#buttonSubmit span").text(chrome.i18n.getMessage("registro"))),!1})),$("#fb-login").off().on("click",(async function(){if(!leidaPolitica())return!1;var e=await decideSiBorrarNotas();if(e&&"close"==e.dismiss)return!1;loginFacebook(),listenMessage("mensBack",(function(e,t){if("loginFbSuccess"==e.mensBack){e.mensBack="";var a=obtenerBotonLogin();$("#loginBot").html(a),$("#fb-login").unbind("click"),modalInstance.close()}}))})),$("#fb-login").attr("title",chrome.i18n.getMessage("facebookLoginAviso")),$("#buttonBorrarNotas").off().on("click",borrarTodoConfirm),$("#buttonBorrarNotasFicheros").off().on("click",borrarTodoFicherosConfirm),$("#fb-login").tooltipster({theme:["tooltipster-noir","tooltipster-noir-customized"],side:"top",delay:100,zIndex:1e9});try{grecaptcha.render("recaptcha-container",{sitekey:"6LdU1v0mAAAAAHcCNxXVZt8KL0CXj1YHjT3nM8_4"})}catch(e){console.log(e)}}}})}function borrarTodoConfirm(){sweetAlert({text:chrome.i18n.getMessage("confirmarBorrado"),successCallback:function(){logoutIniConfirmado(),modalInstance.close()},confirmButtonClass:"btn waves-effect waves-light red lighten-2 left",confirmText:chrome.i18n.getMessage("borrar")})}function borrarTodoFicherosConfirm(){sweetAlert({text:chrome.i18n.getMessage("confirmarBorradoTodoFicheros"),successCallback:function(){deleteAllServerFiles(),logoutIniConfirmado(),modalInstance.close()},confirmButtonClass:"btn waves-effect waves-light red lighten-2 left",confirmText:chrome.i18n.getMessage("borrar")})}function leidaPolitica(){return muestraMensajeModal(""),!($("#campos-reg").is(":visible")&&!$("#leida-politica").is(":checked"))||(idiomaEsp(navigator.language)?muestraMensajeModal("No has leido la polÃ­tica de privacidad"):muestraMensajeModal("You have not read the privacy policy"),document.getElementById("leida-politica").focus(),!1)}async function decideSiBorrarNotas(){if(parseInt(localStorage.totalPost)>0){var e=await Swal.fire({type:"warning",html:chrome.i18n.getMessage("existenNotas"),confirmButtonText:chrome.i18n.getMessage("borrarNotasConectar"),confirmButtonClass:"btn waves-effect waves-light red lighten-2 left",cancelButtonText:chrome.i18n.getMessage("anyadirNotas"),cancelButtonClass:"btn waves-effect waves-light grey darken-1",showCancelButton:!0,showCloseButton:!0,backdrop:"rgba(0,0,0,0.7)",buttonsStyling:!1});e&&!e.dismiss&&logoutIniConfirmado()}return e}function sincroAceptada2(e){localStorage.sincroLogin=!0;var t=obtenerBotonLogin();$("#loginBot").html(t),e||(sincronizaLogin(!0,!0),cambiaIcono(),cambiaContador(),setInterval(grabaModisPorsiaca,1e4))}function logout(e){localStorage.sincroLogin=!1,localStorage.removeItem("id_usuario"),localStorage.removeItem("premium");var t=obtenerBotonLogin();$("#loginBot").html(t),isUserConnected()&&sendMessage({mensBack:"acabaSincroPeriodica"}),e||eliminaCompartidos(),localStorage.sincroLogin=!1,localStorage.removeItem("fbToken"),localStorage.removeItem("fbId"),localStorage.removeItem("googleId")}function logoutIni(){sweetAlert({text:chrome.i18n.getMessage("confirmarLogout"),confirmText:chrome.i18n.getMessage("desconectarBorrar"),successCallback:logoutIniConfirmado,type:"question"})}function deleteAllServerFiles(){if(!isUserConnected())for(var e=0;e<localStorage.totalPost;e++)compruebaBorrarImagen(localStorage["postit"+e])}function logoutIniConfirmado(){if(logout(!0),$(".postitNB:not(#postitnuevo)").remove(),"false"==localStorage.escribeReview)var e=!0;if("false"==localStorage.modoLectura)var t=!0;if("false"==localStorage.programaAgenda)var a=!0;if("false"==localStorage.ayudaNuevaNota)var o=!0;if("false"==localStorage.ayudaEditarNota)var n=!0;localStorage.clear(),e&&(localStorage.escribeReview="false"),t&&(localStorage.modoLectura="false"),a&&(localStorage.programaAgenda="false"),o&&(localStorage.ayudaNuevaNota="false"),n&&(localStorage.ayudaEditarNota="false"),tablonActual=VALORES_POR_DEFECTO.TABLONACTUAL,localStorage.tablonActual=VALORES_POR_DEFECTO.TABLONACTUAL,localStorage.upgrade52="true",localStorage.numTablones=5,localStorage.masonry0="true",localStorage.fondo1=VALORES_POR_DEFECTO.FONDO,localStorage.fondo2=VALORES_POR_DEFECTO.FONDO,localStorage.fondo3=VALORES_POR_DEFECTO.FONDO,localStorage.fondo4=VALORES_POR_DEFECTO.FONDO,localStorage.fondo5=VALORES_POR_DEFECTO.FONDO,localStorage.fuente=VALORES_POR_DEFECTO.FUENTE,localStorage.size=VALORES_POR_DEFECTO.FONT_SIZE,localStorage.sincroLogin=!1,localStorage.fullScreen=!0,localStorage.showTabs=TOP_BAR.BOARDS,localStorage.totalPost="0",localStorage.reabriendoEditor="false",localStorage.seleccionTema=VALORES_POR_DEFECTO.TEMA,localStorage.espacio=0,borraKanban(),inicializaTema(),cambiaIcono(),cambiaContador(),cambiaFondoNum(VALORES_POR_DEFECTO.FONDO),muestraPaneles2(),sendMessage({menstoBack:"cambioMenu"}),sendMessage({mensBack:"seleccionTemaMod"})}function loginUsuario(e){return""==document.getElementById("nick").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Falta informar nombre de usuario"):muestraMensajeModal("Username empty"),document.getElementById("nick").focus(),!1):HayEspacios(document.getElementById("nick").value)?(idiomaEsp(navigator.language)?muestraMensajeModal("No se permiten espacios en el nombre de usuario"):muestraMensajeModal("Username without spaces please"),document.getElementById("nick").focus(),!1):""==document.getElementById("pwd").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Falta informar password"):muestraMensajeModal("Password empty"),document.getElementById("pwd").focus(),!1):HayEspacios(document.getElementById("pwd").value)?(idiomaEsp(navigator.language)?muestraMensajeModal("Hay espacios en el password"):muestraMensajeModal("Password without spaces please"),document.getElementById("pwd").focus(),!1):($("#mensaje-modal").html(""),void chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(function(t){t&&login(e)})))}function login(e){$("#buttonSubmit i").addClass("loader");var t="nick="+encodeURIComponent(document.getElementById("nick").value);t+="&pass="+encodeURIComponent(document.getElementById("pwd").value),t+="&g-recaptcha-response= "+document.querySelector(".g-recaptcha-response")?.value,t+="&sid="+localStorage.sid,$.ajax({type:"POST",url:"https://www.noteboardapp.com/api/login2.php",data:t,cache:!1,success:function(t){var a=JSON.parse(t);a.isSuccess?(localStorage.id_usuario=a.id_usuario,localStorage.token=a.token,localStorage.sincroLogin=!0,localStorage.nick=a.nick,localStorage.nickPublico=a.nickPublico,localStorage.confirmado=a.confirmado,e?e():(muestraMensajeModal("logged"),document.getElementById("logoutForm").style.display="block",document.getElementById("loginForm").style.display="none",document.getElementById("loginNombre").innerHTML="Login "+localStorage.nick)):muestraMensajeModal(a.error)},error:function(e,t,a){muestraMensajeModal("ERROR "+t)},complete:function(){$("#buttonSubmit i").removeClass("loader")}})}function registraUsuario(){return""==document.getElementById("signup").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Falta informar nombre de usuario"):muestraMensajeModal("Username empty"),document.getElementById("signup").focus(),!1):HayEspacios(document.getElementById("signup").value)?(idiomaEsp(navigator.language)?muestraMensajeModal("No se permiten espacios en el nombre de usuario"):muestraMensajeModal("Username without spaces please"),document.getElementById("signup").focus(),!1):-1!=document.getElementById("signup").value.indexOf("@")?(idiomaEsp(navigator.language)?muestraMensajeModal("No puedes usar '@' en el nombre de usuario"):muestraMensajeModal("Don't use '@' in username please"),document.getElementById("signup").focus(),!1):""==document.getElementById("pwds").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Falta informar password"):muestraMensajeModal("Password empty"),document.getElementById("pwds").focus(),!1):HayEspacios(document.getElementById("pwds").value)?(idiomaEsp(navigator.language)?muestraMensajeModal("Hay espacios en el password"):muestraMensajeModal("Password without spaces please"),document.getElementById("pwds").focus(),!1):""==document.getElementById("pwds2").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Falta informar confirmacion de password"):muestraMensajeModal("Password confirmation empty"),document.getElementById("pwds2").focus(),!1):document.getElementById("pwds").value!=document.getElementById("pwds2").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Passwords diferentes"):muestraMensajeModal("Passwords not equal"),document.getElementById("pwds2").focus(),!1):""==document.getElementById("email").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Falta informar email"):muestraMensajeModal("Mail empty"),document.getElementById("email").focus(),!1):/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\D{2,4})+$/.test(document.getElementById("email").value)?!!leidaPolitica()&&void chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(function(e){if(e){$("#buttonSubmit i").addClass("loader");var t="nick="+encodeURIComponent(document.getElementById("signup").value);t+="&password="+encodeURIComponent(document.getElementById("pwds").value),t+="&email="+encodeURIComponent(document.getElementById("email").value),$.ajax({type:"POST",url:"https://www.noteboardapp.com/api/registraUsuarioApi.php",data:t,timeout:2e4,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess?(registrando=!0,localStorage.id_usuario=t.id_usuario,localStorage.token=t.token,localStorage.nick=t.nick,localStorage.nickPublico=t.nickPublico,localStorage.sincroLogin=!0,localStorage.sincPeriodico=!1,localStorage.sessionId=t.sessionId,sincronizaLogin(!0,!1),sincroAceptada2(!0)):muestraMensajeModal(t.mens)},error:function(e,t,a){console.log(t)},complete:function(){$("#buttonSubmit i").removeClass("loader")}})}})):(idiomaEsp(navigator.language)?muestraMensajeModal("Mail incorrecto"):muestraMensajeModal("Mail not correct"),document.getElementById("email").focus(),!1)}function enviaPassword(){if(""==document.getElementById("nick").value)return idiomaEsp(navigator.language)?muestraMensajeModal("Informa el nombre de usuario o mail"):muestraMensajeModal("Fill username or mail please"),document.getElementById("nick").focus(),!1;var e="nick="+encodeURIComponent(document.getElementById("nick").value);$.ajax({type:"POST",url:"https://www.noteboardapp.com/cambiaPass.php",data:e,timeout:2e4,cache:!1,success:function(e){"OK"!=$.trim(e)?muestraMensajeModal("ERROR! "+e):idiomaEsp(navigator.language)?muestraMensajeModal("Mail enviado para cambiar el password"):muestraMensajeModal("Mail sent to change the password")},error:function(e,t,a){console.log(t)}})}function loginFb(e,t,a){var o="nick="+encodeURIComponent(e);o+="&fbId="+encodeURIComponent(t),o+="&fbToken="+encodeURIComponent(a),$.ajax({type:"POST",url:"https://www.noteboardapp.com/api/loginFb.php",cache:!1,data:o,success:async function(e){if("<"!=e[0]){var t=JSON.parse(e);t.isSuccess&&(localStorage.id_usuario=t.id_usuario,localStorage.token=t.token,localStorage.nick=t.nick,localStorage.nickPublico=t.nickPublico,localStorage.sincroLogin=!0,localStorage.confirmado=t.confirmado,localStorage.nuevoReg=t.nuevoReg,localStorage.sessionId=t.sessionId,localStorage.profilePicture=t.picture,await setAllLocalStorage(),sendMessage({mensBack:"loginFbSuccess"}),sincronizaLogin(!0,!0),cambiaIcono(),cambiaContador())}},error:function(e,t,a){muestraMensajeModal("ERROR "+t)}})}function obtenerBotonLogin(){if(isUserConnected()){if(null!=localStorage.fbId){var e='<div class="profilePicture right">';e+=`<img src="${localStorage.profilePicture}">`,e+="</div>",e+='<div class="profileInfo right">',e+=localStorage.nick,e+="</div>"}else if(null!=localStorage.googleId)e=`<div class="profilePicture right">\n                    <img src="${localStorage.profilePicture}">\n                  </div>\n                  <div class="profileInfo right">${localStorage.nick}</div>`;else e=`\n        <div class="profileInfo right">${localStorage.nick}</div>\n      `;$("#loginBot").removeClass("no-logged")}else{e=`<div>${chrome.i18n.getMessage("loginBot")}</div>`;$("#loginBot").attr("title",chrome.i18n.getMessage("loginBot")).addClass("no-logged")}return e}function loginLocalGoogle(){if(isEdgeBrowser()){const e=chrome.identity.getRedirectURL("oauth2");let t;t=isEdgeExtension()?isEdgePro()?GOOGLE_CLIENT_ID_EDGE_PRO:GOOGLE_CLIENT_ID_EDGE_DEV:GOOGLE_CLIENT_ID_CHROME_PRO;const a=["openid","profile","email"];let o="https://accounts.google.com/o/oauth2/auth";o+=`?client_id=${t}`,o+="&response_type=token",o+=`&redirect_uri=${encodeURIComponent(e)}`,o+=`&scope=${encodeURIComponent(a.join(" "))}`,chrome.identity.launchWebAuthFlow({interactive:!0,url:o},identityCallback)}else chrome.identity.getAuthToken({interactive:!0},identityCallback)}function identityCallback(e){if(e){if(0===e.indexOf("https://")){e=e.replace("#","?");var t=new URL(e);searchParams=new URLSearchParams(t.search),e=searchParams.get("access_token")}$.ajax({type:"GET",beforeSend:function(t){t.setRequestHeader("Authorization","Bearer "+e)},url:`https://www.googleapis.com/oauth2/v1/userinfo?alt=json&token=${e}`,cache:!1,success:function(t){loginGoogle(e,t.id,t.name,t.picture)}})}}function loginGoogle(e,t,a,o){var n="auth_token="+encodeURIComponent(e);n+="&google_id="+encodeURIComponent(t),n+="&name="+encodeURIComponent(a),$.ajax({type:"POST",url:"https://www.noteboardapp.com/api/loginGoogle.php",cache:!1,data:n,success:function(e){if(console.log(e),"<"!=e[0]){var a=JSON.parse(e);if(a.isSuccess&&(localStorage.id_usuario=a.id_usuario,localStorage.token=a.token,localStorage.nick=a.nick,localStorage.nickPublico=a.nickPublico,localStorage.sincroLogin=!0,localStorage.confirmado=a.confirmado,localStorage.nuevoReg=a.nuevoReg,localStorage.sessionId=a.sessionId,localStorage.googleId=t,localStorage.profilePicture=o,sincronizaLogin(!0,!0),$("#loginBot").html(obtenerBotonLogin()),cambiaIcono(),cambiaContador(),modalInstance.close(),a.nuevoReg&&a.email&&a.email.indexOf("_repe")>-1)){if(idiomaEsp(navigator.language))var n=`Se ha creado una cuenta nueva con el login de Google. Ya tenÃ­as una cuenta con password asociada a tu gmail con\n              el usuario <b>${a.id_usuario_repe}</b>. <br>Si en realidad querias acceder a la otra cuenta identificate con ese usuario y tu password.`;else n=`A new account has been created with the Google login. You already had an account with password and\n              your gmail with the user <b>${a.id_usuario_repe}</b>, <br>If you really wanted to access to the other account, login with\n              that username and your password.`;sweetAlert({text:n})}}},error:function(e,t,a){muestraMensajeModal("ERROR "+t)}})}function muestraAdvertenciaLogin(e){abrirPantallaModal(chrome.i18n.getMessage(e),{buttons:{cancelButton:!0,list:[{text:chrome.i18n.getMessage("login"),callback:function(){modalInstance.close(),loginModal()}},{text:chrome.i18n.getMessage("registro"),color:"red lighten-2",callback:function(){modalInstance.close(),loginModal(!0)}}]},height:350,width:500,icon:"error",center:!0})}const KB=1024,MB=1024*KB,GO_PREMIUM_URL="https://www.noteboardapp.com/subscribe",PREVIOUS_PREMIUM_USER_CODE="1",PREMIUM_USER_CODE="2",MAX_BOARDS_ALLOWED=7,MAX_USER_SPACE={FREE:50*MB,PRE_PREMIUM:100*MB,PREMIUM:300*MB},EXT_DEV_URL="ajadj/popup.html#premium";function isPrePremiumUser(){return"1"===localStorage.premium}function isNewPremiumUser(){return"2"===localStorage.premium}function isPremiumUser(){return isPrePremiumUser()||isNewPremiumUser()||isDevUser()}function setPremiumUser(){localStorage.premium="2"}function isDevUser(){return document.URL.includes(EXT_DEV_URL)}function getMaxUSerSpace(){var e=MAX_USER_SPACE.FREE;return(isPrePremiumUser()||isDevUser())&&(e=MAX_USER_SPACE.PRE_PREMIUM),isNewPremiumUser()&&(e=MAX_USER_SPACE.PREMIUM),e}function getMaxUSerSpaceKB(){return parseInt(getMaxUSerSpace()/KB)}function getMaxUSerSpaceMB(){return parseInt(getMaxUSerSpace()/MB)}function getUserSpacePercent(){var e=localStorage.espacio||0;return parseInt(e)/getMaxUSerSpace()}function getUserSpaceKb(){if(!localStorage.espacio)return 0;var e=parseInt(localStorage.espacio);return Number.isInteger(e)||(localStorage.removeItem("espacio"),e=0,calculaEspacioUsuarioLocal()),parseInt(e/KB)}function getUserSpaceKbMB(){var e=getUserSpaceKb();return e>KB?parseFloat(e/KB).toFixed(2):e+" Kb"}function userHasSpace(){return getUserSpaceKb()<=getMaxUSerSpaceKB()}function muestraMensajeNohayEspacio(){sweetAlert({text:chrome.i18n.getMessage("noMoreSpace"),confirmText:chrome.i18n.getMessage("goPremium"),cancelText:chrome.i18n.getMessage("cancelar"),successCallback:()=>{window.open(GO_PREMIUM_URL,"_blank")},type:"info"}),localStorage.removeItem("muestraEspacio")}function muestraMensajeHaztePremium(e){sweetAlert({text:e||chrome.i18n.getMessage("opcionPremium"),confirmText:chrome.i18n.getMessage("goPremium"),cancelText:chrome.i18n.getMessage("cancelar"),successCallback:()=>{window.open(GO_PREMIUM_URL,"_blank")},type:"info"})}function getPremiumRibbon(){return isPremiumUser()?'\n    <div class="ribbon-wrap">\n      <span class="ribbon">PREMIUM</span>\n    </div>\n  ':`\n    <div class="ribbon-wrap">\n      <a href="${GO_PREMIUM_URL}" title="${chrome.i18n.getMessage("haztePremium")}"><span class="ribbon">PREMIUM</span></a>\n    </div>\n  `}function calculaEspacioUsuarioLocal(){chrome.permissions.contains({origins:["http://www.noteboardapp.com/"]},(function(e){if(e){for(var t=[],a=0;a<localStorage.totalPost;a++)t.push(localStorage["postit"+a]);for(a=1;a<=localStorage.numTablones;a++)localStorage["fondo"+a].indexOf("http")>-1&&t.push(localStorage["fondo"+a]);var o="listaNotas="+encodeURIComponent(JSON.stringify(t));$.ajax({type:"POST",url:getServerUrl()+"api/getUserFilesSpace.php",data:o,cache:!1,success:function(e){localStorage.espacio=JSON.parse(e).size},error:function(e,t,a){console.log(e)}})}}))}function sumaEspacioServidor(e){localStorage.espacio?localStorage.espacio=parseInt(localStorage.espacio)+e:localStorage.espacio=e}function restaEspacioServidor(e){localStorage.espacio?localStorage.espacio=parseInt(localStorage.espacio)-e:localStorage.espacio=0,parseInt(localStorage.espacio)<0&&localStorage.removeItem("espacio")}async function getPremiumSubscriptionHtml(){var e="";if(isNewPremiumUser())try{var t=await getPremiumSubscriptionData();t.subscription&&(idiomaEsp(navigator.language)?(e=t.subsCancelled?"<h3>Usuario Premium activo</h3>":`\n              <h3>SubscripciÃ³n ${"M"==t.subsType?"mensual":"anual"} activa</h3>\n            `,e+=`\n            <div><span class="titulo-tabla-subs">Fecha inicio: </span>${t.subsIniDate}</div>\n          `,t.subsCancelled?e+=`\n              <div><span class="titulo-tabla-subs">Fecha fin: </span>${t.subsEndDate}</div>\n              <p><b>SubscripciÃ³n anulada</b> el dia ${t.subsCancelDate}, no se cobrarÃ¡n mÃ¡s pagos.<br>La cuenta Premium seguirÃ¡ activa hasta el dia ${t.subsEndDate}.</p>\n            `:(e+=`<div><span class='titulo-tabla-subs'>Fecha prÃ³ximo pago: </span>${t.subsEndDate}</div>`,t.subsPayment&&(e+=`<div><span class='titulo-tabla-subs'>Importe prÃ³ximo pago: </span>${t.subsPayment} ${t.qurrencySign}</div>`),t.stripe?e+="<p>Puedes anular la subscripciÃ³n en cualquier momento con el siguiente botÃ³n que te llevarÃ¡ a una pantalla de Stripe para gestionar tu subscripciÃ³n o tus datos de pago. Tu cuenta seguirÃ¡ siendo Premium hasta que finalice el periodo pagado</p>\n              <button class='waves-effect waves-light red btn manage-stripe' type='submit' id='buttonUnsubscribeCard'>\n                <i class=\"medium material-icons\">credit_card</i>\n                <span>Anular subscripciÃ³n</span>\n              </button>":e+="<p>Puedes anular la subscripciÃ³n en cualquier momento con el siguiente botÃ³n que te llevarÃ¡ a tu cuenta de Paypal. Tu cuenta seguirÃ¡ siendo Premium hasta que finalice el periodo pagado</p>\n                <button class='waves-effect waves-light red btn' type='submit' id='buttonUnsubscribe'><span>Anular subscripciÃ³n</span></button>")):(e=t.subsCancelled?"<h3>Premium user active</h3>":`\n              <h3>Active ${"M"==t.subsType?"monthly":"annual"} subscription</h3>\n            `,e+=`\n            <div><span class="titulo-tabla-subs">Start date: </span>${t.subsIniDate}</div>\n          `,t.subsCancelled?e+=`\n              <div><span class="titulo-tabla-subs">End date: </span>${t.subsEndDate}</div>\n              <p>Subscription canceled the day ${t.subsCancelDate}, no more payments will be collected.<br>The Premium account will remain active until the day ${t.subsEndDate}.</p>\n            `:(e+=`<div><span class='titulo-tabla-subs'>Next payment date: </span>${t.subsEndDate}</div>`,t.subsPayment&&(e+=`<div><span class='titulo-tabla-subs'>Next payment amount: </span>${t.subsPayment} ${t.qurrencySign}</div>`),t.stripe?e+="<p>You can unsubscribe at any time with the following button that will take you to a Stripe screen to manage your subscription or your payment details. Your account will remain Premium until the paid period ends</p>\n              <button class='waves-effect waves-light red btn manage-stripe' type='submit' id='buttonUnsubscribeCard'>\n                <i class=\"medium material-icons\">credit_card</i>\n                <span>Manage subscription</span>\n              </button>":e+="<p>You can unsubscribe at any time with the following button that will take you to your Paypal account. Your account will remain Premium until the paid period ends</p>\n              <button class='waves-effect waves-light red btn' type='submit' id='buttonUnsubscribe'><span>Unsubscribe</span></button>")))}catch(e){console.log(e)}else e=idiomaEsp(navigator.language)?"\n        <h3>SubscripciÃ³n no activa</h3>\n        <button class='waves-effect waves-light green btn subscribe-info' type='button'><span><a href=\"https://www.noteboardapp.com/subscribe\" target=\"_blank\">Ver ventajas con subscripciÃ³n</a></span></button>\n      ":"\n        <h3>Subscription not active</h3>\n        <button class='waves-effect waves-light green btn subscribe-info' type='button'><span><a href=\"https://www.noteboardapp.com/subscribe\" target=\"_blank\">See benefits with subscription</a></span></button>\n      ";return e}function getPremiumSubscriptionData(){return new Promise(((e,t)=>{var a="id_usuario="+localStorage.id_usuario;a+="&token="+localStorage.token,$.ajax({type:"GET",url:getServerUrl()+"api/getUserSubscription.php",data:a,cache:!1,success:function(t){const a=JSON.parse(t);a.subsIniDate=getLocaleDate(a.subsIniDate),a.subsEndDate=getLocaleDate(a.subsEndDate),a.subsCancelDate=getLocaleDate(a.subsCancelDate),e(a)},error:function(e,a,o){console.log(e),t()}})}))}function addBoardPremiumAllowed(){const e=isAddBoardPremiumAllowed();return!e&&muestraMensajeHaztePremium(chrome.i18n.getMessage("tablonesPremium")),e}function isAddBoardPremiumAllowed(){return isPremiumUser()||parseInt(localStorage.numTablones)<2000}function gotoManageStripe(){$("#buttonUnsubscribeCard i").addClass("loader");var e="id_usuario="+localStorage.id_usuario;e+="&token="+localStorage.token,$.ajax({type:"POST",url:"https://www.noteboardapp.com/creditcard/createCustomerPortal.php",data:e,cache:!1,success:function(e){resp=JSON.parse(e),chrome.tabs.create({url:resp.url})},error:function(e,t,a){console.log(t)},complete:function(){$("#buttonUnsubscribeCard i").removeClass("loader")}})}function compruebaVideos(e){return e.indexOf("link-upload-file")>-1||"false"==localStorage.automaticEmbed?e:(e.indexOf("youtube.com/watch")>-1&&(e=transformYoutubeLinks(e)),-1==(e=convert_vimeo(e=convert_twitch(e=convert_video_url(e)))).indexOf("<iframe")&&(e=e.replace(/(https?:\/\/\S*?\.pdf)/g,'<iframe src="$1" width="500" height="400"></iframe>')),e=e.replace(new RegExp('src="//',"g"),'src="https://'))}function convert_Amazon(e){for(var t,a=0,o=0,n=0;e.indexOf('<a href="https://www.amazon.com',n)>-1&&-1==e.indexOf("tag=",n+10)&&a<10;)a++,o=e.indexOf('<a href="https://www.amazon.com',n),n=e.indexOf('"',o+27),t=e.substring(o,n),e=t.indexOf("?")>-1?e.substring(0,n)+"&tag=notboa-20"+e.substring(n):e.substring(0,n)+"?tag=notboa-20"+e.substring(n);for(a=0,n=0;e.indexOf('<a href="https://www.amazon.es',n)>-1&&-1==e.indexOf("tag=",n+10)&&a<10;)a++,o=e.indexOf('<a href="https://www.amazon.es',n),n=e.indexOf('"',o+27),t=e.substring(o,n),e=t.indexOf("?")>-1?e.substring(0,n)+"&tag=notboa-21"+e.substring(n):e.substring(0,n)+"?tag=notboa-21"+e.substring(n);for(a=0,n=0;e.indexOf('<a href="https://www.amazon.co.uk',n)>-1&&-1==e.indexOf("tag=",n+10)&&a<10;)a++,o=e.indexOf('<a href="https://www.amazon.co.uk',n),n=e.indexOf('"',o+27),t=e.substring(o,n),e=t.indexOf("?")>-1?e.substring(0,n)+"&tag=wwwnoteboarda-21"+e.substring(n):e.substring(0,n)+"?tag=wwwnoteboarda-21"+e.substring(n);return e}function createYoutubeEmbed(e){return'<iframe width="420" height="345" src="https://www.youtube.com/embed/'+e+'" frameborder="0" allowfullscreen></iframe><br/>'}function transformYoutubeLinks(e){if(!e)return e;const t=this,a=/(?:)<a([^>]+)>(.+?)<\/a>/g,o=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([^& \n<]+)(?:[^ \n<]+)?/g;let n=e;const i=e.match(/(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)([^& \n<]+)(?:[^ \n<]+)?/g);if(i&&i.length>0){const s=e.match(a);if(s&&s.length>0)for(var r=0;r<s.length;r++)n=n.replace(s[r],"#placeholder"+r+"#");for(r=0;r<i.length;r++){let e=i[r].split(o);n=n.replace(i[r],t.createYoutubeEmbed(e[1]))}if(s&&s.length>0)for(r=0;r<s.length;r++)n=n.replace("#placeholder"+r+"#",s[r])}return n}function convert_vimeo(e){var t=/(?:http?s?:\/\/)?(?:www\.)?(?:vimeo\.com)\/?(\S+)/g;if(t.test(e))e=e.replace(t,'<iframe width="420" height="345" src="https://player.vimeo.com/video/$1" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>');return e}function convert_twitch(e){var t=/(?:http?s?:\/\/)?(?:www\.)?(?:twitch\.tv)\/?(\S+)/g;if(t.test(e))e=e.replace(t,'<iframe src="https://player.twitch.tv/?channel=$1&!autoplay" frameborder="0" allowfullscreen="true" scrolling="no" height="378" width="620"></iframe>');return e}function convert_video_url(e){var t=/([-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?(?:webm|mp4|ogv))/gi;if(t.test(e)&&-1===e.indexOf("<video"))e=e.replace(t,'<video controls="" loop="" controls src="$1" width="100%" height="350"></video>');return e}function iframeWidth(e){var t=0;return $("#texto"+e+" iframe").each((function(){var e=$(this).attr("src");null!=e&&(e.indexOf("youtube.com/embed")>-1||e.indexOf("spotify.com")>-1||e.toLowerCase().indexOf(".pdf")>-1)&&(t=$(this).width())})),t}function isIframeEmbeded(e){return e.indexOf("www.youtube.com/embed")>-1||e.indexOf("<iframe")>-1&&(e.toLowerCase().indexOf(".pdf")>-1||e.indexOf(!1))||e.indexOf("<video")>-1}function resizeIframes(e,t,a){$("#texto"+e+" iframe").each((function(){var e=$(this).attr("src");null!=e&&(e.indexOf("youtube.com/embed")>-1||e.indexOf("embed/video")>-1)?($(this).width(t),$(this).height(.5625*t)):$(this).height()>50&&($(this).width(t),$(this).height(a)),null!=e&&(e.toLowerCase().indexOf(".pdf")>-1||e.indexOf("https://view.officeapps.live.com")>-1||e.indexOf("https://docs.google.com/viewer")>-1||e.indexOf("https://view.officeapps.live.com")>-1)&&($(this).width("100%"),$(this).height(a))})),$("#texto"+e+" video").each((function(){$(this).width("100%"),1==$("#texto"+e+" video").length&&$(this).on("loadedmetadata",(function(){var a=$(this)[0].videoHeight/$(this)[0].videoWidth;$("#texto"+e+" video").height(t*a),$("#texto"+e).height($("#texto"+e).height()-10)})),$(this).height(.5625*t)}))}function esVideo(e){return e.indexOf("<video")>-1}function changeIframesToLink(e){try{if(e.includes('class="iframeUploadFile"')&&e.includes("view.officeapps.live.com")){for(var t=/<iframe class=\"iframeUploadFile\" src="([^"]+)".*?<\/iframe>/g,a=t.exec(e),o=e;a;)o=o.replace(a[0],`<a href="${a[1]}">${a[1]}</a></br>`),a=t.exec(e);e=o}}catch(e){console.log(e)}return e}function searchCode(e){let t,a=0;for(;e.indexOf("```")>-1;){t=e.indexOf("```"),a=e.indexOf("```",t+1),-1===a&&(a=e.length);let o="javascript";e.toLowerCase().indexOf("html")>-1&&(o="html"),e.toLowerCase().indexOf("java ")>-1&&(o="java"),e.toLowerCase().indexOf("css")>-1&&(o="css"),e.toLowerCase().indexOf("php")>-1&&(o="php"),e.toLowerCase().indexOf("python")>-1&&(o="python"),e.toLowerCase().indexOf("sql")>-1&&(o="sql");const n=Prism.languages[o]||Prism.languages.javascript;e=`${e.substring(0,t)}\n           <pre class="language-${o}"><code class="language-${o}">${Prism.highlight(e.substring(t+4,a),n,o)}\n           </code></pre>${e.substring(a+4)}`}return e}function hightlightCode(){Prism.hooks.add("before-highlight",(function(e){e.code=e.element.innerText})),Prism&&Prism.highlightAll()}function muestraDialogoPlugins(){salSiPapelera()||abrirPantallaModal(obtenerFormularioPlugins(),{onOpenStart:function(){$(".plugin-element").off().on("click",aceptaPlugin),$(".plugin-element").on("mouseover",(function(){$(this).find(".plugin-overlay").show()})).on("mouseleave",(function(){$(this).find(".plugin-overlay").hide()}))},height:"75%",maxHeight:600})}$(document).ready((function(){$("#pluginBot").on("click",muestraDialogoPlugins)}));const LISTA_PLUGINS=[{nombre:{esp:"Reloj",ing:"Clock"},img:"appimg/plugins/clock.png",html:'<div class="wrapper">\n\t\t\t\t\t\t<iframe src="https://www.noteboardapp.com/plugins/clock.html?embedded=true&amp;wmode=transparent" width="200" height="200"></iframe>\n\t\t\t\t\t</div>',width:350,height:350},{nombre:{esp:"Reloj 2",ing:"Clock 2"},img:"appimg/plugins/clock2.png",html:'<div class="wrapper">\n\t\t\t\t\t\t<iframe src="https://www.noteboardapp.com/plugins/clock2.html?embedded=true&amp;wmode=transparent" width="250" height="250"></iframe>\n\t\t\t\t\t</div>',width:250,height:250},{nombre:{esp:"Reloj 3D",ing:"3D clock"},img:"appimg/plugins/clock3.gif",html:'<div class="wrapper">\n\t\t\t\t\t\t<iframe src="https://www.noteboardapp.com/plugins/clock3.html?embedded=true&amp;wmode=transparent" width="350" height="250"></iframe>\n\t\t\t\t\t</div>',width:350,height:250},{nombre:{esp:"Reloj digital",ing:"Digital clock"},img:"appimg/plugins/digitalClock.png",html:'<div class="wrapper">\n\t\t\t\t\t\t<iframe src="https://www.noteboardapp.com/plugins/digitalClock.html?embedded=true&amp;wmode=transparent" width="250" height="150"></iframe>\n\t\t\t\t\t</div>',width:250,height:150},{nombre:{esp:"Calendario Google",ing:"Google Calendar"},img:"appimg/plugins/calendar.png",html:'<div class="wrapper">\n\t\t\t\t\t\t<iframe style="border: 0;" src="https://calendar.google.com/calendar/embed?src=%parm1" width="200" height="200" frameborder="0" scrolling="no"></iframe>\n\t\t\t\t\t\t</div>',width:700,height:400,fields:[{name:"gmail",type:"email",desc:{esp:"Informa tu cuenta de gmail para vincular tu calendario",ing:"Inform your gmail account to link your calendar"}}]},{nombre:{esp:"Calendario",ing:"Clock"},img:"appimg/plugins/calendarNB.png",html:'<div class="wrapper">\n\t\t\t\t\t\t<iframe src="https://www.noteboardapp.com/plugins/calendar.html?embedded=true&amp;wmode=transparent" width="200" height="200"></iframe>\n\t\t\t\t\t</div>',width:650,height:650,type:TIPO_NOTA.BLANCO},{nombre:{esp:"El tiempo",ing:"Weather"},img:"appimg/plugins/weather.png",html:'<div class="wrapper">\n\t\t\t\t\t\t<iframe src="https://www.noteboardapp.com/plugins/weather.html?format=%parm1" width="200" height="200"></iframe>\n\t\t\t\t\t</div>',width:800,height:200,type:TIPO_NOTA.BLANCO,fields:[{name:"gmail",type:"radio",inputOptions:{C:"Celsius",F:"Farenheit"},desc:{esp:"Elige el formato de la temperatura",ing:"Choose temperature format"}}]},{nombre:{esp:"Cuenta atrÃ¡s",ing:"Countdown"},img:"appimg/plugins/countdown.png",html:'<div class="wrapper">\n\t\t\t\t\t\t<iframe src="https://www.noteboardapp.com/plugins/countdown.html?eventDate=%parm1&event=%parm2" width="400" height="200"></iframe>\n\t\t\t\t\t</div>',width:400,height:200,type:TIPO_NOTA.BLANCO,fields:[{name:"eventDate",type:"date",desc:{esp:"Informa fecha y hora para iniciar cuenta atrÃ¡s",ing:"Inform date and time to start countdown"}},{name:"event",type:"text",desc:{esp:"Informa tÃ­tulo (opcional)",ing:"Inform title (optional)"}}]}];function listaPlugins(e){var t="";for(const[a,o]of LISTA_PLUGINS.entries())t+=`<div class="plugin-element" data-plugin-num="${a}" data-idioma="${e}">\n\t\t\t\t\t\t\t\t<h4>${o.nombre[e]}</h4>\n\t\t\t\t\t\t\t\t<div class="plugin-content"><img src="${o.img}" /></div>\n\t\t\t\t\t\t\t\t<div class="plugin-overlay"></div>\n\t\t\t\t\t\t</div>`;return t}async function aceptaPlugin(e){if(isPremiumUser()){var t=$(this).data("plugin-num"),a=$(this).data("idioma"),o=LISTA_PLUGINS[t],n=o.html;if(modalInstance.close(),o.fields){if(!await obtieneCampos(o.fields,a))return!1;n=o.html;for(const[e,t]of o.fields.entries())n=n.replace(`%parm${e+1}`,encodeURIComponent(t.value))}guardaPostitPluginSticker(n,o.width,o.height,o.type)}else muestraMensajeHaztePremium()}async function obtieneCampos(e,t){let a={};for(const o of e){if(a="date"===o.type?await getCalendarDateModal():await Swal.fire({title:o.desc[t],input:o.type,inputOptions:o.inputOptions,showCancelButton:!0}),a.dismiss)return!1;o.value=a.value}return!0}function guardaPostitPluginSticker(e,t,a,o){var n=localStorage.totalPost,i=o||TIPO_NOTA.TRANSPARENTE,r=document.createElement("div");r.id="postit"+n,localStorage["sinMarco"+n]="true","true"==localStorage["sinMarco"+n]&&(r.className="postit1 postitSinMarco postitNB"),r.innerHTML=`<div class="parteSuperior" id="parteSuperior${n}">\n\t\t\t\t<div class="bordesup" id="bordesup${n}"></div>\n\t\t</div>\n\t\t<div class="fuente${localStorage.fuente} textoNB"  id="texto${n}">${e}</div>\n\t\t<div class="clearfloat"></div>`,document.getElementById("Postits").appendChild(r);var s=$("#postit"+n);t?(s.width(t),localStorage["width"+n]=t):(s.width("auto"),localStorage["width"+n]="auto"),a&&s.height(a),localStorage["height"+n]=s.height();s.offset({top:100,left:100}),guardaTextoEnNota(n,e),localStorage["tablon"+n]=tablonActual,localStorage["tipoA"+n]=i,localStorage["X"+n]=100;var l=topBarHasBoards()?$(".paneles2").height():0;localStorage["Y"+n]=100-l,esTablonKanban()&&(localStorage["columnaKanban"+n]=posicionXNuevaNota?getColumnPosition(posicionXNuevaNota):0),s.remove(),muestraPostit(n),esTablonKanban()&&guardaOrdenKanban(),ponAlFrentePost(n);var c=new Date;idiomaEsp(navigator.language)?localStorage["fecha"+n]=c.getDate()+"/"+(c.getMonth()+1)+"/"+c.getFullYear():localStorage["fecha"+n]=c.getMonth()+1+"/"+c.getDate()+"/"+c.getFullYear(),localStorage.totalPost++,isUserConnected()&&grabaNotaLogin(n),refrescaKanban(),cambiaContador(),cambiaIcono(),aplicaMasonry(!0)}function muestraDialogoStickers(){salSiPapelera()||abrirPantallaModal(obtenerFormularioStickers(),{onOpenStart:function(){$(".sticker-element").off().on("click",aceptaSticker),$(".sticker-element").on("mouseover",(function(){$(this).find(".sticker-overlay").show()})).on("mouseleave",(function(){$(this).find(".sticker-overlay").hide()})),$("#showAttribution").off().on("click",(function(){$(".sticker-atribution").toggle(),$(".sticker-element").toggleClass("show-credits")})),$(".sticker-atribution").off().on("click",(function(e){e.stopPropagation()}))},height:"75%",maxHeight:600})}$(document).ready((function(){$("#stickersBot").on("click",muestraDialogoStickers)}));const LISTA_STICKERS=[{img:"appimg/stickers/arrow7.png",url:"https://pixabay.com/illustrations/arrow-dashed-pattern-colorful-2207748/",link:'Image by <a target="_blank" href="https://pixabay.com/users/geralt-9301/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2207748">Gerd Altmann</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2207748">Pixabay</a>'},{img:"appimg/stickers/arrow8.png",url:"https://pixabay.com/vectors/right-arrow-next-297788/",link:'Image by <a target="_blank" href="https://pixabay.com/users/Clker-Free-Vector-Images-3736/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=297788">Clker-Free-Vector-Images</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=297788">Pixabay</a>'},{img:"appimg/stickers/arrow1.png"},{img:"appimg/stickers/arrow2.png"},{img:"appimg/stickers/arrow6.png",url:"https://pixabay.com/vectors/arrow-red-up-symbol-icon-156792/",link:'Image by <a target="_blank" href="https://pixabay.com/users/OpenClipart-Vectors-30363/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=156792">OpenClipart-Vectors</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=156792">Pixabay</a>'},{img:"appimg/stickers/arrow9.png",url:"https://pixabay.com/illustrations/doodle-arrow-show-rise-1388119/",link:'Image by <a target="_blank" href="https://pixabay.com/users/Elionas-2345468/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1388119">Elias SchÃ¤fer</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1388119">Pixabay</a>'},{img:"appimg/stickers/arrow10.png",url:"https://pixabay.com/vectors/arrow-direction-right-sign-forward-39651/",link:'Image by <a target="_blank" href="https://pixabay.com/users/Clker-Free-Vector-Images-3736/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=39651">Clker-Free-Vector-Images</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=39651">Pixabay</a>'},{img:"appimg/stickers/arrow10white.png",url:"https://pixabay.com/vectors/arrow-direction-right-sign-forward-39651/",link:'Image by <a target="_blank" href="https://pixabay.com/users/Clker-Free-Vector-Images-3736/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=39651">Clker-Free-Vector-Images</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=39651">Pixabay</a>'},{img:"appimg/stickers/arrow11.png",url:"https://pixabay.com/vectors/download-arrow-down-icon-green-1292814/",link:'Image by <a target="_blank" href="https://pixabay.com/users/OpenClipart-Vectors-30363/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1292814">OpenClipart-Vectors</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1292814">Pixabay</a>'},{img:"appimg/stickers/arrow3.png"},{img:"appimg/stickers/arrow4.png"},{img:"appimg/stickers/arrow5.png"},{img:"appimg/stickers/bombilla.png",link:'Image by <a target="_blank" href="https://www.hiclipart.com/free-transparent-background-png-clipart-zkavu">hiclipart.com/</a>'},{img:"appimg/stickers/business.png",height:240,width:180,url:"https://pixabay.com/vectors/business-idea-strategy-marketing-4271251/",link:'Image by <a target="_blank" href="https://pixabay.com/users/talhakhalil007-5671515/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4271251">talha khalil</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4271251">Pixabay</a>'},{img:"appimg/stickers/music.png",url:"https://pixabay.com/vectors/music-note-music-note-musical-notes-1967480/",link:'Image by <a target="_blank" href="https://pixabay.com/users/ruhbastard-3293703/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1967480">ruhbastard</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1967480">Pixabay</a>'},{img:"appimg/stickers/music2.png",width:120,height:250,url:"https://pixabay.com/vectors/note-music-quaver-38578/",link:'Image by <a target="_blank" href="https://pixabay.com/users/Clker-Free-Vector-Images-3736/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=38578">Clker-Free-Vector-Images</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=38578">Pixabay</a>'},{img:"appimg/stickers/silhouette-music.png",url:"https://pixabay.com/vectors/silhouette-musical-note-clef-bass-3275055/",link:'Image by <a target="_blank" href="https://pixabay.com/users/mohamed_hassan-5229782/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3275055">mohamed Hassan</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=3275055">Pixabay</a>'},{img:"appimg/stickers/bombilla2.png",url:"https://pixabay.com/vectors/cartoon-icon-light-bulb-symbol-1294877/",link:'Image by <a target="_blank" href="https://pixabay.com/users/OpenClipart-Vectors-30363/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1294877">OpenClipart-Vectors</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1294877">Pixabay</a>'},{img:"appimg/stickers/bulb.png",url:"https://pixabay.com/vectors/bulb-business-graphic-cartoon-light-2029707/",link:'Image by <a target="_blank" href="https://pixabay.com/users/OpenClipart-Vectors-30363/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2029707">OpenClipart-Vectors</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2029707">Pixabay</a>'},{img:"appimg/stickers/zombi.png",height:240,width:180,url:"https://pixabay.com/vectors/male-man-boy-zombie-undead-1781413/",link:'Image by <a target="_blank" href="https://pixabay.com/users/GDJ-1086657/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1781413">Gordon Johnson</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1781413">Pixabay</a>'},{img:"appimg/stickers/notepad.png",url:"https://pixabay.com/vectors/notepad-memo-pencil-writing-note-117597/",link:'Image by <a target="_blank" href="https://pixabay.com/users/OpenClipart-Vectors-30363/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=117597">OpenClipart-Vectors</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=117597">Pixabay</a>'},{img:"appimg/stickers/like.png",url:"https://pixabay.com/vectors/well-pugar-top-like-i-i-like-it-2831243/",link:'Image by <a target="_blank" href="https://pixabay.com/users/PaliGraficas-6638487/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2831243">Augusto Ordonez</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=2831243">Pixabay</a>'},{img:"appimg/stickers/rocket.png",height:200,url:"https://pixabay.com/vectors/rocket-space-ship-space-launch-312767/",link:'Image by <a target="_blank" href="https://pixabay.com/users/Clker-Free-Vector-Images-3736/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=312767">Clker-Free-Vector-Images</a> from <a target="_blank" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=312767">Pixabay</a>'},{img:"appimg/stickers/exclamation mark.png",height:200,link:'<a href="https://pngtree.com/so/cartoon">cartoon png from pngtree.com</a>'},{img:"appimg/stickers/star.png",height:200,url:"https://pngtree.com/freepng/cute-stars_401098.html",link:'<a href="https://pngtree.com/so/cute-clipart">cute clipart png from pngtree.com</a>'},{img:"appimg/stickers/light-311119.svg",height:200,url:"https://pixabay.com/vectors/light-bulb-filament-lamp-orange-311119",link:'Image by <a href="https://pixabay.com/users/clker-free-vector-images-3736/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=311119">Clker-Free-Vector-Images</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=311119">Pixabay</a>'},{img:"appimg/stickers/drums.png",height:200,url:"https://pixabay.com/vectors/drums-set-instruments-drum-set-31362/",link:'Image by <a href="https://pixabay.com/users/clker-free-vector-images-3736/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=31362">Clker-Free-Vector-Images</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=31362">Pixabay</a>'},{img:"appimg/stickers/cake.svg",height:200,url:"https://pixabay.com/vectors/cake-candles-birthday-purple-icing-308576/",link:'Image by <a href="https://pixabay.com/users/clker-free-vector-images-3736/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=308576">Clker-Free-Vector-Images</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=308576">Pixabay</a>'},{img:"appimg/stickers/spotlight.svg",height:200,url:"https://pixabay.com/vectors/spotlight-light-searchlamp-297727/",link:'Image by <a href="https://pixabay.com/users/clker-free-vector-images-3736/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=297727">Clker-Free-Vector-Images</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=297727">Pixabay</a>'},{img:"appimg/stickers/lips.svg",height:200,url:"https://pixabay.com/vectors/cake-candles-birthday-purple-icing-308576/",link:'Image by <a href="https://pixabay.com/users/clker-free-vector-images-3736/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=310734">Clker-Free-Vector-Images</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=310734">Pixabay</a>'}];function listaStickers(){var e="";for(const[t,a]of LISTA_STICKERS.entries())e+=`<div class="sticker-element" data-sticker-num="${t}">\n\t\t\t\t\t\t\t\t<div class="sticker-content"><img src="${a.img}" /></div>\n\t\t\t\t\t\t\t\t${a.link?`<div class="sticker-atribution">${a.link}</div>`:""}\n\t\t\t\t\t\t\t\t<div class="sticker-overlay"></div>\n\t\t\t\t\t\t</div>`;return e}function aceptaSticker(e){var t=$(this).data("sticker-num"),a=LISTA_STICKERS[t];a.width=a.width||200,a.height=a.height||150,modalInstance.close(),guardaPostitPluginSticker(`\n\t\t<div class="sticker-imageNB-wrapper">\n\t\t\t<img src="${a.img}" class="sticker-imageNB" />\n\t\t</div>\n\t`,a.width,a.height)}function esSticker(e){return 1===$("#postit"+e).find(".sticker-imageNB").length}var pckry,masonryInterval,masonryTimeout;function ordenaPostits(e,t){esTablonKanban()?sweetAlert({text:chrome.i18n.getMessage("ordenaKanban"),cancel:!1,type:"error"}):(!t&&esTablonOrdenado()?($("#ordenaBot").css({"box-shadow":"0 0 0px black inset"}),localStorage.removeItem("masonry"+tablonActual),$(".postitNB").each((function(){var e=parseInt($(this).attr("id").substr(6));isUserConnected()&&null==localStorage["userComp"+e]&&updateNotaLoginMemo(e)})),pckry.destroy(),refrescaPantalla()):e?sweetAlert({text:chrome.i18n.getMessage("confirmarOrdenacion"),successCallback:function(){muestraAyudaSnackbar("ayudaOrdenacion"),preparaTablonParaOrdenacion(),confirmadaOrdenacion(t),grabaTablones()}}):confirmadaOrdenacion(t),t||grabaTablones())}function quitaMasonry(){esTablonOrdenado()&&($("#ordenaBot").css({"box-shadow":"0 0 0px black inset"}),$("#Postits").css("padding-top",0),localStorage.removeItem("masonry"+tablonActual),refrescaPantalla(),pckry&&pckry.destroy())}function confirmadaOrdenacion(e){localStorage["masonry"+tablonActual]="true",$("#ordenaBot").addClass("selected"),$("#Postits").imagesLoaded().always((function(t){aplicaOrdenImagenesCargadas(e)})),muestraPaneles2()}function ajustaNotasYPadding(){$(getSortPostitClass()).css({"margin-top":"20px","margin-left":"10px",left:"-=10",top:"-=10"}),$("#Postits").css("padding-top",$(".botones").height())}function preparaTablonParaOrdenacion(){cambioTablon.sliding||($(".tablonPostits,#Postits").width("100%"),ajustaNotasYPadding(),$(".tablonPostits").height($(".tablonPostits").height()+$(".botones").height()))}function refrescaOrdenacion(e=0){esTablonOrdenado()&&$("#Postits").imagesLoaded((function(){esTablonOrdenado()&&(masonryTimeout=setTimeout(confirmadaOrdenacion,e))}))}function aplicaOrdenImagenesCargadas(e){if(esTablonOrdenado()){var t=document.getElementById("Postits");$(".tablonPostits").height($(".tablonPostits").height()+$(".botones").height()),(pckry=new Packery(t,{columnWidth:20,isInitLayout:!1,transitionDuration:"1.2s",itemSelector:getSortPostitClass(),stamp:!esTablonPapelera()&&".pinnedNB"}))._isLayoutInited=!0,pckry.bindUIDraggableEvents($(".postitNB")),e?setTimeout((function(){pckry.layout()}),100):pckry.layout(),masonryInterval&&clearInterval(masonryInterval),masonryInterval=setInterval(compruebaMasonry,100)}}function aplicaMasonry(e){pckry&&esTablonOrdenado()&&(e&&($(getSortPostitClass()).css({"margin-top":"10px","margin-left":"10px"}),pckry.reloadItems()),pckry.layout(),masonryInterval&&clearInterval(masonryInterval),masonryInterval=setInterval(compruebaMasonry,100))}function compruebaMasonry(){var e=!1;$(getSortPostitClass()).each((function(){if("opacity, transform"==$(this).css("transition-property"))return e=!0,!1})),e?(cambiaIcono(!1,!0),refreshConnections()):(actualizaDatosPostits(),clearInterval(masonryInterval),compruebaLimites(),cambiaIcono())}function actualizaDatosPostits(){var e=topBarHasBoards()?$(".paneles2").height():0;$(getSortPostitClass()).each((function(){var t=$(this),a=parseInt($(this).attr("id").substr(6)),o=parseInt(t.css("left"))+10,n=parseInt(t.css("top"))-e+10;moviendo==a&&(isUserConnected()&&null==localStorage["userComp"+a]&&updateNotaLoginMemo(moviendo),moviendo=void 0),localStorage["X"+a]==o&&localStorage["Y"+a]==n||(localStorage["X"+a]=o,localStorage["Y"+a]=n,isUserConnected()&&null==localStorage["userComp"+a]&&updateNotaLoginMemo(a))}))}function inicializaTablonMasonry(){esTablonOrdenado()?(ordenaPostits(!1,!0),$("#ordenaBot").addClass("selected")):$("#ordenaBot").removeClass("selected")}function recalculaPaddingMasonry(){esTablonOrdenado()&&$("#Postits").css("padding-top",$(".botones").height())}function getSortPostitClass(){return esTablonPapelera()?".postitNB":".postitNB:not(.pinnedNB)"}function esTablonOrdenado(e=tablonActual){return"true"==localStorage["masonry"+e]}var tapedTwice=!1;function initMovil(){}if(isMobile()){function doubleTapHandler(e,t){tapedTwice?(tapedTwice=!1,t()):(tapedTwice=!0,setTimeout((function(){tapedTwice=!1}),300))}$(document).on("click",'a[href^="http"]',(function(e){if(!$(".modal").is(":visible")){e.preventDefault();var t=$(this).closest(".postitNB"),a=t.find(".textoNB");t.find(".nuevoLink").length?(a.removeClass("classTransparent"),t.find(".nuevoLink").remove()):(a.addClass("classTransparent"),t.append('<div class="nuevoLink" data-href="'+$(this).attr("href")+'"><i class="material-icons">exit_to_app</i></div>'),a.height()>window.innerHeight?$(".nuevoLink").css({top:$(this).position().top-$(".nuevoLink").height()/3,left:a.width()/2-$(".nuevoLink").width()/3}):$(".nuevoLink").css({top:a.height()/2-$(".nuevoLink").height()/3,left:a.width()/2-$(".nuevoLink").width()/3}),"true"==t.attr("data-zoomed")&&t.height()<window.innerHeight&&$(".classTransparent").height(window.innerHeight),muestraAyudaSnackbar("helpLinksMovil"))}})),$(document).on("click",".nuevoLink",(function(e){e.preventDefault();var t=$(this).closest(".postitNB"),a=t.find(".textoNB");t.find(".nuevoLink").length&&(a.removeClass("classTransparent"),t.find(".nuevoLink").remove()),window.open($(this).data("href"),"_system")})),isMobile()&&window.addEventListener("hashchange",(function(e){if("zoomed"!=getHashUrl(e.oldURL)||"modal"!=getHashUrl(e.newURL)){if(e.oldURL.length>e.newURL.length){switch(getHashUrl(e.oldURL)){case"zoomed":quitaZoomNotas();break;case"modal":modalInstance.close();break;case"panelShow":$("#flecha-header").click()}$("#flecha-header").length>0?$("#flecha-header").click():quitaZoomNotas()}e.preventDefault()}}))}function initSmallScreen(){($("#slidesBot").is(":visible")||localStorage.showTabs===TOP_BAR.NONE)&&($(".top-bar-icons.right li").detach().appendTo(".top-bar-icons.left"),$("#slidesBot").hide(),$("#canvasDiv").css("top","100px"),$("#canvasMaqueta").remove(),$("#canvasDiv").prepend('<canvas id="canvasMaqueta" width="75" height="90"></canvas>'),hideMinimapa&&$("#canvasMaqueta").hide(),$(".botones .material-icons ").show(),compruebaCanvasPosEnMovil(400),compruebaCanvasPosEnMovil(1e3))}function removeSmallScreen(){$("#slidesBot").is(":visible")||($(".right-button").detach().appendTo(".top-bar-icons.right"),$("#slidesBot").show(),$(".botones .material-icons ").show())}function compruebaCanvasPosEnMovil(e){setTimeout((function(){$("#canvasDiv").css("top",$(".botones").height()+10+"px")}),e)}function panelShow(e){$(".leader-line").remove();$(e+":eq(0)").prepend('<div class="panel-header">\n      <img id="flecha-header" src="appimg/up-arrow.png">\n      <div class="panel-header-logo"><img src="logos/Board2.png"></div>\n    </div>'),$(".botones").hide(),$("#canvasDiv").hide(),$(".tablonPostits").hide(),$(".fixed-action-btn").hide(),$(e).css({top:0,left:0}),$(e).show(),$(e).width(window.innerWidth),$(e).height(window.innerHeight),".fondos"!=e&&$("body").css("background-image",$(".paneles").css("background-image")),$(".tablonPostits").width(window.innerWidth),$("#flecha-header").on("click",(function(){panelHide(e)})),window.location.hash="panelShow"}function panelHide(e){$(e).hide(),$("body").css("background-image","none"),$(".panel-header").remove(),$(".tablonPostits").show(),$("#canvasDiv").show(),$(".botones").show(),$(".fixed-action-btn").show(),cambiaFondoNum(localStorage["fondo"+localStorage.tablonActual]),window.location.hash=""}function doubleTap(e,t){if(isMobile()&&!isChromeExtension()&&e){var a=new Hammer(e);a.get("tap").set({enable:!0,taps:2}),a.on("tap",(function(e){e.preventDefault(),t(e)}))}}var screenshotImage,streamVideo,cameraSelected="environment";function muestraFormularioCamara(){abrirPantallaModal(obtenerFormularioCamara(),{height:700,onOpenStart:async function(){if(isMobile())setFileUpload();else{var e=document.getElementById("video-camera-capture"),t=document.getElementById("canvas-camera-capture");let a=await getVideoDevices(e);$("#buscando-camaras").hide(),a.length>0?($("#hacer-foto").show(),a.length>1&&$("#cameras-selector").show().on("click",(()=>changeCamera(e)))):$("#camara-no-encontrada").show(),$("#hacer-foto").off().on("click",(()=>doScreenshot(t,e))),$("#repetir-foto").off().on("click",(()=>activarVideo(e)))}$("#aceptar-captura").off().on("click",(function(){guardaNotaSubidaFichero(`<img class="captura-camara-NB" src="${(screenshotImage=document.getElementById("foto-camera-capture")).src}" width="100%">`,!0),removeCameraStream(),ficherosSubidos=[],modalInstance.close()})),ficherosSubidos=[]},onCloseEnd:function(){try{removeCameraStream(),borrarFicherosSubidos(ficherosSubidos),ficherosSubidos=[]}catch(e){console.log(e)}}})}async function getVideoDevices(e){let t=[];if("mediaDevices"in navigator&&"getUserMedia"in navigator.mediaDevices)try{streamVideo=await navigator.mediaDevices.getUserMedia({audio:!1,facingMode:cameraSelected,video:{width:{min:1280,max:1920},height:{min:720,max:1080}}}),e.srcObject=streamVideo,e.play(),t=await navigator.mediaDevices.enumerateDevices(),t=t.filter((e=>"videoinput"===e.kind))}catch(e){e.toString().includes("Permission denied")&&$("#camara-sin-permiso").show()}return t}async function changeCamera(e){activarVideo(e),removeCameraStream(),cameraSelected="user"===cameraSelected?"environment":"user",streamVideo=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:cameraSelected,width:{min:1280,max:1920},height:{min:720,max:1080}}}),e.srcObject=null,e.srcObject=streamVideo,e.play()}function doScreenshot(e,t){e.width=t.videoWidth,e.height=t.videoHeight,e.getContext("2d").drawImage(t,0,0),screenshotImage=document.getElementById("foto-camera-capture");var a=(isUserConnected()?CALIDAD_CAPTURAS_PANTALLA.logged:CALIDAD_CAPTURAS_PANTALLA.local)/100;screenshotImage.src=e.toDataURL("image/jpeg",a),screenshotImage.style.display="block",t.style.display="none",$("#aceptar-captura").removeClass("disabled"),$("#hacer-foto").hide(),$("#repetir-foto").show()}function activarVideo(e){screenshotImage&&(screenshotImage.style.display="none"),e.style.display="block",$("#aceptar-captura").addClass("disabled"),$("#hacer-foto").show(),$("#repetir-foto").hide()}function getCameraOptions(e){return e.map(((e,t)=>({text:e.label||"unknow",value:e.groupId,selected:0===t})))}function removeCameraStream(){if(streamVideo){streamVideo.getTracks().forEach((e=>e.stop()))}}function setFileUpload(){$("#fileupload").fileupload({dataType:"json",url:"https://www.noteboardapp.com/api/subirAwsFichero.php",add:function(e,t){ficherosSubidos.length>0&&(borrarFicherosSubidos(ficherosSubidos),ficherosSubidos=[]),$("#progress, #progress-ajax").show().css("display","block"),muestraMensajeModal(""),localStorage.id_usuario&&$("#usuario-imagen").val(localStorage.id_usuario),t.submit()},done:function(e,t){$("#progress #bar").css("width","100%"),$.each(t.result.files,(function(e,t){null==t.error?(ficherosSubidos.push({url:t.url,name:t.name,size:t.size}),$("#foto-camera-capture").attr("src",t.url).show(),$("#aceptar-captura").removeClass("disabled"),$("#hacer-foto-label").text(chrome.i18n.getMessage("repetirFoto")),$("#progress, #progress-ajax").hide(),$("#aceptar-anexar").removeClass("disabled")):muestraMensajeModal(t.error)})),$("#ajaxAnswer").hide(),modalInstance.isOpen||borrarFicherosSubidos(ficherosSubidos)},progressall:muestraProgreso})}function abreChatgpt(){if(!salSiPapelera())return userHasSpace()?void chrome.permissions.contains({origins:["https://chat.openai.com/"]},(function(e){e?abreFormularioChatgpt():sweetAlert({text:chrome.i18n.getMessage("chatOpenAiRequest"),successCallback:function(){chrome.permissions.request({origins:["https://chat.openai.com/"]},(function(e){e&&abreFormularioChatgpt()}))}})})):(muestraMensajeNohayEspacio(),!1)}function abreFormularioChatgpt(){abrirPantallaModal(obtenerFormularioChatgpt(),{onOpenStart:async function(){$("#chatgptInput").off().on("keyup",(function(e){$("#chatgptInput").val().length>0?$("#submit-chatgpt").removeClass("disabled"):$("#submit-chatgpt").addClass("disabled"),13===e.keyCode&&submitSearch()})),$("#submit-chatgpt").off().on("click",(function(){submitSearch()})),$("#aceptar-chatgpt").off().on("click",(function(){guardaNotaSubidaFichero($("#textoChatgpt").html(),!1,null,"auto"),modalInstance.close()}));"ERROR"===await getAccessToken()?showLogin():($("#openai-link").hide(),$("#chatgptInput").attr("disabled",!1),$("#submit-chatgpt").removeClass("disabled")),chatgptConversationId=null},height:900})}function showLogin(){$("#openai-link").show(),$("#chatgptInput").attr("disabled",!0),$("#submit-chatgpt").addClass("disabled"),$("#openai-link").on("click",(e=>{modalInstance.close()}))}async function submitSearch(){$("#submit-chatgpt i").addClass("loader"),generateAnswers($("#chatgptInput").val(),chatgptText,endGetText,errorCallback)}function chatgptText(e){e&&(e=searchCode(e),$("#textoChatgpt").html(e.replace(/\n\n/g,"<br />").replace(/\n/g,"<br />")),$("#textoChatgpt, .modal-content").scrollTop(1e5),""!=e&&$("#aceptar-chatgpt").removeClass("disabled"))}function endGetText(){$("#submit-chatgpt i").removeClass("loader")}async function errorCallback(e){sessionStorage.accessTokenChatgpt="",await getAccessToken()||showLogin(),(e?.detail?.message||e?.detail)&&sweetAlert({text:e?.detail?.message||e?.detail,cancel:!1,type:"error",width:700}),$("#submit-chatgpt i").removeClass("loader")}async function getAccessToken(){if(sessionStorage.accessTokenChatgpt)return sessionStorage.accessTokenChatgpt;const e=await fetch("https://chat.openai.com/api/auth/session");if(403===e.status)return"ERROR";const t=await e.json().catch((()=>({})));return t.accessToken?(sessionStorage.accessTokenChatgpt=t.accessToken,t.accessToken):"ERROR"}let chatgptConversationId=null;async function generateAnswers(e,t,a,o){const n=await getAccessToken(),i=new AbortController;await fetchSSE("https://chat.openai.com/backend-api/conversation",{method:"POST",signal:i.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({action:"next",messages:[{id:uuidv4(),role:"user",content:{content_type:"text",parts:[e]}}],model:"text-davinci-002-render",parent_message_id:uuidv4()}),onMessage(e){if("[DONE]"!==e)try{const a=JSON.parse(e);chatgptConversationId=a.conversation_id;const o=a.message?.content?.parts?.[0];t(o)}catch(e){console.log(e)}else a()},onError(e){o(e)}})}async function fetchSSE(e,t){const{onMessage:a,onError:o,...n}=t,i=await fetch(e,n);if(!i.ok)return void o(await i.json().catch((()=>({}))));const r=createParser((e=>{"event"===e.type&&a(e.data)}));for await(const e of streamAsyncIterable(i.body)){const t=(new TextDecoder).decode(e);r.feed(t)}}async function*streamAsyncIterable(e){const t=e.getReader();try{for(;;){const{done:e,value:a}=await t.read();if(e)return;yield a}}finally{t.releaseLock()}}function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}function createParser(e){let t,a,o,n,i,r,s;return l(),{feed:function(e){a=a?a+e:e,t&&hasBom(a)&&(a=a.slice(BOM.length));t=!1;const i=a.length;let r=0,s=!1;for(;r<i;){s&&("\n"===a[r]&&++r,s=!1);let e,t=-1,l=n;for(let n=o;t<0&&n<i;++n)e=a[n],":"===e&&l<0?l=n-r:"\r"===e?(s=!0,t=n-r):"\n"===e&&(t=n-r);if(t<0){o=i-r,n=l;break}o=0,n=-1,c(a,r,l,t),r+=t+1}r===i?a="":r>0&&(a=a.slice(r))},reset:l};function l(){t=!0,a="",o=0,n=-1,i=void 0,r=void 0,s=""}function c(t,a,o,n){if(0===n)return s.length>0&&(e({type:"event",id:i,event:r||void 0,data:s.slice(0,-1)}),s="",i=void 0),void(r=void 0);const l=o<0,c=t.slice(a,a+(l?n:o));let d=0;d=l?n:" "===t[a+o+1]?o+2:o+1;const u=a+d,p=n-d,m=t.slice(u,u+p).toString();if("data"===c)s+=m?`${m}\n`:"\n";else if("event"===c)r=m;else if("id"!==c||m.includes("\0")){if("retry"===c){const t=parseInt(m,10);Number.isNaN(t)||e({type:"reconnect-interval",value:t})}}else i=m}}const BOM=[239,187,191];function hasBom(e){return BOM.every(((t,a)=>e.charCodeAt(a)===t))}