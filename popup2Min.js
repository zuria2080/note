const VALORES_POR_DEFECTO={BOARD_HEIGTH:2e3,TEMA:"colorGris",FONDO:"50",TABLONACTUAL:"1",FUENTE:"6",FONT_SIZE:"15px",MIN_WIDTH_NOTA:"270px",MIN_WIDTH_EDITANDO_NOTA:"590px",DIR_IMAGENES:"appimg/",NUEVA_NOTA:"nuevopost",KANBAN_HEIGHT:600},WEBNOTES_BOARD=-999,TIPO_NOTA={TABLONES:"9",BLANCO:"10",AMARILLO:"1",VERDE:"2",LILA:"3",AMARILLO2:"4",ROSA:"5",ROJO:"6",AZUL:"7",TRANSPARENTE:"8",LIBRETA:"80"},TIPOS_NOTAS_RANDOM=[TIPO_NOTA.BLANCO,TIPO_NOTA.AMARILLO,TIPO_NOTA.VERDE,TIPO_NOTA.LILA,TIPO_NOTA.AMARILLO2,TIPO_NOTA.ROSA,TIPO_NOTA.ROJO,TIPO_NOTA.AZUL],CALIDAD_CAPTURAS_PANTALLA={local:20,logged:70},NOTAS_MINIMIZADAS={height:50,width:200},TOP_BAR={NONE:"none",BUTTONS_UP:"buttons_up",BUTTONS_DOWN:"buttons_down",BOARDS:"boards"},DEMO_USERS=["4156","412833","214973","615023"],BUG_IDEAS_USER="615023",GOOGLE_CLIENT_ID_EDGE_DEV="409932428860-ccanb86ttarambra11kvigdd09m8e0i2.apps.googleusercontent.com",GOOGLE_CLIENT_ID_EDGE_PRO="409932428860-s4cdpc3b4dli4jhekvlv6knb71e6araa.apps.googleusercontent.com",GOOGLE_CLIENT_ID_CHROME_PRO="409932428860-5a35icpm6o2quue6r60a91rac5oqmqc8.apps.googleusercontent.com",EDGE_ID_DEV="bjandjchhgibkhdhbfkpoccciebajadj",EDGE_ID_PRO="ehnmbncdeiinoaojbfjldmghkhjhlkli",CHROME_ID_PRO="goficmpcgcnombioohjcgdhbaloknabb",MAX_CHROME_LOCAL_STORAGE_SIZE=524e4,CANVAS_WIDTH={mini:80,normal:125},fondosTablones=[{id:"50",color:"#ececec",className:"fondo50",visible:!0},{id:"0",imagen:"corcho.jpg",className:!1,color:!1,visible:!0},{id:"51",imagen:"patterns/pat15.jpg",visible:!0},{id:"1",imagen:"corcho3.jpg",visible:!0},{id:"2",imagen:"corcho4.jpg",visible:!1},{id:"29",imagen:"patterns/pat7.png",visible:!0},{id:"3",imagen:"cemento.jpg",visible:!1},{id:"24",imagen:"patterns/pat2.png",visible:!0},{id:"41",imagen:"fondos/shattered-island.gif",visible:!0},{id:"6",imagen:"ladrillos.jpg",visible:!1},{id:"7",imagen:"carton.jpg",visible:!0},{id:"9",imagen:"cuero2.jpg",visible:!1},{id:"10",imagen:"malla.jpg",visible:!1},{id:"11",imagen:"cuero.jpg",visible:!1},{id:"12",imagen:"fondoS1.jpg",visible:!1},{id:"13",imagen:"hixs_pattern_evolution.png",visible:!1},{id:"14",color:"#6C8136",className:"fondo14",visible:!1},{id:"15",color:"#1a1a1a",className:"fondo15",visible:!1},{id:"16",color:"#C80000",className:"fondo16",visible:!1},{id:"17",color:"#961C1C",className:"fondo17",visible:!1},{id:"18",color:"#b03",className:"fondo18",visible:!1},{id:"19",color:"#fff",className:"fondo19",visible:!1},{id:"21",imagen:"patterns/vintage-concrete.png",visible:!0},{id:"22",imagen:"flores.jpg",visible:!0},{id:"27",imagen:"patterns/pat5.png",visible:!1},{id:"30",imagen:"patterns/pat8.png",visible:!0},{id:"31",imagen:"patterns/pat9.png",visible:!0},{id:"34",imagen:"patterns/pat12.png",visible:!0},{id:"37",color:"#ededee",className:"fondo37",visible:!0},{id:"4",imagen:"madera.jpg",visible:!0},{id:"33",imagen:"patterns/pat11.png",visible:!0},{id:"35",imagen:"patterns/pat13.png",visible:!0},{id:"5",imagen:"purty_wood.png",visible:!0},{id:"26",imagen:"patterns/pat4.png",visible:!0},{id:"38",imagen:"fondos/alchemy.gif",visible:!0},{id:"40",imagen:"fondos/science.png",visible:!0},{id:"42",imagen:"patterns/intersection.png",visible:!0},{id:"44",imagen:"patterns/doodles.png",visible:!0},{id:"46",imagen:"patterns/playstation-pattern.png",visible:!0},{id:"47",imagen:"patterns/random_grey_variations.png",visible:!0},{id:"48",imagen:"fondos/motherboard.jpg",visible:!0},{id:"23",imagen:"manutsi.jpg",visible:!0},{id:"49",imagen:"fondos/matrix.jpg",visible:!0},{id:"100",imagen:"rejilla.jpg",visible:!0},{id:"20",imagen:"papelArrugado.jpg",visible:!0},{id:"8",imagen:"fuego.jpg",visible:!0},{id:"52",imagen:"fondos/colorBrick.jpg",visible:!0},{id:"53",imagen:"fondos/pexels.jpg",visible:!0},{id:"54",imagen:"fondos/abstract.jpg",visible:!0},{id:"55",imagen:"fondos/pintura.jpg",visible:!0}];function isChromeExtension(){return document.URL.indexOf("chrome-extension")>-1}function isEdgeExtension(){return document.URL.indexOf(EDGE_ID_DEV)>-1||document.URL.indexOf(EDGE_ID_PRO)>-1}function isEdgePro(){return document.URL.indexOf(EDGE_ID_PRO)>-1}function isChromePro(){return document.URL.indexOf(CHROME_ID_PRO)>-1}function isEdgeBrowser(){return navigator.userAgent.toLowerCase().indexOf("edg")>-1}function isMobile(){return/iphone|ipod|ipad|android|ie|blackberry|fennec/.test(navigator.userAgent.toLowerCase())}function isIOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function isSmallScreen(){return window.innerWidth<=1e3}function isDemoUser(e){return!(isChromeExtension()||isEdgeExtension())&&DEMO_USERS.indexOf(localStorage.id_usuario)>-1&&!(e&&"6"===tablonActual&&esTablonKanban()&&"0"===localStorage["columnaKanban"+e]||e&&isBugsIdeasUser()&&("0"===localStorage["columnaKanban"+e]||"1"===localStorage["columnaKanban"+e]))}function isBugsIdeasUser(){return!(isChromeExtension()||isEdgeExtension())&&"615023"===localStorage.id_usuario}function isKanbanBugsBoard(){return isDemoUser()&&"6"===tablonActual&&esTablonKanban()||isBugsIdeasUser()}if(function(e){e.fn.editInPlace=function(o){var a=e.extend({},e.fn.editInPlace.defaults,o);return function(e){if(e.url||e.callback)return;throw new Error("Need to set either url: or callback: option for the inline editor to work.")}(a),function(e){if(""===e)return;(new Image).src=e}(a.saving_image),this.each((function(){var o=e(this);o.data("editInPlace")||(o.data("editInPlace",!0),new t(a,o).init())}))},e.fn.editInPlace.defaults={url:"",bg_over:"#ffc",bg_out:"",hover_class:"",show_buttons:!1,save_button:'<button class="inplace_save">Save</button>',cancel_button:'<button class="inplace_cancel">Cancel</button>',params:"",field_type:"text",default_text:"(Click here to add text)",use_html:!1,textarea_rows:10,textarea_cols:25,select_text:"Choose new value",select_options:"",text_size:null,saving_text:void 0,saving_image:"",saving_animation_color:"transparent",value_required:!1,element_id:"element_id",update_value:"update_value",original_value:"original_value",original_html:"original_html",save_if_nothing_changed:!1,on_blur:"save",cancel:"",callback:null,callback_skip_dom_reset:!1,success:null,error:null,error_sink:function(e,t){alert(t)},preinit:null,postclose:null,delegate:null};function t(e,t){this.settings=e,this.dom=t,this.originalValue=null,this.didInsertDefaultText=!1,this.shouldDelayReinit=!1}function o(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function a(e){return null!=e&&0!==e.length}e.extend(t.prototype,{init:function(){this.setDefaultTextIfNeccessary(),this.connectOpeningEvents()},reinit:function(){this.shouldDelayReinit||(this.triggerCallback(this.settings.postclose,this.dom),this.triggerDelegateCall("didCloseEditInPlace"),this.markEditorAsInactive(),this.connectOpeningEvents())},setDefaultTextIfNeccessary:function(){""===this.dom.html()&&(this.dom.html(this.settings.default_text),this.didInsertDefaultText=!0)},connectOpeningEvents:function(){var t=this;this.dom.bind("mouseenter.editInPlace",(function(){t.addHoverEffect()})).bind("mouseleave.editInPlace",(function(){t.removeHoverEffect()})).bind("openEditor.editInPlace",(function(e){esTablonPapelera()&&!esPopup()||(t.openEditor(e),t.dblclick=!1)})).bind("dblclick.editInPlace",(function(o){if(isMobile())return!1;t.dblclick=!0;try{var a=parseInt(o.currentTarget.id.substr(5));esPopup()?t.scrollEditor=o.pageY+e("#postit"+a).scrollTop()-80:t.scrollEditor=o.pageY-e("#postit"+a).position().top+e("#texto"+a).scrollTop()-70,t.scrollEditor<200&&(t.scrollEditor=0)}catch(e){t.scrollEditor=0}t.openEditor(o),-1!=t.element.className.indexOf("classTransparent")&&(e(".classTransparent").each((function(){e(this).find(".pencilImg").click()})),e(".classTransparent").removeClass("classTransparent"))}))},disconnectOpeningEvents:function(){this.dom.unbind(".editInPlace")},addHoverEffect:function(){this.settings.hover_class?this.dom.addClass(this.settings.hover_class):this.dom.css("background-color",this.settings.bg_over)},removeHoverEffect:function(){this.settings.hover_class?this.dom.removeClass(this.settings.hover_class):this.dom.css("background-color",this.settings.bg_out)},openEditor:function(t){if((!esTablonPapelera()||esPopup())&&(localStorage.editandoTipo="",this.shouldOpenEditor(t))){var o=t.target;if(this.element=o,"tabLabel"!=o.className&&-1==o.className.indexOf("tabPaneles2")&&-1==o.className.indexOf("tabA")){for(esPopup()&&(this.medidasPopup=getPopupData(winId));o!=document&&-1==o.className.indexOf("postitNB");)o=o.parentNode;if(this.numPost=parseInt(o.id.substr(6)),isKanbanBugsBoard()&&"0"!==localStorage["columnaKanban"+this.numPost]&&"1"!==localStorage["columnaKanban"+this.numPost])return;if(this.tipo=localStorage["tipoA"+this.numPost],this.sinMarco=localStorage["sinMarco"+this.numPost],this.element=o,e(this.element).css("min-width",VALORES_POR_DEFECTO.MIN_WIDTH_EDITANDO_NOTA),!esPopup()&&!notaTieneZoom(this.numPost)){var a=parseInt(localStorage["width"+this.numPost]);a>260?e(this.element).width(a+90+"px"):e(this.element).width("450px")}esTablonKanban()&&e(this.element).css({"margin-left":0,"min-width":0,width:"100%"}).addClass("editing-post"),esPopup()||notaTieneZoom(this.numPost)||e(this.element).height("auto"),esPopup()||quitaMinimizado(this.numPost,!0),e(this.element).css("z-index","1000"),e("#texto"+this.numPost).html(localStorage["postit"+this.numPost]),document.getElementById("postit"+this.numPost).style.transform=""}if(this.settings.save_button='<div class="inplace_save btn waves-effect waves-light grey darken-1" title="CTRL+S">'+chrome.i18n.getMessage("aceptar")+"</div>",this.settings.cancel_button='<div class="inplace_cancel modal-close waves-effect waves-gray btn-flat grey-text text-darken-2" title="CTRL+Q">'+chrome.i18n.getMessage("cancelar")+"</div>",this.disconnectOpeningEvents(),this.removeHoverEffect(),this.removeInsertedDefaultTextIfNeccessary(),this.saveOriginalValue(),this.markEditorAsActive(),-1==o.className.indexOf("tabLabel")&&-1==o.className.indexOf("tabPaneles2")&&-1==o.className.indexOf("tabA")){var i=this.numPost,n='<div class="selector-varios" id="selector'+this.numPost+'"><div class="sinMarcoDiv"><label class="sinMarcoCheckbox"><input type="checkbox" id="sinMarco'+i+'"/><span class="sinMarcoLabel">Sin Marco</span></label></div><img class="pinImgSelecEdit" src="appimg/pushpins/pushpin11.png"/><div class="selectorColor" id="selector'+this.numPost+'"><div id="idblanco'+i+'" class="idblanco2"></div><div id="idamarillo'+i+'" class="idamarillo2"></div><div id="idverde'+i+'" class="idverde2"></div><div id="idlila'+i+'" class="idlila2"></div><div id="idnaranja'+i+'" class="idnaranja2"></div><div id="idrosa'+i+'" class="idrosa2"></div><div id="idrojo'+i+'" class="idrojo2"></div><div id="idazul'+i+'" class="idazul2"></div><div id="idtransparente'+i+'" class="idtransparente2"></div><div id="notepad'+i+'" class="notepadBut"></div><div id="customColor'+i+'" class="customColor2"><svg width="24" height="24"><path d="M12 3a9 9 0 0 0 0 18 1.5 1.5 0 0 0 1.1-2.5c-.2-.3-.4-.6-.4-1 0-.8.7-1.5 1.5-1.5H16a5 5 0 0 0 5-5c0-4.4-4-8-9-8zm-5.5 9a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm3-4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm3 4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z" fill-rule="nonzero"></path></svg></div></div>',r='<div class="selectorPins">';localStorage["pushpin"+i]?r+='<img class="pinImgSelec" src="appimg/pushpins/pushpin'+localStorage["pushpin"+i]+'.png"/>':r+='<img class="pinImgSelec" src="appimg/pushpins/pushpin11.png"/>',r+='<img class="pinImgSelec" src="appimg/pushpins/pushpin11.png"/><img class="pinImgSelec" src="appimg/pushpins/pushpin21.png"/><img class="pinImgSelec" src="appimg/pushpins/pushpin31.png"/></div>',e("#postit"+i+" .bordesup").after(r),e("#postit"+i).find(".pinImgSelec").on("click",(function(e){clickImgSelec(e,i)})),esPopup()&&"true"==localStorage["sinMarco"+i]?(e(".parteSuperior").removeClass("parteSuperior2"),e("#parteSuperior"+this.numPost).after(n).height(30),e(".parteSuperior").css("visibility","visible"),e("#selectorColor"+this.numPost).css("margin-top","10px")):("true"!=localStorage["sinMarco"+i]&&localStorage["tipoA"+i]!=TIPO_NOTA.TRANSPARENTE||(e("#parteSuperior"+i).height(30),e("#fondoIconos"+i).hide()),e("#parteSuperior"+this.numPost).after(n)),esTablonKanban()&&e("#zoomImg"+this.numPost).hide(),isMobile()&&e("#parteSuperior"+this.numPost).hide(),e(".pinImgSelecEdit").attr("title",chrome.i18n.getMessage("selecPin")),e(".pinImgSelec:first-child").attr("title",chrome.i18n.getMessage("quitaPin")),e(".sinMarcoLabel").text(chrome.i18n.getMessage("sinMarco")),e("#idblanco"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.BLANCO,"postit"+i)})),e("#idamarillo"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.AMARILLO,"postit"+i)})),e("#idverde"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.VERDE,"postit"+i)})),e("#idlila"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.LILA,"postit"+i)})),e("#idnaranja"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.AMARILLO2,"postit"+i)})),e("#idrosa"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.ROSA,"postit"+i)})),e("#idrojo"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.ROJO,"postit"+i)})),e("#idazul"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.AZUL,"postit"+i)})),e("#idtransparente"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.TRANSPARENTE,"postit"+i)})),e("#notepad"+this.numPost).on("click",(function(){cambioPostit(TIPO_NOTA.LIBRETA,"postit"+i)})),e("#customColor"+this.numPost).css("background-color","#"+localStorage["tipoA"+i]),esPopup()||iniZoom(this.numPost),e(".customColor2").ColorPicker({color:"#"+localStorage["tipoA"+i],onSubmit:function(t,o,a,i){e(i).val(o),e(i).ColorPickerHide()},onBeforeShow:function(t,o,a,n){e(this).ColorPickerSetColor("#"+localStorage["tipoA"+i])},onChange:function(t,o,a,n){e("#customColor2").css("background-color","#"+o),cambioPostit(o,"postit"+i)}}).bind("keyup",(function(){e(this).ColorPickerSetColor(this.value)})),e("#sinMarco"+i).click((function(){localStorage["sinMarco"+i]=e("#sinMarco"+i).is(":checked"),e("#postit"+i).toggleClass("postitSinMarco"),e("#texto"+i).height("auto")})),"true"==localStorage["sinMarco"+i]?(e("#parteSuperior"+i).css("visibility","visible"),e("#sinMarco"+i).attr("checked",!0)):e("#sinMarco"+i).attr("checked",!1),e("#texto"+i).height("auto"),e("#pencilImg"+this.numPost).hide(),e("#postit"+i).attr("data-tipo",this.tipo),ponAlFrentePost(this.numPost);var s=this;esPopup()||(isSmallScreen()&&(e(this.element).css("min-width",0),"true"!=e("#postit"+this.numPost).attr("data-zoomed")&&zoomNota(null,this.numPost,!1,!0)),setTimeout((function(){isSmallScreen()||e("html, body").animate({scrollTop:e("#postit"+s.numPost).offset().top-100,scrollLeft:e("#postit"+s.numPost).offset().left-100},200,(function(){s.dblclick||muestraAyudaSnackbar("ayudaEditarNota")}))}),400))}this.replaceContentWithEditor()}},shouldOpenEditor:function(e){return!this.isClickedObjectCancelled(e.target)&&(!1!==this.triggerCallback(this.settings.preinit,this.dom)&&!1!==this.triggerDelegateCall("shouldOpenEditInPlace",!0,e))},removeInsertedDefaultTextIfNeccessary:function(){this.didInsertDefaultText&&this.dom.html()===this.settings.default_text&&(this.dom.html(""),this.didInsertDefaultText=!1)},isClickedObjectCancelled:function(t){return!!this.settings.cancel&&0!==e(t).parents().andSelf().filter(this.settings.cancel).length},saveOriginalValue:function(){this.settings.use_html?this.originalValue=this.dom.html():this.originalValue=o(this.dom.text())},restoreOriginalValue:function(){this.setClosedEditorContent(this.originalValue)},setClosedEditorContent:function(e){this.settings.use_html?this.dom.html(e):this.dom.text(e)},workAroundMissingBlurBug:function(){var e=this.dom.find(":input");this.dom.parents(":last").find(".editInPlace-active :input").not(e).blur()},replaceContentWithEditor:function(){var t=this.settings.show_buttons?this.settings.save_button+" "+this.settings.cancel_button:"",o=this.createEditorElement();if(this.dom.html('<form class="inplace_form" style="display: inline; margin: 0; padding: 0;"></form>').find("form").append(o).append(t),e(".inplace_field").css("background","transparent"),-1==this.element.className.indexOf("tabLabel")&&-1==this.element.className.indexOf("tabPaneles2")&&-1==this.element.className.indexOf("tabA")){crearEditor(this.numPost,function(){this.setInitialValue()}.bind(this));var a=this;setTimeout((function(){a.scrollEditor>0&&e("#postit"+a.numPost+" iframe").contents().find("html").animate({scrollTop:a.scrollEditor},300)}),400),this.continuaEditor()}else this.continuaEditor()},cambiaReabre:function(){console.log("cambia"),localStorage.reabriendoEditor="false"},continuaEditor:function(){this.workAroundMissingBlurBug(),this.connectClosingEventsToEditor(),this.triggerDelegateCall("didOpenEditInPlace")},createEditorElement:function(){if(-1===e.inArray(this.settings.field_type,["text","textarea","select"]))throw"Unknown field_type <fnord>, supported are 'text', 'textarea' and 'select'";var t=null;return"select"===this.settings.field_type?t=this.createSelectEditor():"text"===this.settings.field_type?t=e('<input type="text" '+this.inputNameAndClass()+' size="'+this.settings.text_size+'" />'):"textarea"===this.settings.field_type&&(t=e("<textarea "+this.inputNameAndClass()+' rows="'+this.settings.textarea_rows+'"  id="textAreaEdit'+this.numPost+'" cols="'+this.settings.textarea_cols+'" />')),t},setInitialValue:function(){var t=this.triggerDelegateCall("willOpenEditInPlace",this.originalValue),o=this.dom.find(":input");if(o.val(t),this.tipo,o.val()!==t&&o.val(""),-1==this.element.className.indexOf("tabLabel")&&-1==this.element.className.indexOf("tabPaneles2")&&-1==this.element.className.indexOf("tabA"))if(""!=localStorage["editando"+this.numPost]&&null!=localStorage["editando"+this.numPost]&&"undefined"!=localStorage["editando"+this.numPost]&&(t=localStorage["editando"+this.numPost],esPopup()||(e("html, body").animate({scrollTop:e(this.element).offset().top-150},200),e("html, body").animate({scrollLeft:e(this.element).offset().left-100},200))),null!=tinyMCE.get("textAreaEdit"+this.numPost)){tinyMCE.get("textAreaEdit"+this.numPost).setContent(t),tinyMCE.get("textAreaEdit"+this.numPost).focus(),cambiaAparenciaEditor(buscarTipo("postit"+this.numPost),"textAreaEdit"+this.numPost);var a=this;tinyMCE.get("textAreaEdit"+this.numPost).addShortcut("ctrl+q","",(function(){a.handleCancelEditor()}))}else{var i=this.numPost;a=this;intervalEd=setInterval((function(){console.log("voy haciendo en editor"),null!=tinyMCE.get("textAreaEdit"+i)&&(tinyMCE.get("textAreaEdit"+i).setContent(t),tinyMCE.get("textAreaEdit"+i).focus(),tinyMCE.get("textAreaEdit"+i).on("change",(function(e){localStorage["editando"+e.target.id.substr(12)]=e.level.content})),cambiaAparenciaEditor(buscarTipo("postit"+i),"textAreaEdit"+i),clearInterval(intervalEd),tinyMCE.get("textAreaEdit"+i).addShortcut("ctrl+q","",(function(){a.handleCancelEditor()})))}),50)}},inputNameAndClass:function(){return' name="inplace_value" class="inplace_field" '},createSelectEditor:function(){var t=e("<select"+this.inputNameAndClass()+'><option disabled="true" value="">'+this.settings.select_text+"</option></select>"),a=this.settings.select_options;e.isArray(a)||(a=a.split(","));for(var i=0;i<a.length;i++){var n=a[i];e.isArray(n)||(n=n.split(":"));var r=o(n[1]||n[0]),s=o(n[0]),l=e("<option>").val(r).text(s);t.append(l)}return t},connectClosingEventsToEditor:function(){var e=this;function t(t){return e.handleCancelEditor(t),!1}function o(t){return e.handleSaveEditor(t),!1}var a=this.dom.find("form");a.find(".inplace_field").focus().select(),a.find(".inplace_cancel").click(t),a.find(".inplace_save").click(o),this.settings.show_buttons||("save"===this.settings.on_blur?a.find(".inplace_field").blur(o):a.find(".inplace_field").blur(t)),a.keyup((function(e){if(27===e.which)return t()})),a.submit(o)},bindSubmitOnEnterInInput:function(){if("textarea"!==this.settings.field_type){var e=this;this.dom.find(":input").keyup((function(t){if(13===t.which)return e.dom.find("form").submit()}))}},handleCancelEditor:function(t){if(!1!==this.triggerDelegateCall("shouldCloseEditInPlace",!0,t)){if(-1==this.element.className.indexOf("tabLabel")&&-1==this.element.className.indexOf("tabPaneles2")&&-1==this.element.className.indexOf("tabA")){var o=tinyMCE.get("textAreaEdit"+this.numPost).getContent();o=this.triggerDelegateCall("willCloseEditInPlace",o),tinyMCE.get("textAreaEdit"+this.numPost).editorContainer.className.indexOf("mce-fullscreen")>-1&&tinyMCE.get("textAreaEdit"+this.numPost).execCommand("mceFullScreen"),tinyMCE.get("textAreaEdit"+this.numPost).ficherosSubidos&&borrarFicherosSubidos(tinyMCE.get("textAreaEdit"+this.numPost).ficherosSubidos,!0),tinyMCE.get("textAreaEdit"+this.numPost).remove(),localStorage["editando"+this.numPost]="",localStorage.editandoTipo="",quitaZoom(this.numPost),esPopup()||(refrescaNota(this.numPost),refrescaOrdenacion(2500))}else o=this.dom.find(":input").val();this.reinit(),esPopup()&&"true"==localStorage["sinMarco"+this.numPost]&&e(".parteSuperior").addClass("parteSuperior2"),esPopup()?notaWeb()?(nuevaNota()&&(localStorage.removeItem("postit"+this.numPost),localStorage.removeItem("tablon"+this.numPost),localStorage.removeItem("tipoA"+this.numPost),localStorage.removeItem("X"+this.numPost),localStorage.removeItem("Y"+this.numPost),localStorage.removeItem("width"+this.numPost),localStorage.removeItem("height"+this.numPost),localStorage.removeItem("treeId"+this.numPost),localStorage.removeItem("fecha"+this.numPost),localStorage.removeItem("updated"+this.numPost),localStorage.removeItem("calendar"+this.numPost),localStorage.removeItem("sinMarco"+this.numPost),localStorage.removeItem("userComp"+this.numPost),localStorage.removeItem("nickComp"+this.numPost),localStorage.removeItem("errorConexion"+this.numPost),localStorage.removeItem("rotacion"+this.numPost),localStorage.removeItem("pushpin"+this.numPost),localStorage.removeItem("notaWeb"+this.numPost)),chrome.runtime.sendMessage({cierraVentana:winId})):(resizeWindow(winId,this.medidasPopup.width,this.medidasPopup.height),window.moveTo(this.medidasPopup.X,this.medidasPopup.Y),e("#postit"+this.numPost).remove(),notaWeb()||muestraPostit(this.numPost),e(".postitPop").css("width","100%")):"true"==localStorage["sinMarco"+this.numPost]&&(e("#bordesup"+this.numPost).height(0),e("#parteSuperior"+this.numPost).height(0),e("#fondoIconos"+this.numPost).show(),e("#fondoIconos"+this.numPost).css("position","absolute")),ordenaPostitsKanban(),hightlightCode(),sendRealTime(this.numPost),restoreBoardZoom()}},handleSaveEditor:function(t){if(!1!==this.triggerDelegateCall("shouldCloseEditInPlace",!0,t)){if(-1==this.element.className.indexOf("tabLabel")&&-1==this.element.className.indexOf("tabPaneles2")&&-1==this.element.className.indexOf("tabA")){esPopup()||muestraAyudaSnackbar("dobleClickGuardar"),e("#texto"+this.numPost).height()>1600&&(e(this.element).scrollTop(0),e(this.element).css("overflow","hidden"));var o=tinyMCE.get("textAreaEdit"+this.numPost).getContent();localStorage["editando"+this.numPost]="",localStorage["tipoA"+this.numPost]=this.tipo,o=this.triggerDelegateCall("willCloseEditInPlace",o);try{tinyMCE.get("textAreaEdit"+this.numPost).remove()}catch(e){console.log(e)}}else o=this.dom.find(":input").val();var a=e("#urlAssign").is(":checked");if(this.settings.callback?this.handleSubmitToCallback(o):this.handleSubmitToServer(o),-1==this.element.className.indexOf("tabLabel")&&-1==this.element.className.indexOf("tabPaneles2")&&-1==this.element.className.indexOf("tabA")&&(e(this.element).width(localStorage["width"+this.numPost]+"px"),e(this.element).css("min-width",VALORES_POR_DEFECTO.MIN_WIDTH_NOTA),e(this.element).height("auto"),!tieneNotaAlturaAuto(this.numPost)&&e("#postit"+this.numPost).height()+30<parseInt(localStorage["height"+this.numPost])&&(localStorage["height"+this.numPost]=e("#postit"+this.numPost).height()),e("#selector"+this.numPost).remove(),localStorage["editando"+this.numPost]=""),this.markEditorAsInactive(),esPopup()&&"true"==localStorage["sinMarco"+this.numPost]?e(".parteSuperior").addClass("parteSuperior2"):"true"==localStorage["sinMarco"+this.numPost]&&(e("#bordesup"+this.numPost).height(0),e("#parteSuperior"+this.numPost).height(0),e("#fondoIconos"+this.numPost).show(),e("#fondoIconos"+this.numPost).css("position","absolute")),esPopup())if(notaWeb()){if(nuevaNota()){var i={postit:o,tipoA:localStorage["tipoA"+this.numPost],numPost:this.numPost,url:a?getHostFromUrl(paramUrl())+"*":paramUrl(),tabId:paramTabId()};chrome.runtime.sendMessage({creaNotaNuevaWeb:i})}else{var n={numPost:this.numPost,url:a?getHostFromUrl(paramUrl())+"*":paramUrl()};chrome.runtime.sendMessage({cambiaNota:n})}chrome.runtime.sendMessage({cierraVentana:winId})}else resizeWindow(winId,this.medidasPopup.width,this.medidasPopup.height),window.moveTo(this.medidasPopup.X,this.medidasPopup.Y);hightlightCode(),restoreBoardZoom()}},didForgetRequiredText:function(e){return this.settings.value_required&&(""===e||null==e)},isDisabledDefaultSelectChoice:function(){return this.dom.find("option").eq(0).is(":selected:disabled")},isUnchangedInput:function(e){return!this.settings.save_if_nothing_changed&&this.originalValue===e},showSaving:function(t){if(!this.settings.callback||!this.settings.callback_skip_dom_reset){var o=t;a(this.settings.saving_text)&&(o=this.settings.saving_text),a(this.settings.saving_image)&&(o=e("<img />").attr("src",this.settings.saving_image).attr("alt",o)),this.dom.html(o)}},handleSubmitToCallback:function(e){this.enableOrDisableAnimationCallbacks(!0,!1);var t=this.triggerCallback(this.settings.callback,this.id(),e,this.originalValue,this.settings.params,this.savingAnimationCallbacks());this.settings.callback_skip_dom_reset||(void 0===t?(this.reportError("Error: Failed to save value: "+e),this.restoreOriginalValue()):this.dom.html(t)),this.didCallNoCallbacks()&&(this.enableOrDisableAnimationCallbacks(!1,!1),this.reinit())},handleSubmitToServer:function(t){var o=this.settings.update_value+"="+encodeURIComponent(t)+"&"+this.settings.element_id+"="+this.dom.attr("id")+(this.settings.params?"&"+this.settings.params:"")+"&"+this.settings.original_html+"="+encodeURIComponent(this.originalValue)+"&"+this.settings.original_value+"="+encodeURIComponent(this.originalValue);this.enableOrDisableAnimationCallbacks(!0,!1),this.didStartSaving();var a=this;e.ajax({url:a.settings.url,type:"POST",data:o,dataType:"html",complete:function(e){a.didEndSaving()},success:function(e){var t=e||a.settings.default_text;a.dom.html(t),a.triggerCallback(a.settings.success,e)},error:function(e){a.dom.html(a.originalHTML),a.settings.error?a.triggerCallback(a.settings.error,e):a.reportError("Failed to save value: "+e.responseText||"Unspecified Error")}})},triggerCallback:function(e){if(e){var t=Array.prototype.slice.call(arguments,1);return e.apply(this.dom[0],t)}},triggerDelegateCall:function(t,o,a){if(!this.settings.delegate||!e.isFunction(this.settings.delegate[t]))return o;var i=this.settings.delegate[t](this.dom,this.settings,a);return void 0===i?o:i},reportError:function(e){this.triggerCallback(this.settings.error_sink,this.id(),e)},id:function(){return this.dom.attr("id")},markEditorAsActive:function(){this.dom.addClass("editInPlace-active")},markEditorAsInactive:function(){this.dom.removeClass("editInPlace-active")},savingAnimationCallbacks:function(){var e=this;return{didStartSaving:function(){e.didStartSaving()},didEndSaving:function(){e.didEndSaving()}}},enableOrDisableAnimationCallbacks:function(e,t){this.didStartSaving.enabled=e,this.didEndSaving.enabled=t},didCallNoCallbacks:function(){return this.didStartSaving.enabled&&!this.didEndSaving.enabled},assertCanCall:function(e){if(!this[e].enabled)throw new Error("Cannot call "+e+" now. See documentation for details.")},didStartSaving:function(){this.assertCanCall("didStartSaving"),this.shouldDelayReinit=!0,this.enableOrDisableAnimationCallbacks(!1,!0),this.startSavingAnimation()},didEndSaving:function(){this.assertCanCall("didEndSaving"),this.shouldDelayReinit=!1,this.enableOrDisableAnimationCallbacks(!1,!1),this.reinit(),this.stopSavingAnimation()},startSavingAnimation:function(){var e=this;this.dom.animate({backgroundColor:this.settings.saving_animation_color},400).animate({backgroundColor:"transparent"},400,"swing",(function(){setTimeout((function(){e.startSavingAnimation()}),10)}))},stopSavingAnimation:function(){this.dom.stop(!0).css({backgroundColor:""})},missingCommaErrorPreventer:""})}(jQuery),!isChromeExtension()){var chrome=chrome||{};chrome.permissions={},chrome.permissions.request=function(e,t){console.log(e),t&&t(!0)},chrome.permissions.contains=function(e,t){console.log(e),t&&t(!0)},chrome.i18n={},chrome.i18n.getMessage=function(e){return getMessage(e)},chrome.runtime={onMessage:{addListener:function(e){window.addEventListener("storage",(function(t){if("eventMessage"==t.key)try{console.log(localStorage.eventMessage),e(JSON.parse(localStorage.eventMessage))}catch(e){console.log(e)}}),!1),document.addEventListener("NoteBoardMessage",(t=>{e(t.detail)}))}},sendMessage:function(e){e={...e,noCache:(new Date).getTime()},localStorage.setItem("eventMessage",JSON.stringify(e)),document.dispatchEvent(new CustomEvent("NoteBoardMessage",{detail:{...e}}))},getURL:e=>(!isChromeExtension()&&e.indexOf("popup2.html")>-1&&(e=e.replace(".html",".php")),e),setUninstallURL:()=>{}},chrome.action={setBadgeText:()=>{},setTitle:()=>{},onClicked:{addListener:()=>{}}},chrome.windows={getAll:function(e){},onRemoved:{addListener:e=>{$(window).on("unload",(function(){e()}))}},create:function(e,t){var o=`toolbar=yes,scrollbars=yes,resizable=yes,top=${e.top},left=${e.left},width=${e.width},height=${e.height}`;window.open(e.url,"_blank",o).onload=t},update:(e,{width:t,height:o})=>{console.log(e),console.log(t),console.log(o)},getCurrent:()=>{}},chrome.tabs={create:function(e){window.open(e.url,"_blank")},onUpdated:{addListener:()=>{}},onRemoved:{addListener:()=>{}},onCreated:{addListener:()=>{}}},chrome.alarms={create:()=>{},onAlarm:{addListener:()=>{}}},chrome.extension={getBackgroundPage:function(){return{asignaNumeroTablon:asignaNumeroTablon,errorConexion:errorConexion,empiezaSincroPeriodica:empiezaSincroPeriodica,cierraPopup:cierraPopup,irAnotaPopup:irAnotaPopup}}},chrome.commands={onCommand:{addListener:()=>{}}},chrome.contextMenus={removeAll:()=>{},onClicked:{addListener:()=>{}}},getLocalStorage=async function(){return new Promise((e=>{e()}))},setAllLocalStorage=async function(){return new Promise((e=>{e()}))},setLocalStorage=async function(){return new Promise((e=>{e()}))}}function getServerUrl(){return isChromeExtension()?"https:/www.noteboardapp.com/":""}function isMovilApp(){return!1}function HayEspacios(e){return e.indexOf(" ")>-1}function cambiaContador(){var e=0;switch(null!=localStorage.contador&&"undefined"!=localStorage.contador||(localStorage.contador="1"),localStorage.contador){case"1":for(i=0;i<localStorage.totalPost;i++)(null!=localStorage["tablon"+i]&&"undefined"!=localStorage["tablon"+i]||1!=tablonActual)&&localStorage["tablon"+i]!=tablonActual||e++;break;case"2":e=localStorage.totalPost;break;case"3":e=0}e>0?chrome.action.setBadgeText({text:String(e)}):chrome.action.setBadgeText({text:""}),actualizaNombreTablon(tablonActual)}function refrescaNota(e){if(!esBackground())if(esPopup())$(".selector-varios").remove(),$(".textoNB").html(localStorage["postit"+e]);else{var t=$("#postit"+e).index();$("#postit"+e).remove(),muestraPostit(e,t),esTablonKanban()&&refrescaKanban(),refreshConnections(),hightlightCode()}}function muestraTodasLasNotas(){for(var e=localStorage.totalPost-1;e>=0;e--)muestraPostit(e);hazKanbanSortable(),refreshConnections(),hightlightCode()}function refrescaPantalla(e,t,o){if(!esBackground()&&!esPopup()){quitaZoomNotas(),e||muestraPaneles2(!1,!1),$(".sharePanel").remove(),t?$(".postitNB:not(#postitnuevo)").remove():$(".postitNB:not(#postitnuevo)").each((function(){var e=$(this).attr("data-numpost");parseInt(e)>=parseInt(localStorage.totalPost)&&$(this).remove()})),esTablonKanban()?inicializaKanban():borraKanban();for(var a=localStorage.totalPost-1;a>=0;a--)!t&&localStorage["editando"+a]&&e&&tinyMCE.get("textAreaEdit"+a)&&tinyMCE.get("textAreaEdit"+a).remove(),localStorage["editando"+a]&&!e||o&&$("#texto"+a).html()==localStorage["postit"+a]||($("#postit"+a).remove(),muestraPostit(a));esTabCompartido(tablonActual)?trataTablonComp():inicializaFriendsBot(),hazKanbanSortable(),refrescaKanban(),refrescaOrdenacion(),deslizaPostVisibles(null,!0),detectColorContrastBackground().then((()=>{refreshConnections(),$(".columna").css("borderColor",defaultColorContrastBackground)})),null==localStorage["fondo"+tablonActual]||"NaN"==localStorage["fondo"+tablonActual]||cambioTablon.sliding||cambiaFondoNum(localStorage["fondo"+tablonActual]),$(".ajaxloader").remove(),$("#Postits").imagesLoaded((function(){cambiaIcono()})),hightlightCode(),!e&&compruebaLimites(),cambiaIcono(),cambiaContador()}}function deslizaPostVisibles(e,t){var o=$(".paneles2").innerHeight()>10&&$(".paneles2").innerHeight()||$(".botones").innerHeight()||localStorage.previousHeight;o>10?localStorage.previousHeight=o:o=localStorage.previousHeight;var a=esTablonKanban()?30:0;if("down"==e)var i="+="+o+"px";else i="-="+o+"px";if(t){var n=parseInt($(".paneles2").innerHeight()+$(".titulo-kanban").height()+70+a)+"px";$("#canvasDiv").css("top",n)}else if($("#canvasDiv").animate({top:i}),esTablonKanban())$(".columna-wrapper").animate({"padding-top":i},(function(){$(".columna").height(window.innerHeight-$(".botones").height()-$(".titulo-kanban").height()-30)}));else for(var r=0;r<localStorage.totalPost;r++)(null!=localStorage["tablon"+r]&&"undefined"!=localStorage["tablon"+r]||1!=tablonActual)&&localStorage["tablon"+r]!=tablonActual||$("#postit"+r).animate({top:i});isSmallScreen()&&(compruebaCanvasPosEnMovil(500),compruebaCanvasPosEnMovil(2e3))}function muestraVotar(){if(isChromeExtension()){var e=isEdgeExtension()?"escribeReviewEdge":"escribeReview";"false"!=localStorage[e]&&sweetAlert({type:"info",text:chrome.i18n.getMessage(e),confirmText:chrome.i18n.getMessage("noMostrarMas"),cancel:!0,cancelText:chrome.i18n.getMessage("votar"),successCallback:function(){localStorage[e]="false"},cancelCallback:function(){isEdgeExtension()?window.open("https://microsoftedge.microsoft.com/addons/detail/note-board-sticky-notes/ehnmbncdeiinoaojbfjldmghkhjhlkli","_newtab"):window.open("https://chrome.google.com/webstore/detail/note-board/goficmpcgcnombioohjcgdhbaloknabb/reviews","_newtab")}})}}function pidePermiso(e,t){sweetAlert({text:chrome.i18n.getMessage(e),successCallback:function(){permisoOrigenes(t)}})}function permisoOrigenes(e){chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(function(t){t?(e&&creaFondo(),console.log("concedido")):console.log("no concedido")}))}function pidePermisoImagenes(e,t,o){"false"!=localStorage[e]&&sweetAlert({text:chrome.i18n.getMessage(e),successCallback:function(){permisoOrigenesImagenes(t,o)}})}function permisoOrigenesImagenes(e,t){chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(function(o){o?(abreFormularioAnexa(e,t),console.log("concedido")):console.log("no concedido")}))}function sendMessage(e){chrome.runtime.sendMessage(e)}function listenMessage(e,t){chrome.runtime.onMessage.addListener((function(o,a){for(var i in o)i==e&&t(o,a)}))}function formateaFecha(e){var t="",o=("0"+e.getFullYear()).slice(-2),a=("0"+parseInt(e.getMonth()+1)).slice(-2),i=("0"+e.getDate()).slice(-2);return t=idiomaEsp(navigator.language)?i+"-"+a+"-"+o:a+"-"+i+"-"+o,t+=" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}function idiomaEsp(e){return"es"==navigator.language||"ca"==navigator.language||"es-419"==navigator.language||"es-ES"==navigator.language}function buscarText(e){var t=new Array,o=document.createElement("div"),a=0;if(0!=e.indexOf(">")&&0!=e.indexOf("<")||(a=parseInt(e.substr(1))),a)for(var i=0==e.indexOf(">"),n=0;n<localStorage.totalPost;n++)"0"!=localStorage["tablon"+n]&&(i&&difFechas(localStorage["fecha"+n])>a&&t.push(n),!i&&difFechas(localStorage["fecha"+n])<a&&t.push(n));else for(n=0;n<localStorage.totalPost;n++){o.innerHTML=localStorage["postit"+n],o.innerText.toLowerCase().indexOf(e.toLowerCase())>-1&&t.push(n)}return t}function ponAlFrente(e,t){if(-1==e.target.className.indexOf("mce_")&&-1==e.target.className.indexOf("inplace")&&"calendar"!=e.target.className){var o=maxZindex();$("#postit"+t).css("z-index",o+1)}}function ponAlFrentePost(e){var t=maxZindex();$("#postit"+e).css("z-index",t+1)}function maxZindex(e=""){var t=10;return $(".postitNB:not(#postit"+e+")").each((function(e){var o=$(this);"postitnuevo"!=o.attr("id")&&"auto"!=o.css("z-index")&&t<parseInt(o.css("z-index"))&&(t=parseInt(o.css("z-index")))})),t}function colorLuminance(e,t){(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var o,a,i="#";for(a=0;a<3;a++)o=parseInt(e.substr(2*a,2),16),i+=("00"+(o=Math.round(Math.min(Math.max(0,o+o*t),255)).toString(16))).substr(o.length);return i}function esColorOscuro(e){return"white"===getContrastYIQ(e)}function getContrastYIQ(e){return(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3>=65?"black":"white"}function youtube_parser(e){var t=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);if(t&&11==t[7].length)return t[7];console.log("Url incorrecta")}function pausecomp(e){var t=new Date,o=null;do{o=new Date}while(o-t<e)}function validaURL(e){return/https?:\/\/(www\.)?[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi.test(e)}var imgs=new Array;function preloadImages(e){e=e||tablonActual;for(var t=0;t<localStorage.totalPost;t++)if(esNotaVisibleEnTablon(t,e)){imgs[t]=void 0;var o=document.createElement("DIV");o.innerHTML=localStorage["postit"+t];var a=o.querySelectorAll("img:not(.link-upload-img)");if(a.length>0&&(imgs[t]=new Image,imgs[t].src=a[0].src),localStorage["postit"+t]&&localStorage["postit"+t].indexOf('src="http://www.youtube.com/embed')>-1){var i=localStorage["postit"+t].indexOf('src="http://www.youtube.com')+5,n=localStorage["postit"+t].indexOf('"',i),r=localStorage["postit"+t].substring(i,n);imgs[t]=new Image,imgs[t].src="http://img.youtube.com/vi/"+youtube_parser(r)+"/0.jpg"}}}function closePaneles(e){"paneles"!=e&&($(".paneles").fadeOut(),$("#panelBotDiv").css({"box-shadow":"0 0 0px black inset"})),"searchPanel"!=e&&($(".searchPanel").fadeOut(),$("#searchBot").css({"box-shadow":"0 0 0px black inset"})),"fondos"!=e&&($(".fondos").fadeOut(),$("#cambFondo").css({"box-shadow":"0 0 0px black inset"})),"nicksComp"!=e&&($(".nicksComp").fadeOut(),$("#compBot").css({"box-shadow":"0 0 0px black inset"})),"panelFuentes"!=e&&($(".panelFuentes").fadeOut(),$("#cambF").css({"box-shadow":"0 0 0px black inset"}))}function mirarSiCerrar(e){$(".searchPanel").is(":visible")&&-1==numPostSearch&&0==$(e).closest(".searchPanel").length&&($(".searchPanel").fadeOut(),$("#searchBot").css({"box-shadow":"0 0 0px black inset"}),$(".searchResult").remove()),$(".fondos").is(":visible")&&0==$(e).closest(".fondos").length&&($(".fondos").fadeOut(),$("#cambFondo").css({"box-shadow":"0 0 0px black inset"})),$(".nicksComp").is(":visible")&&0==$(e).closest(".nicksComp").length&&($(".nicksComp").fadeOut(),$("#compBot").css({"box-shadow":"0 0 0px black inset"})),$(".panelFuentes").is(":visible")&&0==$(e).closest(".panelFuentes").length&&($(".panelFuentes").fadeOut(),$("#cambF").css({"box-shadow":"0 0 0px black inset"}))}function algunoPublico(){for(var e=1;e<=localStorage.numTablones;e++)if("true"==localStorage["publico"+e])return!0;return!1}function nombreTablon(e=tablonActual){return-999==e?chrome.i18n.getMessage("tablonWeb"):0==e?chrome.i18n.getMessage("papelera"):(null!=localStorage["tab"+e+"Label"]&&"undefined"!=localStorage["tab"+e+"Label"]&&""!=localStorage["tab"+e+"Label"]||(localStorage["tab"+e+"Label"]=chrome.i18n.getMessage("tablon")+e),localStorage["tab"+e+"Label"])}function ordenTablon(e){return null!=localStorage["ordenTablon"+e]&&"undefined"!=localStorage["ordenTablon"+e]?localStorage["ordenTablon"+e]:e}function wrapText(e,t){var o,a=new RegExp(t.replace(/[\\^$*+.?[\]{}()|]/,"\\$&"),"i"),i=[];e.normalize();for(var n=e.firstChild;null!=n;){if(n.nodeType==Node.TEXT_NODE){o="string"==typeof n.textContent?n.textContent:n.innerText;var r=a.exec(o);if(null!=r){var s=document.createDocumentFragment();r.index>0&&s.appendChild(document.createTextNode(r.input.substr(0,r.index)));var l=document.createElement("span");l.className="spanNoteBoard",l.appendChild(document.createTextNode(r[0])),s.appendChild(l),r.index+r[0].length<r.input.length&&s.appendChild(document.createTextNode(r.input.substr(r.index+r[0].length))),n.parentNode.replaceChild(s,n),n=l}}else if(n.nodeType==Node.ELEMENT_NODE&&null!=n.firstChild){i.push(n),n=n.firstChild;continue}for(;null!=n&&null==n.nextSibling;)n=i.pop();null!=n&&(n=n.nextSibling)}}function isValidDate(e){return e&&"undefined"!==e}function difFechas(e,t,o){if(!isValidDate(e)||t&&!isValidDate(t))return 0;try{if(e.indexOf("/")&&(e=e.replace(/\//g,"-")),1==e.indexOf("-")&&(e="0"+e),4==e.indexOf("-",3)&&(e=e.substr(0,3)+"0"+e.substr(3)),2==e.indexOf("-")){var a=e;e=idiomaEsp(navigator.language)?e.substr(6)+"-"+e.substr(3,2)+"-"+e.substr(0,2):e.substr(6)+"-"+e.substr(0,2)+"-"+e.substr(3,2)}o=o||"days";var i=36e5,n=24*i;e=new Date(e);var r=(t=t?new Date(t):new Date)-e;if(isNaN(r)){e=idiomaEsp(navigator.language)?a.substr(6)+"-"+a.substr(0,2)+"-"+a.substr(3,2):a.substr(6)+"-"+a.substr(3,2)+"-"+a.substr(0,2);r=t-(e=new Date(e))}if(isNaN(r))return NaN;switch(o){case"years":return t.getFullYear()-e.getFullYear();case"months":return 12*t.getFullYear()+t.getMonth()-(12*e.getFullYear()+e.getMonth());case"weeks":return Math.floor(r/6048e5);case"days":return Math.floor(r/n);case"hours":return Math.floor(r/i);case"minutes":return Math.floor(r/6e4);case"seconds":return Math.floor(r/1e3);default:return}}catch(e){return console.log(e),0}}function clickImgSelecEdit(e){$(this).parent().parent().find(".selectorPins").slideToggle();var t=$(this).parent().parent().find(".subSelectorPins");t.length>0&&t.is(":visible")&&t.slideUp()}function clickImgSelec(e,t){if(t>=0){var o=$("#postit"+t);$this=$(e.target)}else{o=$("#postitnuevo");$this=$(this)}var a=o.find(".pinImgSelec").index(e.target),i=$this.closest(".selectorPins").parent().find(".subSelectorPins");if(0==a&&o.find(".pinImg").remove(),0==a||$this.closest(".selectorPins").parent().find(".tipoPins"+a).length>0)i.slideUp((function(){$(this).remove()}));else{i.slideUp((function(){$(this).remove()}));for(var n='<div class="subSelectorPins tipoPins'+a+'" data-tipopin="'+a+'" data-postit="'+o.attr("id")+'">',r=1;r<=7;r++)n+='<img class="subPinImgSelec" src="appimg/pushpins/pushpin'+a+r+'.png">';n+="</div>",$this.closest(".selectorPins").after(n),$this.closest(".selectorPins").parent().find(".subSelectorPins").slideDown(),$(".subPinImgSelec").on("click",subClickImgSelec)}}function subClickImgSelec(e){var t=$(this).closest(".subSelectorPins").data("tipopin"),o=$(this).closest(".subSelectorPins").data("postit"),a=$("#"+o).find(".subPinImgSelec").index(e.target)+1;$("#"+o+" .pinImg").remove(),a>0&&$("#"+o).append('<img class="pinImg" data-pushpin="'+t+a+'" src="appimg/pushpins/pushpin'+t+a+'.png" />'),$(this).parent().parent().find(".pinImgSelec:first-child").attr("src","appimg/pushpins/pushpin"+t+a+".png")}function esTablonNotasWeb(e=tablonActual){return-999==e}function esTablonPapelera(e=tablonActual){return 0==e}function salSiPapelera(){return!!esTablonPapelera()&&(sweetAlert({type:"error",text:chrome.i18n.getMessage("salSiPapelera"),cancel:!1}),!0)}function inicializaPapelera(){esTablonPapelera()?($("#papelera").css({"box-shadow":"0 0 50px black inset"}),$("#botonVaciarPapelera").show()):($("#papelera").css({"box-shadow":"0 0 0px black inset"}),$("#botonVaciarPapelera").hide());for(var e=0;e<localStorage.totalPost;e++)if("0"==localStorage["tablon"+e])return void $("#papelera").find("img").attr("src","appimg/papeleraLlena.png");$("#papelera").find("img").attr("src","appimg/papelera.png"),$("#botonVaciarPapelera").hide()}function vaciarPapelera(e,t){if(t)vaciarPapeleraConfirmado(t);else{var o=chrome.i18n.getMessage("confirmarPapelera");idiomaEsp(navigator.language)&&(o="¿"+o),sweetAlert({type:"question",text:o,cancel:!0,successCallback:vaciarPapeleraConfirmado})}}function vaciarPapeleraConfirmado(e){for(var t=new Array,o=0;o<localStorage.totalPost;)"0"==localStorage["tablon"+o]&&(!e||difFechas(localStorage["fecha"+o])>e)?(isUserConnected()&&t.push(localStorage["treeId"+o]),borrarConfirmado(o,!1,!0)):o++;isUserConnected()&&t.length>0&&borraListaNotas(t)}function tirarPostitPapelera(e,t){if("nuevopost"!=e){muestraAyudaSnackbar("tiraPapelera"),$("#papelera").find("img").attr("src","appimg/papeleraLlena.png");var o=$("#postit"+e);borrarCalendar(e),o.css("z-index","998998998"),o.animate({top:"50",left:"50",zoom:"0",opacity:"0.3"},800,(function(){o.remove(),t&&t()})),sendRealTime(e,{delete:!0})}}function moverPostitTablon(e,t,o){var a=$("#postit"+e);a.css("z-index","998998998"),-999==t&&0==$("#tabPa2"+t).length&&muestraPaneles2(),esTablonCompartido(t)&&sendRealTime(e,{create:!0},t),esTablonCompartido(tablonActual)&&sendRealTime(e,{delete:!0},tablonActual),a.animate({top:$("#tabPa2"+t).offset().top,left:$("#tabPa2"+t).offset().left,opacity:"0.2"},400,(function(e){a.remove(),o&&o(),refrescaOrdenacion()}))}function notaEnPapelera(e){return"0"==localStorage["tablon"+e]}function borrarConfirmado(e,t,o){var a=localStorage["tablon"+e];for($(".sharePanel").remove(),!isUserConnected()||o||esNotaCompartida(e)||deleteNoteLogin(e),isUserConnected()||esNotaCompartida(e)||compruebaBorrarImagen(localStorage["postit"+e]),$("#postit"+e).remove(),borrarCalendar(e),borraPopupConfirmado(e),localStorage.totalPost--,i=e;i<localStorage.totalPost;i++)localStorage["postit"+i]=localStorage["postit"+(i+1)],localStorage["tipoA"+i]=localStorage["tipoA"+(i+1)],localStorage["tablon"+i]=localStorage["tablon"+(i+1)],localStorage["X"+i]=localStorage["X"+(i+1)],localStorage["Y"+i]=localStorage["Y"+(i+1)],localStorage["width"+i]=localStorage["width"+(i+1)],localStorage["height"+i]=localStorage["height"+(i+1)],localStorage["treeId"+i]=localStorage["treeId"+(i+1)],localStorage["fecha"+i]=localStorage["fecha"+(i+1)],localStorage["calendar"+i]=localStorage["calendar"+(i+1)],localStorage["sinMarco"+i]=localStorage["sinMarco"+(i+1)],null!=localStorage["updated"+(i+1)]?(localStorage["updated"+i]=localStorage["updated"+(i+1)],localStorage.removeItem("updated"+(i+1))):localStorage.removeItem("updated"+i),null!=localStorage["rotacion"+(i+1)]?(localStorage["rotacion"+i]=localStorage["rotacion"+(i+1)],localStorage.removeItem("rotacion"+(i+1))):localStorage.removeItem("rotacion"+i),null!=localStorage["pushpin"+(i+1)]?(localStorage["pushpin"+i]=localStorage["pushpin"+(i+1)],localStorage.removeItem("pushpin"+(i+1))):localStorage.removeItem("pushpin"+i),null!=localStorage["notaWeb"+(i+1)]?(localStorage["notaWeb"+i]=localStorage["notaWeb"+(i+1)],localStorage.removeItem("notaWeb"+(i+1))):localStorage.removeItem("notaWeb"+i),null!=localStorage["userComp"+(i+1)]?(localStorage["userComp"+i]=localStorage["userComp"+(i+1)],localStorage["nickComp"+i]=localStorage["nickComp"+(i+1)],localStorage.removeItem("userComp"+(i+1)),localStorage.removeItem("nickComp"+(i+1))):(localStorage.removeItem("userComp"+i),localStorage.removeItem("nickComp"+i)),null!=localStorage["errorConexion"+(i+1)]?(localStorage["errorConexion"+i]=localStorage["errorConexion"+(i+1)],localStorage.removeItem("errorConexion"+(i+1))):localStorage.removeItem("errorConexion"+i),null!=localStorage["columnaKanban"+(i+1)]?(localStorage["columnaKanban"+i]=localStorage["columnaKanban"+(i+1)],localStorage.removeItem("columnaKanban"+(i+1))):localStorage.removeItem("columnaKanban"+i),null!=localStorage["connections"+(i+1)]?(localStorage["connections"+i]=localStorage["connections"+(i+1)],localStorage.removeItem("connections"+(i+1))):localStorage.removeItem("connections"+i),null!=localStorage["minimizado"+(i+1)]?(localStorage["minimizado"+i]=localStorage["minimizado"+(i+1)],localStorage.removeItem("minimizado"+(i+1))):localStorage.removeItem("minimizado"+i),null!=imgs[i+1]?imgs[i]=imgs[i+1]:imgs[i]=void 0;updateConnectionsBorrado(e),refrescaPantalla(!1,!0),localStorage.removeItem("postit"+localStorage.totalPost),localStorage.removeItem("tablon"+localStorage.totalPost),localStorage.removeItem("tipoA"+localStorage.totalPost),localStorage.removeItem("X"+localStorage.totalPost),localStorage.removeItem("Y"+localStorage.totalPost),localStorage.removeItem("width"+localStorage.totalPost),localStorage.removeItem("height"+localStorage.totalPost),localStorage.removeItem("treeId"+localStorage.totalPost),localStorage.removeItem("fecha"+localStorage.totalPost),localStorage.removeItem("updated"+localStorage.totalPost),localStorage.removeItem("calendar"+localStorage.totalPost),localStorage.removeItem("sinMarco"+localStorage.totalPost),localStorage.removeItem("userComp"+localStorage.totalPost),localStorage.removeItem("nickComp"+localStorage.totalPost),localStorage.removeItem("errorConexion"+localStorage.totalPost),localStorage.removeItem("rotacion"+localStorage.totalPost),localStorage.removeItem("pushpin"+localStorage.totalPost),localStorage.removeItem("notaWeb"+localStorage.totalPost),localStorage.removeItem("columnaKanban"+localStorage.totalPost),localStorage.removeItem("connections"+localStorage.totalPost),imgs[localStorage.totalPost]=void 0,"0"!=a||esBackground()||inicializaPapelera(),"function"==typeof aplicaMasonry&&(preloadImages(),aplicaMasonry()),cambiaIcono(),cambiaContador()}function compruebaBorrarImagen(e){if(e){var t=e.indexOf("https://www.noteboardapp.com/users/");t>-1&&borrarImagen(e.substring(t,e.indexOf(".",t+30)+4)),(t=e.indexOf("https://noteboardapp.s3.amazonaws.com/users/"))>-1&&borrarFicherosAws(e,!0)}}function esNotaWeb(e){return null!=localStorage["notaWeb"+e]}function notaPerteneceUrl(e,t){if(!localStorage["notaWeb"+e])return!1;var o=localStorage["notaWeb"+e].split("||");return o[0].endsWith("/*")?getHostFromUrl(o[0]).replace(/(^\w+:|^)\/\//,"")==getHostFromUrl(t).replace(/(^\w+:|^)\/\//,""):o[0].replace(/(^\w+:|^)\/\//,"")==t.replace(/(^\w+:|^)\/\//,"")}function urlDeNotaWeb(e){return localStorage["notaWeb"+e]?localStorage["notaWeb"+e].split("||")[0]:""}function algunaNotaWeb(){for(var e=0;e<localStorage.totalPost;e++)if("-999"==localStorage["tablon"+e])return!0;return!1}function getPosicionNotaWeb(e){if(localStorage["notaWeb"+e]){var t=localStorage["notaWeb"+e].split("||");return{x:t[1],y:t[2]}}}function setPosicionNotaWeb(e,t,o){if(localStorage["notaWeb"+e]){var a=localStorage["notaWeb"+e].split("||");a[1]=t,a[2]=o,localStorage["notaWeb"+e]=a.join("||")}}function setUrlNotaWeb(e,t){if(localStorage["notaWeb"+e]){var o=localStorage["notaWeb"+e].split("||");o[0]=t,localStorage["notaWeb"+e]=o.join("||")}}async function modificaNotaWeb(e){var t=e.numPost;e.width&&(localStorage["width"+t]=e.width),e.height&&!tieneNotaAlturaAuto(t)&&(localStorage["height"+t]=e.height),e.left&&setPosicionNotaWeb(t,e.left,e.top),e.url&&setUrlNotaWeb(t,e.url),isUserConnected()&&updateNotaLogin(t),await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})}async function borraNotaWeb(e){var t=e.numPost;localStorage["tablon"+t]=0;var o=new Date;idiomaEsp(navigator.language)?localStorage["fecha"+t]=o.getDate()+"/"+(o.getMonth()+1)+"/"+o.getFullYear():localStorage["fecha"+t]=o.getMonth()+1+"/"+o.getDate()+"/"+o.getFullYear(),isUserConnected()&&updateNotaLogin(t),await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})}async function adjuntaHtmlWeb(e){var t=e.numPost,o=e.html;localStorage["postit"+t]+="<br>"+compruebaVideos(o),"auto"==localStorage["width"+t]&&(localStorage["width"+t]=$("#postit"+t).width()),$("#postit"+t).remove(),isUserConnected()&&updateNotaLogin(t),getCalendarMail(t)&&crearRegistroMail(t),await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})}function cierraVentana(){setTimeout((function(){window.close()}),3e3)}function puntoEnPostit(e,t,o){var a=$("#postit"+e);if(!a.is(":visible"))return!1;var i=parseInt(localStorage["X"+e]),n=parseInt(localStorage["Y"+e]),r=a.width(),s=a.height();return i<=t&&t<=i+r&&n<=o&&o<=n+s}function webkitBrowser(){return navigator.userAgent.toLowerCase().indexOf("webkit")>-1}function elementoEncima(e,t){var o=e.height()||30,a=e.offset().top,i=e.offset().left,n=a+o,r=i+e.width(),s=t.offset().top,l=t.offset().left,c=s+t.height(),u=l+t.width();return!(n<s||a>c||r<l||i>u)}function inicializaTema(e){(e||"default"==localStorage.seleccionTema)&&$("body").removeClass("metal piedra marmol lava colorNegro colorGris colorBlanco colorAzul colorVerde"),localStorage.seleccionTema&&("colorGris"!=localStorage.seleccionTema||e)&&"default"!=localStorage.seleccionTema&&($("body").addClass(localStorage.seleccionTema),$(".paneles2").css({"background-position":"right top"}),"colorBlanco"==localStorage.seleccionTema&&$(".boardsSwitch").css("filter","invert(1)"))}function ponTooltipPaneles2(){$(".tabPaneles2").each((function(){var e=$(this).attr("id").substr(6);"+"!=e&&$(this).tooltipster({content:'<div class="contenedor-tablon-tooltip"><div class="borrar-tablon-tooltip" id="borraTabToo'+e+'"><img src="appimg/removeWhite.png"></div><canvas id="canvasTooltip'+e+'" class="canvas-tooltip" width="125" height="100"></canvas></div>',contentCloning:!1,contentAsHTML:!0,theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:100,functionReady:function(){dibujaMaqueta("canvasTooltip"+e,e,125,100),$("#canvasTooltip"+e).off().on("click",(function(){clickTablon(null,!1,e)})),$("#borraTabToo"+e).off().on("click",(function(){borraTablon(e)})),$(".borrar-tablon-tooltip").attr("title",chrome.i18n.getMessage("borraTablon"))},interactive:!0})}))}function compruebaNotasWeb(){if(!isChromeExtension())return!1;for(var e=!1,t=0;t<localStorage.totalPost;t++)if(esNotaWeb(t)){e=!0;break}e&&(document.URL.indexOf("popup.html")>0||document.URL.indexOf("options.html")>0?chrome.permissions.contains({permissions:["tabs"],origins:["http://*/*","https://*/*"]},(function(e){e||sweetAlert({text:chrome.i18n.getMessage("notasWebPermisos"),successCallback:function(){chrome.permissions.request({permissions:["tabs"],origins:["http://*/*","https://*/*"]},(function(e){e&&console.log("aceptado")}))},cancel:!1,type:"warning"})})):sendMessage({mensBack:"compruebaNotasWeb"}))}function checkOverflow(e){var t=e.style.overflow;t&&"visible"!==t||(e.style.overflow="hidden");var o=e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight;return e.style.overflow=t,o}function postitNoVisibleEntero(e){return checkOverflow(document.getElementById("texto"+e))}function compruebaPostitDebajoDeOtros(){"true"==localStorage["masonry"+tablonActual]&&0===$(".pinnedNB").length||$(".postitNB").each((function(){var e=parseInt($(this).attr("id").substr(6));x=parseInt(localStorage["X"+e]),y=parseInt(localStorage["Y"+e]),widthPost=$("#postit"+e).width(),heightPost=$("#postit"+e).height(),$(".postitNB").each((function(){var t=parseInt($(this).attr("id").substr(6));if(t!=e&&puntoEnPostit(t,x,y)&&puntoEnPostit(t,x+widthPost,y)&&puntoEnPostit(t,x,y+heightPost)&&puntoEnPostit(t,x+widthPost,y+heightPost)){var o=maxZindex();$("#postit"+e).css("z-index",o+1)}}))}))}function limpiaNombreTablon(e){return e.replace(/\\/g,"").replace(/\"/g,"")}function clearSelection(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){window.getSelection().removeAllRanges()}}function creaTablonTemporal(){$("#postits-temp").remove(),cambioTablon.sliding=!0;var e=$("#Postits"),t=$(".tablonPostits");cambioTablon.haciaDerecha?e.after('<div class="Postits" id="Postits" ></div>'):e.before('<div class="Postits" id="Postits" ></div>'),e.removeAttr("id").addClass("postits-temp").attr("id","postits-temp").removeClass("Postits"),cambioTablon.haciaDerecha?(e.css("overflow","auto"),e.width(window.innerWidth)):($("#Postits").css("overflow","auto"),e.width(window.innerWidth)),$("#Postits").width(window.innerWidth),t.width(t.width()+window.innerWidth),t.width(t.width()+window.innerWidth+100),$(".postitNB",e).removeAttr("id").removeClass("postitNB"),cambioTablon.haciaDerecha||$(window).scrollLeft(window.innerWidth)}function borraTablonTemporal(e){var t=cambioTablon.haciaDerecha?window.innerWidth:0;esTablonOrdenado()&&ajustaNotasYPadding(),$("html").animate({scrollLeft:t,scrollTop:0},800,(function(){$("#postits-temp").remove(),$(".tablonPostits").width($("#Postits").width()),$("#Postits").css("overflow","visible").width(window.innerWidth),detectColorContrastBackground().then((()=>{refreshConnections(),$(".columna").css("borderColor",defaultColorContrastBackground)})),cambioTablon.sliding=!1,compruebaLimites(),window.scrollTo(0,0),cambiaIcono(!0),compruebaCanvasPosEnMovil(100),$("#Postits").css("background-image",""),cambiaFondoNum(localStorage["fondo"+e])}))}function elementInViewport(e){for(var t=e.offsetTop,o=e.offsetLeft,a=e.offsetWidth,i=e.offsetHeight;e.offsetParent;)t+=(e=e.offsetParent).offsetTop,o+=e.offsetLeft;return t>=window.pageYOffset&&o>=window.pageXOffset&&t+i<=window.pageYOffset+window.innerHeight&&o+a<=window.pageXOffset+window.innerWidth}function compruebaMinimapa(){hideMinimapa?($("#canvasMaqueta").hide(),$("#maquetaPant").hide()):($("#canvasMaqueta").show(),$("#maquetaPant").show())}function actualizaNombreTablon(e){document.getElementById("nombreTablon")&&(e=e||tablonActual||localStorage.tablonActual,document.getElementById("nombreTablon").innerText=`${nombreTablon(e)} - ${cuentaNotas(e)}`)}function cuentaNotas(e){for(var t=0,o=0;o<localStorage.totalPost;o++)esNotaVisibleEnTablon(o,e)&&t++;return t}function checkMaxLocalStorage(){try{return localStorage.pruebaMaximoAlcanzado="test".repeat(100),localStorage.removeItem("pruebaMaximoAlcanzado"),!0}catch(e){return!1}}function getLocalStorageSize(){return JSON.stringify(localStorage).length}function guardaTextoEnNota(e,t){try{localStorage["postit"+e]=t}catch(e){getLocalStorageSize()+t.length>524e4&&sweetAlert({type:"error",text:chrome.i18n.getMessage("noMasEspacio")}),console.log(e)}}function detectColorBackground(e){var t=document.createElement("img"),o=document.getElementById("Postits"),a=o.currentStyle||window.getComputedStyle(o,!1);a.backgroundImage.indexOf("://")>-1&&-1==a.backgroundImage.indexOf("noise")?(t.src=a.backgroundImage.slice(4,-1).replace(/"/g,""),t.onload=function(){$.adaptiveBackground.run({selector:t,success:function(t,o){e(colourBrightness(o.color))}})}):e(colourBrightness(a.backgroundColor))}function colourBrightness(e){var t=e.substring(4,e.length-1).replace(/ /g,"").split(",");return Math.round((299*parseInt(t[0])+587*parseInt(t[1])+114*parseInt(t[2]))/1e3)>125?"#333":"white"}jQuery.fn.sortElements=function(){var e=[].sort;return function(t,o){o=o||function(){return this};var a=this.map((function(){var e=o.call(this),t=e.parentNode,a=t.insertBefore(document.createTextNode(""),e.nextSibling);return function(){if(t===this)throw new Error("You can't sort elements if any one is a descendant of another.");t.insertBefore(this,a),t.removeChild(a)}}));return e.call(this,t).each((function(e){a[e].call(o.call(this))}))}}();var defaultColorContrastBackground="#333";function detectColorContrastBackground(){let e;return e=new Promise(((e,t)=>{detectColorBackground((t=>{e(defaultColorContrastBackground=t)}))})),e}function getRandomNumber(e,t){return Math.floor(Math.random()*(t+1-e))+e}function iniLocalStorageCaptureData(){localStorage.removeItem("imageSave"),localStorage.removeItem("capturaPantalla"),localStorage.removeItem("capturaVideo")}function isUserConnected(){return"true"==localStorage.sincroLogin}function resizeWindow(e,t,o){isChromeExtension()?chrome.runtime.sendMessage({resizeWindow:{winId:e,width:t,height:o}}):window.resizeTo(t,o)}function getRandomNoteType(){return TIPOS_NOTAS_RANDOM[getRandomNumber(0,TIPOS_NOTAS_RANDOM.length-1)]}function esBackground(){return document.URL.indexOf("background")>0}function traduceLiteralesHtml(){document.querySelectorAll("[data-locale]").forEach((e=>{e.innerText=chrome.i18n.getMessage(e.dataset.locale)}))}function tieneNotaAlturaAuto(e){return"auto"==localStorage["height"+e]}function getAlturaNota(e){return tieneNotaAlturaAuto(e)?$("#postit"+e)?.height()||(()=>{const t=localStorage["postit"+e].length/2;return 300>t?300:t})():parseInt(localStorage["height"+e])}function restaurarMedidasAutoNota(e){$("#postit"+e).height("auto"),$("#texto"+e).css("maxHeight","calc(95vh - 90px)")}function getBoardNumberParam(){return new URL(window.location.href).searchParams.get("boardNumber")}function setNewTab(e,t){localStorage["new-tab"]=JSON.stringify({numTab:e,hideBar:t})}function getNewTab(){let e=!1;if(localStorage["new-tab"])try{e=JSON.parse(localStorage["new-tab"])}catch(e){console.log(e)}return e}function getGridData(){var e=!1;if(localStorage["grid-drag"])try{e={x:localStorage["grid-drag"].split("x")[0],y:localStorage["grid-drag"].split("x")[1]}}catch(e){console.log(e)}return e}function addNopubli(){$noPubli=$("#cansadoAnun"),$noPubli.length&&($noPubli.html(chrome.i18n.getMessage("quitaAnuncios")),$noPubli.on("click",(()=>muestraMensajeHaztePremium())))}function isWebNotesBoard(e=tablonActual){return-999==e}function isFunction(e){return!(!e||"function"!=typeof e)}function addScalable(){isMobile()&&document.querySelector("meta[name=viewport]").setAttribute("content","width=device-width, initial-scale=1, user-scalable=yes")}function removeScalable(){isMobile()&&document.querySelector("meta[name=viewport]").setAttribute("content","width=device-width, initial-scale=1, user-scalable=no")}function getHashUrl(e){return e.substr(e.indexOf("#")+1)}function getLocaleDate(e){if(!e)return;const t=e.split("-");return new Date(t[1]+"/"+t[0]+"/"+t[2]).toLocaleDateString(navigator.language,{year:"numeric",month:"long",day:"numeric"})}function topBarHasBoards(){return localStorage.showTabs===TOP_BAR.BOARDS}function isServiceWorker(){return"ServiceWorkerGlobalScope"in self&&self instanceof ServiceWorkerGlobalScope}function crearEditor(e,t){var o,a,i,n;restaurarMedidasAutoNota(e),i=notaTieneZoom(e)?window.innerHeight-200:window.innerHeight-250,null!=e?(o="textAreaEdit"+e,a=getAlturaNota(e)+210,esPopup()&&(a=window.innerHeight+300,i=screen.height-250)):(o="textoAnun",a=300),esTablonKanban()&&!notaTieneZoom(e)?(i=VALORES_POR_DEFECTO.KANBAN_HEIGHT-250,n="spellchecker paste autolink autoresize print save preview code searchreplace directionality visualblocks visualchars fullscreen image link media codesample table charmap hr pagebreak nonbreaking anchor insertdatetime advlist lists wordcount imagetools textpattern emoticons"):n="spellchecker paste autolink autoresize print save preview code searchreplace directionality visualblocks visualchars fullscreen image link media codesample table charmap hr pagebreak nonbreaking anchor insertdatetime advlist lists wordcount imagetools textpattern help emoticons";var r="formatselect | bold italic strikethrough forecolor backcolor | link | numlist bullist | removeformat | alignleft aligncenter alignright alignjustify | outdent indent | ltr rtl | hr | check | code";isMobile()&&(r=chrome.i18n.getMessage("aceptar")+" | "+chrome.i18n.getMessage("cancelar")+" | "+r),tinyMCE.init({mode:"exact",language:"es-ES"==navigator.language?"es":"en-US"==navigator.language?"":navigator.language,elements:o,statusbar:!1,relative_urls:!1,remove_script_host:!1,convert_urls:!1,width:"100%",plugins:n,imagetools_cors_hosts:["www.noteboardapp.com"],imagetools_toolbar:"rotateleft rotateright | flipv fliph | imageoptions editimage",imagetools_proxy:"https://www.noteboardapp.com/proxy.php",dialog_type:"modal",codesample_languages:[{text:"HTML/XML",value:"markup"},{text:"JavaScript",value:"javascript"},{text:"CSS",value:"css"},{text:"PHP",value:"php"},{text:"Ruby",value:"ruby"},{text:"Python",value:"python"},{text:"Java",value:"java"},{text:"C",value:"c"},{text:"C#",value:"csharp"},{text:"C++",value:"cpp"},{text:"Sql",value:"sql"},{text:"Json",value:"json"}],nonbreaking_force_tab:!0,contextmenu:"link copy paste",min_height:a,max_height:i,forced_root_block:"p",force_br_newlines:!0,browser_spellcheck:!0,force_p_newlines:!1,image_advtab:!0,paste_data_images:!0,init_instance_callback:t,toolbar_drawer:"sliding",toolbar:r,toolbar_items_size:"small",font_formats:"Kalam=Kalam,Arial;Droid Sans=Droid Sans,Arial;Architects Daughter=Architects Daughter,Arial;Quando=Quando,Arial;Indie Flower=Indie Flower,Arial;Andale Mono=andale mono,times;Balsamiq Sans=Balsamiq Sans,times;Quattrocento Sans=Quattrocento Sans,Arial;Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Roboto=roboto;Karla=karla;Montserrat=montserrat;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats",setup:function(t){t.on("init",(function(o){if(localStorage.numeroNotaEnEdicion=e||VALORES_POR_DEFECTO.NUEVA_NOTA,esPopup()||notaTieneZoom(e))try{ajustaTamanyoVentanaEditarPopup(e);var a=$(o.target.editorContainer).find("iframe");a.height(window.innerHeight-a.position().top-getEditorToolsHeight()),$(window).on("resize",(function(){a.height(window.innerHeight-a.position().top-getEditorToolsHeight())}))}catch(e){console.log(e)}t.on("Remove",(function(e){var t=numeroNotaEditando();t!=localStorage.numeroNotaEnEdicion&&0!=t?localStorage.numeroNotaEnEdicion=t:localStorage.removeItem("numeroNotaEnEdicion")})),t.on("ExecCommand",(function(e){switch(e.command.toLowerCase()){case"copy":case"cut":case"paste":chrome.permissions.request({permissions:["clipboardRead"]});break;case"mceImageRotateLeft":case"mceImageRotateRight":case"mceImageFlipVertical":case"mceImageFlipHorizontal":case"mceEditImage":chrome.permissions.contains({origins:["https://www.noteboardapp.com/"]},(function(e){e||pidePermisoParaEditarImagenes()}))}}))})),t.on("Change",(function(t){(e||0===e)&&(localStorage["editando"+e]=t.level.content,sendRealTime(e,{texto:t.level.content}))})),t.ui.registry.addButton("check",{icon:"checkmark",tooltip:"checkbox",onAction:function(){t.insertContent('<input class="noteBoardCheck" type="checkbox"/>'),null!=e?cambiaAparenciaEditor(buscarTipo("postit"+e),"textAreaEdit"+e):cambiaAparenciaEditor(buscarTipo("postitnuevo"),"postitnuevo")}}),isMobile()&&(t.ui.registry.addButton(chrome.i18n.getMessage("aceptar"),{text:chrome.i18n.getMessage("aceptar"),title:chrome.i18n.getMessage("aceptar"),onAction:function(){"textoAnun"==t.id?$("#postitnuevo .inplace_save").click():$("#postit"+parseInt(t.id.substr(12))+" .inplace_save").click()}}),t.ui.registry.addButton(chrome.i18n.getMessage("cancelar"),{text:chrome.i18n.getMessage("cancelar"),title:chrome.i18n.getMessage("cancelar"),onAction:function(){"textoAnun"==t.id?$("#postitnuevo .inplace_cancel").click():$("#postit"+parseInt(t.id.substr(12))+" .inplace_cancel").click()}})),activaTooltipsEditor()},save_enablewhendirty:!1,save_onsavecallback:e=>{"textoAnun"==e.id?$("#postitnuevo .inplace_save").click():$("#postit"+parseInt(e.id.substr(12))+" .inplace_save").click()},content_css:"https://fonts.googleapis.com/css?family=Kalam|Montserrat|Indie+Flower|Droid+Sans|Architects+Daughter|Balsamiq+Sans|Quando|Quattrocento+Sans|Roboto|Karla",content_style:"p {margin: 0}"})}function getEditorToolsHeight(){return $(".selectorColor").height()+$(".tox-menubar").height()+$(".tox-toolbar").height()+100}function ajustaTamanyoVentanaEditarPopup(e){if(esPopup()){const o=100;var t=$("#postit"+e).outerWidth()>700?$("#postit"+e).outerWidth():700;resizeWindow(winId,t+30,$(".inplace_save").position().top+o<screen.height?$(".inplace_save").position().top+o:screen.height-o)}}function activarMod(){for(var e=0;e<localStorage.totalPost;e++)(null!=localStorage["tablon"+e]&&"undefined"!=localStorage["tablon"+e]||1!=tablonActual)&&localStorage["tablon"+e]!=tablonActual||""!=localStorage["editando"+e]&&null!=localStorage["editando"+e]&&"undefined"!=localStorage["editando"+e]&&$("#texto"+e).trigger("openEditor")}function editandoAlgunaNota(){return!1!==numeroNotaEditando()}function numeroNotaEditando(){for(var e=document.createElement("div"),t=0;t<localStorage.totalPost;t++)if(((null==localStorage["tablon"+t]||"undefined"==localStorage["tablon"+t])&&1==tablonActual||localStorage["tablon"+t]==tablonActual)&&(e.innerHTML=localStorage["editando"+t],""!=localStorage["editando"+t]&&null!=localStorage["editando"+t]&&"undefined"!=localStorage["editando"+t]&&""!=e.innerText))return t;return!1}function oscarGuardaContenido(e,t){"textoAnun"==e?localStorage.editando=t:localStorage["editando"+e.substr(12)]=t}function pidePermisoParaEditarImagenes(){sweetAlert({text:chrome.i18n.getMessage("permisoEditarImagenes"),successCallback:function(){chrome.permissions.request({origins:["https://www.noteboardapp.com/"]})},type:"warning"})}function estaEditorAbierto(e){return!!tinyMCE.get("textAreaEdit"+e)}function hayEdicionNuevaNotaPendiente(){if(document.URL.indexOf("newTab")>-1)return!1;var e={innertext:""};return localStorage.editando&&((e=document.createElement("div")).innerHTML=localStorage.editando),""!=localStorage.editando&&null!=localStorage.editando&&"undefined"!=localStorage.editando&&""!=e.innerText}function obtenEditor(e){return e===VALORES_POR_DEFECTO.NUEVA_NOTA&&tinyMCE.get("textoAnun")||tinyMCE.get("textAreaEdit"+e)}function activaTooltipsEditor(){var e={theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:150};$(".idtransparente2").attr("title",chrome.i18n.getMessage("colorTransparente")).tooltipster(e),$(".notepadBut").attr("title",chrome.i18n.getMessage("colorNotepad")).tooltipster(e),$(".customColor2").attr("title",chrome.i18n.getMessage("colorCustom")).tooltipster(e)}function activaTooltipsEditorNuevaNota(){if(!$("#idtransparente").hasClass("tooltipstered")){var e={theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:150};$("#idtransparente").attr("title",chrome.i18n.getMessage("colorTransparente")).tooltipster(e),$("#notepad").attr("title",chrome.i18n.getMessage("colorNotepad")).tooltipster(e),$("#customColor").attr("title",chrome.i18n.getMessage("colorCustom")).tooltipster(e)}}function addContentToEditor(e,t){var o=obtenEditor(e);o&&(o.insertContent(t),o.setContent(o.getContent().replace(/(\r\n|\n|\r)/gm,""),{format:"html"}))}function algunEditorAbierto(){return $('iframe[id^="textAre"]').length>0||$("#postitnuevo").is(":visible")}function aceptaEdicion(){$("#postitnuevo").is(":visible")?$(".inplace_save").click():$(".inplace_save:not(.nuevo_save)").click()}function initializeNewPostit(){if(0==$("#postitnuevo").length){var e=getNewPostit();$(".tablonPostits").append(e),document.getElementById("aceptar").innerText=chrome.i18n.getMessage("aceptar"),document.getElementById("borrar").innerText=chrome.i18n.getMessage("cancelar"),$("#botonborNuevo").on("click",borraPostitNuevo),$("#idblanco").on("click",(function(){cambioPostit(TIPO_NOTA.BLANCO,"postitnuevo")})),$("#idamarillo").on("click",(function(){cambioPostit(TIPO_NOTA.AMARILLO,"postitnuevo")})),$("#idverde").on("click",(function(){cambioPostit(TIPO_NOTA.VERDE,"postitnuevo")})),$("#idlila").on("click",(function(){cambioPostit(TIPO_NOTA.LILA,"postitnuevo")})),$("#idnaranja").on("click",(function(){cambioPostit(TIPO_NOTA.AMARILLO2,"postitnuevo")})),$("#idrosa").on("click",(function(){cambioPostit(TIPO_NOTA.ROSA,"postitnuevo")})),$("#idrojo").on("click",(function(){cambioPostit(TIPO_NOTA.ROJO,"postitnuevo")})),$("#idazul").on("click",(function(){cambioPostit(TIPO_NOTA.AZUL,"postitnuevo")})),$("#idtransparente").on("click",(function(){cambioPostit(TIPO_NOTA.TRANSPARENTE,"postitnuevo")})),$("#notepad").on("click",(function(){cambioPostit(TIPO_NOTA.LIBRETA,"postitnuevo")})),$("#sinMarcoNuevo").click((function(){$("#postitnuevo").toggleClass("postitSinMarco"),$("#textoAnun").height("auto")})),$(".sinMarcoLabel").text(chrome.i18n.getMessage("sinMarco")),$("#aceptar").on("click",guardaPostit),$("#borrar").on("click",borraPostitNuevo),$("#customColor").ColorPicker({onSubmit:function(e,t,o,a){$(a).val(t),$(a).ColorPickerHide()},onBeforeShow:function(e,t,o,a){$(this).ColorPickerSetColor("#0000ff")},onChange:function(e,t,o,a){$("#customColor").css("background-color","#"+t),cambioPostit(t,"postitnuevo")}}).bind("keyup",(function(){$(this).ColorPickerSetColor(this.value)})),$("#postitnuevo").resizable({minHeight:200,minWidth:390,resize:function(e,t){resizeEditor(e)}}),$(".postit0").draggable({distance:5,cancel:".inplace_save,.inplace_cancel",stack:".anuncios div",containment:".Postits"}),activaTooltipsEditorNuevaNota()}}function cierraPostitNuevo(){$("#postitnuevo").addClass("scale-down-center"),setTimeout((function(){$("#postitnuevo").hide(),$("#postitnuevo").removeClass("scale-down-center").removeClass("scale-up-center")}),150)}var _self="undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?self:{},Prism=function(){var e=/\blang(?:uage)?-(\w+)\b/i,t=0,o=_self.Prism={manual:_self.Prism&&_self.Prism.manual,util:{encode:function(e){return e instanceof a?new a(e.type,o.util.encode(e.content),e.alias):"Array"===o.util.type(e)?e.map(o.util.encode):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).match(/\[object (\w+)\]/)[1]},objId:function(e){return e.__id||Object.defineProperty(e,"__id",{value:++t}),e.__id},clone:function(e){switch(o.util.type(e)){case"Object":var t={};for(var a in e)e.hasOwnProperty(a)&&(t[a]=o.util.clone(e[a]));return t;case"Array":return e.map&&e.map((function(e){return o.util.clone(e)}))}return e}},languages:{extend:function(e,t){var a=o.util.clone(o.languages[e]);for(var i in t)a[i]=t[i];return a},insertBefore:function(e,t,a,i){var n=(i=i||o.languages)[e];if(2==arguments.length){for(var r in a=arguments[1])a.hasOwnProperty(r)&&(n[r]=a[r]);return n}var s={};for(var l in n)if(n.hasOwnProperty(l)){if(l==t)for(var r in a)a.hasOwnProperty(r)&&(s[r]=a[r]);s[l]=n[l]}return o.languages.DFS(o.languages,(function(t,o){o===i[e]&&t!=e&&(this[t]=s)})),i[e]=s},DFS:function(e,t,a,i){for(var n in i=i||{},e)e.hasOwnProperty(n)&&(t.call(e,n,e[n],a||n),"Object"!==o.util.type(e[n])||i[o.util.objId(e[n])]?"Array"!==o.util.type(e[n])||i[o.util.objId(e[n])]||(i[o.util.objId(e[n])]=!0,o.languages.DFS(e[n],t,n,i)):(i[o.util.objId(e[n])]=!0,o.languages.DFS(e[n],t,null,i)))}},plugins:{},highlightAll:function(e,t){var a={callback:t,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};o.hooks.run("before-highlightall",a);for(var i,n=a.elements||document.querySelectorAll(a.selector),r=0;i=n[r++];)o.highlightElement(i,!0===e,a.callback)},highlightElement:function(t,a,i){for(var n,r,s=t;s&&!e.test(s.className);)s=s.parentNode;s&&(n=(s.className.match(e)||[,""])[1].toLowerCase(),r=o.languages[n]),t.className=t.className.replace(e,"").replace(/\s+/g," ")+" language-"+n,s=t.parentNode,/pre/i.test(s.nodeName)&&(s.className=s.className.replace(e,"").replace(/\s+/g," ")+" language-"+n);var l={element:t,language:n,grammar:r,code:t.textContent};if(o.hooks.run("before-sanity-check",l),!l.code||!l.grammar)return l.code&&(l.element.textContent=l.code),void o.hooks.run("complete",l);if(o.hooks.run("before-highlight",l),a&&_self.Worker){var c=new Worker(o.filename);c.onmessage=function(e){l.highlightedCode=e.data,o.hooks.run("before-insert",l),l.element.innerHTML=l.highlightedCode,i&&i.call(l.element),o.hooks.run("after-highlight",l),o.hooks.run("complete",l)},c.postMessage(JSON.stringify({language:l.language,code:l.code,immediateClose:!0}))}else l.highlightedCode=o.highlight(l.code,l.grammar,l.language),o.hooks.run("before-insert",l),l.element.innerHTML=l.highlightedCode,i&&i.call(t),o.hooks.run("after-highlight",l),o.hooks.run("complete",l)},highlight:function(e,t,i){var n=o.tokenize(e,t);return a.stringify(o.util.encode(n),i)},tokenize:function(e,t){var a=o.Token,i=[e],n=t.rest;if(n){for(var r in n)t[r]=n[r];delete t.rest}e:for(var r in t)if(t.hasOwnProperty(r)&&t[r]){var s=t[r];s="Array"===o.util.type(s)?s:[s];for(var l=0;l<s.length;++l){var c=s[l],u=c.inside,d=!!c.lookbehind,p=!!c.greedy,g=0,m=c.alias;if(p&&!c.pattern.global){var h=c.pattern.toString().match(/[imuy]*$/)[0];c.pattern=RegExp(c.pattern.source,h+"g")}c=c.pattern||c;for(var f=0,b=0;f<i.length;b+=i[f].length,++f){var v=i[f];if(i.length>e.length)break e;if(!(v instanceof a)){c.lastIndex=0;var S=1;if(!($=c.exec(v))&&p&&f!=i.length-1){if(c.lastIndex=b,!($=c.exec(e)))break;for(var _=$.index+(d?$[1].length:0),w=$.index+$[0].length,C=f,P=b,I=i.length;I>C&&w>P;++C)_>=(P+=i[C].length)&&(++f,b=P);if(i[f]instanceof a||i[C-1].greedy)continue;S=C-f,v=e.slice(b,P),$.index-=b}if($){d&&(g=$[1].length);w=(_=$.index+g)+($=$[0].slice(g)).length;var $,T=v.slice(0,_),E=v.slice(w),y=[f,S];T&&y.push(T);var O=new a(r,u?o.tokenize($,u):$,m,$,p);y.push(O),E&&y.push(E),Array.prototype.splice.apply(i,y)}}}}}return i},hooks:{all:{},add:function(e,t){var a=o.hooks.all;a[e]=a[e]||[],a[e].push(t)},run:function(e,t){var a=o.hooks.all[e];if(a&&a.length)for(var i,n=0;i=a[n++];)i(t)}}},a=o.Token=function(e,t,o,a,i){this.type=e,this.content=t,this.alias=o,this.length=0|(a||"").length,this.greedy=!!i};if(a.stringify=function(e,t,i){if("string"==typeof e)return e;if("Array"===o.util.type(e))return e.map((function(o){return a.stringify(o,t,e)})).join("");var n={type:e.type,content:a.stringify(e.content,t,i),tag:"span",classes:["token",e.type],attributes:{},language:t,parent:i};if("comment"==n.type&&(n.attributes.spellcheck="true"),e.alias){var r="Array"===o.util.type(e.alias)?e.alias:[e.alias];Array.prototype.push.apply(n.classes,r)}o.hooks.run("wrap",n);var s=Object.keys(n.attributes).map((function(e){return e+'="'+(n.attributes[e]||"").replace(/"/g,"&quot;")+'"'})).join(" ");return"<"+n.tag+' class="'+n.classes.join(" ")+'"'+(s?" "+s:"")+">"+n.content+"</"+n.tag+">"},!_self.document)return _self.addEventListener?(_self.addEventListener("message",(function(e){var t=JSON.parse(e.data),a=t.language,i=t.code,n=t.immediateClose;_self.postMessage(o.highlight(i,o.languages[a],a)),n&&_self.close()}),!1),_self.Prism):_self.Prism;var i=document.currentScript||[].slice.call(document.getElementsByTagName("script")).pop();return i&&(o.filename=i.src,!document.addEventListener||o.manual||i.hasAttribute("data-manual")||("loading"!==document.readyState?window.requestAnimationFrame?window.requestAnimationFrame(o.highlightAll):window.setTimeout(o.highlightAll,16):document.addEventListener("DOMContentLoaded",o.highlightAll))),_self.Prism}();"undefined"!=typeof module&&module.exports&&(module.exports=Prism),"undefined"!=typeof global&&(global.Prism=Prism),Prism.languages.markup={comment:/<!--[\w\W]*?-->/,prolog:/<\?[\w\W]+?\?>/,doctype:/<!DOCTYPE[\w\W]+?>/i,cdata:/<!\[CDATA\[[\w\W]*?]]>/i,tag:{pattern:/<\/?(?!\d)[^\s>\/=$<]+(?:\s+[^\s>\/=]+(?:=(?:("|')(?:\\\1|\\?(?!\1)[\w\W])*\1|[^\s'">=]+))?)*\s*\/?>/i,inside:{tag:{pattern:/^<\/?[^\s>\/]+/i,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"attr-value":{pattern:/=(?:('|")[\w\W]*?(\1)|[^\s>]+)/i,inside:{punctuation:/[=>"']/}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:/&#?[\da-z]{1,8};/i},Prism.hooks.add("wrap",(function(e){"entity"===e.type&&(e.attributes.title=e.content.replace(/&amp;/,"&"))})),Prism.languages.xml=Prism.languages.markup,Prism.languages.html=Prism.languages.markup,Prism.languages.mathml=Prism.languages.markup,Prism.languages.svg=Prism.languages.markup,Prism.languages.css={comment:/\/\*[\w\W]*?\*\//,atrule:{pattern:/@[\w-]+?.*?(;|(?=\s*\{))/i,inside:{rule:/@[\w-]+/}},url:/url\((?:(["'])(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1|.*?)\)/i,selector:/[^\{\}\s][^\{\};]*?(?=\s*\{)/,string:{pattern:/("|')(\\(?:\r\n|[\w\W])|(?!\1)[^\\\r\n])*\1/,greedy:!0},property:/(\b|\B)[\w-]+(?=\s*:)/i,important:/\B!important\b/i,function:/[-a-z0-9]+(?=\()/i,punctuation:/[(){};:]/},Prism.languages.css.atrule.inside.rest=Prism.util.clone(Prism.languages.css),Prism.languages.markup&&(Prism.languages.insertBefore("markup","tag",{style:{pattern:/(<style[\w\W]*?>)[\w\W]*?(?=<\/style>)/i,lookbehind:!0,inside:Prism.languages.css,alias:"language-css"}}),Prism.languages.insertBefore("inside","attr-value",{"style-attr":{pattern:/\s*style=("|').*?\1/i,inside:{"attr-name":{pattern:/^\s*style/i,inside:Prism.languages.markup.tag.inside},punctuation:/^\s*=\s*['"]|['"]\s*$/,"attr-value":{pattern:/.+/i,inside:Prism.languages.css}},alias:"language-css"}},Prism.languages.markup.tag)),Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\w\W]*?\*\//,lookbehind:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0}],string:{pattern:/(["'])(\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/((?:\b(?:class|interface|extends|implements|trait|instanceof|new)\s+)|(?:catch\s+\())[a-z0-9_\.\\]+/i,lookbehind:!0,inside:{punctuation:/(\.|\\)/}},keyword:/\b(if|else|while|do|for|return|in|instanceof|function|new|try|throw|catch|finally|null|break|continue)\b/,boolean:/\b(true|false)\b/,function:/[a-z0-9_]+(?=\()/i,number:/\b-?(?:0x[\da-f]+|\d*\.?\d+(?:e[+-]?\d+)?)\b/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*|\/|~|\^|%/,punctuation:/[{}[\];(),.:]/},Prism.languages.javascript=Prism.languages.extend("clike",{keyword:/\b(as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield)\b/,number:/\b-?(0x[\dA-Fa-f]+|0b[01]+|0o[0-7]+|\d*\.?\d+([Ee][+-]?\d+)?|NaN|Infinity)\b/,function:/[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*(?=\()/i,operator:/--?|\+\+?|!=?=?|<=?|>=?|==?=?|&&?|\|\|?|\?|\*\*?|\/|~|\^|%|\.{3}/}),Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:/(^|[^\/])\/(?!\/)(\[.+?]|\\.|[^\/\\\r\n])+\/[gimyu]{0,5}(?=\s*($|[\r\n,.;})]))/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("javascript","string",{"template-string":{pattern:/`(?:\\\\|\\?[^\\])*?`/,greedy:!0,inside:{interpolation:{pattern:/\$\{[^}]+\}/,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}}}),Prism.languages.markup&&Prism.languages.insertBefore("markup","tag",{script:{pattern:/(<script[\w\W]*?>)[\w\W]*?(?=<\/script>)/i,lookbehind:!0,inside:Prism.languages.javascript,alias:"language-javascript"}}),Prism.languages.js=Prism.languages.javascript,Prism.languages.java=Prism.languages.extend("clike",{keyword:/\b(abstract|continue|for|new|switch|assert|default|goto|package|synchronized|boolean|do|if|private|this|break|double|implements|protected|throw|byte|else|import|public|throws|case|enum|instanceof|return|transient|catch|extends|int|short|try|char|final|interface|static|void|class|finally|long|strictfp|volatile|const|float|native|super|while)\b/,number:/\b0b[01]+\b|\b0x[\da-f]*\.?[\da-fp\-]+\b|\b\d*\.?\d+(?:e[+-]?\d+)?[df]?\b/i,operator:{pattern:/(^|[^.])(?:\+[+=]?|-[-=]?|!=?|<<?=?|>>?>?=?|==?|&[&=]?|\|[|=]?|\*=?|\/=?|%=?|\^=?|[?:~])/m,lookbehind:!0}}),Prism.languages.insertBefore("java","function",{annotation:{alias:"punctuation",pattern:/(^|[^.])@\w+/,lookbehind:!0}}),Prism.languages.json={property:/"(?:\\.|[^\\"])*"(?=\s*:)/gi,string:/"(?!:)(?:\\.|[^\\"])*"(?!:)/g,number:/\b-?(0x[\dA-Fa-f]+|\d*\.?\d+([Ee][+-]?\d+)?)\b/g,punctuation:/[{}[\]);,]/g,operator:/:/g,boolean:/\b(true|false)\b/gi,null:/\bnull\b/gi},Prism.languages.jsonp=Prism.languages.json,Prism.languages.less=Prism.languages.extend("css",{comment:[/\/\*[\w\W]*?\*\//,{pattern:/(^|[^\\])\/\/.*/,lookbehind:!0}],atrule:{pattern:/@[\w-]+?(?:\([^{}]+\)|[^(){};])*?(?=\s*\{)/i,inside:{punctuation:/[:()]/}},selector:{pattern:/(?:@\{[\w-]+\}|[^{};\s@])(?:@\{[\w-]+\}|\([^{}]*\)|[^{};@])*?(?=\s*\{)/,inside:{variable:/@+[\w-]+/}},property:/(?:@\{[\w-]+\}|[\w-])+(?:\+_?)?(?=\s*:)/i,punctuation:/[{}();:,]/,operator:/[+\-*\/]/}),Prism.languages.insertBefore("less","punctuation",{function:Prism.languages.less.function}),Prism.languages.insertBefore("less","property",{variable:[{pattern:/@[\w-]+\s*:/,inside:{punctuation:/:/}},/@@?[\w-]+/],"mixin-usage":{pattern:/([{;]\s*)[.#](?!\d)[\w-]+.*?(?=[(;])/,lookbehind:!0,alias:"function"}}),Prism.languages.php=Prism.languages.extend("clike",{keyword:/\b(and|or|xor|array|as|break|case|cfunction|class|const|continue|declare|default|die|do|else|elseif|enddeclare|endfor|endforeach|endif|endswitch|endwhile|extends|for|foreach|function|include|include_once|global|if|new|return|static|switch|use|require|require_once|var|while|abstract|interface|public|implements|private|protected|parent|throw|null|echo|print|trait|namespace|final|yield|goto|instanceof|finally|try|catch)\b/i,constant:/\b[A-Z0-9_]{2,}\b/,comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|\/\/.*)/,lookbehind:!0,greedy:!0}}),Prism.languages.insertBefore("php","class-name",{"shell-comment":{pattern:/(^|[^\\])#.*/,lookbehind:!0,alias:"comment"}}),Prism.languages.insertBefore("php","keyword",{delimiter:/\?>|<\?(?:php)?/i,variable:/\$\w+\b/i,package:{pattern:/(\\|namespace\s+|use\s+)[\w\\]+/,lookbehind:!0,inside:{punctuation:/\\/}}}),Prism.languages.insertBefore("php","operator",{property:{pattern:/(->)[\w]+/,lookbehind:!0}}),Prism.languages.markup&&(Prism.hooks.add("before-highlight",(function(e){"php"===e.language&&(e.tokenStack=[],e.backupCode=e.code,e.code=e.code.replace(/(?:<\?php|<\?)[\w\W]*?(?:\?>)/gi,(function(t){return e.tokenStack.push(t),"{{{PHP"+e.tokenStack.length+"}}}"})))})),Prism.hooks.add("before-insert",(function(e){"php"===e.language&&(e.code=e.backupCode,delete e.backupCode)})),Prism.hooks.add("after-highlight",(function(e){if("php"===e.language){for(var t,o=0;t=e.tokenStack[o];o++)e.highlightedCode=e.highlightedCode.replace("{{{PHP"+(o+1)+"}}}",Prism.highlight(t,e.grammar,"php").replace(/\$/g,"$$$$"));e.element.innerHTML=e.highlightedCode}})),Prism.hooks.add("wrap",(function(e){"php"===e.language&&"markup"===e.type&&(e.content=e.content.replace(/(\{\{\{PHP[0-9]+\}\}\})/g,'<span class="token php">$1</span>'))})),Prism.languages.insertBefore("php","comment",{markup:{pattern:/<[^?]\/?(.*?)>/,inside:Prism.languages.markup},php:/\{\{\{PHP[0-9]+\}\}\}/})),function(e){e.languages.sass=e.languages.extend("css",{comment:{pattern:/^([ \t]*)\/[\/*].*(?:(?:\r?\n|\r)\1[ \t]+.+)*/m,lookbehind:!0}}),e.languages.insertBefore("sass","atrule",{"atrule-line":{pattern:/^(?:[ \t]*)[@+=].+/m,inside:{atrule:/(?:@[\w-]+|[+=])/m}}}),delete e.languages.sass.atrule;var t=/((\$[-_\w]+)|(#\{\$[-_\w]+\}))/i,o=[/[+*\/%]|[=!]=|<=?|>=?|\b(?:and|or|not)\b/,{pattern:/(\s+)-(?=\s)/,lookbehind:!0}];e.languages.insertBefore("sass","property",{"variable-line":{pattern:/^[ \t]*\$.+/m,inside:{punctuation:/:/,variable:t,operator:o}},"property-line":{pattern:/^[ \t]*(?:[^:\s]+ *:.*|:[^:\s]+.*)/m,inside:{property:[/[^:\s]+(?=\s*:)/,{pattern:/(:)[^:\s]+/,lookbehind:!0}],punctuation:/:/,variable:t,operator:o,important:e.languages.sass.important}}}),delete e.languages.sass.property,delete e.languages.sass.important,delete e.languages.sass.selector,e.languages.insertBefore("sass","punctuation",{selector:{pattern:/([ \t]*)\S(?:,?[^,\r\n]+)*(?:,(?:\r?\n|\r)\1[ \t]+\S(?:,?[^,\r\n]+)*)*/,lookbehind:!0}})}(Prism),Prism.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\w\W]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},string:{pattern:/(^|[^@\\])("|')(?:\\?[\s\S])*?\2/,greedy:!0,lookbehind:!0},variable:/@[\w.$]+|@("|'|`)(?:\\?[\s\S])+?\1/,function:/\b(?:COUNT|SUM|AVG|MIN|MAX|FIRST|LAST|UCASE|LCASE|MID|LEN|ROUND|NOW|FORMAT)(?=\s*\()/i,keyword:/\b(?:ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR VARYING|CHARACTER (?:SET|VARYING)|CHARSET|CHECK|CHECKPOINT|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMN|COLUMNS|COMMENT|COMMIT|COMMITTED|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS|CONTAINSTABLE|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|DATA(?:BASES?)?|DATE(?:TIME)?|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITER(?:S)?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE(?: PRECISION)?|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE KEY|ELSE|ENABLE|ENCLOSED BY|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPE(?:D BY)?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|IDENTITY(?:_INSERT|COL)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTO|INVOKER|ISOLATION LEVEL|JOIN|KEYS?|KILL|LANGUAGE SQL|LAST|LEFT|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MODIFIES SQL DATA|MODIFY|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL(?: CHAR VARYING| CHARACTER(?: VARYING)?| VARCHAR)?|NATURAL|NCHAR(?: VARCHAR)?|NEXT|NO(?: SQL|CHECK|CYCLE)?|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READ(?:S SQL DATA|TEXT)?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEATABLE|REPLICATION|REQUIRE|RESTORE|RESTRICT|RETURNS?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE MODE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|START(?:ING BY)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED BY|TEXT(?:SIZE)?|THEN|TIMESTAMP|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNPIVOT|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?)\b/i,boolean:/\b(?:TRUE|FALSE|NULL)\b/i,number:/\b-?(?:0x)?\d*\.?[\da-f]+\b/,operator:/[-+*\/=%^~]|&&?|\|?\||!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|IN|LIKE|NOT|OR|IS|DIV|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,punctuation:/[;[\]()`,.]/};var posCompartidas=new Array;function inicializaLocalStorage(){for(var e=1;e<=localStorage.numTablones;e++)localStorage.removeItem("tab"+e+"Label"),localStorage.removeItem("publico"+e),localStorage.removeItem("ordenTablon"+e),localStorage.removeItem("masonry"+e),localStorage.removeItem("tablonKanban"+e);var t=0;localStorage.removeItem("treeId10000");for(e=0;e<localStorage.totalPost;e++)esNotaCompartida(e)&&guardaPosCompartido(e),null==localStorage["errorConexion"+e]&&null!=localStorage["treeId"+e]||null==localStorage["postit"+e]||(null==localStorage["treeId"+e]&&(localStorage["errorConexion"+e]="create"),e>t&&(muevePostit(e,t),localStorage.removeItem("errorConexion"+e)),t++,clearInterval(intervalErrorConexion),intervalErrorConexion=setInterval(intentaConexion,1e4)),null!=localStorage["errorConexion"+e]&&e==t-1||(localStorage.removeItem("postit"+e),localStorage.removeItem("tablon"+e),localStorage.removeItem("tipoA"+e),localStorage.removeItem("X"+e),localStorage.removeItem("Y"+e),localStorage.removeItem("width"+e),localStorage.removeItem("height"+e),localStorage.removeItem("treeId"+e),localStorage.removeItem("fecha"+e),localStorage.removeItem("updated"+e),localStorage.removeItem("calendar"+e),localStorage.removeItem("sinMarco"+e),localStorage.removeItem("userComp"+e),localStorage.removeItem("nickComp"+e),localStorage.removeItem("rotacion"+e),localStorage.removeItem("pushpin"+e),localStorage.removeItem("notaWeb"+e),localStorage.removeItem("columnaKanban"+e),localStorage.removeItem("connections"+e),localStorage.removeItem("minimizado"+e));localStorage.totalPost=t}function muevePostit(e,t){localStorage["postit"+t]=localStorage["postit"+e],localStorage["tipoA"+t]=localStorage["tipoA"+e],localStorage["tablon"+t]=localStorage["tablon"+e],localStorage["X"+t]=localStorage["X"+e],localStorage["Y"+t]=localStorage["Y"+e],localStorage["width"+t]=localStorage["width"+e],localStorage["height"+t]=localStorage["height"+e],localStorage["treeId"+t]=localStorage["treeId"+e],localStorage["fecha"+t]=localStorage["fecha"+e],localStorage["updated"+t]=localStorage["updated"+e],localStorage["calendar"+t]=localStorage["calendar"+e],localStorage["sinMarco"+t]=localStorage["sinMarco"+e],null!=localStorage["userComp"+e]?(localStorage["userComp"+t]=localStorage["userComp"+e],localStorage["nickComp"+t]=localStorage["nickComp"+e]):(localStorage.removeItem("userComp"+t),localStorage.removeItem("nickComp"+t)),null!=localStorage["errorConexion"+e]?localStorage["errorConexion"+t]=localStorage["errorConexion"+e]:localStorage.removeItem("errorConexion"+t),null!=localStorage["rotacion"+e]?localStorage["rotacion"+t]=localStorage["rotacion"+e]:localStorage.removeItem("rotacion"+t),null!=localStorage["pushpin"+e]?localStorage["pushpin"+t]=localStorage["pushpin"+e]:localStorage.removeItem("pushpin"+t),null!=localStorage["notaWeb"+e]?localStorage["notaWeb"+t]=localStorage["notaWeb"+e]:localStorage.removeItem("notaWeb"+t),null!=localStorage["columnaKanban"+e]?localStorage["columnaKanban"+t]=localStorage["columnaKanban"+e]:localStorage.removeItem("columnaKanban"+t),null!=localStorage["connections"+e]?localStorage["connections"+t]=localStorage["connections"+e]:localStorage.removeItem("connections"+t),null!=localStorage["minimizado"+e]?localStorage["minimizado"+t]=localStorage["minimizado"+e]:localStorage.removeItem("minimizado"+t)}function obtenerNickPublico(){var e=getServerUrl()+"api/obtenNickPublico.php";e+="?id_usuario="+localStorage.id_usuario,$.ajax({type:"GET",url:e,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess&&(localStorage.nickPublico=t.nickPublico)},error:function(e,t,o){console.log(t)}})}function logoutUsuario(){localStorage.removeItem("id_usuario"),localStorage.removeItem("token"),localStorage.removeItem("sincroLogin"),localStorage.removeItem("nick"),localStorage.removeItem("confirmado"),localStorage.removeItem("fbToken"),localStorage.removeItem("fbId"),localStorage.removeItem("googleId"),localStorage.sincroLogin=!1,document.getElementById("logoutForm").style.display="none",document.getElementById("loginForm").style.display="block"}function grabaNotaLogin(e){if(!isDemoUser(e)){if(e<1e4){"undefined"!=localStorage["tablon"+e]&&null!=localStorage["tablon"+e]||(localStorage["tablon"+e]=1),null!=localStorage["sinMarco"+e]&&"undefined"!=localStorage["sinMarco"+e]||(localStorage["sinMarco"+e]="false");var t={tipoA:localStorage["tipoA"+e],X:localStorage["X"+e],Y:localStorage["Y"+e],postit:localStorage["postit"+e],width:localStorage["width"+e],height:localStorage["height"+e],fecha:localStorage["fecha"+e],tablon:localStorage["tablon"+e],calendar:localStorage["calendar"+e],sinMarco:localStorage["sinMarco"+e],rotacion:localStorage["rotacion"+e],pushpin:localStorage["pushpin"+e],notaWeb:localStorage["notaWeb"+e],columnaKanban:localStorage["columnaKanban"+e],connections:localStorage["connections"+e],minimizado:localStorage["minimizado"+e]}}else{for(var o=new Array,a=new Array,i=new Array,n=new Array,r=new Array,s=new Array,l=1;l<=localStorage.numTablones;l++)null==localStorage["tab"+l+"Label"]&&(localStorage["tab"+l+"Label"]="undefined"),o.push(localStorage["tab"+l+"Label"]),a.push(localStorage["fondo"+l]),"true"==localStorage["publico"+l]?i.push(1):i.push(0),"true"==localStorage["masonry"+l]?r.push(1):r.push(0),n.push(ordenTablon(l)),localStorage["tablonKanban"+l]?s.push(localStorage["tablonKanban"+l]):s.push("");var c={tabLabels:o,tabBgs:a,tabPublico:i,tabOrden:n,tabMasonry:r,fuente:localStorage.fuente,size:localStorage.size,tabKanban:s};t={tipoA:TIPO_NOTA.TABLONES,X:0,Y:0,postit:JSON.stringify(c),width:0,height:0,rotacion:"",fecha:"",tablon:0,calendar:"",sinMarco:!1,pushpin:"",notaWeb:""}}var u="id_usuario="+localStorage.id_usuario;u+="&token="+localStorage.token,u+="&nota="+encodeURIComponent(JSON.stringify(t)),u+="&sid="+localStorage.sid,$.ajax({type:"POST",url:getServerUrl()+"api/createNote.php",data:u,cache:!1,success:function(o){var a=JSON.parse(o);a.isSuccess?(null!=localStorage["errorConexion"+e]&&(localStorage.removeItem("errorConexion"+e),e<1e4&&(localStorage.refrescaNota=e,sendMessage({mensBack:"refrescaNota"}))),localStorage["treeId"+e]=a.idNota,sendRealTime(e,{create:!0},localStorage["tablon"+e]),$("#postit"+e).length>0&&$("#postit"+e).attr("data-treeid",a.idNota),a.espacio&&(localStorage.espacio=a.espacio),1e4!=e||!registrando&&"true"!=localStorage.nuevoReg||(localStorage.removeItem("nuevoReg"),registrando=!1,chrome.tabs.create({url:GO_PREMIUM_URL+"?sessionId="+localStorage.sessionId}),modalInstance.close()),e<1e4&&localStorage["postit"+e].indexOf("data:image/")>0&&null!=a.postit&&(localStorage["postit"+e]=a.postit.replace(/<\/p>n<p>/gm,"</p>\n<p>"),refrescaNota(e))):(console.log("OK "+a.error),sendReportError(localStorage.id_usuario,e,encodeURIComponent(JSON.stringify(t))))},error:function(t,o,a){404===t.status?manageConnectionError(e,"create"):localStorage.removeItem("errorConexion"+e)}})}}function manageConnectionError(e,t,o=!0){esBackground()?errorConexion(e,t):(sendMessage({menstoBack:"errorConexion",numPost:e,operacion:t}),o&&muestraAyuda("mensErrorConexion"))}function updateNotaMemo(e){isUserConnected()&&updateNotaLoginMemo(e)}function updateNotaLoginMemo(e){e<1e4?(localStorage["updated"+e]="true",sendRealTime(e,localStorage["tablon"+e])):updateNotaLogin(e)}function updateNotaLogin(e){if(!isDemoUser(e)&&isUserConnected()){if("undefined"!=localStorage["tablon"+e]&&null!=localStorage["tablon"+e]||(localStorage["tablon"+e]=1),e<1e4){null!=localStorage["sinMarco"+e]&&"undefined"!=localStorage["sinMarco"+e]||(localStorage["sinMarco"+e]="false");var t={tipoA:localStorage["tipoA"+e],X:localStorage["X"+e],Y:localStorage["Y"+e],postit:localStorage["postit"+e],width:localStorage["width"+e],height:localStorage["height"+e],fecha:localStorage["fecha"+e],tablon:localStorage["tablon"+e],calendar:localStorage["calendar"+e],sinMarco:localStorage["sinMarco"+e],rotacion:localStorage["rotacion"+e],pushpin:localStorage["pushpin"+e],notaWeb:localStorage["notaWeb"+e],columnaKanban:localStorage["columnaKanban"+e],connections:localStorage["connections"+e],minimizado:localStorage["minimizado"+e]};sendRealTime(e,localStorage["tablon"+e])}else{for(var o=new Array,a=new Array,i=new Array,n=new Array,r=new Array,s=new Array,l=1;l<=localStorage.numTablones;l++)null==localStorage["tab"+l+"Label"]&&(localStorage["tab"+l+"Label"]="undefined"),o.push(localStorage["tab"+l+"Label"]),a.push(localStorage["fondo"+l]),"true"==localStorage["publico"+l]?i.push(1):i.push(0),"true"==localStorage["masonry"+l]?r.push(1):r.push(0),n.push(ordenTablon(l)),localStorage["tablonKanban"+l]?s.push(localStorage["tablonKanban"+l]):s.push("");var c={tabLabels:o,tabBgs:a,tabPublico:i,tabOrden:n,tabMasonry:r,fuente:localStorage.fuente,size:localStorage.size,tabKanban:s};t={tipoA:TIPO_NOTA.TABLONES,X:0,Y:0,postit:JSON.stringify(c),width:0,height:0,fecha:"",tablon:0,calendar:"",pushpin:"",sinMarco:!1}}if(localStorage["updated"+e]="false",null==localStorage["userComp"+e]||"R"==localStorage["userComp"+e])var u=localStorage.id_usuario,d="false";else u=localStorage["userComp"+e],d="true";var p="id_usuario="+u;p+="&token="+localStorage.token,p+="&id_nota="+localStorage["treeId"+e],p+="&nota="+encodeURIComponent(JSON.stringify(t)),p+="&sid="+localStorage.sid,p+="&compartido="+d,$.ajax({type:"POST",url:getServerUrl()+"api/updateNote.php",data:p,cache:!1,success:function(o){var a=JSON.parse(o);a.isSuccess?(a.espacio&&(localStorage.espacio=a.espacio),null!=localStorage["errorConexion"+e]&&(localStorage.removeItem("errorConexion"+e),e<1e4&&(localStorage.refrescaNota=e,sendMessage({mensBack:"refrescaNota"}))),e<1e4&&localStorage["postit"+e].indexOf("data:image/")>0&&null!=a.postit&&(localStorage["postit"+e]=a.postit.replace(/<\/p>n<p>/gm,"</p>\n<p>"),refrescaNota(e))):(console.log("OK "+a.error),sendReportError(localStorage.id_usuario,e,encodeURIComponent(JSON.stringify(t))))},error:function(t,o,a){404===t.status?manageConnectionError(e,"update"):localStorage.removeItem("errorConexion"+e)}})}}function deleteNoteLogin(e){if(!isDemoUser()){var t="id_usuario="+localStorage.id_usuario;t+="&token="+localStorage.token,t+="&id_nota="+localStorage["treeId"+e],t+="&sid="+localStorage.sid,$.ajax({type:"POST",url:getServerUrl()+"api/deleteNote.php",data:t,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess?t.espacio&&(localStorage.espacio=t.espacio):console.log("OK "+t.error)},error:function(e,t,o){console.log(t)}})}}function borraListaNotas(e){if(!isDemoUser()){var t="id_usuario="+localStorage.id_usuario;t+="&token="+localStorage.token,t+="&listaNotas="+encodeURIComponent(JSON.stringify(e)),t+="&sid="+localStorage.sid,$.ajax({type:"POST",url:getServerUrl()+"api/deleteListNotes.php",data:t,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess?t.espacio&&(localStorage.espacio=t.espacio):console.log("OK "+t.error)},error:function(e,t,o){console.log(t)}})}}function borrarImagen(e){var t="imgUrl="+encodeURIComponent(e);$.ajax({type:"POST",url:getServerUrl()+"api/deleteImage.php",data:t,cache:!1,success:function(e){if(!isUserConnected())try{restaEspacioServidor(JSON.parse(e).spaceFiles)}catch(e){console.log(e)}},error:function(e,t,o){console.log(t)}})}function borrarFicherosAws(e,t){if(e&&-1!=e.indexOf("noteboardapp")){var o="ficheros="+encodeURIComponent(e);$.ajax({type:"POST",url:getServerUrl()+"api/borraFichAws.php",data:o,cache:!1,success:function(e){if(t&&!isUserConnected())try{restaEspacioServidor(JSON.parse(e).spaceFiles)}catch(e){console.log(e)}}})}}let getNotesTry=0;async function sincronizaLogin(e,t,o){esBackground()&&!localStorage.id_usuario&&await getLocalStorage();var a=getServerUrl()+"api/getNotes2.php";const i=new URLSearchParams;i.append("id_usuario",localStorage.id_usuario),i.append("token",localStorage.token);try{i.append("stackTrace",(new Error).stack),i.append("getNotesTry",getNotesTry)}catch(e){console.log(e)}fetch(a,{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i}).then((a=>{if(!a.ok)throw getNotesTry<3&&(getNotesTry++,setTimeout((function(){sincronizaLogin(e,t,o)}),1e4*getNotesTry)),new Error("Network response was not ok");return a.json()})).then((async function(a){getNotesTry=0;var i=a;i.isSuccess&&(localStorage.sid=i.sid,localStorage.confirmado=i.confirmado,localStorage.publicCount=i.publicCount,null!=i.invitaciones?recibeInvitaciones(i.invitaciones):localStorage.removeItem("invitaciones"),null!=i.invEnviadas?recibeInvEnviadas(i.invEnviadas):localStorage.removeItem("invEnviadas"),e?t&&"function"==typeof muestraPostit?cargaNotasAdd(i,t,o):(cargaNotasAdd(i,!1,o),esBackground()&&await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})):(inicializaLocalStorage(),cargaNotas(i,t,o),esBackground()&&await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})),null!=i.comparticiones?recibeComparticiones(i.comparticiones):localStorage.removeItem("comparticiones"),vaciarPapelera({},30),compruebaPopups(),muestraPops(),!esBackground()&&($(".updateButton").is(":visible")||$("#progress").is(":visible")||$("#black_overlay-web-app").is(":visible"))&&(refrescaPantalla(!1,!0),refrescaOrdenacion(),$(".updateButton").find(".ajaxloader").remove()),esBackground()?(chrome.contextMenus.removeAll(initializeMenus),miraAgenda(),await setAllLocalStorage()):(sendMessage({menstoBack:"cambioMenu"}),muestraPaneles2(!1,!0),$("#black_overlay-web-app").fadeOut(400)),compruebaNotasWeb())})).catch((e=>{console.error("Error:",e)}))}function cargaNotas(e,t,o){var a=0;e.mail&&(localStorage.mail=e.mail),e.espacio&&(localStorage.espacio=e.espacio),e.premium&&(localStorage.premium=e.premium);let i=0;for(;e[i];){if(null!=e[i].postit)if(e[i].tipoA!=TIPO_NOTA.TABLONES){var n=localStorage.totalPost;localStorage["tipoA"+n]=e[i].tipoA,localStorage["X"+n]=e[i].X,localStorage["Y"+n]=e[i].Y,localStorage["postit"+n]=e[i].postit,localStorage["width"+n]=e[i].width,localStorage["height"+n]="0"==e[i].height?"auto":e[i].height,localStorage["fecha"+n]=e[i].fecha,localStorage["treeId"+n]=e[i].id_nota,localStorage["tablon"+n]=e[i].tablon,localStorage["calendar"+n]=e[i].calendar,localStorage["sinMarco"+n]="1"==e[i].sinMarco,e[i].rotacion&&(localStorage["rotacion"+n]=e[i].rotacion),e[i].pushpin&&(localStorage["pushpin"+n]=e[i].pushpin),e[i].notaWeb&&(localStorage["notaWeb"+n]=e[i].notaWeb),e[i].columnaKanban&&(localStorage["columnaKanban"+n]=e[i].columnaKanban),e[i].connections&&(localStorage["connections"+n]=e[i].connections),e[i].minimizado&&"0"!=e[i].minimizado&&(localStorage["minimizado"+n]="1"==e[i].minimizado),parseInt(e[i].tablon)>a&&"-999"!=e[i].tablon&&(a=parseInt(e[i].tablon)),null!=e[i].permisos&&("RW"==e[i].permisos?localStorage["userComp"+n]=e[i].userComp:localStorage["userComp"+n]="R",localStorage["nickComp"+n]=e[i].nickComp,recuperaPosCompartido(n)),localStorage.totalPost++}else{localStorage.treeId10000=e[i].id_nota;try{var r=JSON.parse(e[i].postit)}catch(t){try{r=JSON.parse(e[i].postit.replace("\\",""))}catch(e){console.log(e);r={tabLabels:[]}}}var s=r.tabLabels.length,l=localStorage.numTablones;if(null==localStorage.errorConexion10000||s>l){for(var c=1;c<=s;c++)localStorage["tab"+c+"Label"]=r.tabLabels[c-1],localStorage["fondo"+c]=r.tabBgs[c-1],null!=r.tabPublico&&1==r.tabPublico[c-1]?localStorage["publico"+c]="true":localStorage["publico"+c]="false",null!=r.tabMasonry&&1==r.tabMasonry[c-1]?localStorage["masonry"+c]="true":localStorage["masonry"+c]="false",null!=r.tabOrden&&(localStorage["ordenTablon"+c]=r.tabOrden[c-1]),null!=r.tabKanban&&r.tabKanban[c-1]&&"null"!=r.tabKanban[c-1]&&(localStorage["tablonKanban"+c]=r.tabKanban[c-1]);localStorage.removeItem("errorConexion10000")}else clearInterval(intervalErrorConexion),intervalErrorConexion=setInterval(intentaConexion,1e4),s=l;localStorage.numTablones=s}i++}if(a>localStorage.numTablones){for(var u=parseInt(localStorage.numTablones);u<a;u++)null!=localStorage["fondo"+(u+1)]&&"undefined"!=localStorage["fondo"+(u+1)]||(localStorage["fondo"+(u+1)]=0);localStorage.numTablones=a}t&&sendMessage({mensBack:"muestraNotas"}),o?muestraNotasAlCompartir():inicializaInvitaciones(),localStorage.totalPost>0&&(cambiaIcono(),cambiaContador()),("-999"!=localStorage.tablonActual||!algunaNotaWeb())&&parseInt(localStorage.tablonActual)>parseInt(localStorage.numTablones)&&(localStorage.tablonActual=localStorage.numTablones)}function cargaNotasAdd(e,t,o){for(var a=localStorage.totalPost,i=new Array,n=!1,r=0,s=0;s<a;s++)i[s]=!1;e.mail&&(localStorage.mail=e.mail),e.espacio&&(localStorage.espacio=e.espacio),e.premium&&(localStorage.premium=e.premium);let l=0;for(;e[l];){if(null!=e[l].postit)if(e[l].tipoA!=TIPO_NOTA.TABLONES){var c=!1;for(s=0;s<a;s++)localStorage["postit"+s]==e[l].postit&&(i[s]=!0,c=!0);if(!c){var u=localStorage.totalPost;localStorage["tipoA"+u]=e[l].tipoA,localStorage["X"+u]=e[l].X,localStorage["Y"+u]=e[l].Y,localStorage["postit"+u]=e[l].postit,localStorage["width"+u]=e[l].width,localStorage["height"+u]="0"==e[l].height?"auto":e[l].height,localStorage["fecha"+u]=e[l].fecha,localStorage["tablon"+u]=e[l].tablon,localStorage["treeId"+u]=e[l].id_nota,localStorage["calendar"+u]=e[l].calendar,localStorage["sinMarco"+u]="1"==e[l].sinMarco,e[l].rotacion&&(localStorage["rotacion"+u]=e[l].rotacion),e[l].pushpin&&(localStorage["pushpin"+u]=e[l].pushpin),e[l].notaWeb&&(localStorage["notaWeb"+u]=e[l].notaWeb),e[l].columnaKanban&&(localStorage["columnaKanban"+u]=e[l].columnaKanban),e[l].connections&&(localStorage["connections"+u]=e[l].connections),e[l].minimizado&&"0"!=e[l].minimizado&&(localStorage["minimizado"+u]="1"==e[l].minimizado),parseInt(e[l].tablon)>r&&"-999"!=e[l].tablon&&(r=parseInt(e[l].tablon)),null!=e[l].permisos&&("RW"==e[l].permisos?localStorage["userComp"+u]=e[l].userComp:localStorage["userComp"+u]="R",localStorage["nickComp"+u]=e[l].nickComp,recuperaPosCompartido(u)),localStorage.totalPost++,t&&muestraPostit(u)}}else{localStorage.treeId10000=e[l].id_nota;try{var d=JSON.parse(e[l].postit)}catch(t){try{d=JSON.parse(e[l].postit.replace("\\",""))}catch(e){console.log(e);d={tabLabels:[]}}}var p=d.tabLabels.length,g=localStorage.numTablones;if(null==localStorage.errorConexion10000||p>g){for(var m=1;m<=p;m++)localStorage["tab"+m+"Label"]=d.tabLabels[m-1],localStorage["fondo"+m]=d.tabBgs[m-1],null!=d.tabPublico&&1==d.tabPublico[m-1]?localStorage["publico"+m]="true":localStorage["publico"+m]="false",null!=d.tabMasonry&&1==d.tabMasonry[m-1]?localStorage["masonry"+m]="true":localStorage["masonry"+m]="false",null!=d.tabOrden&&(localStorage["ordenTablon"+m]=d.tabOrden[m-1]),null!=d.tabKanban&&d.tabKanban[m-1]&&"null"!=d.tabKanban[m-1]&&(localStorage["tablonKanban"+m]=d.tabKanban[m-1]);localStorage.removeItem("errorConexion10000")}else clearInterval(intervalErrorConexion),intervalErrorConexion=setInterval(intentaConexion,1e4),p=g;(null==localStorage.numTablones||p>localStorage.numTablones)&&(localStorage.numTablones=p),n=!0}l++}if(localStorage.totalPost>0&&(cambiaIcono(),cambiaContador()),r>localStorage.numTablones){for(s=parseInt(localStorage.numTablones);s<r;s++)null!=localStorage["fondo"+(s+1)]&&"undefined"!=localStorage["fondo"+(s+1)]||(localStorage["fondo"+(s+1)]=0);localStorage.numTablones=r}addNotasNuevas(i,a,n),inicializaInvitaciones(),esTabCompartido(localStorage.tablonActual)?trataTablonComp():inicializaFriendsBot(),t&&refrescaPantalla(!1,!0)}function addNotasNuevas(e,t,o){if(!isDemoUser()){for(var a=new Array,i=0,n=0;n<t;n++)if(!e[n]){"undefined"!=localStorage["tablon"+n]&&null!=localStorage["tablon"+n]||(localStorage["tablon"+n]=1),null!=localStorage["sinMarco"+n]&&"undefined"!=localStorage["sinMarco"+n]||(localStorage["sinMarco"+n]="false");var r={tipoA:localStorage["tipoA"+n],X:localStorage["X"+n],Y:localStorage["Y"+n],postit:localStorage["postit"+n],width:localStorage["width"+n],height:localStorage["height"+n],fecha:localStorage["fecha"+n],tablon:localStorage["tablon"+n],calendar:localStorage["calendar"+n],sinMarco:localStorage["sinMarco"+n],rotacion:localStorage["rotacion"+n],pushpin:localStorage["pushpin"+n],notaWeb:localStorage["notaWeb"+n],columnaKanban:localStorage["columnaKanban"+n],connections:localStorage["connections"+n],minimizado:localStorage["minimizado"+n]};localStorage["updated"+n]="false",a[i]=r,i++}if(i>0){var s="id_usuario="+localStorage.id_usuario;s+="&token="+localStorage.token,s+="&listaNotas="+encodeURIComponent(JSON.stringify(a)),numIntentos=0,llamadaCreate(s,e,t,o)}else o?updateNotaLoginMemo(1e4):grabaNotaLogin(1e4)}}var numIntentos,numIntentosMod;function llamadaCreate(e,t,o,a){$.ajax({type:"POST",url:getServerUrl()+"api/createListNotes.php",data:e,cache:!1,success:function(e){var i=JSON.parse(e),n=0;if(i.isSuccess){i.espacio&&(localStorage.espacio=i.espacio);for(var r=0;r<o;r++)t[r]||(localStorage["treeId"+r]=i.idNota[n],addTreeIdPopup(i.idNota[n],r),addTreeIdConnection(i.idNota[n],r),addTreeIdKanban(i.idNota[n],r),$("#postit"+r).attr("data-treeId",i.idNota[n]),localStorage["postit"+r].indexOf("data:image/")>0&&null!=i.postit[n]&&(localStorage["postit"+r]=i.postit[n].replace(/<\/p>n<p>/gm,"</p>\n<p>"),refrescaNota(r)),n++);a?updateNotaLoginMemo(1e4):grabaNotaLogin(1e4)}else localStorage.sincroLogin=!1},error:function(e,a,i){console.log("Error llamadaCreate");for(var n=0;n<o;n++)t[n]||(manageConnectionError(n,"create",!1),errorConexion(n,"create"));muestraAyuda("mensErrorConexion")}})}function grabaModificaciones(){if(!isDemoUser()){for(var e=new Array,t=!1,o=0,a=0;a<localStorage.totalPost;a++)if("true"==localStorage["updated"+a]){if(t=!0,"undefined"!=localStorage["tablon"+a]&&null!=localStorage["tablon"+a]||(localStorage["tablon"+a]=1),null==localStorage["userComp"+a]||"R"==localStorage["userComp"+a])var i=localStorage.id_usuario;else i=localStorage["userComp"+a];null!=localStorage["sinMarco"+a]&&"undefined"!=localStorage["sinMarco"+a]||(localStorage["sinMarco"+a]="false");var n={id_nota:localStorage["treeId"+a],tipoA:localStorage["tipoA"+a],X:localStorage["X"+a],Y:localStorage["Y"+a],postit:localStorage["postit"+a],width:localStorage["width"+a],height:localStorage["height"+a],fecha:localStorage["fecha"+a],tablon:localStorage["tablon"+a],calendar:localStorage["calendar"+a],sinMarco:localStorage["sinMarco"+a],rotacion:localStorage["rotacion"+a],pushpin:localStorage["pushpin"+a],usuario:i,notaWeb:localStorage["notaWeb"+a],columnaKanban:localStorage["columnaKanban"+a],connections:localStorage["connections"+a],minimizado:localStorage["minimizado"+a]};localStorage["updated"+a]="false",e[o]=n,o++}if("true"==localStorage.updated10000){var r=new Array,s=new Array,l=new Array,c=new Array,u=new Array,d=new Array;for(a=1;a<=localStorage.numTablones;a++)null==localStorage["tab"+a+"Label"]&&(localStorage["tab"+a+"Label"]="undefined"),r.push(localStorage["tab"+a+"Label"]),s.push(localStorage["fondo"+a]),"true"==localStorage["publico"+a]?l.push(1):l.push(0),"true"==localStorage["masonry"+a]?u.push(1):u.push(0),c.push(ordenTablon(a)),localStorage["tablonKanban"+a]?d.push(localStorage["tablonKanban"+a]):d.push("");var p={tabLabels:r,tabBgs:s,tabPublico:l,tabOrden:c,tabMasonry:u,fuente:localStorage.fuente,size:localStorage.size,tabKanban:d};n={id_nota:localStorage.treeId10000,tipoA:TIPO_NOTA.TABLONES,X:0,Y:0,rotacion:"",postit:JSON.stringify(p),width:0,height:0,fecha:"",tablon:0,calendar:"",pushpin:"",sinMarco:!1,usuario:localStorage.id_usuario};e[o]=n,t=!0,localStorage.updated10000="false"}if(t){var g="id_usuario="+localStorage.id_usuario;g+="&token="+localStorage.token,g+="&listaNotas="+encodeURIComponent(JSON.stringify(e)),g+="&sid="+localStorage.sid,numIntentosMod=0,llamadaUpdate(g)}}}function llamadaUpdate(e){$.ajax({type:"POST",url:getServerUrl()+"api/updateListNotes4.php",data:e,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess||console.log("Error:  "+t.error)},error:function(t,o,a){console.log(t),console.log("Error UpdateList"),++numIntentosMod<8?(console.log("Intento otra vez..."+numIntentosMod),setTimeout((function(){llamadaUpdate(e)}),1e4)):console.log("No quedan intentos, mala suerte")}})}function sendReportError(e,t,o){var a="id_usuario="+e;a+="&numPost="+t,a+="&nota="+o,a+="&localStorage="+escape(JSON.stringify(localStorage)),a+="&navigator="+encodeURIComponent(navigator.userAgent+"-"+navigator.platform+"-"+navigator.cookieEnabled+"-"+navigator.language),a+="&origen=extensión",$.ajax({type:"POST",url:getServerUrl()+"api/sendReport.php",data:a,cache:!1,success:function(e){},error:function(e,t,o){console.log(t)}})}function sendReportErrorGetNotes(){var e="stackTrace="+(new Error).stack;e+="&version="+chrome.runtime.getManifest().version,e+="&navigator="+encodeURIComponent(navigator.userAgent+"-"+navigator.platform+"-"+navigator.cookieEnabled+"-"+navigator.language),e+="&origen=extensión",$.ajax({type:"POST",url:getServerUrl()+"api/sendReportTrace.php",data:e,cache:!1,success:function(e){},error:function(e,t,o){console.log(t)}})}var intervalErrorConexion=0;function errorConexion(e,t){null==localStorage["errorConexion"+e]&&(localStorage["errorConexion"+e]=t,localStorage.refrescaNota=e,sendMessage({mensBack:"refrescaNota"}),clearInterval(intervalErrorConexion),intervalErrorConexion=setInterval(intentaConexion,1e4))}function intentaConexion(){var e=!1;if(isUserConnected()){for(var t=0;t<localStorage.totalPost;t++)e=reintentarSiError(t)||e;(e=reintentarSiError(1e4)||e)||clearInterval(intervalErrorConexion)}else clearInterval(intervalErrorConexion)}function reintentarSiError(e){var t=!1;if(null!=localStorage["errorConexion"+e])switch(t=!0,localStorage["errorConexion"+e]){case"create":grabaNotaLogin(e);break;case"update":e<1e4&&yaExisteNota(e)?grabaNotaLogin(e):updateNotaLogin(e)}return t}function yaExisteNota(e){for(var t=localStorage["treeId"+e],o=0;o<localStorage.totalPost;o++)if(t==localStorage["treeId"+o]&&o!=e)return!0;return!1}var numPostEditar,hayYoutubeSpotify=!1,winId=0,tablonActual=1;$(document).on("click",'a[href^="http"]',(function(e){e.preventDefault(),window.open($(this).attr("href"),"_blank")})),$(document).ready((function(){tablonActual=localStorage.tablonActual||1,inicializar(),chrome.windows.getCurrent((function(e){winId=e.id})),$(window).on("mouseout",(function(e){$(this).find(".ui-resizable-se").hide(),$(this).find(".pencilImg").hide(),setPopupPos(winId,window.screenX,window.screenY)})),$(".pinImgSelec").on("click",clickImgSelec),$("body").on("click",".pinImgSelecEdit",clickImgSelecEdit),$(window).on("resize",(function(e){resizeFunc();var t=numeroNota();null==tinyMCE.get("textAreaEdit"+t)&&setPopupSize(winId,$(window).width(),$(window).height())})),listenMessage("postMod",(function(e,t){var o=numeroNota();e.numPost==o&&($("#postit"+o).remove(),muestraPostit(o))})),listenMessage("unpopup",(function(e,t){chrome.windows.getCurrent((function(t){t.id==e.winId&&window.close()}))})),listenMessage("mensBack",(function(e,t){"notaEnEdicion"==e.mensBack&&addContentToEditor(e.numPost,e.content)}))}));var intervalInv,zoomGlobal=1;function resizeFunc(){var e=numeroNota();hayYoutubeSpotify&&(resizeIframes(e,$("#postit"+e).width(),$("#postit"+e).height()),localStorage["postit"+e].indexOf(".pdf")>-1&&location.reload())}function inicializar(){$(".sinMarcoLabel").text(chrome.i18n.getMessage("sinMarco"));var e=numeroNota();muestraPostit(e),abreEditando()&&setTimeout((function(){$("#texto"+e).dblclick()}),500),checkBoardRealTime(localStorage["tablon"+e])}function buscarTipo(e){return $("#"+e).attr("data-tipo")||"1"}function muestraPostit(e){nuevaNota()?localStorage["postit"+e]||(localStorage["postit"+e]=" ",localStorage["tipoA"+e]=1+Math.floor(7*Math.random()),localStorage["X"+e]=20+Math.floor(100*Math.random()),localStorage["Y"+e]=50+Math.floor(100*Math.random())):null==localStorage["postit"+e]&&window.close(),""!=localStorage["tipoA"+e]&&null!=localStorage["tipoA"+e]&&"undefined"!=localStorage["tipoA"+e]||(localStorage["tipoA"+e]=1);var t=localStorage["tipoA"+e],o=localStorage["postit"+e],a=document.createElement("postit");if(a.id="postit"+e,"true"==localStorage["sinMarco"+e]?t.length<3?a.className="postitPop postit"+t+" postitSinMarco postitNB":a.className="postitPop postit1 postitSinMarco postitNB":t.length<3?a.className="postitPop postit"+t+" postitConMarco postitNB":a.className="postitPop postit1 postitConMarco postitNB",a.innerHTML=`<div class="bordesup" id="bordesup${e}"></div>\n\t\t\t${notaWeb()&&getHostFromUrl(paramUrl())!==paramUrl()?`\n\t\t\t<div class="switch">\n\t\t\t\t<span class="switch-title">${chrome.i18n.getMessage("asignarUrl")}</span>\n\t\t\t\t<label>\n\t\t\t\t\t<span">${paramUrl()}</span>\n\t\t\t\t\t<input type="checkbox" id="urlAssign" ${urlDeNotaWeb(e)&&urlDeNotaWeb(e)!=paramUrl()?"checked":""}>\n\t\t\t\t\t<span class="lever"></span>\n\t\t\t\t\t<span>${getHostFromUrl(paramUrl())}*</span>\n\t\t\t\t</label>\n\t\t\t</div>`:""}\n\t\t<div class="parteSuperior" id="parteSuperior${e}" data-numpost=${e} ${notaWeb()?'style="margin-bottom: 10px"':""}>\n\t\t\t<div class="fondoIconos tooltip" id="fondoIconos${e}"></div>\n\t\t\t${o.indexOf("<video")>-1?`<img class="pipVideo tooltip" id="pipVideo${e}" src="appimg/pip.png"/>`:""}\n\t\t\t${notaWeb()?"":'<img class="volverNoteBoard" id="volverNoteBoard${numPost}" src="appimg/enter.png"/>'}\n\t\t\t<img class="pencilImg tooltip" id="pencilImg${e}" src="appimg/pencil.png"/>\n\t\t</div>\n\t\t<div class="textoNB fuente${localStorage.fuente}"  id="texto${e}">${o}</div>\n\t\t<div class="clearfloat"></div>\n\t\t</div>`,$("body").append(a),80==t&&$("#postit"+e).removeClass("postit1").addClass("postit80").addClass("notepad"),localStorage["pushpin"+e]&&$("#postit"+e).append('<img class="pinImg" data-pushpin="'+localStorage["pushpin"+e]+'" src="appimg/pushpins/pushpin'+localStorage["pushpin"+e]+'.png" />'),$("#pencilImg"+e).css("right","15px"),$("#texto"+e).css({"font-size":localStorage.size}),t.length>2){var i=colorLuminance(t,-.2);document.getElementById("postit"+e).style.background="linear-gradient(#"+t+", "+i+")"}null!=localStorage["userComp"+e]&&($("#borr"+e).remove(),$("#moverImg"+e).remove(),$("#bordesup"+e).height("25"),$("#bordesup"+e).html('<div class="friendsDiv"><img src="appimg/friends.png"><label>'+localStorage["nickComp"+e]+"</label></div>"),"R"==localStorage["userComp"+e]&&$("#pencilImg"+e).remove()),null!=localStorage["errorConexion"+e]&&($("#bordesup"+e).html('<div class="errorDiv"><label class="errorLabel">'+chrome.i18n.getMessage("errorConex")+"</label></div>"),$(".errorDiv").attr("title",chrome.i18n.getMessage("descErrorConex"))),"R"!=localStorage["userComp"+e]&&(hazEditable(e),$("#pencilImg"+e).on("click",(function(){$("#texto"+e).trigger("openEditor")}))),localStorage["Y"+e]<-50&&(localStorage["Y"+e]=40+Math.floor(100*Math.random())),localStorage["Y"+e]<-50&&(localStorage["Y"+e]=100+Math.floor(100*Math.random())),$("#postit"+e).css({overflow:"auto"}),$("#postit"+e).height()>1200&&$("#texto"+e).css("overflow","auto"),$("#postit"+e).offset({top:0,left:0}),null!=localStorage["width"+e]&&"undefined"!=localStorage["width"+e]||(localStorage["width"+e]=$("#postit"+e).width()),null!=localStorage["height"+e]&&"undefined"!=localStorage["height"+e]&&"0"!=localStorage["height"+e]||(localStorage["height"+e]=$("#postit"+e).height()),programaEventos(e),activaTooltip(e),compruebaListaDerecha(e),(hayYoutubeSpotify=isIframeEmbeded(localStorage["postit"+e]))&&resizeIframes(e,$("#postit"+e).width(),$("#postit"+e).height()),hightlightCode()}function activaTooltip(e){var t={theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:150};$("#volverNoteBoard"+e).tooltipster(t),$("#pencilImg"+e).tooltipster(t)}function programaEventos(e){$(".pencilImg").attr("title",chrome.i18n.getMessage("botonEdit")),isChromeExtension()?($("#volverNoteBoard"+e).attr("title",chrome.i18n.getMessage("volverNoteBoard")),$("#volverNoteBoard"+e).on("click",(function(){chrome.extension.getBackgroundPage().irAnotaPopup(e)}))):$("#volverNoteBoard"+e).hide(),$("#postit"+e).hover((function(){$(".parteSuperior").css("visibility","visible"),"true"==localStorage["sinMarco"+e]&&null==tinyMCE.get("textAreaEdit"+e)&&$("#parteSuperior"+e).show()}),(function(){$(".parteSuperior").css("visibility","hidden"),"true"==localStorage["sinMarco"+e]&&null==tinyMCE.get("textAreaEdit"+e)&&$("#parteSuperior"+e).hide()})),$(".noteBoardCheck").on("click",checkChanged2)}function checkChanged2(e){var t=numeroNota();$(this).attr("checked")?$(this).attr("checked",!1):$(this).attr("checked",!0),localStorage["postit"+t]=$("#texto"+t).html(),isUserConnected()&&null==localStorage["userComp"+t]&&updateNotaLoginMemo(t),localStorage.refrescaNota=t,sendMessage({mensBack:"refrescaNota"})}function compruebaListaDerecha(e){localStorage["postit"+e].indexOf('<li dir="rtl" style="text-align: right')>-1&&$("#postit"+e).css("padding-right","35px")}function hazEditable(e){var t=Math.floor($("#postit"+e).height()/35);$("#texto"+e).editInPlace({bg_over:"transparent",field_type:"textarea",textarea_rows:t,show_buttons:!0,value_required:!0,use_html:!0,callback:function(t,o,a,i,n){n.didStartSaving(),setTimeout(n.didEndSaving,2e3),o=compruebaVideos(o),guardaTextoEnNota(e,o),null!=localStorage.editandoTipo&&"undefined"!=localStorage.editandoTipo&&""!=localStorage.editandoTipo&&(localStorage["tipoA"+e]=localStorage.editandoTipo),localStorage.editandoTipo="";var r=$("#postit"+e+" .pinImg").data("pushpin")||0;return r?localStorage["pushpin"+e]=r:localStorage.removeItem("pushpin"+e),isUserConnected()&&updateNotaLogin(e),$("#postit"+e).remove(),notaWeb()||muestraPostit(e),localStorage.refrescaNota=e,sendMessage({mensBack:"refrescaNota",nota:e}),o}})}function cambiaAparenciaEditor(e,t){var o;switch(e){case TIPO_NOTA.AMARILLO:o="#fff4c7";break;case TIPO_NOTA.VERDE:o="#ddf2c9";break;case TIPO_NOTA.LILA:o="#efe2f4";break;case TIPO_NOTA.AMARILLO2:o="#f3e05d";break;case TIPO_NOTA.ROSA:o="#f5a4d8";break;case TIPO_NOTA.ROJO:o="rgb(252, 91, 91)";break;case TIPO_NOTA.AZUL:o="rgb(191, 192, 243)";break;case TIPO_NOTA.TRANSPARENTE:o="transparent";break;case TIPO_NOTA.BLANCO:case TIPO_NOTA.LIBRETA:o="#ffffff";break;default:o="#"+e}switch(localStorage.fuente){case"1":var a="'Kalam'";"http://fonts.googleapis.com/css?family=Kalam:400normal&subset=all";break;case"2":a="'Droid Sans'";"http://fonts.googleapis.com/css?family=Droid+Sans";break;case"3":a="'Architects Daughter'";"http://fonts.googleapis.com/css?family=Architects+Daughter:400normal&subset=all";break;case"4":a="'Quando', Arial, Helvetica, sans-serif";"https://fonts.googleapis.com/css?family=Quando:400normal&subset=all";break;case"5":a="'Indie Flower'";"http://fonts.googleapis.com/css?family=Indie+Flower";break;case"6":a="'Quattrocento Sans'";"http://fonts.googleapis.com/css?family=Quattrocento+Sans:400,700&subset=all";break;case"7":a="'Montserrat'";"http://fonts.googleapis.com/css?family=Montserrat:400normal&subset=all";break;case"8":a="'Roboto'";"http://fonts.googleapis.com/css?family=Roboto&display=swap";break;case"9":a="'Karla'";"http://fonts.googleapis.com/css?family=Karla&display=swap";break;case"10":a="'Balsamiq Sans'";"http://fonts.googleapis.com/css?family=Balsamiq+Sans&display=swap"}if("postitnuevo"!=t&&t.indexOf("postit")>-1){var i=parseInt(t.substr(6));t="textAreaEdit"+i}"postitnuevo"==t&&(t="textoAnun");for(var n=$(".fuente"+localStorage.fuente).css("line-height"),r=0;r<$("iframe").length;r++)if($("iframe")[r].id.indexOf("text")>-1){var s=$("iframe")[r].contentDocument;null==s||null!=t&&$("iframe")[r].id!=t+"_ifr"||($(s.body).css({"background-color":o,"font-family":a,"font-size":localStorage.size,"line-height":n}),s.styleSheets[0].insertRule("::-webkit-scrollbar { width: 12px; height: 12px;}",0),s.styleSheets[0].insertRule("::-webkit-scrollbar-track {-webkit-box-shadow: inset 0 0 6px #a1aca2;-webkit-border-radius: 3px;border-radius: 3px;}",0),s.styleSheets[0].insertRule("::-webkit-scrollbar-thumb { -webkit-border-radius: 3px;border-radius: 3px;background: #333;-webkit-box-shadow: inset 0 0 6px black;}",0),s.styleSheets[0].insertRule("::-webkit-scrollbar-thumb:window-inactive {background: #bbb8b6;} ",0),s.styleSheets[0].insertRule("::-webkit-scrollbar-track-piece {background-color: #d3cfcc;}",0),$(s.body).find(".noteBoardCheck").on("click",(function(){$(this).attr("checked")?$(this).attr("checked",!1):$(this).attr("checked",!0)})))}}function cambioPostit(e,t){if($("#"+t).removeClass("notepad").removeClass("postit0").removeClass("postit1").removeClass("postit2").removeClass("postit3").removeClass("postit4").removeClass("postit5").removeClass("postit6").removeClass("postit7").removeClass("postit8").removeClass("postit10"),e.length>3){var o=colorLuminance(e,-.2);document.getElementById(t).style.background="linear-gradient(#"+e+", "+o+")"}else $("#"+t).addClass("postit"+e);e==TIPO_NOTA.LIBRETA&&$("#"+t).addClass("notepad"),cambiaAparenciaEditor(e,t),localStorage.editandoTipo=e,$("#"+t).attr("data-tipo",e)}function cambiaFuente(e){var t=new Array;t=document.getElementsByTagName("*");for($("#fuente"+localStorage.fuente).css("background-color",""),$("#fuente"+e).css("background-color","#9F7E61"),localStorage.fuente=e,i=0;i<t.length;i++)"fuente"==t[i].className.substring(0,6)&&(t[i].className="fuente"+e);null!=localStorage.size&&$(".fuente"+e).css({"font-size":localStorage.size}),cambiaAparenciaEditor(buscarTipo("postitnuevo"),"postitnuevo")}function adjuntarDatos(e){var t=numeroNota();localStorage["postit"+t]+="<br>"+compruebaVideos(e),$("#postit"+t).remove(),muestraPostit(t),"auto"==localStorage["width"+t]&&(localStorage["width"+t]=$("#postit"+t).width()),isUserConnected()&&updateNotaLogin(t),localStorage.refrescaNota=t,window.resizeTo($("#postit"+t).width()+16,$("#postit"+t).height()+50),sendMessage({mensBack:"refrescaNota"})}function inicializaInvitaciones(){invitacionesPorTratar()&&($("#invitacionesBot").show(),$("#compBot").attr("title",chrome.i18n.getMessage("compartir")),$("#invitacionesBot").attr("title",chrome.i18n.getMessage("invitacionesBot")),intervalInv=setInterval(parpadeaBotonInv,300))}function muestraNotasAlCompartir(){refrescaPantalla(null,!0),inicializaInvitaciones(),esTabCompartido(tablonActual)?trataTablonComp():inicializaFriendsBot(),muestraPaneles2(),cambiaIcono(),cambiaContador()}function esTablonCompartido(e){if(!isUserConnected()||!localStorage.comparticiones)return!1;for(var t=JSON.parse(localStorage.comparticiones),o=0;o<t.length&&t[o].tabComp!=e;)o++;return o<t.length}function getTablonCompartido(e){if(!isUserConnected()||!localStorage.comparticiones)return!1;for(var t=JSON.parse(localStorage.comparticiones),o=0;o<t.length&&t[o].tabComp!=e;)o++;return o<t.length&&t[o]}function comparteTablon(){if(!salSiPapelera())if(isUserConnected()){var e=obtenerFormularioInvitar();$("#listaTablones option").sortElements((function(e,t){return parseInt($(e).attr("orden"))>parseInt($(t).attr("orden"))?1:-1})),abrirPantallaModal(e,{onOpenStart:function(){$("#enviar-compartir").off().on("click",compartir),$("#pedir-url").off().on("click",pedirUrlCompartir)},height:700})}else muestraAdvertenciaLogin("hayQueLoguearse")}function compartir(){if(!isDemoUser()){var e=$("#userInvitado").val();if(""==e)return $("#userInvitado").focus(),void(idiomaEsp(navigator.language)?muestraMensajeModal("Informa el usuario al que quieres invitar por favor"):muestraMensajeModal("Informs the user that you want to invite please"));if(e!=localStorage.nick)if(-1==e.indexOf("@")&&yaCompartido(e,parseInt($("#listaTablones").val())))idiomaEsp(navigator.language)?muestraMensajeModal("Tablón ya compartido con "+e):muestraMensajeModal("Board already shared with "+e);else if(e.indexOf("@")>-1&&!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\D{2,4})+$/.test(e))idiomaEsp(navigator.language)?muestraMensajeModal("Mail con formato incorrecto"):muestraMensajeModal("Wrong mail");else{muestraMensajeModal(""),$("#enviar-compartir i").addClass("loader");var t=$("#onlyRead").is(":checked")?"R":"RW",o="id_usuario="+localStorage.id_usuario;o+="&token="+localStorage.token,o+="&permisos="+t,o+="&userInvitado="+encodeURIComponent(e),o+="&nombreInvitador="+encodeURIComponent($("#nombreInvitador").val()),o+="&tablon="+parseInt($("#listaTablones").val()),o+="&textoCompartir="+encodeURIComponent($("#textoCompartir").val()),$.ajax({type:"POST",url:getServerUrl()+"api/invitar.php",data:o,cache:!1,success:function(o){var a=JSON.parse(o);$("#mensError").html(a.mens),a.isSuccess&&(addInvEnviadas(e,a.id_usuarioInv,parseInt($("#listaTablones").val()),$("#textoCompartir").val(),t),$("#dialog-confirm").fadeOut(1e3,(function(){modalInstance.close()})))},error:function(e,t,o){console.log(t)},complete:function(){$("#enviar-compartir i").removeClass("loader")}})}else idiomaEsp(navigator.language)?muestraMensajeModal("No puedes compartir contigo mismo, escribe el nombre de usuario o mail del usuario al que quieres invitar"):muestraMensajeModal("You can not share with yourself, type the user name or mail the user you want to invite")}}function pedirUrlCompartir(){if(!isDemoUser()){$("#pedir-url i").addClass("loader");var e="id_usuario="+localStorage.id_usuario;e+="&tablon="+parseInt($("#listaTablones").val()),e+="&permisos="+($("#onlyRead").is(":checked")?"R":"RW"),$.ajax({type:"POST",url:getServerUrl()+"api/getUrlShare.php",data:e,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess?($("#url-generada").val(t.url),document.getElementById("url-generada").select(),document.execCommand("copy"),window.getSelection().empty()):muestraMensajeModal(chrome.i18n.getMessage("errorShareUrl"))},error:function(e,t,o){muestraMensajeModal(chrome.i18n.getMessage("errorShareUrl"))},complete:function(){$("#pedir-url i").removeClass("loader")}})}}function anularInvitacion(){var e=parseInt($(this).attr("id").substr(7)),t=JSON.parse(localStorage.invEnviadas),o="id_usuario1="+localStorage.id_usuario;o+="&id_usuario2="+t[e].id_usuario2,o+="&mail2="+t[e].mail,o+="&tablon1="+t[e].tablon,$.ajax({type:"POST",url:getServerUrl()+"api/anularInv.php",data:o,cache:!1,success:function(t){var o=JSON.parse(t);if(o.isSuccess){var a=JSON.parse(localStorage.invEnviadas);a.splice(e,1),localStorage.invEnviadas=JSON.stringify(a),0==a.length?$("#tablaInvEnviadas").fadeOut():$("#lineaInv"+e).fadeOut((function(){$("#contenedorTabla").html(tablaInvitacionesEnviadas())}))}else alert(o.error)},error:function(e,t,o){console.log(t)}})}function recibeInvitaciones(e){for(var t=0;t<e.length;t++)e.tratada=!1,e.aceptada=!1;localStorage.invitaciones=JSON.stringify(e)}function recibeInvEnviadas(e){localStorage.invEnviadas=JSON.stringify(e)}function recibeComparticiones(e){for(var t=[],o=0;o<e.length;o++)contieneComp(e[o],t)||(t.push(e[o]),e[o].tabKanban&&(localStorage["tablonKanban"+e[o].tabComp]=JSON.stringify(e[o].tabKanban)));localStorage.comparticiones=JSON.stringify(t)}function muestraInvitaciones(){if(clearInterval(intervalInv),$("#invitacionesBot").css("background","linear-gradient(bottom, #E3B752 6%, #FFDC73 35%, #FFFF96 73%)"),invitacionesPorTratar()>0){var e=JSON.parse(localStorage.invitaciones),t='<div class="invitaciones">';t+='<div id="listaInv"><ul>';for(var o=0;o<e.length;o++)e[o].tratada||(t+='<li id="invitacion'+o+'">',t+=chrome.i18n.getMessage("user")+":<p> "+e[o].user,t+=' - <a href="mailto:'+e[o].mail+'">'+e[o].mail+"</a></p><br>",t+=chrome.i18n.getMessage("mensaje")+":<p> "+e[o].mensaje+"</p><br>","RW"==e[o].permisos?t+=chrome.i18n.getMessage("permisos")+": <p>"+chrome.i18n.getMessage("escLec")+"</p><br>":t+=chrome.i18n.getMessage("permisos")+": <p>"+chrome.i18n.getMessage("lec")+"</p><br>",t+=`<div class="input-field"><p>${chrome.i18n.getMessage("eligeTablonDestino")}</p>\n            <div class="input-field">\n              ${getSelectHtml({id:"listaTablones",label:chrome.i18n.getMessage("elijeDestino"),options:listaTablones(isAddBoardPremiumAllowed())})}\n            </div>\n          </div>`,t+='<button type="button" class="rechazarInv btn waves-effect waves-light red lighten-2" id="rechazarInv'+o+'">'+chrome.i18n.getMessage("rechazar")+"</button>",t+='<button type="button" class="aceptarInv accept-btn btn waves-effect waves-light" id="aceptarInv'+o+'">'+chrome.i18n.getMessage("aceptar")+"</button>",t+="<hr></li>");t+='</ul></div><div id="ajaxAnswer"></div></div>',$("#dialog-confirm").attr("title",chrome.i18n.getMessage("extName")),$("#dialog-confirm").html(t),$("#listaTablones option").sortElements((function(e,t){return parseInt($(e).attr("orden"))>parseInt($(t).attr("orden"))?1:-1})),abrirPantallaModal(t,{onOpenStart:function(){$("#enviar-compartir").on("click",compartir),$(".aceptarInv").on("click",aceptarInv),$(".rechazarInv").on("click",rechazarInv)},header:{title:chrome.i18n.getMessage("invitacionesPend")},buttons:{cancelButton:!0},height:580})}}function aceptarInv(){if(!isDemoUser()){var e=parseInt($(this).attr("id").substr(10)),t=JSON.parse(localStorage.invitaciones),o="id_usuario1="+t[e].id_usuario1;o+="&id_usuario2="+localStorage.id_usuario,o+="&nick1="+t[e].user,o+="&nick2="+localStorage.nick,o+="&tablon1="+t[e].tablon,o+="&tablon2="+$("#listaTablones").val(),o+="&token="+t[e].token,$("#ajaxAnswer").html('<img src="appimg/ajax-loader.gif"/>'),$.ajax({type:"POST",url:getServerUrl()+"api/aceptarInv.php",data:o,cache:!1,success:function(t){var o=JSON.parse(t);if(o.isSuccess){var a=JSON.parse(localStorage.invitaciones);a[e].tratada=!0,a[e].aceptada=!0,localStorage.invitaciones=JSON.stringify(a),parseInt($("#listaTablones").val())>parseInt(localStorage.numTablones)?(addBoard(),sweetAlert({type:"info",text:chrome.i18n.getMessage("newSharedBoard",[nombreTablon($("#listaTablones").val()),a[e].user]),cancel:!1,successCallback:function(){clickTablon(null,!1,$("#listaTablones").val())}})):sweetAlert({type:"info",text:chrome.i18n.getMessage("sharedBoard",[nombreTablon($("#listaTablones").val()),a[e].user]),cancel:!1}),localStorage.sincPeriodico="true",sendMessage({empiezaSincroPeriodica:!0}),grabaModificaciones(),sincronizaLogin(!1,!0,!0),0==invitacionesPorTratar()?($("#dialog-confirm").fadeOut(1400,(function(){modalInstance.close()})),$("#invitacionesBot").hide()):$("#invitacion"+e).remove()}else $("#ajaxAnswer").html(o.error);$("#ajaxAnswer").html("")},error:function(e,t,o){console.log(t)}})}}function rechazarInv(){var e=parseInt($(this).attr("id").substr(11)),t=JSON.parse(localStorage.invitaciones),o="id_usuario1="+t[e].id_usuario1;o+="&id_usuario2="+localStorage.id_usuario,o+="&nick1="+t[e].user,o+="&nick2="+localStorage.nick,o+="&tablon1="+t[e].tablon,o+="&token="+t[e].token,$.ajax({type:"POST",url:getServerUrl()+"api/rechazarInv.php",data:o,cache:!1,success:function(t){var o=JSON.parse(t);if(o.isSuccess){var a=JSON.parse(localStorage.invitaciones);a[e].tratada=!0,a[e].aceptada=!1,localStorage.invitaciones=JSON.stringify(a),0==invitacionesPorTratar()?($("#dialog-confirm").fadeOut(1400,(function(){modalInstance.close()})),$("#invitacionesBot").hide()):$("#invitacion"+e).remove()}else alert(o.error)},error:function(e,t,o){console.log(t)}})}function updateCompartido(e,t){if(!isDemoUser()){for(var o=JSON.parse(localStorage.comparticiones),a=0;a<o.length;a++)o[a].tabComp==e&&(o[a].tabComp=t);localStorage.comparticiones=JSON.stringify(o);var i="id_usuario="+localStorage.id_usuario;i+="&numTablon="+e,i+="&numNuevo="+t,$.ajax({type:"POST",url:getServerUrl()+"api/updateCompartir.php",data:i,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess?console.log("success"):alert(t.error)},error:function(e,t,o){console.log(t)}})}}function deleteTablonCompartido(e,t){if(!isDemoUser()){var o="id_usuario="+localStorage.id_usuario;o+="&numTablon="+e,$.ajax({type:"POST",url:getServerUrl()+"api/deleteTablonCompartido.php",data:o,cache:!1,success:function(e){var t=JSON.parse(e);t.isSuccess?inicializaFriendsBot():alert(t.error)},error:function(e,t,o){console.log(t)}})}}function borrarCompartir(){var e=$(this).attr("id").substr(14);sweetAlert({text:chrome.i18n.getMessage("confirmarCompartirTab"),successCallback:function(){borrarCompartirConfirmado(e)},type:"warning"})}function borrarCompartirConfirmado(e){if(!isDemoUser()){var t=JSON.parse(localStorage.comparticiones),o="id_usuario="+localStorage.id_usuario;o+="&idUserComp="+t[e].id_usuarioComp,o+="&numTablon="+t[e].tabComp;var a=t[e].tabComp;$.ajax({type:"POST",url:getServerUrl()+"api/deleteCompartir.php",data:o,cache:!1,success:function(t){var o=JSON.parse(t);if(o.isSuccess){var i=JSON.parse(localStorage.comparticiones);i.splice(e,1),localStorage.comparticiones=JSON.stringify(i),esTabCompartido(a)?muestraUsuariosComp(null,!0):inicializaFriendsBot(),grabaModificaciones(),sincronizaLogin(!1,!0,!0),0==i.length&&localStorage.removeItem("comparticiones")}else console.log(o.error)},error:function(e,t,o){console.log(t)}})}}document.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault(),$("body").css("opacity","0.7")}),!1),document.addEventListener("dragleave",(function(e){e.stopPropagation(),e.preventDefault(),$("body").css("opacity","1")}),!1),document.addEventListener("drop",(function(e){e.stopPropagation(),e.preventDefault(),$("body").css("opacity","1");var t=e.dataTransfer.getData("text/html");(t.length||(t=e.dataTransfer.getData("Text")).length)&&adjuntarDatos(t)}),!1);var mailModalInstance,postitChange,numParp=0;function parpadeaBotonInv(){numParp++,"rgb(231, 91, 44)"==$("#invitacionesBot").css("background-color")?$("#invitacionesBot").css("background","linear-gradient(bottom, #E3B752 6%, #FFDC73 35%, #FFFF96 73%)"):$("#invitacionesBot").css("background","#E75B2C"),30==numParp&&(clearInterval(intervalInv),$("#invitacionesBot").css("background",""),$("#invitacionesBot").css("background-color",""))}function inicializaFriendsBot(){$("#friendsBot").hide(),$(".nicksComp").hide()}function trataTablonComp(){$("#friendsBot").show()}function muestraUsuariosComp(e,t){if(t||!$(".nicksComp").is(":visible")){for(var o='<div id="usuariosComp">'+chrome.i18n.getMessage("compartidoCon")+"</div>",a=JSON.parse(localStorage.comparticiones),i=0;i<a.length;i++)a[i].tabComp==tablonActual&&(o+='<div class="nickComp" id="nick'+i+'">'+a[i].nickComp,o+='<img class="borraCompartir" id="borraCompartir'+i+'"src="appimg/removeWhite.png">',o+='<label class="permCompartir">'+chrome.i18n.getMessage(a[i].permisos)+" </label>",o+="</div>");$(".nicksComp").html(o),$("#borraCompartir").attr("title",chrome.i18n.getMessage("borraCompartir")),$(".borraCompartir").on("click",borrarCompartir);var n=$("#friendsBot").position().left+$(".nicksComp").width();$(".nicksComp").css({top:$("#friendsBot").height(),left:n>window.innerWidth?$("#friendsBot").position().left-(n+10-window.innerWidth):$("#friendsBot").position().left}),$(".nicksComp").fadeIn()}else $(".nicksComp").fadeOut();e&&e.stopPropagation(),closePaneles("nicksComp")}function showCalendar(e){var t=obtenerFormularioCalendar();abrirPantallaModal(t,{onOpenStart:function(){inicializaCalendar(e)},width:600,maxHeight:"500px",minHeight:"480px",dialogElement:"dialog-calendar"})}function inicializaCalendar(e){var t=getCalendarDate(e);t?($("#crear-aviso").hide(),$("#modificar-aviso").show(),$("#borrar-aviso").show()):($("#crear-aviso").show(),$("#modificar-aviso").hide(),$("#borrar-aviso").hide()),$("#borrar-aviso").off().on("click",(function(){borrarCalendar(e),modalInstance.close()})),$("#crear-aviso, #modificar-aviso").off().on("click",(function(){crearCalendar(e),modalInstance.close()}));var o=t||new Date;$("#datepicker").val(o.getDate()+"."+(o.getMonth()+1)+"."+o.getFullYear()+" "+o.getHours()+":"+o.getMinutes()),jQuery("#datepicker").datetimepicker({format:"d.m.Y H:i",inline:!0,step:5,minDate:0,dayOfWeekStart:1}),$.datetimepicker.setLocale(window.navigator.language||navigator.browserLanguage),getCalendarPopup(e)||null==localStorage["calendar"+e]||$("#popupCalendarCheck").prop("checked",!1),getCalendarPeriodicidad(e)&&$("#periodicidad").val(getCalendarPeriodicidad(e)),getCalendarMail(e)&&$("#popupMailCheck").prop("checked",!0),$("#popupMailCheck").on("click",(function(){ocultaFormularioCalendar(),abreFormMail(e),compruebaCheckMail()})),compruebaCheckMail(),$("#dialog-calendar .tooltipstered").tooltipster({theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:150,zIndex:100000001})}function ocultaFormularioCalendar(){$("#dialog-calendar").hide()}function muestraFormularioCalendar(){$("#dialog-calendar").show()}function compruebaCheckMail(){$("#popupMailCheck").is(":checked")?$("#popupCalendarCheck").removeAttr("disabled"):($("#popupCalendarCheck").prop("checked",!0),$("#popupCalendarCheck").attr("disabled",!0))}function crearCalendar(e){var t=$("#datepicker").datetimepicker("getValue");setCalendarDate(e,t),$("#popupCalendarCheck").is(":checked")?setCalendarPopup(e,!0):setCalendarPopup(e,!1),grabaNotaCalendar(e),$("#periodicidad").val()||getCalendarPeriodicidad(e)?setCalendarPeriodicidad(e,$("#periodicidad").val()):getCalendarPush(e)&&(borraPush(e),setCalendarPush(e,"")),$("#popupMailCheck").is(":checked")?crearRegistroMail(e):getCalendarMail(e)&&(borraMail(e),setCalendarMail(e,"")),$("#calendar"+e).css("opacity","1"),$("#calendar"+e).tooltipster("content",chrome.i18n.getMessage("aviso")+formateaFecha(t))}function borrarCalendar(e){null!=localStorage["calendar"+e]&&""!=localStorage["calendar"+e]&&"undefined"!=localStorage["calendar"+e]&&(""!=getCalendarPush(e)&&borraPush(e),getCalendarMail(e)&&borraMail(e),localStorage.removeItem("calendar"+e),grabaNotaCalendar(e));$("#calendar"+e).length>0&&($("#calendar"+e).css("opacity","0.5"),$("#calendar"+e).tooltipster("content",chrome.i18n.getMessage("programaAviso")))}function setCalendar(e,t,o){var a=localStorage["calendar"+e];if(a&&-1==a.indexOf("{")&&(a=convierteFormatoViejo(a,e)),a&&"undefined"!=a)i=JSON.parse(a);else var i={};""==o||0==o?delete i[t]:i[t]=o,localStorage["calendar"+e]=JSON.stringify(i),grabaNotaCalendar(e)}function getCalendar(e,t){var o,a=localStorage["calendar"+e];if(a&&-1==a.indexOf("{")&&(a=convierteFormatoViejo(a,e)),!a||"undefined"==a)return"";try{o=JSON.parse(a)[t]||""}catch(e){o=""}return o}function getCalendarDate(e){var t=getCalendar(e,"fechaHora");return t&&(t=new Date(t)),t}function setCalendarDate(e,t){setCalendar(e,"fechaHora",t.toString())}function getCalendarPeriodicidad(e){var t=getCalendar(e,"peri");return"0"==t&&(t=""),t}function setCalendarPeriodicidad(e,t){setCalendar(e,"peri",t)}function getCalendarPopup(e){return getCalendar(e,"popup")}function setCalendarPopup(e,t){setCalendar(e,"popup",t)}function getCalendarNotifica(e){return getCalendar(e,"noti")}function setCalendarNotifica(e,t){setCalendar(e,"noti",t)}function getCalendarPush(e){return getCalendar(e,"idPush")}function setCalendarPush(e,t){setCalendar(e,"idPush",t)}function getCalendarMail(e){return getCalendar(e,"idMail")}function setCalendarMail(e,t){setCalendar(e,"idMail",t)}function grabaNotaCalendar(e){isUserConnected()&&updateNotaLoginMemo(e)}function actualizaFechaCalendar(e){var t=getCalendarPeriodicidad(e);if(t){var o=new Date,a=getCalendarDate(e),i=a.getHours(),n=a.getMinutes(),r=a.getDate();switch(t){case"1":a.setDate(a.getDate()+1);break;case"2":5==(new Date).getDay()?a.setDate(a.getDate()+3):a.setDate(a.getDate()+1);break;case"7":a.setDate(a.getDate()+7);break;case"30":a.setMonth(a.getMonth()+1)}a<o&&(a.setTime(o),a.setHours(i),a.setMinutes(n),"30"==t&&a.setDate(r)),setCalendarDate(e,a)}}function convierteFormatoViejo(e,t){if("undefined"==e)return localStorage.removeItem("calendar"+t),{};var o={};try{o.fechaHora=new Date(e.substr(0,16)),(e.length>16||"||popup"!=e.substr(16))&&"||"!=e.substring(16,1)&&(idPush=parseInt(e.substr(17,4)),Number.isInteger(idPush)&&(o.idPush=idPush),idMail=e.split("||")[1],"popup"==idMail&&(idMail=""),Number.isInteger(parseInt(idMail))&&(o.idMail=idMail))}catch(e){console.log(e)}return JSON.stringify(o)}function abreFormMail(e,t){chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(function(o){if(o){var a=obtenerFormularioMail(t);mailModalInstance=abrirPantallaModal(a,{onOpenStart:function(){insertaThumb(e),$("#enviar-mail").off().on("click",(function(){aceptaMail(),t&&crearRegistroMail(e,!0),compruebaCheckMail()})),$("#userDestino, #ccmail").off().on("dblclick",(function(){localStorage.mail&&$(this).val(localStorage.mail)})),t||$("#cancelar-mail").off().on("click",(function(){$("#popupMailCheck").attr("checked",!1),compruebaCheckMail(),mailModalInstance.close(),muestraFormularioCalendar()}))},newModalInstance:!0})}else $("#popupMailCheck").attr("checked",!1)}))}function aceptaMail(){if(""==document.getElementById("userDestino").value)return idiomaEsp(navigator.language)?document.getElementById("errorMail").innerHTML="<font color='red'>Falta informar email</font>":document.getElementById("errorMail").innerHTML="<font color='red'>Mail empty</font>",document.getElementById("userDestino").focus(),!1;for(var e=document.getElementById("userDestino").value.split(","),t=0;t<e.length;t++)if(!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\D{2,4})+$/.test(e[t]))return idiomaEsp(navigator.language)?document.getElementById("errorMail").innerHTML="<font color='red'>Alguno de los destinatarios es incorrecto</font>":document.getElementById("errorMail").innerHTML="<font color='red'>Some of the emails are not correct</font>",document.getElementById("userDestino").focus(),!1;if(""!=document.getElementById("ccmail").value){var o=document.getElementById("ccmail").value.split(",");for(t=0;t<o.length;t++)if(!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\D{2,4})+$/.test(o[t]))return idiomaEsp(navigator.language)?document.getElementById("errorMail").innerHTML="<font color='red'>Alguno de los destinatarios es incorrecto</font>":document.getElementById("errorMail").innerHTML="<font color='red'>Some of the emails are not correct</font>",document.getElementById("ccmail").focus(),!1}mailModalInstance.close(),muestraFormularioCalendar()}function insertaThumb(e){$("#thumbnailPost").html(localStorage["postit"+e]),$("#thumbnailPost").height()<100&&$("#thumbnailPost").css("zoom","1")}function crearRegistroMail(e,t,o){if(""!=$("#userDestino").val()){var a=localStorage["postit"+e];if(t)var i=new Date;else i=getCalendarDate(e);var n=i.getTime(),r=6e4*i.getTimezoneOffset();nd=new Date(n+r+72e5);var s=nd.getFullYear()+"-"+("0"+parseInt(nd.getMonth()+1)).slice(-2)+"-"+("0"+nd.getDate()).slice(-2);s+=" "+("0"+nd.getHours()).slice(-2)+":"+("0"+nd.getMinutes()).slice(-2);var l="&postit="+encodeURIComponent(a);if(l+="&calendar="+s,l+="&destino="+$("#userDestino").val(),l+="&ccmail="+$("#ccmail").val(),l+="&asunto="+$("#asunto").val(),l+="&textoMail="+$("#textoMail").val(),l+="&tipoA="+localStorage["tipoA"+e],l+="&sinMarco="+localStorage["sinMarco"+e],l+="&periodicidad="+getCalendarPeriodicidad(e),t||o)var c="";else c=getCalendarMail(e);if(t)u=getServerUrl()+"api/mail/sendMail.php";else if(c){var u=getServerUrl()+"api/mail/updateMail.php";l+="&idMail="+c}else var u=getServerUrl()+"api/mail/createMail.php";$.ajax({type:"POST",url:u,data:l,cache:!1,success:function(o){var a=JSON.parse(o);a.isSuccess&&!t&&u.indexOf("createMail")>-1&&setCalendarMail(e,a.idMail)},error:function(e,t,o){console.log(t)}})}}function borraMail(e){var t=getCalendarMail(e);if(""!=t){var o="idMail="+t;$.ajax({type:"POST",url:getServerUrl()+"api/mail/deleteMail.php",data:o,cache:!1,success:function(e){},error:function(e,t,o){console.log(t)}})}}function contieneComp(e,t){for(var o=0;o<t.length;o++)if(t[o].id_usuarioComp==e.id_usuarioComp&&t[o].tabComp==e.tabComp&&t[o].permisos==e.permisos)return!0;return!1}function invitacionesPorTratar(){if(null==localStorage.invitaciones)return 0;for(var e=JSON.parse(localStorage.invitaciones),t=0,o=0;o<e.length;o++)e[o].tratada||t++;return t}function yaCompartido(e,t){if(null==localStorage.comparticiones)return!1;for(var o=JSON.parse(localStorage.comparticiones),a=0;a<o.length;a++)if(o[a].nickComp==e&&o[a].tabComp==t)return!0;return!1}function esTabCompartido(e=tablonActual){if(null==localStorage.comparticiones||!isUserConnected())return!1;for(var t=JSON.parse(localStorage.comparticiones),o=0;o<t.length;o++)if(t[o].tabComp==e)return!0;return!1}function getTablonCompartidoLocal(e){if(!localStorage.comparticiones||!isUserConnected())return-1;for(var t=JSON.parse(localStorage.comparticiones),o=0;o<t.length;o++)if(t[o].tabCompRemoto==e)return t[o].tabComp;return-1}function esNotaCompartida(e){return!!localStorage["userComp"+e]}function borraComparticion(e){for(var t=JSON.parse(localStorage.comparticiones),o=0;o<t.length;o++)t[o].tabComp==e&&t.splice(o,1);localStorage.comparticiones=JSON.stringify(t)}function selectDeTablones(e,t){var o='<select id="listaTablones">';e?"0"!=tablonActual&&(o+='<option orden="'+ordenTablon(tablonActual)+'" value="'+tablonActual+'">'+nombreTablon(tablonActual)+"</option>"):o+='<option value="'+(parseInt(localStorage.numTablones)+1)+'">'+chrome.i18n.getMessage("labelAdd")+"</option>";for(var a=1;a<=localStorage.numTablones;a++)e&&a==tablonActual||(o+='<option orden="'+ordenTablon(a)+'" value="'+a+'">'+nombreTablon(a)+"</option>");return esNotaWeb(t)&&(o+='<option value="-999">'+nombreTablon(-999)+"</option>"),o+="</select>"}function listaTablones(e=!1,t=!1){var o,a=[];t&&a.push({text:chrome.i18n.getMessage("ultimoTablonActual"),value:0,orden:0,selected:!0}),e&&a.push({text:chrome.i18n.getMessage("labelAdd"),value:parseInt(localStorage.numTablones)+1});for(var i=1;i<=localStorage.numTablones;i++)a.push({text:nombreTablon(i),value:i,orden:parseInt(ordenTablon(i)),selected:0!=tablonActual||t?tablonActual==i:1==i});return algunaNotaWeb()&&a.push({text:nombreTablon(-999),value:"-999",orden:9999,selected:"-999"==tablonActual}),a.sort((o="orden",(e,t)=>e[o]>t[o]?1:t[o]>e[o]?-1:0))}function tablaInvitacionesEnviadas(){var e="";if(null==localStorage.invEnviadas)return e;var t=JSON.parse(localStorage.invEnviadas);if(0==t.length)return e;e="<table>",e+="<tr>",e+="<th>"+chrome.i18n.getMessage("tablon")+"</th>",e+="<th>"+chrome.i18n.getMessage("user")+"</th>",e+="<th>"+chrome.i18n.getMessage("permisos")+"</th>",e+="<th>"+chrome.i18n.getMessage("anular")+"</th>",e+="</th>";for(var o=0;o<t.length;o++)e+='<tr id="lineaInv'+o+'" title="'+t[o].mensaje+'">',null!=localStorage["tab"+t[o].tablon+"Label"]&&"undefined"!=localStorage["tab"+t[o].tablon+"Label"]?e+="<td>"+localStorage["tab"+t[o].tablon+"Label"]+"</td>":e+="<td>"+chrome.i18n.getMessage("tablon")+t[o].tablon+"</td>",""!=t[o].user?e+="<td>"+t[o].user+"</td>":t[o].mail.indexOf("@")>0?e+="<td>"+t[o].mail+"</td>":e+="<td>Facebook</td>",e+="<td>"+chrome.i18n.getMessage(t[o].permisos)+"</td>",e+='<td><button class="anulInvBut waves-effect waves-light btn-small teal lighten-2" id="anulInv'+o+'">'+chrome.i18n.getMessage("anularBot")+"</button></td>",e+="</tr>";return e+="</table>"}function addInvEnviadas(e,t,o,a,i){if(null==localStorage.invEnviadas)var n=new Array;else n=JSON.parse(localStorage.invEnviadas);var r={mail:e.indexOf("@")>-1?e:"",mensaje:a,permisos:i,tablon:o,user:-1==e.indexOf("@")?e:"",id_usuario2:t};n.push(r),localStorage.invEnviadas=JSON.stringify(n)}function eliminaCompartidos(){for(var e=0;e<localStorage.totalPost;)null!=localStorage["userComp"+e]?borrarConfirmado(e,!0):e++;localStorage.removeItem("comparticiones"),localStorage.removeItem("invitaciones"),localStorage.removeItem("invEnviadas"),inicializaFriendsBot()}function showAjaxGif(){$("#black_overlay").show()}function hideAjaxGif(){$("#black_overlay").hide()}function guardaPosCompartido(e){posCompartidas["X"+localStorage["treeId"+e]]=localStorage["X"+e],posCompartidas["Y"+localStorage["treeId"+e]]=localStorage["Y"+e]}function recuperaPosCompartido(e){null!=posCompartidas["X"+localStorage["treeId"+e]]&&(localStorage["X"+e]=posCompartidas["X"+localStorage["treeId"+e]],localStorage["Y"+e]=posCompartidas["Y"+localStorage["treeId"+e]])}function esPopup(){return document.URL.indexOf("popup2.")>-1}function esPopupNotaWeb(){return document.URL.indexOf("popup2.")>-1&&document.URL.indexOf("abreEditando=true")>-1}function numeroNota(){return document.URL.indexOf("&")>-1?document.URL.substring(document.URL.indexOf("?numPost")+9,document.URL.indexOf("&")):document.URL.substr(document.URL.indexOf("?numPost")+9)}function abreEditando(){return document.URL.indexOf("abreEditando=true")>-1}function notaWeb(){return document.URL.indexOf("notaWeb=true")>-1}function nuevaNota(){return document.URL.indexOf("nuevaNota=true")>-1}function paramUrl(){return document.URL.indexOf("url=")>-1?document.URL.substring(document.URL.indexOf("url=")+4):""}function getHostFromUrl(e){try{const t=new URL(e);return`${t.protocol}//${t.hostname}/`}catch(t){return console.log(t),e}}function paramTabId(){return document.URL.indexOf("tabId=")>-1?document.URL.substring(document.URL.indexOf("tabId=")+6,document.URL.lastIndexOf("&")):""}async function creaPopupNota(e,t,o,a,i,n,r,s,l,c,u){esBackground()&&await getLocalStorage(),document.URL.indexOf("popup.html")>-1&&webkitBrowser()&&chrome.permissions.request({permissions:["background"]});var d=existePopup(e);if(t&&d)t&&chrome.windows.update(d,{drawAttention:!0});else{if(n=n||200,r=r||200,o=o||!1,a=a||!1,i=i||!1,c=c||0,u=u||"",s&&l)var p=s,g=l;else{if($("#postit"+e)?.length>0)var m=$("#postit"+e).width()+10,h=$("#postit"+e).height()+40;else m="auto"!=localStorage["width"+e]?parseInt(localStorage["width"+e]):450,h=getAlturaNota(e);if("true"==localStorage["sinMarco"+e])p=Math.round(m),g=Math.round(h-5);else p=Math.round(m+24),g=Math.round(h+50)}if(n=parseInt(n),r=parseInt(r),screen.height&&g>screen.height&&(g=screen.height-100),localStorage["treeId"+e]&&"undefined"!=localStorage["treeId"+e])var f=localStorage["treeId"+e];else f=0;var b={url:chrome.runtime.getURL("popup2.html?numPost="+e+"&abreEditando="+o+"&notaWeb="+a+"&nuevaNota="+i+"&tabId="+c+"&url="+u),top:n,left:r,width:p,height:g,type:"popup"};chrome.windows.create(b,(function(o){if(isChromeExtension()){if(o.height=500,localStorage.popups)var i=JSON.parse(localStorage.popups);else i=new Array;i.push({winId:o.id,numPost:e,width:p,height:g,X:r,Y:n,treeId:f,notaWeb:a,tabId:c}),localStorage.popups=JSON.stringify(i),t&&chrome.windows.update(o.id,{drawAttention:!0}),esBackground()&&setLocalStorage(["popups"])}}))}}function muestraPops(){chrome.windows.getAll((function(e){if(localStorage.popups)for(var t=JSON.parse(localStorage.popups),o=0;o<t.length;o++)if(-1==JSON.stringify(e).indexOf('"id":'+t[o].winId)){var a={url:chrome.runtime.getURL("popup2.html?numPost="+t[o].numPost),top:t[o].Y,left:t[o].X,width:t[o].width,height:t[o].height,type:"popup"};!function(e){chrome.windows.create(a,(async function(t){var o=JSON.parse(localStorage.popups);o[e].winId=t.id,localStorage.popups=JSON.stringify(o),esBackground()&&await setLocalStorage(["popups"])}))}(o)}}))}function borraPopupConfirmado(e){if(localStorage.popups){for(var t=JSON.parse(localStorage.popups),o=new Array,a=0;a<t.length;a++)t[a].numPost==e&&(o.push(a),sendMessage({unpopup:"unpopup",winId:t[a].winId})),t[a]&&t[a].numPost>e&&t[a].numPost--;for(a=0;a<o.length;a++)t.splice(o[a],1);localStorage.popups=JSON.stringify(t)}}function borraPopupWindow(e){if(localStorage.popups)for(var t=JSON.parse(localStorage.popups),o=0;o<t.length;o++)if(t[o].winId==e)return t[o].notaWeb&&t[o].tabId&&chrome.tabs.sendMessage(t[o].tabId,{muestraNotas:"muestraNotas"}),t.splice(o,1),localStorage.popups=JSON.stringify(t),void setLocalStorage(["popups"])}function compruebaPopups(){if(localStorage.popups){for(var e=JSON.parse(localStorage.popups),t=new Array,o=0;o<e.length;o++)if(0!=e[o].treeId&&e[o].treeId!=localStorage["treeId"+e[o].numPost]){for(var a=0;a<localStorage.totalPost&&e[o].treeId!=localStorage["treeId"+a];)a++;e[o].treeId==localStorage["treeId"+a]?e[o].numPost=a:(t.push(o),chrome.windows.remove(e[o].winId))}for(o=0;o<t.length;o++)e.splice(t[o],1);localStorage.popups=JSON.stringify(e)}}function addTreeIdPopup(e,t){if(localStorage.popups){for(var o=JSON.parse(localStorage.popups),a=0;a<o.length;a++)o[a].numPost==t&&(o[a].treeId=e);localStorage.popups=JSON.stringify(o)}}function getPopupData(e){if(isChromeExtension()){if(!localStorage.popups)return{width:0,height:0};for(var t=JSON.parse(localStorage.popups),o=0;o<t.length;o++)if(t[o].winId==e)return{width:t[o].width,height:t[o].height,X:t[o].X,Y:t[o].Y}}return{width:window.innerWidth,height:window.innerHeight,X:window.screenX,Y:window.screenY}}function setPopupPos(e,t,o){if(localStorage.popups)for(var a=JSON.parse(localStorage.popups),i=0;i<a.length;i++)if(a[i].winId==e)return a[i].X=t,a[i].Y=o,void(localStorage.popups=JSON.stringify(a))}function setPopupSize(e,t,o){if(localStorage.popups)for(var a=JSON.parse(localStorage.popups),i=0;i<a.length;i++)if(a[i].winId==e)return a[i].width=t,a[i].height=o,void(localStorage.popups=JSON.stringify(a))}function existePopup(e){if(!localStorage.popups)return!1;for(var t=JSON.parse(localStorage.popups),o=0;o<t.length;o++)if(t[o].numPost==e)return t[o].winId;return!1}function initRealTime(){if("undefined"!=typeof firebase&&isPremiumUser()){if(0===firebase.apps.length){firebase.initializeApp({apiKey:"AIzaSyAX48wcrExFdN--o728Pdrc8CPED_SdQ0E",authDomain:"note-board-web.firebaseapp.com",databaseURL:"https://note-board-web.firebaseio.com",projectId:"note-board-web",storageBucket:"note-board-web.appspot.com",messagingSenderId:"1053127044847"});firebase.database()}else firebase.database().goOnline()}}function checkBoardRealTime(e){if("undefined"!=typeof firebase&&isPremiumUser())try{esTablonCompartido(e)?(initRealTime(),listenRealTime(e)):firebase.apps.length>0&&(firebase.database().goOffline(),postitChange&&postitChange.off())}catch(e){console.log(e)}}function sendRealTime(e,t,o=tablonActual){if("undefined"!=typeof firebase&&isPremiumUser()&&isUserConnected()&&esTablonCompartido(o)&&localStorage["treeId"+e])try{(o!=tablonActual&&!esTablonCompartido(tablonActual)||esBackground()&&checkBoardRealTime(o))&&initRealTime();for(var a=(t=t||{}).texto||localStorage["postit"+e],i=JSON.parse(localStorage.comparticiones),n=0;n<i.length;n++)if(i[n].tabComp==o){var r={postit:a,tipoA:localStorage["tipoA"+e],X:localStorage["X"+e],Y:localStorage["Y"+e],width:localStorage["width"+e]||0,height:localStorage["height"+e]||0,treeId:localStorage["treeId"+e]||0,fecha:localStorage["fecha"+e]||"",calendar:localStorage["calendar"+e]||"",sinMarco:localStorage["sinMarco"+e]||"",rotacion:localStorage["rotacion"+e]||"",pushpin:localStorage["pushpin"+e]||"",columnaKanban:localStorage["columnaKanban"+e]||"",connections:localStorage["connections"+e]||"",create:t.create||!1,delete:t.delete||!1,tabKanban:esTablonKanban(o)?localStorage["tablonKanban"+o]:""};t.create&&(r={...r,userComp:"RW"==i[n].permisos?localStorage.id_usuario:"R",nickComp:localStorage.nick}),firebase.database().ref("users/"+i[n].id_usuarioComp+"/board/"+i[n].tabCompRemoto+"/treeId/"+localStorage["treeId"+e]).set(r)}}catch(e){console.log(e)}}function listenRealTime(e){if("undefined"!=typeof firebase&&isPremiumUser()){var t=localStorage.id_usuario;postitChange&&postitChange.off(),(postitChange=firebase.database().ref("users/"+t+"/board/"+e)).on("value",(function(i){try{var n=i.val();if(!n)return;for(const i in n.treeId){var r=n.treeId[i];if(r.delete)o(r.treeId);else if(r.create){var s=localStorage.totalPost;a(r.treeId)||(informaLocalStorage(s,r,e),localStorage.totalPost++,muestraPostit(s))}else if(r&&r.treeId)for(var l=0;l<localStorage.totalPost;l++)if(localStorage["treeId"+l]==r.treeId){informaLocalStorage(l,r),estaEditorAbierto(l)?obtenEditor(l).setContent(localStorage["postit"+l]):refrescaNota(l);break}r.tabKanban&&(localStorage["tablonKanban"+e]=r.tabKanban),deleteRealTime(t,e,r.treeId)}}catch(e){console.log(e)}}))}function o(e){for(var t=0;t<localStorage.totalPost;t++)if(localStorage["treeId"+t]==e){borrarConfirmado(t);break}}function a(e){for(var t=0;t<localStorage.totalPost;t++)if(localStorage["treeId"+t]==e)return!0;return!1}}function informaLocalStorage(e,t,o){localStorage["postit"+e]=t.postit,localStorage["tipoA"+e]=t.tipoA,localStorage["X"+e]=t.X,localStorage["Y"+e]=t.Y,localStorage["width"+e]=t.width,localStorage["height"+e]=t.height,localStorage["sinMarco"+e]=t.sinMarco,localStorage["rotacion"+e]=t.rotacion,localStorage["pushpin"+e]=t.pushpin,localStorage["treeId"+e]=t.treeId,localStorage["columnaKanban"+e]=t.columnaKanban,t.connections&&(localStorage["connections"+e]=t.connections),t.create&&(localStorage["tablon"+e]=o,localStorage["userComp"+e]=t.userComp,localStorage["nickComp"+e]=t.nickComp)}function deleteRealTime(e,t,o){firebase.database().ref("users/"+e+"/board/"+t+"/treeId/"+o).remove()}
/*! tooltipster v4.2.2 */!function(e){var t,o,a,i,n,r,s,l,c,u,d,p,g,m,h,f,b,v,S,_,w,C,P,I,$,T,E,y,O,k,A,N,x,M,L,R,D,z=(t=65,o={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!1},a=function(t,o){var a=L(t);e(o).data("colorpicker").fields.eq(1).val(a.r).end().eq(2).val(a.g).end().eq(3).val(a.b).end()},i=function(t,o){e(o).data("colorpicker").fields.eq(4).val(t.h).end().eq(5).val(t.s).end().eq(6).val(t.b).end()},n=function(t,o){e(o).data("colorpicker").fields.eq(0).val(R(t)).end()},r=function(t,o){e(o).data("colorpicker").selector.css("backgroundColor","#"+R({h:t.h,s:100,b:100})),e(o).data("colorpicker").selectorIndic.css({left:parseInt(150*t.s/100,10),top:parseInt(150*(100-t.b)/100,10)})},s=function(t,o){e(o).data("colorpicker").hue.css("top",parseInt(150-150*t.h/360,10))},l=function(t,o){e(o).data("colorpicker").currentColor.css("backgroundColor","#"+R(t))},c=function(t,o){e(o).data("colorpicker").newColor.css("backgroundColor","#"+R(t))},u=function(o){var a=o.charCode||o.keyCode||-1;if(a>t&&a<=90||32==a)return!1;!0===e(this).parent().parent().data("colorpicker").livePreview&&d.apply(this)},d=function(t){var o,l=e(this).parent().parent();this.parentNode.className.indexOf("_hex")>0?l.data("colorpicker").color=o=x(N(this.value)):this.parentNode.className.indexOf("_hsb")>0?l.data("colorpicker").color=o=k({h:parseInt(l.data("colorpicker").fields.eq(4).val(),10),s:parseInt(l.data("colorpicker").fields.eq(5).val(),10),b:parseInt(l.data("colorpicker").fields.eq(6).val(),10)}):l.data("colorpicker").color=o=M(A({r:parseInt(l.data("colorpicker").fields.eq(1).val(),10),g:parseInt(l.data("colorpicker").fields.eq(2).val(),10),b:parseInt(l.data("colorpicker").fields.eq(3).val(),10)})),t&&(a(o,l.get(0)),n(o,l.get(0)),i(o,l.get(0))),r(o,l.get(0)),s(o,l.get(0)),c(o,l.get(0)),l.data("colorpicker").onChange.apply(l,[o,R(o),L(o)])},p=function(t){e(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus")},g=function(){t=this.parentNode.className.indexOf("_hex")>0?70:65,e(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),e(this).parent().addClass("colorpicker_focus")},m=function(t){var o=e(this).parent().find("input").focus(),a={el:e(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:o,val:parseInt(o.val(),10),preview:e(this).parent().parent().data("colorpicker").livePreview};e(document).bind("mouseup",a,f),e(document).bind("mousemove",a,h)},h=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10)))),e.data.preview&&d.apply(e.data.field.get(0),[!0]),!1},f=function(t){return d.apply(t.data.field.get(0),[!0]),t.data.el.removeClass("colorpicker_slider").find("input").focus(),e(document).unbind("mouseup",f),e(document).unbind("mousemove",h),!1},b=function(t){var o={cal:e(this).parent(),y:e(this).offset().top};o.preview=o.cal.data("colorpicker").livePreview,e(document).bind("mouseup",o,S),e(document).bind("mousemove",o,v)},v=function(e){return d.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,e.pageY-e.data.y)))/150,10)).get(0),[e.data.preview]),!1},S=function(t){return a(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),n(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),e(document).unbind("mouseup",S),e(document).unbind("mousemove",v),!1},_=function(t){var o={cal:e(this).parent(),pos:e(this).offset()};o.preview=o.cal.data("colorpicker").livePreview,e(document).bind("mouseup",o,C),e(document).bind("mousemove",o,w)},w=function(e){return d.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,e.pageY-e.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.pos.left))/150,10)).get(0),[e.data.preview]),!1},C=function(t){return a(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),n(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),e(document).unbind("mouseup",C),e(document).unbind("mousemove",w),!1},P=function(t){e(this).addClass("colorpicker_focus")},I=function(t){e(this).removeClass("colorpicker_focus")},$=function(t){var o=e(this).parent(),a=o.data("colorpicker").color;o.data("colorpicker").origColor=a,l(a,o.get(0)),o.data("colorpicker").onSubmit(a,R(a),L(a),o.data("colorpicker").el)},T=function(t){var o=e("#"+e(this).data("colorpickerId"));o.data("colorpicker").onBeforeShow.apply(this,[o.get(0)]);var a=e(this).offset(),i=O(),n=a.top+this.offsetHeight,r=a.left;return n+176>i.t+i.h&&(n-=this.offsetHeight+176),r+356>i.l+i.w&&(r-=356),o.css({left:r+"px",top:n+"px"}),0!=o.data("colorpicker").onShow.apply(this,[o.get(0)])&&o.show(),e(document).bind("mousedown",{cal:o},E),!1},E=function(t){y(t.data.cal.get(0),t.target,t.data.cal.get(0))||(0!=t.data.cal.data("colorpicker").onHide.apply(this,[t.data.cal.get(0)])&&t.data.cal.hide(),e(document).unbind("mousedown",E))},y=function(e,t,o){if(e==t)return!0;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));for(var a=t.parentNode;a&&a!=o;){if(a==e)return!0;a=a.parentNode}return!1},O=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},k=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},A=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},N=function(e){var t=6-e.length;if(t>0){for(var o=[],a=0;a<t;a++)o.push("0");o.push(e),e=o.join("")}return e},x=function(e){return M(function(e){return{r:(e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16))>>16,g:(65280&e)>>8,b:255&e}}(e))},M=function(e){var t={h:0,s:0,b:0},o=Math.min(e.r,e.g,e.b),a=Math.max(e.r,e.g,e.b),i=a-o;return t.b=a,t.s=0!=a?255*i/a:0,0!=t.s?e.r==a?t.h=(e.g-e.b)/i:e.g==a?t.h=2+(e.b-e.r)/i:t.h=4+(e.r-e.g)/i:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},L=function(e){var t={},o=Math.round(e.h),a=Math.round(255*e.s/100),i=Math.round(255*e.b/100);if(0==a)t.r=t.g=t.b=i;else{var n=i,r=(255-a)*i/255,s=o%60*(n-r)/60;360==o&&(o=0),o<60?(t.r=n,t.b=r,t.g=r+s):o<120?(t.g=n,t.b=r,t.r=n-s):o<180?(t.g=n,t.r=r,t.b=r+s):o<240?(t.b=n,t.r=r,t.g=n-s):o<300?(t.b=n,t.g=r,t.r=r+s):o<360?(t.r=n,t.g=r,t.b=n-s):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},R=function(t){return o=L(t),a=[o.r.toString(16),o.g.toString(16),o.b.toString(16)],e.each(a,(function(e,t){1==t.length&&(a[e]="0"+t)})),a.join("");var o,a},D=function(){var t=e(this).parent(),o=t.data("colorpicker").origColor;t.data("colorpicker").color=o,a(o,t.get(0)),n(o,t.get(0)),i(o,t.get(0)),r(o,t.get(0)),s(o,t.get(0)),c(o,t.get(0))},{init:function(t){if("string"==typeof(t=e.extend({},o,t||{})).color)t.color=x(t.color);else if(null!=t.color.r&&null!=t.color.g&&null!=t.color.b)t.color=M(t.color);else{if(null==t.color.h||null==t.color.s||null==t.color.b)return this;t.color=k(t.color)}return this.each((function(){if(!e(this).data("colorpickerId")){var o=e.extend({},t);o.origColor=t.color;var h="collorpicker_"+parseInt(1e3*Math.random());e(this).data("colorpickerId",h);var f=e('<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>').attr("id",h);o.flat?f.appendTo(this).show():f.appendTo(document.body),o.fields=f.find("input").bind("keyup",u).bind("change",d).bind("blur",p).bind("focus",g),f.find("span").bind("mousedown",m).end().find(">div.colorpicker_current_color").bind("click",D),o.selector=f.find("div.colorpicker_color").bind("mousedown",_),o.selectorIndic=o.selector.find("div div"),o.el=this,o.hue=f.find("div.colorpicker_hue div"),f.find("div.colorpicker_hue").bind("mousedown",b),o.newColor=f.find("div.colorpicker_new_color"),o.currentColor=f.find("div.colorpicker_current_color"),f.data("colorpicker",o),f.find("div.colorpicker_submit").bind("mouseenter",P).bind("mouseleave",I).bind("click",$),a(o.color,f.get(0)),i(o.color,f.get(0)),n(o.color,f.get(0)),s(o.color,f.get(0)),r(o.color,f.get(0)),l(o.color,f.get(0)),c(o.color,f.get(0)),o.flat?f.css({position:"relative",display:"block"}):e(this).bind(o.eventName,T)}}))},showPicker:function(){return this.each((function(){e(this).data("colorpickerId")&&T.apply(this)}))},hidePicker:function(){return this.each((function(){e(this).data("colorpickerId")&&e("#"+e(this).data("colorpickerId")).hide()}))},setColor:function(t){if("string"==typeof t)t=x(t);else if(null!=t.r&&null!=t.g&&null!=t.b)t=M(t);else{if(null==t.h||null==t.s||null==t.b)return this;t=k(t)}return this.each((function(){if(e(this).data("colorpickerId")){var o=e("#"+e(this).data("colorpickerId"));o.data("colorpicker").color=t,o.data("colorpicker").origColor=t,a(t,o.get(0)),i(t,o.get(0)),n(t,o.get(0)),s(t,o.get(0)),r(t,o.get(0)),l(t,o.get(0)),c(t,o.get(0))}}))}});e.fn.extend({ColorPicker:z.init,ColorPickerHide:z.hidePicker,ColorPickerShow:z.showPicker,ColorPickerSetColor:z.setColor})}(jQuery),function(e,t){"function"==typeof define&&define.amd?define(["jquery"],(function(e){return t(e)})):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery)}(0,(function(e){function t(e){this.$container,this.constraints=null,this.__$tooltip,this.__init(e)}function o(t,o){var a=!0;return e.each(t,(function(e,i){return void 0===o[e]||t[e]!==o[e]?(a=!1,!1):void 0})),a}function a(t){var o=t.attr("id"),a=o?r.window.document.getElementById(o):null;return a?a===t[0]:e.contains(r.window.document.body,t[0])}var i={animation:"fade",animationDuration:350,content:null,contentAsHTML:!1,contentCloning:!1,debug:!0,delay:300,delayTouch:[300,500],functionInit:null,functionBefore:null,functionReady:null,functionAfter:null,functionFormat:null,IEmin:6,interactive:!1,multiple:!1,parent:null,plugins:["sideTip"],repositionOnScroll:!1,restoration:"none",selfDestruction:!0,theme:[],timer:0,trackerInterval:500,trackOrigin:!1,trackTooltip:!1,trigger:"hover",triggerClose:{click:!1,mouseleave:!1,originClick:!1,scroll:!1,tap:!1,touchleave:!1},triggerOpen:{click:!1,mouseenter:!1,tap:!1,touchstart:!1},updateAnimation:"rotate",zIndex:9999999},n="undefined"!=typeof window?window:null,r={hasTouchCapability:!(!n||!("ontouchstart"in n||n.DocumentTouch&&n.document instanceof n.DocumentTouch||n.navigator.maxTouchPoints)),hasTransitions:function(){if(!n)return!1;var e=(n.document.body||n.document.documentElement).style,t="transition",o=["Moz","Webkit","Khtml","O","ms"];if("string"==typeof e[t])return!0;t=t.charAt(0).toUpperCase()+t.substr(1);for(var a=0;a<o.length;a++)if("string"==typeof e[o[a]+t])return!0;return!1}(),IE:!1,semVer:"4.2.2",window:n},s=function(){this.__$emitterPrivate=e({}),this.__$emitterPublic=e({}),this.__instancesLatestArr=[],this.__plugins={},this._env=r};s.prototype={__bridge:function(t,o,a){if(!o[a]){var n=function(){};n.prototype=t;var r=new n;r.__init&&r.__init(o),e.each(t,(function(e,t){0!=e.indexOf("__")&&(o[e]?i.debug&&console.log("The "+e+" method of the "+a+" plugin conflicts with another plugin or native methods"):(o[e]=function(){return r[e].apply(r,Array.prototype.slice.apply(arguments))},o[e].bridged=r))})),o[a]=r}return this},__setWindow:function(e){return r.window=e,this},_getRuler:function(e){return new t(e)},_off:function(){return this.__$emitterPrivate.off.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_on:function(){return this.__$emitterPrivate.on.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_one:function(){return this.__$emitterPrivate.one.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_plugin:function(t){var o=this;if("string"==typeof t){var a=t,i=null;return a.indexOf(".")>0?i=o.__plugins[a]:e.each(o.__plugins,(function(e,t){return t.name.substring(t.name.length-a.length-1)=="."+a?(i=t,!1):void 0})),i}if(t.name.indexOf(".")<0)throw new Error("Plugins must be namespaced");return o.__plugins[t.name]=t,t.core&&o.__bridge(t.core,o,t.name),this},_trigger:function(){var e=Array.prototype.slice.apply(arguments);return"string"==typeof e[0]&&(e[0]={type:e[0]}),this.__$emitterPrivate.trigger.apply(this.__$emitterPrivate,e),this.__$emitterPublic.trigger.apply(this.__$emitterPublic,e),this},instances:function(t){var o=[];return e(t||".tooltipstered").each((function(){var t=e(this),a=t.data("tooltipster-ns");a&&e.each(a,(function(e,a){o.push(t.data(a))}))})),o},instancesLatest:function(){return this.__instancesLatestArr},off:function(){return this.__$emitterPublic.off.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},on:function(){return this.__$emitterPublic.on.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},one:function(){return this.__$emitterPublic.one.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},origins:function(t){return e((t?t+" ":"")+".tooltipstered").toArray()},setDefaults:function(t){return e.extend(i,t),this},triggerHandler:function(){return this.__$emitterPublic.triggerHandler.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this}},e.tooltipster=new s,e.Tooltipster=function(t,o){this.__callbacks={close:[],open:[]},this.__closingTime,this.__Content,this.__contentBcr,this.__destroyed=!1,this.__$emitterPrivate=e({}),this.__$emitterPublic=e({}),this.__enabled=!0,this.__garbageCollector,this.__Geometry,this.__lastPosition,this.__namespace="tooltipster-"+Math.round(1e6*Math.random()),this.__options,this.__$originParents,this.__pointerIsOverOrigin=!1,this.__previousThemes=[],this.__state="closed",this.__timeouts={close:[],open:null},this.__touchEvents=[],this.__tracker=null,this._$origin,this._$tooltip,this.__init(t,o)},e.Tooltipster.prototype={__init:function(t,o){var a=this;if(a._$origin=e(t),a.__options=e.extend(!0,{},i,o),a.__optionsFormat(),!r.IE||r.IE>=a.__options.IEmin){var n=null;if(void 0===a._$origin.data("tooltipster-initialTitle")&&(void 0===(n=a._$origin.attr("title"))&&(n=null),a._$origin.data("tooltipster-initialTitle",n)),null!==a.__options.content)a.__contentSet(a.__options.content);else{var s,l=a._$origin.attr("data-tooltip-content");l&&(s=e(l)),s&&s[0]?a.__contentSet(s.first()):a.__contentSet(n)}a._$origin.removeAttr("title").addClass("tooltipstered"),a.__prepareOrigin(),a.__prepareGC(),e.each(a.__options.plugins,(function(e,t){a._plug(t)})),r.hasTouchCapability&&e(r.window.document.body).on("touchmove."+a.__namespace+"-triggerOpen",(function(e){a._touchRecordEvent(e)})),a._on("created",(function(){a.__prepareTooltip()}))._on("repositioned",(function(e){a.__lastPosition=e.position}))}else a.__options.disabled=!0},__contentInsert:function(){var e=this,t=e._$tooltip.find(".tooltipster-content"),o=e.__Content;return e._trigger({type:"format",content:e.__Content,format:function(e){o=e}}),e.__options.functionFormat&&(o=e.__options.functionFormat.call(e,e,{origin:e._$origin[0]},e.__Content)),"string"!=typeof o||e.__options.contentAsHTML?t.empty().append(o):t.text(o),e},__contentSet:function(t){return t instanceof e&&this.__options.contentCloning&&(t=t.clone(!0)),this.__Content=t,this._trigger({type:"updated",content:t}),this},__destroyError:function(){throw new Error("This tooltip has been destroyed and cannot execute your method call.")},__geometry:function(){var t=this,o=t._$origin,a=t._$origin.is("area");if(a){var i=t._$origin.parent().attr("name");o=e('img[usemap="#'+i+'"]')}var n=o[0].getBoundingClientRect(),s=e(r.window.document),l=e(r.window),c=o,u={available:{document:null,window:null},document:{size:{height:s.height(),width:s.width()}},window:{scroll:{left:r.window.scrollX||r.window.document.documentElement.scrollLeft,top:r.window.scrollY||r.window.document.documentElement.scrollTop},size:{height:l.height(),width:l.width()}},origin:{fixedLineage:!1,offset:{},size:{height:n.bottom-n.top,width:n.right-n.left},usemapImage:a?o[0]:null,windowOffset:{bottom:n.bottom,left:n.left,right:n.right,top:n.top}}};if(a){var d=t._$origin.attr("shape"),p=t._$origin.attr("coords");if(p&&(p=p.split(","),e.map(p,(function(e,t){p[t]=parseInt(e)}))),"default"!=d)switch(d){case"circle":var g=p[0],m=p[1],h=p[2],f=m-h,b=g-h;u.origin.size.height=2*h,u.origin.size.width=u.origin.size.height,u.origin.windowOffset.left+=b,u.origin.windowOffset.top+=f;break;case"rect":var v=p[0],S=p[1],_=p[2],w=p[3];u.origin.size.height=w-S,u.origin.size.width=_-v,u.origin.windowOffset.left+=v,u.origin.windowOffset.top+=S;break;case"poly":for(var C=0,P=0,I=0,$=0,T="even",E=0;E<p.length;E++){var y=p[E];"even"==T?(y>I&&(I=y,0===E&&(C=I)),C>y&&(C=y),T="odd"):(y>$&&($=y,1==E&&(P=$)),P>y&&(P=y),T="even")}u.origin.size.height=$-P,u.origin.size.width=I-C,u.origin.windowOffset.left+=C,u.origin.windowOffset.top+=P}}for(t._trigger({type:"geometry",edit:function(e){u.origin.size.height=e.height,u.origin.windowOffset.left=e.left,u.origin.windowOffset.top=e.top,u.origin.size.width=e.width},geometry:{height:u.origin.size.height,left:u.origin.windowOffset.left,top:u.origin.windowOffset.top,width:u.origin.size.width}}),u.origin.windowOffset.right=u.origin.windowOffset.left+u.origin.size.width,u.origin.windowOffset.bottom=u.origin.windowOffset.top+u.origin.size.height,u.origin.offset.left=u.origin.windowOffset.left+u.window.scroll.left,u.origin.offset.top=u.origin.windowOffset.top+u.window.scroll.top,u.origin.offset.bottom=u.origin.offset.top+u.origin.size.height,u.origin.offset.right=u.origin.offset.left+u.origin.size.width,u.available.document={bottom:{height:u.document.size.height-u.origin.offset.bottom,width:u.document.size.width},left:{height:u.document.size.height,width:u.origin.offset.left},right:{height:u.document.size.height,width:u.document.size.width-u.origin.offset.right},top:{height:u.origin.offset.top,width:u.document.size.width}},u.available.window={bottom:{height:Math.max(u.window.size.height-Math.max(u.origin.windowOffset.bottom,0),0),width:u.window.size.width},left:{height:u.window.size.height,width:Math.max(u.origin.windowOffset.left,0)},right:{height:u.window.size.height,width:Math.max(u.window.size.width-Math.max(u.origin.windowOffset.right,0),0)},top:{height:Math.max(u.origin.windowOffset.top,0),width:u.window.size.width}};"html"!=c[0].tagName.toLowerCase();){if("fixed"==c.css("position")){u.origin.fixedLineage=!0;break}c=c.parent()}return u},__optionsFormat:function(){return"number"==typeof this.__options.animationDuration&&(this.__options.animationDuration=[this.__options.animationDuration,this.__options.animationDuration]),"number"==typeof this.__options.delay&&(this.__options.delay=[this.__options.delay,this.__options.delay]),"number"==typeof this.__options.delayTouch&&(this.__options.delayTouch=[this.__options.delayTouch,this.__options.delayTouch]),"string"==typeof this.__options.theme&&(this.__options.theme=[this.__options.theme]),null===this.__options.parent?this.__options.parent=e(r.window.document.body):"string"==typeof this.__options.parent&&(this.__options.parent=e(this.__options.parent)),"hover"==this.__options.trigger?(this.__options.triggerOpen={mouseenter:!0,touchstart:!0},this.__options.triggerClose={mouseleave:!0,originClick:!0,touchleave:!0}):"click"==this.__options.trigger&&(this.__options.triggerOpen={click:!0,tap:!0},this.__options.triggerClose={click:!0,tap:!0}),this._trigger("options"),this},__prepareGC:function(){var t=this;return t.__options.selfDestruction?t.__garbageCollector=setInterval((function(){var o=(new Date).getTime();t.__touchEvents=e.grep(t.__touchEvents,(function(e,t){return o-e.time>6e4})),a(t._$origin)||t.close((function(){t.destroy()}))}),2e4):clearInterval(t.__garbageCollector),t},__prepareOrigin:function(){var e=this;if(e._$origin.off("."+e.__namespace+"-triggerOpen"),r.hasTouchCapability&&e._$origin.on("touchstart."+e.__namespace+"-triggerOpen touchend."+e.__namespace+"-triggerOpen touchcancel."+e.__namespace+"-triggerOpen",(function(t){e._touchRecordEvent(t)})),e.__options.triggerOpen.click||e.__options.triggerOpen.tap&&r.hasTouchCapability){var t="";e.__options.triggerOpen.click&&(t+="click."+e.__namespace+"-triggerOpen "),e.__options.triggerOpen.tap&&r.hasTouchCapability&&(t+="touchend."+e.__namespace+"-triggerOpen"),e._$origin.on(t,(function(t){e._touchIsMeaningfulEvent(t)&&e._open(t)}))}if(e.__options.triggerOpen.mouseenter||e.__options.triggerOpen.touchstart&&r.hasTouchCapability){t="";e.__options.triggerOpen.mouseenter&&(t+="mouseenter."+e.__namespace+"-triggerOpen "),e.__options.triggerOpen.touchstart&&r.hasTouchCapability&&(t+="touchstart."+e.__namespace+"-triggerOpen"),e._$origin.on(t,(function(t){!e._touchIsTouchEvent(t)&&e._touchIsEmulatedEvent(t)||(e.__pointerIsOverOrigin=!0,e._openShortly(t))}))}if(e.__options.triggerClose.mouseleave||e.__options.triggerClose.touchleave&&r.hasTouchCapability){t="";e.__options.triggerClose.mouseleave&&(t+="mouseleave."+e.__namespace+"-triggerOpen "),e.__options.triggerClose.touchleave&&r.hasTouchCapability&&(t+="touchend."+e.__namespace+"-triggerOpen touchcancel."+e.__namespace+"-triggerOpen"),e._$origin.on(t,(function(t){e._touchIsMeaningfulEvent(t)&&(e.__pointerIsOverOrigin=!1)}))}return e},__prepareTooltip:function(){var t=this,o=t.__options.interactive?"auto":"";return t._$tooltip.attr("id",t.__namespace).css({"pointer-events":o,zIndex:t.__options.zIndex}),e.each(t.__previousThemes,(function(e,o){t._$tooltip.removeClass(o)})),e.each(t.__options.theme,(function(e,o){t._$tooltip.addClass(o)})),t.__previousThemes=e.merge([],t.__options.theme),t},__scrollHandler:function(t){var o=this;if(o.__options.triggerClose.scroll)o._close(t);else if(a(o._$origin)&&a(o._$tooltip)){if(t.target===r.window.document)o.__Geometry.origin.fixedLineage||o.__options.repositionOnScroll&&o.reposition(t);else{var i=o.__geometry(),n=!1;if("fixed"!=o._$origin.css("position")&&o.__$originParents.each((function(t,o){var a=e(o),r=a.css("overflow-x"),s=a.css("overflow-y");if("visible"!=r||"visible"!=s){var l=o.getBoundingClientRect();if("visible"!=r&&(i.origin.windowOffset.left<l.left||i.origin.windowOffset.right>l.right))return n=!0,!1;if("visible"!=s&&(i.origin.windowOffset.top<l.top||i.origin.windowOffset.bottom>l.bottom))return n=!0,!1}return"fixed"!=a.css("position")&&void 0})),n)o._$tooltip.css("visibility","hidden");else if(o._$tooltip.css("visibility","visible"),o.__options.repositionOnScroll)o.reposition(t);else{var s=i.origin.offset.left-o.__Geometry.origin.offset.left,l=i.origin.offset.top-o.__Geometry.origin.offset.top;o._$tooltip.css({left:o.__lastPosition.coord.left+s,top:o.__lastPosition.coord.top+l})}}o._trigger({type:"scroll",event:t})}return o},__stateSet:function(e){return this.__state=e,this._trigger({type:"state",state:e}),this},__timeoutsClear:function(){return clearTimeout(this.__timeouts.open),this.__timeouts.open=null,e.each(this.__timeouts.close,(function(e,t){clearTimeout(t)})),this.__timeouts.close=[],this},__trackerStart:function(){var e=this,t=e._$tooltip.find(".tooltipster-content");return e.__options.trackTooltip&&(e.__contentBcr=t[0].getBoundingClientRect()),e.__tracker=setInterval((function(){if(a(e._$origin)&&a(e._$tooltip)){if(e.__options.trackOrigin){var i=e.__geometry(),n=!1;o(i.origin.size,e.__Geometry.origin.size)&&(e.__Geometry.origin.fixedLineage?o(i.origin.windowOffset,e.__Geometry.origin.windowOffset)&&(n=!0):o(i.origin.offset,e.__Geometry.origin.offset)&&(n=!0)),n||(e.__options.triggerClose.mouseleave?e._close():e.reposition())}if(e.__options.trackTooltip){var r=t[0].getBoundingClientRect();r.height===e.__contentBcr.height&&r.width===e.__contentBcr.width||(e.reposition(),e.__contentBcr=r)}}else e._close()}),e.__options.trackerInterval),e},_close:function(t,o,a){var i=this,n=!0;if(i._trigger({type:"close",event:t,stop:function(){n=!1}}),n||a){o&&i.__callbacks.close.push(o),i.__callbacks.open=[],i.__timeoutsClear();var s=function(){e.each(i.__callbacks.close,(function(e,o){o.call(i,i,{event:t,origin:i._$origin[0]})})),i.__callbacks.close=[]};if("closed"!=i.__state){var l=!0,c=(new Date).getTime()+i.__options.animationDuration[1];if("disappearing"==i.__state&&c>i.__closingTime&&(l=!1),l){i.__closingTime=c,"disappearing"!=i.__state&&i.__stateSet("disappearing");var u=function(){clearInterval(i.__tracker),i._trigger({type:"closing",event:t}),i._$tooltip.off("."+i.__namespace+"-triggerClose").removeClass("tooltipster-dying"),e(r.window).off("."+i.__namespace+"-triggerClose"),i.__$originParents.each((function(t,o){e(o).off("scroll."+i.__namespace+"-triggerClose")})),i.__$originParents=null,e(r.window.document.body).off("."+i.__namespace+"-triggerClose"),i._$origin.off("."+i.__namespace+"-triggerClose"),i._off("dismissable"),i.__stateSet("closed"),i._trigger({type:"after",event:t}),i.__options.functionAfter&&i.__options.functionAfter.call(i,i,{event:t,origin:i._$origin[0]}),s()};r.hasTransitions?(i._$tooltip.css({"-moz-animation-duration":i.__options.animationDuration[1]+"ms","-ms-animation-duration":i.__options.animationDuration[1]+"ms","-o-animation-duration":i.__options.animationDuration[1]+"ms","-webkit-animation-duration":i.__options.animationDuration[1]+"ms","animation-duration":i.__options.animationDuration[1]+"ms","transition-duration":i.__options.animationDuration[1]+"ms"}),i._$tooltip.clearQueue().removeClass("tooltipster-show").addClass("tooltipster-dying"),i.__options.animationDuration[1]>0&&i._$tooltip.delay(i.__options.animationDuration[1]),i._$tooltip.queue(u)):i._$tooltip.stop().fadeOut(i.__options.animationDuration[1],u)}}else s()}return i},_off:function(){return this.__$emitterPrivate.off.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_on:function(){return this.__$emitterPrivate.on.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_one:function(){return this.__$emitterPrivate.one.apply(this.__$emitterPrivate,Array.prototype.slice.apply(arguments)),this},_open:function(t,o){var i=this;if(!i.__destroying&&a(i._$origin)&&i.__enabled){var n=!0;if("closed"==i.__state&&(i._trigger({type:"before",event:t,stop:function(){n=!1}}),n&&i.__options.functionBefore&&(n=i.__options.functionBefore.call(i,i,{event:t,origin:i._$origin[0]}))),!1!==n&&null!==i.__Content){o&&i.__callbacks.open.push(o),i.__callbacks.close=[],i.__timeoutsClear();var s,l=function(){"stable"!=i.__state&&i.__stateSet("stable"),e.each(i.__callbacks.open,(function(e,t){t.call(i,i,{origin:i._$origin[0],tooltip:i._$tooltip[0]})})),i.__callbacks.open=[]};if("closed"!==i.__state)s=0,"disappearing"===i.__state?(i.__stateSet("appearing"),r.hasTransitions?(i._$tooltip.clearQueue().removeClass("tooltipster-dying").addClass("tooltipster-show"),i.__options.animationDuration[0]>0&&i._$tooltip.delay(i.__options.animationDuration[0]),i._$tooltip.queue(l)):i._$tooltip.stop().fadeIn(l)):"stable"==i.__state&&l();else{if(i.__stateSet("appearing"),s=i.__options.animationDuration[0],i.__contentInsert(),i.reposition(t,!0),r.hasTransitions?(i._$tooltip.addClass("tooltipster-"+i.__options.animation).addClass("tooltipster-initial").css({"-moz-animation-duration":i.__options.animationDuration[0]+"ms","-ms-animation-duration":i.__options.animationDuration[0]+"ms","-o-animation-duration":i.__options.animationDuration[0]+"ms","-webkit-animation-duration":i.__options.animationDuration[0]+"ms","animation-duration":i.__options.animationDuration[0]+"ms","transition-duration":i.__options.animationDuration[0]+"ms"}),setTimeout((function(){"closed"!=i.__state&&(i._$tooltip.addClass("tooltipster-show").removeClass("tooltipster-initial"),i.__options.animationDuration[0]>0&&i._$tooltip.delay(i.__options.animationDuration[0]),i._$tooltip.queue(l))}),0)):i._$tooltip.css("display","none").fadeIn(i.__options.animationDuration[0],l),i.__trackerStart(),e(r.window).on("resize."+i.__namespace+"-triggerClose",(function(t){var o=e(document.activeElement);(o.is("input")||o.is("textarea"))&&e.contains(i._$tooltip[0],o[0])||i.reposition(t)})).on("scroll."+i.__namespace+"-triggerClose",(function(e){i.__scrollHandler(e)})),i.__$originParents=i._$origin.parents(),i.__$originParents.each((function(t,o){e(o).on("scroll."+i.__namespace+"-triggerClose",(function(e){i.__scrollHandler(e)}))})),i.__options.triggerClose.mouseleave||i.__options.triggerClose.touchleave&&r.hasTouchCapability){i._on("dismissable",(function(e){e.dismissable?e.delay?(p=setTimeout((function(){i._close(e.event)}),e.delay),i.__timeouts.close.push(p)):i._close(e):clearTimeout(p)}));var c=i._$origin,u="",d="",p=null;i.__options.interactive&&(c=c.add(i._$tooltip)),i.__options.triggerClose.mouseleave&&(u+="mouseenter."+i.__namespace+"-triggerClose ",d+="mouseleave."+i.__namespace+"-triggerClose "),i.__options.triggerClose.touchleave&&r.hasTouchCapability&&(u+="touchstart."+i.__namespace+"-triggerClose",d+="touchend."+i.__namespace+"-triggerClose touchcancel."+i.__namespace+"-triggerClose"),c.on(d,(function(e){if(i._touchIsTouchEvent(e)||!i._touchIsEmulatedEvent(e)){var t="mouseleave"==e.type?i.__options.delay:i.__options.delayTouch;i._trigger({delay:t[1],dismissable:!0,event:e,type:"dismissable"})}})).on(u,(function(e){!i._touchIsTouchEvent(e)&&i._touchIsEmulatedEvent(e)||i._trigger({dismissable:!1,event:e,type:"dismissable"})}))}i.__options.triggerClose.originClick&&i._$origin.on("click."+i.__namespace+"-triggerClose",(function(e){i._touchIsTouchEvent(e)||i._touchIsEmulatedEvent(e)||i._close(e)})),(i.__options.triggerClose.click||i.__options.triggerClose.tap&&r.hasTouchCapability)&&setTimeout((function(){if("closed"!=i.__state){var t="",o=e(r.window.document.body);i.__options.triggerClose.click&&(t+="click."+i.__namespace+"-triggerClose "),i.__options.triggerClose.tap&&r.hasTouchCapability&&(t+="touchend."+i.__namespace+"-triggerClose"),o.on(t,(function(t){i._touchIsMeaningfulEvent(t)&&(i._touchRecordEvent(t),i.__options.interactive&&e.contains(i._$tooltip[0],t.target)||i._close(t))})),i.__options.triggerClose.tap&&r.hasTouchCapability&&o.on("touchstart."+i.__namespace+"-triggerClose",(function(e){i._touchRecordEvent(e)}))}}),0),i._trigger("ready"),i.__options.functionReady&&i.__options.functionReady.call(i,i,{origin:i._$origin[0],tooltip:i._$tooltip[0]})}if(i.__options.timer>0){p=setTimeout((function(){i._close()}),i.__options.timer+s);i.__timeouts.close.push(p)}}}return i},_openShortly:function(e){var t=this,o=!0;if("stable"!=t.__state&&"appearing"!=t.__state&&!t.__timeouts.open&&(t._trigger({type:"start",event:e,stop:function(){o=!1}}),o)){var a=0==e.type.indexOf("touch")?t.__options.delayTouch:t.__options.delay;a[0]?t.__timeouts.open=setTimeout((function(){t.__timeouts.open=null,t.__pointerIsOverOrigin&&t._touchIsMeaningfulEvent(e)?(t._trigger("startend"),t._open(e)):t._trigger("startcancel")}),a[0]):(t._trigger("startend"),t._open(e))}return t},_optionsExtract:function(t,o){var a=this,i=e.extend(!0,{},o),n=a.__options[t];return n||(n={},e.each(o,(function(e,t){var o=a.__options[e];void 0!==o&&(n[e]=o)}))),e.each(i,(function(t,o){void 0!==n[t]&&("object"!=typeof o||o instanceof Array||null==o||"object"!=typeof n[t]||n[t]instanceof Array||null==n[t]?i[t]=n[t]:e.extend(i[t],n[t]))})),i},_plug:function(t){var o=e.tooltipster._plugin(t);if(!o)throw new Error('The "'+t+'" plugin is not defined');return o.instance&&e.tooltipster.__bridge(o.instance,this,o.name),this},_touchIsEmulatedEvent:function(e){for(var t=!1,o=(new Date).getTime(),a=this.__touchEvents.length-1;a>=0;a--){var i=this.__touchEvents[a];if(!(o-i.time<500))break;i.target===e.target&&(t=!0)}return t},_touchIsMeaningfulEvent:function(e){return this._touchIsTouchEvent(e)&&!this._touchSwiped(e.target)||!this._touchIsTouchEvent(e)&&!this._touchIsEmulatedEvent(e)},_touchIsTouchEvent:function(e){return 0==e.type.indexOf("touch")},_touchRecordEvent:function(e){return this._touchIsTouchEvent(e)&&(e.time=(new Date).getTime(),this.__touchEvents.push(e)),this},_touchSwiped:function(e){for(var t=!1,o=this.__touchEvents.length-1;o>=0;o--){var a=this.__touchEvents[o];if("touchmove"==a.type){t=!0;break}if("touchstart"==a.type&&e===a.target)break}return t},_trigger:function(){var t=Array.prototype.slice.apply(arguments);return"string"==typeof t[0]&&(t[0]={type:t[0]}),t[0].instance=this,t[0].origin=this._$origin?this._$origin[0]:null,t[0].tooltip=this._$tooltip?this._$tooltip[0]:null,this.__$emitterPrivate.trigger.apply(this.__$emitterPrivate,t),e.tooltipster._trigger.apply(e.tooltipster,t),this.__$emitterPublic.trigger.apply(this.__$emitterPublic,t),this},_unplug:function(t){var o=this;if(o[t]){var a=e.tooltipster._plugin(t);a.instance&&e.each(a.instance,(function(e,a){o[e]&&o[e].bridged===o[t]&&delete o[e]})),o[t].__destroy&&o[t].__destroy(),delete o[t]}return o},close:function(e){return this.__destroyed?this.__destroyError():this._close(null,e),this},content:function(e){var t=this;if(void 0===e)return t.__Content;if(t.__destroyed)t.__destroyError();else if(t.__contentSet(e),null!==t.__Content){if("closed"!==t.__state&&(t.__contentInsert(),t.reposition(),t.__options.updateAnimation))if(r.hasTransitions){var o=t.__options.updateAnimation;t._$tooltip.addClass("tooltipster-update-"+o),setTimeout((function(){"closed"!=t.__state&&t._$tooltip.removeClass("tooltipster-update-"+o)}),1e3)}else t._$tooltip.fadeTo(200,.5,(function(){"closed"!=t.__state&&t._$tooltip.fadeTo(200,1)}))}else t._close();return t},destroy:function(){var t=this;if(t.__destroyed)t.__destroyError();else{"closed"!=t.__state&&t.option("animationDuration",0)._close(null,null,!0),t._trigger("destroy"),t.__destroyed=!0,t._$origin.removeData(t.__namespace).off("."+t.__namespace+"-triggerOpen"),e(r.window.document.body).off("."+t.__namespace+"-triggerOpen");var o=t._$origin.data("tooltipster-ns");if(o)if(1===o.length){var a=null;"previous"==t.__options.restoration?a=t._$origin.data("tooltipster-initialTitle"):"current"==t.__options.restoration&&(a="string"==typeof t.__Content?t.__Content:e("<div></div>").append(t.__Content).html()),a&&t._$origin.attr("title",a),t._$origin.removeClass("tooltipstered"),t._$origin.removeData("tooltipster-ns").removeData("tooltipster-initialTitle")}else o=e.grep(o,(function(e,o){return e!==t.__namespace})),t._$origin.data("tooltipster-ns",o);t._trigger("destroyed"),t._off(),t.off(),t.__Content=null,t.__$emitterPrivate=null,t.__$emitterPublic=null,t.__options.parent=null,t._$origin=null,t._$tooltip=null,e.tooltipster.__instancesLatestArr=e.grep(e.tooltipster.__instancesLatestArr,(function(e,o){return t!==e})),clearInterval(t.__garbageCollector)}return t},disable:function(){return this.__destroyed?(this.__destroyError(),this):(this._close(),this.__enabled=!1,this)},elementOrigin:function(){return this.__destroyed?void this.__destroyError():this._$origin[0]},elementTooltip:function(){return this._$tooltip?this._$tooltip[0]:null},enable:function(){return this.__enabled=!0,this},hide:function(e){return this.close(e)},instance:function(){return this},off:function(){return this.__destroyed||this.__$emitterPublic.off.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},on:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.on.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},one:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.one.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this},open:function(e){return this.__destroyed?this.__destroyError():this._open(null,e),this},option:function(t,o){return void 0===o?this.__options[t]:(this.__destroyed?this.__destroyError():(this.__options[t]=o,this.__optionsFormat(),e.inArray(t,["trigger","triggerClose","triggerOpen"])>=0&&this.__prepareOrigin(),"selfDestruction"===t&&this.__prepareGC()),this)},reposition:function(e,t){var o=this;return o.__destroyed?o.__destroyError():"closed"!=o.__state&&a(o._$origin)&&(t||a(o._$tooltip))&&(t||o._$tooltip.detach(),o.__Geometry=o.__geometry(),o._trigger({type:"reposition",event:e,helper:{geo:o.__Geometry}})),o},show:function(e){return this.open(e)},status:function(){return{destroyed:this.__destroyed,enabled:this.__enabled,open:"closed"!==this.__state,state:this.__state}},triggerHandler:function(){return this.__destroyed?this.__destroyError():this.__$emitterPublic.triggerHandler.apply(this.__$emitterPublic,Array.prototype.slice.apply(arguments)),this}},e.fn.tooltipster=function(){var t=Array.prototype.slice.apply(arguments),o="You are using a single HTML element as content for several tooltips. You probably want to set the contentCloning option to TRUE.";if(0===this.length)return this;if("string"==typeof t[0]){var a="#*$~&";return this.each((function(){var i=e(this).data("tooltipster-ns"),n=i?e(this).data(i[0]):null;if(!n)throw new Error("You called Tooltipster's \""+t[0]+'" method on an uninitialized element');if("function"!=typeof n[t[0]])throw new Error('Unknown method "'+t[0]+'"');this.length>1&&"content"==t[0]&&(t[1]instanceof e||"object"==typeof t[1]&&null!=t[1]&&t[1].tagName)&&!n.__options.contentCloning&&n.__options.debug&&console.log(o);var r=n[t[0]](t[1],t[2]);return r!==n||"instance"===t[0]?(a=r,!1):void 0})),"#*$~&"!==a?a:this}e.tooltipster.__instancesLatestArr=[];var n=t[0]&&void 0!==t[0].multiple,r=n&&t[0].multiple||!n&&i.multiple,s=t[0]&&void 0!==t[0].content,l=s&&t[0].content||!s&&i.content,c=t[0]&&void 0!==t[0].contentCloning,u=c&&t[0].contentCloning||!c&&i.contentCloning,d=t[0]&&void 0!==t[0].debug,p=d&&t[0].debug||!d&&i.debug;return this.length>1&&(l instanceof e||"object"==typeof l&&null!=l&&l.tagName)&&!u&&p&&console.log(o),this.each((function(){var o=!1,a=e(this),i=a.data("tooltipster-ns"),n=null;i?r?o=!0:p&&(console.log("Tooltipster: one or more tooltips are already attached to the element below. Ignoring."),console.log(this)):o=!0,o&&(n=new e.Tooltipster(this,t[0]),i||(i=[]),i.push(n.__namespace),a.data("tooltipster-ns",i),a.data(n.__namespace,n),n.__options.functionInit&&n.__options.functionInit.call(n,n,{origin:this}),n._trigger("init")),e.tooltipster.__instancesLatestArr.push(n)})),this},t.prototype={__init:function(t){this.__$tooltip=t,this.__$tooltip.css({left:0,overflow:"hidden",position:"absolute",top:0}).find(".tooltipster-content").css("overflow","auto"),this.$container=e('<div class="tooltipster-ruler"></div>').append(this.__$tooltip).appendTo(r.window.document.body)},__forceRedraw:function(){var e=this.__$tooltip.parent();this.__$tooltip.detach(),this.__$tooltip.appendTo(e)},constrain:function(e,t){return this.constraints={width:e,height:t},this.__$tooltip.css({display:"block",height:"",overflow:"auto",width:e}),this},destroy:function(){this.__$tooltip.detach().find(".tooltipster-content").css({display:"",overflow:""}),this.$container.remove()},free:function(){return this.constraints=null,this.__$tooltip.css({display:"",height:"",overflow:"visible",width:""}),this},measure:function(){this.__forceRedraw();var e=this.__$tooltip[0].getBoundingClientRect(),t={size:{height:e.height||e.bottom,width:e.width||e.right}};if(this.constraints){var o=this.__$tooltip.find(".tooltipster-content"),a=this.__$tooltip.outerHeight(),i=o[0].getBoundingClientRect(),n={height:a<=this.constraints.height,width:e.width<=this.constraints.width&&i.width>=o[0].scrollWidth-1};t.fits=n.height&&n.width}return r.IE&&r.IE<=11&&t.size.width!==r.window.document.documentElement.clientWidth&&(t.size.width=Math.ceil(t.size.width)+1),t}};var l=navigator.userAgent.toLowerCase();-1!=l.indexOf("msie")?r.IE=parseInt(l.split("msie")[1]):-1!==l.toLowerCase().indexOf("trident")&&-1!==l.indexOf(" rv:11")?r.IE=11:-1!=l.toLowerCase().indexOf("edge/")&&(r.IE=parseInt(l.toLowerCase().split("edge/")[1]));var c="tooltipster.sideTip";return e.tooltipster._plugin({name:c,instance:{__defaults:function(){return{arrow:!0,distance:6,functionPosition:null,maxWidth:null,minIntersection:16,minWidth:0,position:null,side:"top",viewportAware:!0}},__init:function(e){var t=this;t.__instance=e,t.__namespace="tooltipster-sideTip-"+Math.round(1e6*Math.random()),t.__previousState="closed",t.__options,t.__optionsFormat(),t.__instance._on("state."+t.__namespace,(function(e){"closed"==e.state?t.__close():"appearing"==e.state&&"closed"==t.__previousState&&t.__create(),t.__previousState=e.state})),t.__instance._on("options."+t.__namespace,(function(){t.__optionsFormat()})),t.__instance._on("reposition."+t.__namespace,(function(e){t.__reposition(e.event,e.helper)}))},__close:function(){this.__instance.content()instanceof e&&this.__instance.content().detach(),this.__instance._$tooltip.remove(),this.__instance._$tooltip=null},__create:function(){var t=e('<div class="tooltipster-base tooltipster-sidetip"><div class="tooltipster-box"><div class="tooltipster-content"></div></div><div class="tooltipster-arrow"><div class="tooltipster-arrow-uncropped"><div class="tooltipster-arrow-border"></div><div class="tooltipster-arrow-background"></div></div></div></div>');this.__options.arrow||t.find(".tooltipster-box").css("margin",0).end().find(".tooltipster-arrow").hide(),this.__options.minWidth&&t.css("min-width",this.__options.minWidth+"px"),this.__options.maxWidth&&t.css("max-width",this.__options.maxWidth+"px"),this.__instance._$tooltip=t,this.__instance._trigger("created")},__destroy:function(){this.__instance._off("."+self.__namespace)},__optionsFormat:function(){var t=this;if(t.__options=t.__instance._optionsExtract(c,t.__defaults()),t.__options.position&&(t.__options.side=t.__options.position),"object"!=typeof t.__options.distance&&(t.__options.distance=[t.__options.distance]),t.__options.distance.length<4&&(void 0===t.__options.distance[1]&&(t.__options.distance[1]=t.__options.distance[0]),void 0===t.__options.distance[2]&&(t.__options.distance[2]=t.__options.distance[0]),void 0===t.__options.distance[3]&&(t.__options.distance[3]=t.__options.distance[1]),t.__options.distance={top:t.__options.distance[0],right:t.__options.distance[1],bottom:t.__options.distance[2],left:t.__options.distance[3]}),"string"==typeof t.__options.side){t.__options.side=[t.__options.side,{top:"bottom",right:"left",bottom:"top",left:"right"}[t.__options.side]],"left"==t.__options.side[0]||"right"==t.__options.side[0]?t.__options.side.push("top","bottom"):t.__options.side.push("right","left")}6===e.tooltipster._env.IE&&!0!==t.__options.arrow&&(t.__options.arrow=!1)},__reposition:function(t,o){var a,i=this,n=i.__targetFind(o),r=[];i.__instance._$tooltip.detach();var s=i.__instance._$tooltip.clone(),l=e.tooltipster._getRuler(s),c=!1,u=i.__instance.option("animation");switch(u&&s.removeClass("tooltipster-"+u),e.each(["window","document"],(function(a,u){var d=null;if(i.__instance._trigger({container:u,helper:o,satisfied:c,takeTest:function(e){d=e},results:r,type:"positionTest"}),1==d||0!=d&&0==c&&("window"!=u||i.__options.viewportAware))for(a=0;a<i.__options.side.length;a++){var p={horizontal:0,vertical:0},g=i.__options.side[a];"top"==g||"bottom"==g?p.vertical=i.__options.distance[g]:p.horizontal=i.__options.distance[g],i.__sideChange(s,g),e.each(["natural","constrained"],(function(e,a){if(d=null,i.__instance._trigger({container:u,event:t,helper:o,mode:a,results:r,satisfied:c,side:g,takeTest:function(e){d=e},type:"positionTest"}),1==d||0!=d&&0==c){var s={container:u,distance:p,fits:null,mode:a,outerSize:null,side:g,size:null,target:n[g],whole:null},m=("natural"==a?l.free():l.constrain(o.geo.available[u][g].width-p.horizontal,o.geo.available[u][g].height-p.vertical)).measure();if(s.size=m.size,s.outerSize={height:m.size.height+p.vertical,width:m.size.width+p.horizontal},"natural"==a?o.geo.available[u][g].width>=s.outerSize.width&&o.geo.available[u][g].height>=s.outerSize.height?s.fits=!0:s.fits=!1:s.fits=m.fits,"window"==u&&(s.fits?s.whole="top"==g||"bottom"==g?o.geo.origin.windowOffset.right>=i.__options.minIntersection&&o.geo.window.size.width-o.geo.origin.windowOffset.left>=i.__options.minIntersection:o.geo.origin.windowOffset.bottom>=i.__options.minIntersection&&o.geo.window.size.height-o.geo.origin.windowOffset.top>=i.__options.minIntersection:s.whole=!1),r.push(s),s.whole)c=!0;else if("natural"==s.mode&&(s.fits||s.size.width<=o.geo.available[u][g].width))return!1}}))}})),i.__instance._trigger({edit:function(e){r=e},event:t,helper:o,results:r,type:"positionTested"}),r.sort((function(e,t){if(e.whole&&!t.whole)return-1;if(!e.whole&&t.whole)return 1;if(e.whole&&t.whole){var o=i.__options.side.indexOf(e.side);return(a=i.__options.side.indexOf(t.side))>o?-1:o>a?1:"natural"==e.mode?-1:1}if(e.fits&&!t.fits)return-1;if(!e.fits&&t.fits)return 1;if(e.fits&&t.fits){var a;o=i.__options.side.indexOf(e.side);return(a=i.__options.side.indexOf(t.side))>o?-1:o>a?1:"natural"==e.mode?-1:1}return"document"==e.container&&"bottom"==e.side&&"natural"==e.mode?-1:1})),(a=r[0]).coord={},a.side){case"left":case"right":a.coord.top=Math.floor(a.target-a.size.height/2);break;case"bottom":case"top":a.coord.left=Math.floor(a.target-a.size.width/2)}switch(a.side){case"left":a.coord.left=o.geo.origin.windowOffset.left-a.outerSize.width;break;case"right":a.coord.left=o.geo.origin.windowOffset.right+a.distance.horizontal;break;case"top":a.coord.top=o.geo.origin.windowOffset.top-a.outerSize.height;break;case"bottom":a.coord.top=o.geo.origin.windowOffset.bottom+a.distance.vertical}"window"==a.container?"top"==a.side||"bottom"==a.side?a.coord.left<0?o.geo.origin.windowOffset.right-this.__options.minIntersection>=0?a.coord.left=0:a.coord.left=o.geo.origin.windowOffset.right-this.__options.minIntersection-1:a.coord.left>o.geo.window.size.width-a.size.width&&(o.geo.origin.windowOffset.left+this.__options.minIntersection<=o.geo.window.size.width?a.coord.left=o.geo.window.size.width-a.size.width:a.coord.left=o.geo.origin.windowOffset.left+this.__options.minIntersection+1-a.size.width):a.coord.top<0?o.geo.origin.windowOffset.bottom-this.__options.minIntersection>=0?a.coord.top=0:a.coord.top=o.geo.origin.windowOffset.bottom-this.__options.minIntersection-1:a.coord.top>o.geo.window.size.height-a.size.height&&(o.geo.origin.windowOffset.top+this.__options.minIntersection<=o.geo.window.size.height?a.coord.top=o.geo.window.size.height-a.size.height:a.coord.top=o.geo.origin.windowOffset.top+this.__options.minIntersection+1-a.size.height):(a.coord.left>o.geo.window.size.width-a.size.width&&(a.coord.left=o.geo.window.size.width-a.size.width),a.coord.left<0&&(a.coord.left=0)),i.__sideChange(s,a.side),o.tooltipClone=s[0],o.tooltipParent=i.__instance.option("parent").parent[0],o.mode=a.mode,o.whole=a.whole,o.origin=i.__instance._$origin[0],o.tooltip=i.__instance._$tooltip[0],delete a.container,delete a.fits,delete a.mode,delete a.outerSize,delete a.whole,a.distance=a.distance.horizontal||a.distance.vertical;var d,p,g,m=e.extend(!0,{},a);if(i.__instance._trigger({edit:function(e){a=e},event:t,helper:o,position:m,type:"position"}),i.__options.functionPosition){var h=i.__options.functionPosition.call(i,i.__instance,o,m);h&&(a=h)}l.destroy(),"top"==a.side||"bottom"==a.side?(d={prop:"left",val:a.target-a.coord.left},p=a.size.width-this.__options.minIntersection):(d={prop:"top",val:a.target-a.coord.top},p=a.size.height-this.__options.minIntersection),d.val<this.__options.minIntersection?d.val=this.__options.minIntersection:d.val>p&&(d.val=p),g=o.geo.origin.fixedLineage?o.geo.origin.windowOffset:{left:o.geo.origin.windowOffset.left+o.geo.window.scroll.left,top:o.geo.origin.windowOffset.top+o.geo.window.scroll.top},a.coord={left:g.left+(a.coord.left-o.geo.origin.windowOffset.left),top:g.top+(a.coord.top-o.geo.origin.windowOffset.top)},i.__sideChange(i.__instance._$tooltip,a.side),o.geo.origin.fixedLineage?i.__instance._$tooltip.css("position","fixed"):i.__instance._$tooltip.css("position",""),i.__instance._$tooltip.css({left:a.coord.left,top:a.coord.top,height:a.size.height,width:a.size.width}).find(".tooltipster-arrow").css({left:"",top:""}).css(d.prop,d.val),i.__instance._$tooltip.appendTo(i.__instance.option("parent")),i.__instance._trigger({type:"repositioned",event:t,position:a})},__sideChange:function(e,t){e.removeClass("tooltipster-bottom").removeClass("tooltipster-left").removeClass("tooltipster-right").removeClass("tooltipster-top").addClass("tooltipster-"+t)},__targetFind:function(e){var t={},o=this.__instance._$origin[0].getClientRects();o.length>1&&(1==this.__instance._$origin.css("opacity")&&(this.__instance._$origin.css("opacity",.99),o=this.__instance._$origin[0].getClientRects(),this.__instance._$origin.css("opacity",1)));if(o.length<2)t.top=Math.floor(e.geo.origin.windowOffset.left+e.geo.origin.size.width/2),t.bottom=t.top,t.left=Math.floor(e.geo.origin.windowOffset.top+e.geo.origin.size.height/2),t.right=t.left;else{var a=o[0];t.top=Math.floor(a.left+(a.right-a.left)/2),a=o.length>2?o[Math.ceil(o.length/2)-1]:o[0],t.right=Math.floor(a.top+(a.bottom-a.top)/2),a=o[o.length-1],t.bottom=Math.floor(a.left+(a.right-a.left)/2),a=o.length>2?o[Math.ceil((o.length+1)/2)-1]:o[o.length-1],t.left=Math.floor(a.top+(a.bottom-a.top)/2)}return t}}}),e})),$(document).ready((function(){if($("#slider").length>0){if($("#slider").slider({max:3,min:.3,value:1,step:.05,slide:slideFunc,stop:slideStop}),$("#slider").on("dblclick",(()=>{changeZoom(1),localStorage.removeItem("zoomTablon"+tablonActual)})),isMobile()&&"undefined"!=typeof Hammer){var e=new Hammer(document.getElementById("slider"));e.get("tap").set({enable:!0,taps:2}),e.on("tap",(function(){changeZoom(1),localStorage.removeItem("zoomTablon"+tablonActual)}))}restoreBoardZoom()}}));zoomGlobal=1;var zoomAnt,zoomTabHeight,zoomTabWidth,zoomMaxHeight,zoomScrollTop,zoomScrollLeft,zoomTopAdjust=0,zoomLeftAdjust=0;function slideFunc(e,t){0!==$(".ui-slider-handle").length&&(1!==(zoomGlobal=t.value)||isTransformActive()?(e&&(localStorage["zoomTablon"+tablonActual]=zoomGlobal),$("#nivelZoom").show(),$("#nivelZoom").text("ZOOM: "+parseInt(100*zoomGlobal)+"%"),$(".ui-slider-handle").html("<span>"+parseInt(100*zoomGlobal)+"%</span>"),1==zoomGlobal?(zoomTopAdjust=0,zoomLeftAdjust=0):(zoomTopAdjust=20/zoomGlobal,zoomLeftAdjust=5/zoomGlobal),$("#Postits").css({transform:"scale("+zoomGlobal+")","transform-origin":"top left",top:zoomTopAdjust,left:zoomLeftAdjust}),zoomGlobal>.8&&1!=zoomGlobal?$(".parteSuperior img, .parteSuperior i, .parteSuperior button").css({transform:"scale("+1/zoomGlobal+")","transform-origin":"top center"}):$(".parteSuperior img, .parteSuperior i, .parteSuperior button").css({transform:"none"}),esTablonKanban()&&1!=zoomGlobal&&setTimeout((()=>{$(".tablonPostits").width($("#Postits").width()*zoomGlobal),$(".tablonPostits").height($("#Postits").height()*zoomGlobal)}),800),cambiaMaquetaPant(),refreshConnections()):$(".ui-slider-handle").html("<span>"+parseInt(100*zoomGlobal)+"%</span>"))}function isTransformActive(){var e=document.querySelector("#Postits");try{return"none"!=(window.getComputedStyle(e,null)&&window.getComputedStyle(e,null).getPropertyValue("transform"))}catch(e){console.log(e)}}function slideStop(){inicializaTablonMasonry(),refreshConnections(),muestraAyudaSnackbar("helpZoomDblClick"),$("#nivelZoom").fadeOut(600)}function iniZoom(e){0!==$(".ui-slider-handle").length&&hayZoom()&&(changeZoom(1),e&&iraNota(e,!1))}function changeZoom(e){0!==$(".ui-slider-handle").length&&(slideFunc(null,{value:e}),$("#slider").slider("value",e),$("#nivelZoom").hide())}function hayZoom(){return 1!=zoomGlobal}function restoreBoardZoom(e=tablonActual){localStorage["zoomTablon"+e]?changeZoom(localStorage["zoomTablon"+e]):changeZoom(1)}function restoreBoardScroll(){null!=zoomScrollLeft&&null!=zoomScrollTop&&window.scrollTo(zoomScrollLeft,zoomScrollTop)}function hayAlgunaNotaConZoom(){return $("#Postits").find("[data-zoomed='true']").length>0}function zoomNota(e,t,o,a){if(t=t||e&&e.target.id.substr(7)){if("postitnuevo"==t)var i=$("#postitnuevo");else i=$("#postit"+t);if(0!=i.length){if("true"==i.attr("data-zoomed")||o)"true"==i.attr("data-zoomed")&&(quitaZoom(t),$("#floating-button").show(),$(".columna").show(),$(".leader-line").show(),$(".minimizaTool").show(),restoreBoardScroll(),isMobile&&(isChromeExtension()||removeScalable(),window.location.hash=""));else{muestraAyudaSnackbar("ayudaZoom","info"),iniZoom(),$(".postitNB").each((function(){$(this).attr("id")!="postit"+t&&"postitnuevo"!=$(this).attr("id")&&$(this).hide()})),zoomScrollTop=$(document).scrollTop(),zoomScrollLeft=$(document).scrollLeft(),window.scrollTo(0,0),i.attr("data-zoomed","true"),$(".botones, #canvasDiv, .btn-crea-nota").hide(),esTablonKanban()&&i.prependTo("#Postits"),i.addClass("zoomed"),zoomTabHeight=$(".tablonPostits").height(),zoomTabWidth=$(".tablonPostits").width(),document.getElementById("texto"+t)&&(document.getElementById("texto"+t).style.height=""),$(".tablonPostits").width(window.innerWidth-14),$("#Postits").width(window.innerWidth-14),"postitnuevo"!=t&&(esTablonKanban()||i.draggable("disable"),i.removeClass("ui-state-disabled")),$("#zoomImg"+t).attr("src","appimg/zoomOut.png"),$("#borr"+t).hide(),$("#moverImg"+t).hide(),$("#connectImg"+t).hide(),"true"==localStorage["masonry"+localStorage.tablonActual]&&$("#Postits").css("padding-top",0);var n=$("#texto"+t);zoomMaxHeight=n.css("maxHeight"),n.css("maxHeight","50000px"),!a&&i.height()<window.innerHeight&&i.height(window.innerHeight),a?($(".tablonPostits").height(window.innerHeight),$("#Postits").height(window.innerHeight)):($(".tablonPostits").height(i.height()),$("#Postits").height(i.height())),i.find(".nuevoLink").length&&(n.removeClass("classTransparent"),i.find(".nuevoLink").remove()),$("#floating-button").hide(),$(".columna").hide(),$(".leader-line").hide(),$(".minimizaTool").hide(),isMobile()&&hideParteSuperior(t),$(document).on("keyup",(function(e){27==e.keyCode&&quitaZoom(t)})),isMobile()&&(isChromeExtension()||addScalable(),window.location.hash="zoomed")}resizeIframes(t,window.innerWidth,$("#postit"+t).height()),hightlightCode(),$("#grupoIconosSinMarco"+t).hide()}}}function quitaZoom(e){if(!esPopup()){if("postitnuevo"==e)var t=$("#postitnuevo");else{t=$("#postit"+e);esTablonKanban()||t.draggable("enable")}removeScalable(),t.attr("data-zoomed")&&(t.attr("data-zoomed","false"),$(".botones, #canvasDiv, .btn-crea-nota, .minimizaTool").show(),$(".tablonPostits").width(zoomTabWidth),$("#Postits").width(zoomTabWidth),$(".tablonPostits").height(zoomTabHeight),$("#Postits").height(zoomTabHeight),$(".columna").show(),$(".leader-line").show(),$(".postitNB").each((function(){$(this).attr("id")!="postit"+e&&"postitnuevo"!=$(this).attr("id")&&$(this).show()})),zoomMaxHeight&&$("texto"+e).css("maxHeight",zoomMaxHeight),recalculaPaddingMasonry(),"postitnuevo"!=e?(refrescaNota(e),refrescaOrdenacion(),ordenaPostitsKanban()):t.hide(),$(document).off("keyup"),t.removeClass("zoomed"),restoreBoardZoom(),restoreBoardScroll())}}function quitaZoomNotas(){removeScalable(),$("[data-zoomed=true]").each((function(e){if(0==$("iframe[id *= textAreaE]").length){if("postitnuevo"==$(this).attr("id"))var t="postitnuevo";else t=$(this).attr("id").substr(6);quitaZoom(t)}})),restoreBoardScroll(),window.location.hash=""}function notaTieneZoom(e){return $("#postit"+e).attr("data-zoomed")}function toggleMinimizaNota(e){$("#postit"+e).hasClass("postit-min")?quitaMinimizado(e):aplicaMinimizado(e),updateNotaMemo(e),cambiaIcono()}function aplicaMinimizado(e){$("#postit"+e).addClass("postit-min").css("border-color",defaultColorContrastBackground),$("#minimizaImg"+e).attr("src","appimg/zoomIn.png"),localStorage["minimizado"+e]="true",setTimeout((function(){refreshConnections(),refrescaOrdenacion()}),400)}function quitaMinimizado(e,t){$("#postit"+e).hasClass("postit-min")&&($("#postit"+e).removeClass("postit-min"),$("#minimizaImg"+e).attr("src","appimg/zoomOut.png"),!t&&localStorage.removeItem("minimizado"+e),setTimeout((function(){$("#postit"+e).height()>1500&&refrescaNota(e),refreshConnections(),refrescaOrdenacion()}),400),restoreBoardZoom())}var DEFAULT_KANBAN=["Todo","Doing","Done"];function muestraDialogoKanban(){salSiPapelera()||abrirPantallaModal(obtenerFormularioKanban(),{onOpenStart:function(){var e={data:crearTagData(getKanbanList()),placeholder:"Introduce más Columnas",secondaryPlaceholder:"+Tag",limit:8};M.Chips.init(document.getElementById("chips"),e),$("#quitar-kanban").off().on("click",quitarTablonKanban),$("#aceptar-kanban").off().on("click",hazTablonKanban),$(".chips").sortable()},height:"60%",minHeight:380,maxHeight:450,maxWidth:750})}function crearTagData(e){return e.map((e=>({tag:e})))}function getKanbanList(e=tablonActual){var t=[];try{if(esTablonKanban(tablonActual))t=JSON.parse(localStorage["tablonKanban"+e]).kanbanList;else t=DEFAULT_KANBAN}catch(e){console.log(e)}return t}function getKanbanWidths(e=tablonActual){var t=[];try{if(esTablonKanban(e))t=JSON.parse(localStorage["tablonKanban"+e]).widths}catch(e){console.log(e)}return t}function quitarTablonKanban(){localStorage.removeItem("tablonKanban"+tablonActual),modalInstance.close(),quitarColumnaKanbanPostis(tablonActual),borraKanban(),refrescaPantalla(),grabaTablones()}function hazTablonKanban(e){if(isPremiumUser()){var t=getSortedChipsData();localStorage["tablonKanban"+tablonActual]=JSON.stringify({kanbanList:t,kanbanOrder:[]}),modalInstance.close(),inicializaKanban(),refrescaPantalla(),grabaTablones()}else muestraMensajeHaztePremium()}function getSortedChipsData(){var e=[];return $("#chips").find("i").remove(),$(".chip").each((function(){e.push($(this).text())})),e}function esTablonKanban(e=tablonActual){return!esPopup()&&!!localStorage["tablonKanban"+e]}function esTablonKanbanCompartido(e=tablonActual){var t=getTablonCompartido(e);return t&&t.tabKanban}function inicializaKanban(){if(esTablonKanban()){$("#kanbanBot").addClass("selected"),quitaMasonry(),$(".columna-wrapper").remove();var e=getKanbanList(),t=e.length;quitaMasonry();for(var o=0;o<t;o++)$("#Postits").append(`\n      <div class="columna-wrapper">\n        <div class="titulo-kanban teal darken-3">\n          ${e[o]}\n          <span class="contenedor-contador-kanban">\n            - <span class="contador-kanban">${numeroNotasEnColumna(o)}</span>\n          </span>\n          <a class="add-kanba-note btn-floating btn-small waves-effect waves-light teal lighten-1 right mdc-elevation--z10"\n            data-col="${o}" title="${chrome.i18n.getMessage("addKanbanNote")}">\n            <i class="material-icons">add</i>\n          </a>\n        </div>\n        <div class="columna" data-colid = ${o} id="columna${o}"></div>\n      </div>\n    `);isChromeExtension()?$(".columna-wrapper").width(100/t-1+"%"):$(".columna-wrapper").width(100/t+"%");var a=getKanbanWidths();if(a){for(o=0;o<a.length;o++)a[o]&&$(".columna-wrapper").eq(o).width(a[o]);$("#Postits, .tablonPostits").width(getTotalWidth(a))}else $("#Postits, .tablonPostits").width(($(".columna-wrapper").width()+1)*t);$(".columna-wrapper").resizable({minWidth:400,resize:kanbanResize,stop:function(){grabaTablones(),muestraAyudaSnackbar("helpKanbanResize")}}),asignaPosicionTituloKanban(),$(".columna-wrapper").css("borderColor",defaultColorContrastBackground),$(".add-kanba-note").on("click",(function(e){muestraEditorNuevaNota(e.pageX-$(".columna").width(),e.pageY+$(".titulo-kanban ").height(),$(this).data("col"))})),$(".columna-wrapper .titulo-kanban").first().on("dblclick",mueveNotaRandom),$(".columna").off().on("scroll",(function(e){refreshConnections(),cambiaMaquetaPant(e)})),$(".columna-wrapper .ui-resizable-handle").on("dblclick",(function(e){borraWidths(),isChromeExtension()?$(".columna-wrapper").width(100/t-1+"%"):$(".columna-wrapper").width(100/t+"%"),refrescaKanban(),refreshConnections(),grabaTablones(),cambiaIcono(!1,!0)})),isKanbanBugsBoard()&&($(".add-kanba-note").hide(),$(".add-kanba-note")[0].style.display="block",$(".add-kanba-note")[1].style.display="block")}else $("#kanbanBot").removeClass("selected")}function borraKanban(){$(".columna").length>0&&$(".columna-wrapper").remove(),$("#kanbanBot").removeClass("selected")}function refrescaKanban(){if(esTablonKanban()&&!cambioTablon.sliding){if($(".columna").height(window.innerHeight-$(".botones").height()-$(".titulo-kanban").height()-30),$("#Postits").height(window.innerHeight),getKanbanWidths())getTotalWidth()<window.innerWidth?$(".tablonPostits").width(window.innerWidth):$(".tablonPostits").width(getTotalWidth()),isChromeExtension(),$(".tablonPostits").height(window.innerHeight).addClass("tablon-kanban");else isChromeExtension()?$(".tablonPostits").width(window.innerWidth-3).height(window.innerHeight-3).addClass("tablon-kanban"):$(".tablonPostits").width(window.innerWidth).height(window.innerHeight).addClass("tablon-kanban"),$("#Postits").width($(".tablonPostits").width()).width(($(".columna").width()+1)*$(".columna").length);$(".titulo-kanban").show(),$(".columna-wrapper").css("borderColor",defaultColorContrastBackground),refrescaContadoresKanban(),asignaPosicionTituloKanban(),ordenaPostitsKanban()}}function asignaPosicionTituloKanban(){const e=isMovilApp()?-5:5;$(".columna-wrapper").css("padding-top",$(".botones").height()+e)}function getMaxPostitWidth(){return parseInt($("#Postits").outerWidth()/$(".columna").length)-80}function getColumnPostit(e){return parseInt($("#postit"+e).closest(".columna").attr("data-colid"))}function getColumnPosition(e){return parseInt(e/($(".tablonPostits").width()/$(".columna").length))}function getLeftCoordColum(e){return parseInt($(".tablonPostits").outerWidth()/$(".columna").length*e)}function getKanbanColumnNumber(e=tablonActual){return getKanbanList(e).length}function quitarColumnaKanbanPostis(e=tablonActual){for(var t=0;t<localStorage.totalPost;t++)localStorage["tablon"+t]==e&&(localStorage.removeItem("columnaKanban"+t),isUserConnected()&&null==localStorage["userComp"+t]&&updateNotaLoginMemo(t))}function coordenadaXEnTablonKanban(e){var t=parseInt(localStorage["X"+e]),o=parseInt(localStorage["columnaKanban"+e]);if(getColumnPostit(e)!=o)t=o?getLeftCoordColum(o)+20:20;else{var a=$("#columna0").width();t+$("#postit"+e).outerWidth()>a*(o+1)&&(t=getLeftCoordColum(o)+20)}return t}function ajustaPostistSegunColumna(){if(esTablonKanban()){for(var e=0;e<localStorage.totalPost;e++)if(localStorage["tablon"+e]==tablonActual){var t=coordenadaXEnTablonKanban(e);t!=localStorage["X"+e]&&(localStorage["X"+e]=t,updateNotaMemo(e),$("#postit"+e).offset({left:t}))}refreshConnections()}}function refrescaContadoresKanban(){$(".titulo-kanban").each((function(e){$(this).find(".contador-kanban").text(numeroNotasEnColumna(e))}))}function numeroNotasEnColumna(e,t=tablonActual){for(var o=0,a=0;a<localStorage.totalPost;a++)localStorage["tablon"+a]==t&&localStorage["columnaKanban"+a]==e&&o++;return o}function dijujaLineasKanban(e,t,o,a=tablonActual){if(esTablonKanban(a)){e.fillStyle=defaultColorContrastBackground;var i=getKanbanList(a).length,n=getKanbanWidths(a);if(n)for(var r=getTotalWidth(n),s=0,l=0;l<i-1;l++)s+=o*n[l]/r,e.fillRect(s,0,1,t);else{var c=o/i;for(l=1;l<i;l++)e.fillRect(c*l,0,1,t)}}}function ajustaPostitsMaxWidth(e){$(".postitNB").each((function(){if($(this).attr("id")){var t=parseInt($(this).attr("id").substr(6));localStorage["width"+t]>e&&(localStorage["width"+t]=e,updateNotaMemo(t))}}))}function hazKanbanSortable(){$(".columna").sortable({handle:isMobile()&&".parteSuperior, .bordesup",connectWith:!isKanbanBugsBoard()&&".columna",items:".postitNB",start:function(e,t){removeConnections(),sortStart(e,t)},stop:function(e,t){sortEnd(e,t)},cancel:".editing-post, input",scroll:!0,opacity:.7,create:guardaPosicionesPostits})}function sortStart(e,t){var o=t.item[0].id.substr(6);$("#postit"+o).addClass("postitMoving")}function sortEnd(e,t){var o=t.item[0].id.substr(6);$("#postit"+o).removeClass("postitMoving");var a=topBarHasBoards()?$(".paneles2").height():0;localStorage["X"+o]=parseInt(t.offset.left),localStorage["Y"+o]=parseInt(t.offset.top-a),localStorage["columnaKanban"+o]=getColumnPostit(o),updateNotaMemo(o),$(".classTransparent").each((function(){var e=$(this).attr("id").substr(6);e!=o?(localStorage["columnaKanban"+e]=getColumnPostit(o),$("#postit"+e).remove(),muestraPostit(e),updateNotaMemo(e)):$(this).css("opacity","1")})),$(".classTransparent").removeClass("classTransparent"),refrescaContadoresKanban(),guardaOrdenKanban(),isUserConnected()&&esTabCompartido()&&sendRealTime(o,localStorage["tablon"+o]),refreshConnections(),cambiaIcono(!1,!0)}function guardaOrdenKanban(e=tablonActual){if(localStorage["tablonKanban"+e]){for(var t=JSON.parse(localStorage["tablonKanban"+e]),o=isUserConnected()?"data-treeid":"data-numpost",a=0;a<t.kanbanList.length;a++)t.kanbanOrder[a]=$("#columna"+a).sortable("toArray",{attribute:o});localStorage["tablonKanban"+e]=JSON.stringify(t),grabaTablones()}}function ordenaPostitsKanban(){if(localStorage["tablonKanban"+tablonActual]){var e=JSON.parse(localStorage["tablonKanban"+tablonActual]),t=isUserConnected()?"data-treeid":"data-numpost";function o(o,i){return e.kanbanOrder[a].indexOf($(o).attr(t))>e.kanbanOrder[a].indexOf($(i).attr(t))?1:-1}for(var a=0;a<e.kanbanList.length;a++)e.kanbanOrder[a]&&$("#columna"+a+" .postitNB").sortElements(o)}}function guardaPosicionesPostits(e){setTimeout((function(){$(e.target).find(".postitNB").each((function(){var e=$(this).attr("data-numpost"),t=parseInt($(this).position().left)+parseInt($(this).css("margin-left")),o=parseInt($(this).position().top);t==localStorage["X"+e]&&o==localStorage["Y"+e]||(localStorage["X"+e]=t,localStorage["Y"+e]=o)})),cambiaIcono(!1,!0)}),1e3)}function mueveNotaRandom(){var e=$("#columna0 .postitNB");if(0!=e.length){var t=getRandomNumber(0,e.length-1),o=$(e[t]).data("numpost");localStorage["columnaKanban"+o]=1,refrescaNota(o)}}function addTreeIdKanban(e,t){try{for(var o=0;o<localStorage.numTablones;o++)if(localStorage["tablonKanban"+o]){var a=JSON.parse(localStorage["tablonKanban"+o]);a.kanbanOrder=JSON.parse(JSON.stringify(a.kanbanOrder).replace(`"${t}"`,`"${e}"`)),localStorage["tablonKanban"+o]=JSON.stringify(a)}}catch(e){console.log(e)}}function kanbanResize(e,t){guardaWidhtKanban($(e.target).index(),t.size.width),$("#Postits").width(getTotalWidth()),refreshConnections(),cambiaIcono(!1,!0)}function guardaWidhtKanban(e,t){if(localStorage["tablonKanban"+tablonActual]){var o=JSON.parse(localStorage["tablonKanban"+tablonActual]);o.widths||(o.widths=[]),$(".columna-wrapper").each((function(a){o.widths[a]=a===e?t:$(this).width(),$(this).width($(this).width())})),localStorage["tablonKanban"+tablonActual]=JSON.stringify(o)}}function getTotalWidth(e){var t=0;if(e=e||getKanbanWidths())for(var o of e)t+=o+1;return t}function getParcialWidthByColumn(e,t){e=e||getKanbanWidths();for(var o=0,a=0;a<e.length&&a<t;)o+=e[a]+1,a++;return o}function borraWidths(){if(esTablonKanban(tablonActual)){var e=JSON.parse(localStorage["tablonKanban"+tablonActual]);delete e.widths,localStorage["tablonKanban"+tablonActual]=JSON.stringify(e)}}$(document).ready((function(){$("#kanbanBot").on("click",muestraDialogoKanban)}));const KB=1024,MB=1048576,GO_PREMIUM_URL="https://www.noteboardapp.com/subscribe",PREVIOUS_PREMIUM_USER_CODE="1",PREMIUM_USER_CODE="2",MAX_BOARDS_ALLOWED=7,MAX_USER_SPACE={FREE:50*MB,PRE_PREMIUM:100*MB,PREMIUM:300*MB},EXT_DEV_URL="ajadj/popup.html#premium";function isPrePremiumUser(){return"1"===localStorage.premium}function isNewPremiumUser(){return"2"===localStorage.premium}function isPremiumUser(){return isPrePremiumUser()||isNewPremiumUser()||isDevUser()}function setPremiumUser(){localStorage.premium="2"}function isDevUser(){return document.URL.includes(EXT_DEV_URL)}function getMaxUSerSpace(){var e=MAX_USER_SPACE.FREE;return(isPrePremiumUser()||isDevUser())&&(e=MAX_USER_SPACE.PRE_PREMIUM),isNewPremiumUser()&&(e=MAX_USER_SPACE.PREMIUM),e}function getMaxUSerSpaceKB(){return parseInt(getMaxUSerSpace()/KB)}function getMaxUSerSpaceMB(){return parseInt(getMaxUSerSpace()/MB)}function getUserSpacePercent(){var e=localStorage.espacio||0;return parseInt(e)/getMaxUSerSpace()}function getUserSpaceKb(){if(!localStorage.espacio)return 0;var e=parseInt(localStorage.espacio);return Number.isInteger(e)||(localStorage.removeItem("espacio"),e=0,calculaEspacioUsuarioLocal()),parseInt(e/KB)}function getUserSpaceKbMB(){var e=getUserSpaceKb();return e>KB?parseFloat(e/KB).toFixed(2):e+" Kb"}function userHasSpace(){return getUserSpaceKb()<=getMaxUSerSpaceKB()}function muestraMensajeNohayEspacio(){sweetAlert({text:chrome.i18n.getMessage("noMoreSpace"),confirmText:chrome.i18n.getMessage("goPremium"),cancelText:chrome.i18n.getMessage("cancelar"),successCallback:()=>{window.open(GO_PREMIUM_URL,"_blank")},type:"info"}),localStorage.removeItem("muestraEspacio")}function muestraMensajeHaztePremium(e){sweetAlert({text:e||chrome.i18n.getMessage("opcionPremium"),confirmText:chrome.i18n.getMessage("goPremium"),cancelText:chrome.i18n.getMessage("cancelar"),successCallback:()=>{window.open(GO_PREMIUM_URL,"_blank")},type:"info"})}function getPremiumRibbon(){return isPremiumUser()?'\n    <div class="ribbon-wrap">\n      <span class="ribbon">PREMIUM</span>\n    </div>\n  ':`\n    <div class="ribbon-wrap">\n      <a href="${GO_PREMIUM_URL}" title="${chrome.i18n.getMessage("haztePremium")}"><span class="ribbon">PREMIUM</span></a>\n    </div>\n  `}function calculaEspacioUsuarioLocal(){chrome.permissions.contains({origins:["http://www.noteboardapp.com/"]},(function(e){if(e){for(var t=[],o=0;o<localStorage.totalPost;o++)t.push(localStorage["postit"+o]);for(o=1;o<=localStorage.numTablones;o++)localStorage["fondo"+o].indexOf("http")>-1&&t.push(localStorage["fondo"+o]);var a="listaNotas="+encodeURIComponent(JSON.stringify(t));$.ajax({type:"POST",url:getServerUrl()+"api/getUserFilesSpace.php",data:a,cache:!1,success:function(e){localStorage.espacio=JSON.parse(e).size},error:function(e,t,o){console.log(e)}})}}))}function sumaEspacioServidor(e){localStorage.espacio?localStorage.espacio=parseInt(localStorage.espacio)+e:localStorage.espacio=e}function restaEspacioServidor(e){localStorage.espacio?localStorage.espacio=parseInt(localStorage.espacio)-e:localStorage.espacio=0,parseInt(localStorage.espacio)<0&&localStorage.removeItem("espacio")}async function getPremiumSubscriptionHtml(){var e="";if(isNewPremiumUser())try{var t=await getPremiumSubscriptionData();t.subscription&&(idiomaEsp(navigator.language)?(e=t.subsCancelled?"<h3>Usuario Premium activo</h3>":`\n              <h3>Subscripción ${"M"==t.subsType?"mensual":"anual"} activa</h3>\n            `,e+=`\n            <div><span class="titulo-tabla-subs">Fecha inicio: </span>${t.subsIniDate}</div>\n          `,t.subsCancelled?e+=`\n              <div><span class="titulo-tabla-subs">Fecha fin: </span>${t.subsEndDate}</div>\n              <p><b>Subscripción anulada</b> el dia ${t.subsCancelDate}, no se cobrarán más pagos.<br>La cuenta Premium seguirá activa hasta el dia ${t.subsEndDate}.</p>\n            `:(e+=`<div><span class='titulo-tabla-subs'>Fecha próximo pago: </span>${t.subsEndDate}</div>`,t.subsPayment&&(e+=`<div><span class='titulo-tabla-subs'>Importe próximo pago: </span>${t.subsPayment} ${t.qurrencySign}</div>`),t.stripe?e+="<p>Puedes anular la subscripción en cualquier momento con el siguiente botón que te llevará a una pantalla de Stripe para gestionar tu subscripción o tus datos de pago. Tu cuenta seguirá siendo Premium hasta que finalice el periodo pagado</p>\n              <button class='waves-effect waves-light red btn manage-stripe' type='submit' id='buttonUnsubscribeCard'>\n                <i class=\"medium material-icons\">credit_card</i>\n                <span>Anular subscripción</span>\n              </button>":e+="<p>Puedes anular la subscripción en cualquier momento con el siguiente botón que te llevará a tu cuenta de Paypal. Tu cuenta seguirá siendo Premium hasta que finalice el periodo pagado</p>\n                <button class='waves-effect waves-light red btn' type='submit' id='buttonUnsubscribe'><span>Anular subscripción</span></button>")):(e=t.subsCancelled?"<h3>Premium user active</h3>":`\n              <h3>Active ${"M"==t.subsType?"monthly":"annual"} subscription</h3>\n            `,e+=`\n            <div><span class="titulo-tabla-subs">Start date: </span>${t.subsIniDate}</div>\n          `,t.subsCancelled?e+=`\n              <div><span class="titulo-tabla-subs">End date: </span>${t.subsEndDate}</div>\n              <p>Subscription canceled the day ${t.subsCancelDate}, no more payments will be collected.<br>The Premium account will remain active until the day ${t.subsEndDate}.</p>\n            `:(e+=`<div><span class='titulo-tabla-subs'>Next payment date: </span>${t.subsEndDate}</div>`,t.subsPayment&&(e+=`<div><span class='titulo-tabla-subs'>Next payment amount: </span>${t.subsPayment} ${t.qurrencySign}</div>`),t.stripe?e+="<p>You can unsubscribe at any time with the following button that will take you to a Stripe screen to manage your subscription or your payment details. Your account will remain Premium until the paid period ends</p>\n              <button class='waves-effect waves-light red btn manage-stripe' type='submit' id='buttonUnsubscribeCard'>\n                <i class=\"medium material-icons\">credit_card</i>\n                <span>Manage subscription</span>\n              </button>":e+="<p>You can unsubscribe at any time with the following button that will take you to your Paypal account. Your account will remain Premium until the paid period ends</p>\n              <button class='waves-effect waves-light red btn' type='submit' id='buttonUnsubscribe'><span>Unsubscribe</span></button>")))}catch(e){console.log(e)}else e=idiomaEsp(navigator.language)?"\n        <h3>Subscripción no activa</h3>\n        <button class='waves-effect waves-light green btn subscribe-info' type='button'><span><a href=\"https://www.noteboardapp.com/subscribe\" target=\"_blank\">Ver ventajas con subscripción</a></span></button>\n      ":"\n        <h3>Subscription not active</h3>\n        <button class='waves-effect waves-light green btn subscribe-info' type='button'><span><a href=\"https://www.noteboardapp.com/subscribe\" target=\"_blank\">See benefits with subscription</a></span></button>\n      ";return e}function getPremiumSubscriptionData(){return new Promise(((e,t)=>{var o="id_usuario="+localStorage.id_usuario;o+="&token="+localStorage.token,$.ajax({type:"GET",url:getServerUrl()+"api/getUserSubscription.php",data:o,cache:!1,success:function(t){const o=JSON.parse(t);o.subsIniDate=getLocaleDate(o.subsIniDate),o.subsEndDate=getLocaleDate(o.subsEndDate),o.subsCancelDate=getLocaleDate(o.subsCancelDate),e(o)},error:function(e,o,a){console.log(e),t()}})}))}function addBoardPremiumAllowed(){const e=isAddBoardPremiumAllowed();return!e&&muestraMensajeHaztePremium(chrome.i18n.getMessage("tablonesPremium")),e}function isAddBoardPremiumAllowed(){return isPremiumUser()||parseInt(localStorage.numTablones)<2000}function gotoManageStripe(){$("#buttonUnsubscribeCard i").addClass("loader");var e="id_usuario="+localStorage.id_usuario;e+="&token="+localStorage.token,$.ajax({type:"POST",url:"https://www.noteboardapp.com/creditcard/createCustomerPortal.php",data:e,cache:!1,success:function(e){resp=JSON.parse(e),chrome.tabs.create({url:resp.url})},error:function(e,t,o){console.log(t)},complete:function(){$("#buttonUnsubscribeCard i").removeClass("loader")}})}function compruebaVideos(e){return e.indexOf("link-upload-file")>-1||"false"==localStorage.automaticEmbed?e:(e.indexOf("youtube.com/watch")>-1&&(e=transformYoutubeLinks(e)),-1==(e=convert_vimeo(e=convert_twitch(e=convert_video_url(e)))).indexOf("<iframe")&&(e=e.replace(/(https?:\/\/\S*?\.pdf)/g,'<iframe src="$1" width="500" height="400"></iframe>')),e=e.replace(new RegExp('src="//',"g"),'src="https://'))}function convert_Amazon(e){for(var t,o=0,a=0,i=0;e.indexOf('<a href="https://www.amazon.com',i)>-1&&-1==e.indexOf("tag=",i+10)&&o<10;)o++,a=e.indexOf('<a href="https://www.amazon.com',i),i=e.indexOf('"',a+27),t=e.substring(a,i),e=t.indexOf("?")>-1?e.substring(0,i)+"&tag=notboa-20"+e.substring(i):e.substring(0,i)+"?tag=notboa-20"+e.substring(i);for(o=0,i=0;e.indexOf('<a href="https://www.amazon.es',i)>-1&&-1==e.indexOf("tag=",i+10)&&o<10;)o++,a=e.indexOf('<a href="https://www.amazon.es',i),i=e.indexOf('"',a+27),t=e.substring(a,i),e=t.indexOf("?")>-1?e.substring(0,i)+"&tag=notboa-21"+e.substring(i):e.substring(0,i)+"?tag=notboa-21"+e.substring(i);for(o=0,i=0;e.indexOf('<a href="https://www.amazon.co.uk',i)>-1&&-1==e.indexOf("tag=",i+10)&&o<10;)o++,a=e.indexOf('<a href="https://www.amazon.co.uk',i),i=e.indexOf('"',a+27),t=e.substring(a,i),e=t.indexOf("?")>-1?e.substring(0,i)+"&tag=wwwnoteboarda-21"+e.substring(i):e.substring(0,i)+"?tag=wwwnoteboarda-21"+e.substring(i);return e}function createYoutubeEmbed(e){return'<iframe width="420" height="345" src="https://www.youtube.com/embed/'+e+'" frameborder="0" allowfullscreen></iframe><br/>'}function transformYoutubeLinks(e){if(!e)return e;const t=this,o=/(?:)<a([^>]+)>(.+?)<\/a>/g,a=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([^& \n<]+)(?:[^ \n<]+)?/g;let i=e;const n=e.match(/(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)([^& \n<]+)(?:[^ \n<]+)?/g);if(n&&n.length>0){const s=e.match(o);if(s&&s.length>0)for(var r=0;r<s.length;r++)i=i.replace(s[r],"#placeholder"+r+"#");for(r=0;r<n.length;r++){let e=n[r].split(a);i=i.replace(n[r],t.createYoutubeEmbed(e[1]))}if(s&&s.length>0)for(r=0;r<s.length;r++)i=i.replace("#placeholder"+r+"#",s[r])}return i}function convert_vimeo(e){var t=/(?:http?s?:\/\/)?(?:www\.)?(?:vimeo\.com)\/?(\S+)/g;if(t.test(e))e=e.replace(t,'<iframe width="420" height="345" src="https://player.vimeo.com/video/$1" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>');return e}function convert_twitch(e){var t=/(?:http?s?:\/\/)?(?:www\.)?(?:twitch\.tv)\/?(\S+)/g;if(t.test(e))e=e.replace(t,'<iframe src="https://player.twitch.tv/?channel=$1&!autoplay" frameborder="0" allowfullscreen="true" scrolling="no" height="378" width="620"></iframe>');return e}function convert_video_url(e){var t=/([-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?(?:webm|mp4|ogv))/gi;if(t.test(e)&&-1===e.indexOf("<video"))e=e.replace(t,'<video controls="" loop="" controls src="$1" width="100%" height="350"></video>');return e}function iframeWidth(e){var t=0;return $("#texto"+e+" iframe").each((function(){var e=$(this).attr("src");null!=e&&(e.indexOf("youtube.com/embed")>-1||e.indexOf("spotify.com")>-1||e.toLowerCase().indexOf(".pdf")>-1)&&(t=$(this).width())})),t}function isIframeEmbeded(e){return e.indexOf("www.youtube.com/embed")>-1||e.indexOf("<iframe")>-1&&(e.toLowerCase().indexOf(".pdf")>-1||e.indexOf(!1))||e.indexOf("<video")>-1}function resizeIframes(e,t,o){$("#texto"+e+" iframe").each((function(){var e=$(this).attr("src");null!=e&&(e.indexOf("youtube.com/embed")>-1||e.indexOf("embed/video")>-1)?($(this).width(t),$(this).height(.5625*t)):$(this).height()>50&&($(this).width(t),$(this).height(o)),null!=e&&(e.toLowerCase().indexOf(".pdf")>-1||e.indexOf("https://view.officeapps.live.com")>-1||e.indexOf("https://docs.google.com/viewer")>-1||e.indexOf("https://view.officeapps.live.com")>-1)&&($(this).width("100%"),$(this).height(o))})),$("#texto"+e+" video").each((function(){$(this).width("100%"),1==$("#texto"+e+" video").length&&$(this).on("loadedmetadata",(function(){var o=$(this)[0].videoHeight/$(this)[0].videoWidth;$("#texto"+e+" video").height(t*o),$("#texto"+e).height($("#texto"+e).height()-10)})),$(this).height(.5625*t)}))}function esVideo(e){return e.indexOf("<video")>-1}function changeIframesToLink(e){try{if(e.includes('class="iframeUploadFile"')&&e.includes("view.officeapps.live.com")){for(var t=/<iframe class=\"iframeUploadFile\" src="([^"]+)".*?<\/iframe>/g,o=t.exec(e),a=e;o;)a=a.replace(o[0],`<a href="${o[1]}">${o[1]}</a></br>`),o=t.exec(e);e=a}}catch(e){console.log(e)}return e}function searchCode(e){let t,o=0;for(;e.indexOf("```")>-1;){t=e.indexOf("```"),o=e.indexOf("```",t+1),-1===o&&(o=e.length);let a="javascript";e.toLowerCase().indexOf("html")>-1&&(a="html"),e.toLowerCase().indexOf("java ")>-1&&(a="java"),e.toLowerCase().indexOf("css")>-1&&(a="css"),e.toLowerCase().indexOf("php")>-1&&(a="php"),e.toLowerCase().indexOf("python")>-1&&(a="python"),e.toLowerCase().indexOf("sql")>-1&&(a="sql");const i=Prism.languages[a]||Prism.languages.javascript;e=`${e.substring(0,t)}\n           <pre class="language-${a}"><code class="language-${a}">${Prism.highlight(e.substring(t+4,o),i,a)}\n           </code></pre>${e.substring(o+4)}`}return e}function hightlightCode(){Prism.hooks.add("before-highlight",(function(e){e.code=e.element.innerText})),Prism&&Prism.highlightAll()}var tapedTwice=!1;function initMovil(){}if(isMobile()){function doubleTapHandler(e,t){tapedTwice?(tapedTwice=!1,t()):(tapedTwice=!0,setTimeout((function(){tapedTwice=!1}),300))}$(document).on("click",'a[href^="http"]',(function(e){if(!$(".modal").is(":visible")){e.preventDefault();var t=$(this).closest(".postitNB"),o=t.find(".textoNB");t.find(".nuevoLink").length?(o.removeClass("classTransparent"),t.find(".nuevoLink").remove()):(o.addClass("classTransparent"),t.append('<div class="nuevoLink" data-href="'+$(this).attr("href")+'"><i class="material-icons">exit_to_app</i></div>'),o.height()>window.innerHeight?$(".nuevoLink").css({top:$(this).position().top-$(".nuevoLink").height()/3,left:o.width()/2-$(".nuevoLink").width()/3}):$(".nuevoLink").css({top:o.height()/2-$(".nuevoLink").height()/3,left:o.width()/2-$(".nuevoLink").width()/3}),"true"==t.attr("data-zoomed")&&t.height()<window.innerHeight&&$(".classTransparent").height(window.innerHeight),muestraAyudaSnackbar("helpLinksMovil"))}})),$(document).on("click",".nuevoLink",(function(e){e.preventDefault();var t=$(this).closest(".postitNB"),o=t.find(".textoNB");t.find(".nuevoLink").length&&(o.removeClass("classTransparent"),t.find(".nuevoLink").remove()),window.open($(this).data("href"),"_system")})),isMobile()&&window.addEventListener("hashchange",(function(e){if("zoomed"!=getHashUrl(e.oldURL)||"modal"!=getHashUrl(e.newURL)){if(e.oldURL.length>e.newURL.length){switch(getHashUrl(e.oldURL)){case"zoomed":quitaZoomNotas();break;case"modal":modalInstance.close();break;case"panelShow":$("#flecha-header").click()}$("#flecha-header").length>0?$("#flecha-header").click():quitaZoomNotas()}e.preventDefault()}}))}function initSmallScreen(){($("#slidesBot").is(":visible")||localStorage.showTabs===TOP_BAR.NONE)&&($(".top-bar-icons.right li").detach().appendTo(".top-bar-icons.left"),$("#slidesBot").hide(),$("#canvasDiv").css("top","100px"),$("#canvasMaqueta").remove(),$("#canvasDiv").prepend('<canvas id="canvasMaqueta" width="75" height="90"></canvas>'),hideMinimapa&&$("#canvasMaqueta").hide(),$(".botones .material-icons ").show(),compruebaCanvasPosEnMovil(400),compruebaCanvasPosEnMovil(1e3))}function removeSmallScreen(){$("#slidesBot").is(":visible")||($(".right-button").detach().appendTo(".top-bar-icons.right"),$("#slidesBot").show(),$(".botones .material-icons ").show())}function compruebaCanvasPosEnMovil(e){setTimeout((function(){$("#canvasDiv").css("top",$(".botones").height()+10+"px")}),e)}function panelShow(e){$(".leader-line").remove();$(e+":eq(0)").prepend('<div class="panel-header">\n      <img id="flecha-header" src="appimg/up-arrow.png">\n      <div class="panel-header-logo"><img src="logos/Board2.png"></div>\n    </div>'),$(".botones").hide(),$("#canvasDiv").hide(),$(".tablonPostits").hide(),$(".fixed-action-btn").hide(),$(e).css({top:0,left:0}),$(e).show(),$(e).width(window.innerWidth),$(e).height(window.innerHeight),".fondos"!=e&&$("body").css("background-image",$(".paneles").css("background-image")),$(".tablonPostits").width(window.innerWidth),$("#flecha-header").on("click",(function(){panelHide(e)})),window.location.hash="panelShow"}function panelHide(e){$(e).hide(),$("body").css("background-image","none"),$(".panel-header").remove(),$(".tablonPostits").show(),$("#canvasDiv").show(),$(".botones").show(),$(".fixed-action-btn").show(),cambiaFondoNum(localStorage["fondo"+localStorage.tablonActual]),window.location.hash=""}function doubleTap(e,t){if(isMobile()&&!isChromeExtension()&&e){var o=new Hammer(e);o.get("tap").set({enable:!0,taps:2}),o.on("tap",(function(e){e.preventDefault(),t(e)}))}}