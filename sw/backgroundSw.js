self.localStorage={removeItem:e=>{localStorage[e]&&delete localStorage[e]}};const jQuery={fn:{}};function $(){return new Proxy({ready:()=>{},height:()=>{},hide:()=>{},show:()=>{},remove:()=>{},css:()=>{},find:()=>{},attr:()=>{}},{get:function(e,a){return a in e?e[a]:()=>{}}})}let documentDiv,window={},screen={};const document={getElementById:()=>!1,URL:"chrome-extension://background",createElement:()=>{}};async function initExtension(){try{const e=chrome.offscreen.createDocument({url:"offScreen.html",reasons:["LOCAL_STORAGE"],justification:"Use of localStorage to recover data"});await e}catch(e){console.log(e)}await getLocalStorage(),screen=JSON.parse(await chrome.runtime.sendMessage({getScreen:!0})),window=JSON.parse(await chrome.runtime.sendMessage({getWindow:!0})),initBackground()}var activeTab=0,activeTabLoading=!1,activeWin=0;let initializing=!0;async function getLocalStorage(){const e=await chrome.runtime.sendMessage({getLocalStorage:!0});self.localStorage={...JSON.parse(e),removeItem:e=>{localStorage[e]&&delete localStorage[e]}}}async function getLocalStorageIfEmpty(){localStorage.hasOwnProperty("fullScreen")||await getLocalStorage()}async function setLocalStorage(e){const a={};e.forEach((e=>a[e]=localStorage[e])),await chrome.runtime.sendMessage({setLocalStorage:!0,allLocalStorage:!1,localStorage:a})}async function setAllLocalStorage(){await chrome.runtime.sendMessage({setLocalStorage:!0,allLocalStorage:!0,localStorage:self.localStorage})}$.ajax=e=>{"POST"===e.type&&(e.data=new URLSearchParams(e.data)),fetch(e.url,{headers:{"Content-Type":"application/x-www-form-urlencoded"},method:e.type,body:e.data}).then((e=>e.json())).then((a=>{e.success&&(e.success(JSON.stringify(a)),setAllLocalStorage())})).catch((a=>{e.error&&(e.error(a),setAllLocalStorage())}))},chrome.runtime.onStartup.addListener((()=>{initExtension()})),chrome.runtime.onInstalled.addListener((()=>{initExtension()}));const VALORES_POR_DEFECTO={BOARD_HEIGTH:2e3,TEMA:"colorGris",FONDO:"50",TABLONACTUAL:"1",FUENTE:"6",FONT_SIZE:"15px",MIN_WIDTH_NOTA:"270px",MIN_WIDTH_EDITANDO_NOTA:"590px",DIR_IMAGENES:"appimg/",NUEVA_NOTA:"nuevopost",KANBAN_HEIGHT:600},WEBNOTES_BOARD=-999,TIPO_NOTA={TABLONES:"9",BLANCO:"10",AMARILLO:"1",VERDE:"2",LILA:"3",AMARILLO2:"4",ROSA:"5",ROJO:"6",AZUL:"7",TRANSPARENTE:"8",LIBRETA:"80"},TIPOS_NOTAS_RANDOM=[TIPO_NOTA.BLANCO,TIPO_NOTA.AMARILLO,TIPO_NOTA.VERDE,TIPO_NOTA.LILA,TIPO_NOTA.AMARILLO2,TIPO_NOTA.ROSA,TIPO_NOTA.ROJO,TIPO_NOTA.AZUL],CALIDAD_CAPTURAS_PANTALLA={local:20,logged:70},NOTAS_MINIMIZADAS={height:50,width:200},TOP_BAR={NONE:"none",BUTTONS_UP:"buttons_up",BUTTONS_DOWN:"buttons_down",BOARDS:"boards"},DEMO_USERS=["4156","412833","214973","615023"],BUG_IDEAS_USER="615023",GOOGLE_CLIENT_ID_EDGE_DEV="409932428860-ccanb86ttarambra11kvigdd09m8e0i2.apps.googleusercontent.com",GOOGLE_CLIENT_ID_EDGE_PRO="409932428860-s4cdpc3b4dli4jhekvlv6knb71e6araa.apps.googleusercontent.com",GOOGLE_CLIENT_ID_CHROME_PRO="409932428860-5a35icpm6o2quue6r60a91rac5oqmqc8.apps.googleusercontent.com",EDGE_ID_DEV="bjandjchhgibkhdhbfkpoccciebajadj",EDGE_ID_PRO="ehnmbncdeiinoaojbfjldmghkhjhlkli",CHROME_ID_PRO="goficmpcgcnombioohjcgdhbaloknabb",MAX_CHROME_LOCAL_STORAGE_SIZE=524e4,CANVAS_WIDTH={mini:80,normal:125},fondosTablones=[{id:"50",color:"#ececec",className:"fondo50",visible:!0},{id:"0",imagen:"corcho.jpg",className:!1,color:!1,visible:!0},{id:"51",imagen:"patterns/pat15.jpg",visible:!0},{id:"1",imagen:"corcho3.jpg",visible:!0},{id:"2",imagen:"corcho4.jpg",visible:!1},{id:"29",imagen:"patterns/pat7.png",visible:!0},{id:"3",imagen:"cemento.jpg",visible:!1},{id:"24",imagen:"patterns/pat2.png",visible:!0},{id:"41",imagen:"fondos/shattered-island.gif",visible:!0},{id:"6",imagen:"ladrillos.jpg",visible:!1},{id:"7",imagen:"carton.jpg",visible:!0},{id:"9",imagen:"cuero2.jpg",visible:!1},{id:"10",imagen:"malla.jpg",visible:!1},{id:"11",imagen:"cuero.jpg",visible:!1},{id:"12",imagen:"fondoS1.jpg",visible:!1},{id:"13",imagen:"hixs_pattern_evolution.png",visible:!1},{id:"14",color:"#6C8136",className:"fondo14",visible:!1},{id:"15",color:"#1a1a1a",className:"fondo15",visible:!1},{id:"16",color:"#C80000",className:"fondo16",visible:!1},{id:"17",color:"#961C1C",className:"fondo17",visible:!1},{id:"18",color:"#b03",className:"fondo18",visible:!1},{id:"19",color:"#fff",className:"fondo19",visible:!1},{id:"21",imagen:"patterns/vintage-concrete.png",visible:!0},{id:"22",imagen:"flores.jpg",visible:!0},{id:"27",imagen:"patterns/pat5.png",visible:!1},{id:"30",imagen:"patterns/pat8.png",visible:!0},{id:"31",imagen:"patterns/pat9.png",visible:!0},{id:"34",imagen:"patterns/pat12.png",visible:!0},{id:"37",color:"#ededee",className:"fondo37",visible:!0},{id:"4",imagen:"madera.jpg",visible:!0},{id:"33",imagen:"patterns/pat11.png",visible:!0},{id:"35",imagen:"patterns/pat13.png",visible:!0},{id:"5",imagen:"purty_wood.png",visible:!0},{id:"26",imagen:"patterns/pat4.png",visible:!0},{id:"38",imagen:"fondos/alchemy.gif",visible:!0},{id:"40",imagen:"fondos/science.png",visible:!0},{id:"42",imagen:"patterns/intersection.png",visible:!0},{id:"44",imagen:"patterns/doodles.png",visible:!0},{id:"46",imagen:"patterns/playstation-pattern.png",visible:!0},{id:"47",imagen:"patterns/random_grey_variations.png",visible:!0},{id:"48",imagen:"fondos/motherboard.jpg",visible:!0},{id:"23",imagen:"manutsi.jpg",visible:!0},{id:"49",imagen:"fondos/matrix.jpg",visible:!0},{id:"100",imagen:"rejilla.jpg",visible:!0},{id:"20",imagen:"papelArrugado.jpg",visible:!0},{id:"8",imagen:"fuego.jpg",visible:!0},{id:"52",imagen:"fondos/colorBrick.jpg",visible:!0},{id:"53",imagen:"fondos/pexels.jpg",visible:!0},{id:"54",imagen:"fondos/abstract.jpg",visible:!0},{id:"55",imagen:"fondos/pintura.jpg",visible:!0}];var interval,interval2,sincronizando=0,tablonActual=1;function initBackground(){null!=localStorage.tablonActual&&"0"!=localStorage.tablonActual||(localStorage.tablonActual=VALORES_POR_DEFECTO.TABLONACTUAL),null==localStorage.seleccionTema&&(localStorage.seleccionTema=VALORES_POR_DEFECTO.TEMA,sendMessage({mensBack:"seleccionTemaMod"})),tablonActual=localStorage.tablonActual||1,null!=localStorage.numTablones&&"undefined"!=localStorage.numTablones||(localStorage.numTablones=5,null==localStorage.fondo0&&(localStorage.fondo0=VALORES_POR_DEFECTO.FONDO),null==localStorage.fondo1&&(localStorage.fondo1=VALORES_POR_DEFECTO.FONDO),null==localStorage.fondo2&&(localStorage.fondo2=VALORES_POR_DEFECTO.FONDO),null==localStorage.fondo3&&(localStorage.fondo3=VALORES_POR_DEFECTO.FONDO),null==localStorage.fondo4&&(localStorage.fondo4=VALORES_POR_DEFECTO.FONDO),null==localStorage.fondo5&&(localStorage.fondo5=VALORES_POR_DEFECTO.FONDO),localStorage.masonry0="true"),null!=localStorage.fuente&&"undefined"!=localStorage.fuente||(localStorage.fuente=VALORES_POR_DEFECTO.FUENTE),null!=localStorage.size&&"undefined"!=localStorage.size||(localStorage.size=VALORES_POR_DEFECTO.FONT_SIZE),null==localStorage.sincroLogin&&(localStorage.sincroLogin="false"),null==localStorage.fullScreen&&(localStorage.fullScreen="true"),null!=localStorage.showTabs&&"true"!==localStorage.showTabs||(localStorage.showTabs=TOP_BAR.BOARDS),null!=localStorage.totalPost&&"NaN"!=localStorage.totalPost||(localStorage.totalPost="0"),"true"==localStorage.reabriendoEditor&&(localStorage.reabriendoEditor="false"),isChromeExtension()&&null==localStorage.upgrade52&&(setTimeout((function(){isEdgeBrowser()?chrome.tabs.create({url:"https://www.noteboardapp.com/edgeExtension8Welcome?ori=edgeeext"}):chrome.tabs.create({url:"https://www.noteboardapp.com/chromeExtension8Welcome?ori=chromeext"})}),5e3),localStorage.upgrade52="true","0"==localStorage.totalPost&&crearNotaInicial()),"true"!=localStorage.fullScreen&&chrome.action.setPopup({popup:"popup.html"}),isUserConnected()?(null!=localStorage.nickPublico&&"undefined"!=localStorage.nickPublico||obtenerNickPublico(),sincronizaLogin(!1)):(vaciarPapelera({},30),muestraPops(),setTimeout(miraAgenda,1e4)),cambiaIcono(),localStorage.totalPost>0&&cambiaContador(),"true"==localStorage.sincPeriodico&&isUserConnected()&&empiezaSincroPeriodica(),chrome.contextMenus.removeAll(initializeMenus),chrome.alarms.create("agenda",{periodInMinutes:5}),chrome.alarms.create("vaciaPapelera",{periodInMinutes:60}),chrome.alarms.create("grabaModisPorsiaca",{periodInMinutes:.2}),setAlarmListener(),isUserConnected()||localStorage.espacio||calculaEspacioUsuarioLocal(),isChromeExtension()&&chrome.storage.local.set({versionExtension:chrome.runtime.getManifest().version}),iniLocalStorageCaptureData(),setAllLocalStorage()}activeTab=0,activeTabLoading=!1,activeWin=0;function empiezaSincroPeriodica(){chrome.alarms.create("sincronizaPeriodico",{periodInMinutes:10})}function acabaSincroPeriodica(){chrome.alarms.clear("sincronizaPeriodico")}async function sincronizaPeriodico(){if(await getLocalStorage(),"true"===localStorage.sincPeriodico&&isUserConnected()){await chrome.runtime.sendMessage({editandoNota:!0})||(grabaModificaciones(),sincronizaLogin(!1,!0))}}chrome.action.onClicked.addListener((async function(e){localStorage.hasOwnProperty("fullScreen")||await initExtension(),"true"==localStorage.fullScreen&&(0==activeTab||activeWin!=e.windowId?chrome.tabs.create({url:"popup.html"},(function(e){activeTab=e.id,activeWin=e.windowId,activeTabLoading=!0})):chrome.tabs.update(activeTab,{active:!0},(function(e){(null==e||null==e.url||null!=e.url&&-1==e.url.indexOf("chrome-extension://"))&&chrome.tabs.create({url:"popup.html"},(function(e){activeTab=e.id,activeWin=e.windowId,activeTabLoading=!0}))})))})),chrome.tabs.onUpdated.addListener((function(e,a,t){if(activeTabLoading||e!=activeTab||"complete"!=a.status||(activeTab=0,activeWin=0),activeTabLoading&&"complete"==a.status&&(activeTabLoading=!1),a.url&&a.url.includes("noteboardapp"))switch(!0){case a.url.includes("#goToExtension"):chrome.tabs.create({url:"popup.html?welcome"},(function(e){activeTab=e.id,activeWin=e.windowId,activeTabLoading=!0}));break;case a.url.includes("subscribeSuccess")||a.url.includes("paypalSuccess"):setPremiumUser(),setLocalStorage(["premium"])}})),chrome.tabs.onCreated.addListener((function(e){if(e.pendingUrl&&("chrome://newtab/"==e.pendingUrl||"edge://newtab/"==e.pendingUrl)){if(localStorage["original-new-tab"])return void localStorage.removeItem("original-new-tab");var a=getNewTab();if(a){const t=`popup.html?newTab${parseInt(a.numTab)?"&boardNumber="+a.numTab:""}${a.hideBar?"&hideBar":""}`;chrome.tabs.update(e.id,{url:chrome.runtime.getURL(t)})}}})),chrome.tabs.onRemoved.addListener((function(e){e==activeTab&&(activeTab=0,activeWin=0)})),chrome.commands.onCommand.addListener((function(e){"nueva-nota-web"==e&&chrome.permissions.request({permissions:["tabs"],origins:["http://*/*","https://*/*"]},(function(e){e&&chrome.tabs.query({active:!0,lastFocusedWindow:!0},(([e])=>{creaNotaWeb({pageUrl:e.url},e,!0)}))})),"captura-pantalla-activa"==e&&capturaAreaPantalla(),"captura-pantalla"==e&&capturaAreaPantallaEntera(),"captura-pantalla-video"==e&&capturaVideoPantalla()}));var numPostTemp,options,token,expires,tabList=[];function initializeMenus(){tabList=[];for(var e=0;e<=localStorage.numTablones;e++)tabList.push([]);listaMenus(["selection"],chrome.contextMenus.create({id:"selection-menu",title:chrome.i18n.getMessage("guardaSeleccion"),type:"normal",contexts:["selection"]}),saveSelection,chrome.i18n.getMessage("guardaSeleccion"),chrome.i18n.getMessage("guardaSeleccion2"),"selection-menu"),listaMenus(["link"],chrome.contextMenus.create({id:"save-link-menu",title:chrome.i18n.getMessage("guardaLink"),type:"normal",contexts:["link"]}),saveLink,chrome.i18n.getMessage("guardaLink"),chrome.i18n.getMessage("guardaLink2"),"save-link-menu");var a=chrome.contextMenus.create({id:"save-page-menu",title:chrome.i18n.getMessage("guardaPage"),type:"normal",contexts:["page"]}),t=chrome.contextMenus.create({id:"save-page2-menu",title:chrome.i18n.getMessage("guardaPageS"),type:"normal",contexts:["page"]});listaMenus(["page"],a,savePage,chrome.i18n.getMessage("guardaPage"),chrome.i18n.getMessage("guardaPage2"),"save-page-menu"),listaMenus(["page"],t,savePageS,chrome.i18n.getMessage("guardaPageS"),chrome.i18n.getMessage("guardaPageS2"),"save-page2-menu"),chrome.contextMenus.create({id:"save-screen-menu",title:chrome.i18n.getMessage("guardaImagenPantalla"),type:"normal",contexts:["image"]}),listaMenus(["image"],chrome.contextMenus.create({id:"save-image-menu",title:chrome.i18n.getMessage("guardaImagen"),type:"normal",contexts:["image"]}),saveImage,chrome.i18n.getMessage("guardaImagen")),listaMenus(["page","link","image"],chrome.contextMenus.create({id:"save-web-note",title:chrome.i18n.getMessage("nuevaNotaWeb"),type:"normal",contexts:["page","link","image"]}),creaNotaWeb,chrome.i18n.getMessage("nuevaNotaWeb2"),chrome.i18n.getMessage("nuevaNotaWeb3"),"save-web-note");var o=chrome.contextMenus.create({id:"save-screen-2-menu",title:chrome.i18n.getMessage("capturaPantalla"),type:"normal",contexts:["page","link","image"]});chrome.contextMenus.create({id:"save-screen-area-menu",title:chrome.i18n.getMessage("capturaAreaPantalla"),type:"normal",contexts:["page","link","image"],parentId:o}),chrome.contextMenus.create({id:"save-screen-full-area-menu",title:chrome.i18n.getMessage("capturaAreaPantallaEntera"),type:"normal",contexts:["page","link","image"],parentId:o}),listaMenus(["page","link","image"],chrome.contextMenus.create({id:"save-clean-menu",title:chrome.i18n.getMessage("guardaLimpio"),type:"normal",contexts:["page","link","image"]}),guardaLegible,chrome.i18n.getMessage("guardaLimpio"),chrome.i18n.getMessage("guardaLimpio2"),"save-clean-menu")}function listaMenus(e,a,t,o,n,i){n=n||"";chrome.contextMenus.create({id:"actual-page-menu"+i,title:n+chrome.i18n.getMessage("tablonActual"),type:"normal",contexts:e,parentId:a});chrome.contextMenus.create({id:"separator-menu"+i,type:"separator",contexts:e,parentId:a});for(var r=1;r<=localStorage.numTablones;r++){let t;t=null==localStorage["tab"+r+"Label"]||"undefined"==localStorage["tab"+r+"Label"]?chrome.contextMenus.create({id:"board-menu"+i+r,title:n+chrome.i18n.getMessage("tablon")+r,type:"normal",contexts:e,parentId:a}):chrome.contextMenus.create({id:"board-label-menu"+i+r,title:n+localStorage["tab"+r+"Label"],type:"normal",contexts:e,parentId:a}),tabList[r].push(t)}}function saveSelection(e,a){guardaPostitBackground(e.selectionText,{menuItemId:e.menuItemId})}function saveLink(e,a){guardaPostitBackground(linkify(e.linkUrl),{menuItemId:e.menuItemId})}function savePage(e,a){guardaPostitBackground('<a href="'+e.pageUrl+'" target="_blank" >'+e.pageUrl+"</a>",{menuItemId:e.menuItemId})}function savePageS(e,a){var t={format:"jpeg",quality:isUserConnected()?CALIDAD_CAPTURAS_PANTALLA.logged:CALIDAD_CAPTURAS_PANTALLA.local};chrome.tabs.captureVisibleTab(null,t,(function(a){isUserConnected()?subeCaptura(e.pageUrl,a,e.menuItemId):guardaPostitBackground('<a href="'+e.pageUrl+'" target="_blank" >'+e.pageUrl.split("?")[0]+'</a><br><a href="'+e.pageUrl+'" target="_blank" ><img src="'+a+'" width="100%"/></a>',{menuItemId:e.menuItemId})}))}function saveImage(e,a){guardaPostitBackground('<img src="'+e.srcUrl+'" alt="'+e.pageUrl+' " width="100%" />',{menuItemId:e.menuItemId})}function saveImageFull(e,a){var t={imagen:e.srcUrl,url:a.url};localStorage.imageSave=JSON.stringify(t),chrome.tabs.create({url:"imageSave.html"})}async function buscarMenu(e){if(!e)return 0;0===tabList.length&&(await chrome.contextMenus.removeAll(),initializeMenus());for(var a=1;a<=localStorage.numTablones;a++)for(var t=0;t<tabList[a].length;t++)if(tabList[a][t]==e)return a;return 0}async function guardaPostitBackground(e,a){if(!userHasSpace())return muestraMensajeNohayEspacioDesdeBackground(),!1;if(a.menuItem,a.numTablon)t=a.numTablon;else if(a.nuevaNotaWeb&&0==a.menuItemId)var t=-999;else 0!=(t=await buscarMenu(a.menuItemId))&&-999!=t||(t=a.nuevaNotaWeb?-999:0);var o=localStorage.totalPost;e=compruebaVideos(e),a.url&&(localStorage["notaWeb"+o]=a.url+"||0||0"),null==a.sinMarco?(0==e.indexOf("<img src=")||e.indexOf('src="http://www.youtube.com/embed')>-1||e.indexOf("<video")>-1)&&(localStorage["sinMarco"+o]="true"):localStorage["sinMarco"+o]=a.sinMarco,null!=localStorage.tablonActual&&0!=localStorage.tablonActual||(localStorage.tablonActual=1),localStorage["tablon"+o]=0==t?localStorage.tablonActual:t,localStorage["postit"+o]=e;var n=a.tipoA||getRandomNoteType();8==n&&(n=80),localStorage["tipoA"+o]=n,localStorage["X"+o]=a.left||20+Math.floor(600*Math.random()),localStorage["Y"+o]=a.top||50+Math.floor(600*Math.random());var i=new Date;idiomaEsp(navigator.language)?localStorage["fecha"+o]=i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear():localStorage["fecha"+o]=i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear(),a.height?localStorage["height"+o]=a.height:localStorage["height"+o]="auto",a.nuevaNotaWeb&&a.width?localStorage["width"+o]=a.width:(e.length>500?localStorage["width"+o]="500":localStorage["width"+o]="400",a.width&&a.width<800?localStorage["width"+o]=a.width:a.width&&a.width>650&&a.height&&localStorage.removeItem("height"+o)),localStorage.totalPost++,cambiaIcono(),cambiaContador(),isUserConnected()&&grabaNotaLogin(o),await setAllLocalStorage(),sendMessage({mensBack:"captura"})}function linkify(e){return e.replace(/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,'<a href="$1" target="_blank">$1</a>').replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a href="http://$2" target="_blank">$2</a>').replace(/(\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,6})/gim,'<a href="mailto:$1">$1</a>')}function cambiaIcono(){}function cierraPopup(){isUserConnected()&&grabaModificaciones()}function grabaModisPorsiaca(){isUserConnected()&&grabaModificaciones()}function setAlarmListener(){chrome.alarms.onAlarm.addListener((async e=>{switch(await getLocalStorage(),e.name){case"agenda":miraAgenda();break;case"vaciarPapelera":vaciarPapelera({},30);break;case"grabaModisPorsiaca":grabaModisPorsiaca();break;case"sincronizaPeriodico":sincronizaPeriodico();break;case"connectionRetry":intentaConexion()}}))}function miraAgenda(){let e=!1;for(var a=0;a<localStorage.totalPost;a++){if(null!=localStorage["calendar"+a]&&""!=localStorage["calendar"+a]&&"undefined"!=localStorage["calendar"+a])getCalendarDate(a)<new Date&&(e=!0,getCalendarPopup(a)&&creaPopupNota(a,!0),getCalendarPeriodicidad(a)?actualizaFechaCalendar(a):(localStorage.removeItem("calendar"+a),isUserConnected()&&updateNotaLogin(a)),localStorage.refrescaNota=a,sendMessage({mensBack:"refrescaNota"}))}e&&setAllLocalStorage()}async function onFacebookLogin(e,a,t){if(await getLocalStorage(),"loading"==a.status&&null!=t.url&&t.url.indexOf("www.facebook.com/connect/login_success.html")>-1)if(console.log("url facebooklogin: "+t.url),t.url.indexOf("#access_token")>-1){token=t.url.substring(t.url.indexOf("#access_token=")+14,t.url.indexOf("&expires")),expires=t.url.indexOf("&base_domain")>-1?t.url.substring(t.url.indexOf("&expires_in=")+12,t.url.indexOf("&base_domain")):t.url.substring(t.url.indexOf("&expires_in=")+12);var o="https://graph.facebook.com/v4.0/me?access_token="+token;$.ajax({url:o,dataType:"json",cache:!1,error:function(e,a,t){console.log("error"+a)},success:function(e){localStorage.fbToken=token,localStorage.fbExpires=expires,localStorage.fbId=e.id;var a=new Date;localStorage.timeLogin=a.getTime(),chrome.tabs.onUpdated.removeListener(onFacebookLogin),loginFb(e.name,e.id,token)}}),chrome.tabs.remove(e)}else sendMessageToInjectCode(loginTab,{anwerLogin:"Error"})}function subeCaptura(e,a,t){var o="id_usuario="+localStorage.id_usuario;o+="&captura="+encodeURIComponent(a),$.ajax({type:"POST",url:"https://www.noteboardapp.com/api/subirAwsCaptura.php",data:o,cache:!1,success:function(a){var o=JSON.parse(a);o.isSuccess&&guardaPostitBackground('<a href="'+e+'" target="_blank" >'+e.split("?")[0]+'</a><br><a href="'+e+'" target="_blank" ><img src="https://noteboardapp.s3.amazonaws.com/users/screenshots/'+o.url+'" width="100%"/></a>',{menuItemId:t})},error:function(e,a,t){console.log(a)}})}async function irAnotaPopup(e){localStorage.muestraNota=e,await setLocalStorage(["muestraNota"]),abreAppYEnviaMensaje("muestraNota")}async function muestraMensajeNohayEspacioDesdeBackground(){abreAppYEnviaMensaje("avisoEspacio"),localStorage.muestraEspacio=!0,await setLocalStorage(["muestraEspacio"])}function abreAppYEnviaMensaje(e){0==activeTab?chrome.windows.create({url:chrome.runtime.getURL("popup.html"),state:"maximized"},(function(a){activeTab=a.id,sendMessage({mensBack:e})})):chrome.tabs.update(activeTab,{active:!0},(function(a){null==a||null!=a.url&&-1==a.url.indexOf("chrome-extension://")&&-1==a.url.indexOf("moz-extension://")?chrome.windows.create({url:chrome.runtime.getURL("popup.html"),state:"maximized"},(function(a){activeTab=a.id,sendMessage({mensBack:e})})):sendMessage({mensBack:e})}))}function crearNotaInicial(){var e=localStorage.totalPost||"0";localStorage.totalPost++,localStorage["tablon"+e]=1,localStorage["tipoA"+e]=TIPO_NOTA.AMARILLO,localStorage["X"+e]=100,localStorage["Y"+e]=100,localStorage["width"+e]=625,localStorage["height"+e]="auto",localStorage["sinMarco"+e]=!1;var a=new Date;localStorage["postit"+e]=getWelcomeNote(),idiomaEsp(navigator.language)?localStorage["fecha"+e]=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear():localStorage["fecha"+e]=a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()}chrome.contextMenus.onClicked.addListener(((e,a)=>{switch(e.parentMenuItemId){case"selection-menu":saveSelection(e,a);break;case"save-link-menu":saveLink(e,a);break;case"save-page-menu":savePage(e,a);break;case"save-page2-menu":savePageS(e,a);break;case"save-image-menu":saveImage(e,a);break;case"save-web-note":creaNotaWeb(e,a);break;case"save-clean-menu":guardaLegible(e,a)}switch(e.menuItemId){case"save-screen-menu":saveImageFull(e,a);break;case"save-screen-area-menu":capturaAreaPantalla(e,a);break;case"save-screen-full-area-menu":capturaAreaPantallaEntera(e,a);break;case"save-video-menu":capturaVideoPantalla(e,a)}})),listenMessage("menstoBack",(function(e,a){"cambioMenu"==e.menstoBack&&chrome.contextMenus.removeAll(initializeMenus),"cambioPost"==e.cambioPost&&(console.log("cambiado "+e.numPost),sendMessage({mensBack:"refrescaNota",nota:e.numPost}))})),chrome.runtime.onMessage.addListener((function(e,a,t){e.loginFace&&chrome.tabs.onUpdated.addListener(onFacebookLogin)})),chrome.windows.onRemoved.addListener((function(e){setTimeout((async function(){await getLocalStorage(),borraPopupWindow(e)}),4e3)}));var tabsConNotasInyectadas=[];function inyectaNotas(e){chrome.scripting.executeScript({target:{tabId:e},files:["jquery/jquery-2.0.3.min.js","jquery/jquery-ui.min.js","inject.js"]}),chrome.scripting.insertCSS({target:{tabId:e},files:["inject.css"]})}function borraNotasPreviamenteInyectadas(e){var a=tabsConNotasInyectadas.indexOf(e);a>=0&&(chrome.scripting.executeScript({target:{tabId:e},files:["borraNotasInyectadas.js"]}),tabsConNotasInyectadas.splice(a,1))}chrome.tabs.onUpdated.addListener((async function(e,a,t){if("loading"==a.status){await getLocalStorageIfEmpty(),borraNotasPreviamenteInyectadas(t.id);for(var o=new Array,n=0;n<localStorage.totalPost;n++)if(-1==o.indexOf(t.url)&&!notaEnPapelera(n)&&esNotaWeb(n)&&notaPerteneceUrl(n,t.url))return-1==tabsConNotasInyectadas.indexOf(t.id)&&tabsConNotasInyectadas.push(t.id),o.push(t.url),void inyectaNotas(t.id)}})),chrome.runtime.onMessage.addListener((async function(e,a){if("dameNotas"==e.dameNotas){await getLocalStorage();for(var t=new Object,o=new Array,n=0;n<localStorage.totalPost;n++)if(esNotaWeb(n)&&notaPerteneceUrl(n,a.url)&&!notaEnPapelera(n)){var i={tipoA:localStorage["tipoA"+n],X:getPosicionNotaWeb(n).x,Y:getPosicionNotaWeb(n).y,postit:localStorage["postit"+n],width:localStorage["width"+n],height:localStorage["height"+n],fecha:localStorage["fecha"+n],tablon:localStorage["tablon"+n],calendar:localStorage["calendar"+n],sinMarco:localStorage["sinMarco"+n],rotacion:localStorage["rotacion"+n],pushpin:localStorage["pushpin"+n],numPost:n};o.push(i)}t.listaNotas=o,t.sizef=localStorage.size,t.fuente=localStorage.fuente,chrome.tabs.sendMessage(a.tab.id,{objetoEnvio:JSON.stringify(t)})}if(e.editaNota&&creaPopupNota(e.editaNota.substr(8),!1,!0,!0,!1,e.posY,e.posX,e.notaWidth,e.notaHeight,a.tab.id,a.url),e.creaNotaNuevaWeb){await getLocalStorage();var r=0;notasWebMenu[e.creaNotaNuevaWeb.tabId]&&(r=notasWebMenu[e.creaNotaNuevaWeb.tabId],notasWebMenu.splice(e.creaNotaNuevaWeb.tabId,1)),guardaPostitBackground(e.creaNotaNuevaWeb.postit,{menuItemId:r,height:"auto",width:300,nuevaNotaWeb:!0,tipoA:e.creaNotaNuevaWeb.tipoA,url:e.creaNotaNuevaWeb.url}),inyectaNotas(parseInt(e.creaNotaNuevaWeb.tabId)),setAllLocalStorage()}if(e.cambiaNota&&(await getLocalStorage(),modificaNotaWeb(e.cambiaNota)),e.borraNota&&(await getLocalStorage(),borraNotaWeb(e.borraNota)),e.adjuntaHtml&&(await getLocalStorage(),adjuntaHtmlWeb(e.adjuntaHtml)),e.creaNotaNuevaSelecWeb){await getLocalStorage();var l=e.creaNotaNuevaSelecWeb;guardaPostitBackground(l.postit,{menuItemId:0,height:"auto",width:l.width,nuevaNotaWeb:!0,url:l.url,left:l.left,top:l.top}),inyectaNotas(a.tab.id),setAllLocalStorage()}if(e.cierraVentana&&chrome.windows.remove(e.cierraVentana),e.resizeWindow&&chrome.windows.update(e.resizeWindow.winId,{width:parseInt(e.resizeWindow.width),height:parseInt(e.resizeWindow.height)}),e.readAbilityDone){await getLocalStorage();var s=e.readAbilityDone.content;s=s.replace(/<img /g,'<img width="100%" '),guardaPostitBackground(s='<h3><a target="_blanl" href="'+e.readAbilityDone.uri.spec+'">'+e.readAbilityDone.title+"</a></h3>"+s,{menuItemId:menuNotaLegible,width:775}),await setAllLocalStorage(),irAnotaPopup(parseInt(localStorage.totalPost)-1)}if(e.imagenResultadoCrop){var c={imagen:e.imagenResultadoCrop,url:e.url};localStorage.imageSave=JSON.stringify(c),await setLocalStorage(["imageSave"]),chrome.tabs.create({url:"imageSave.html"})}if(e.cropSalva){await getLocalStorage();var d="";e.textoImagen&&(d=`<p>${e.textoImagen}</p>`);var u='<img src="'+e.cropSalva+'" width="100%"/>';e.linkImagen?d+=`<a href="${e.url}">${u}</a>`:d+=u,e.linkTexto&&(d=`<a href="${e.url}">${e.url}</a>${d}`),e.notaEnEdicion?sendMessage({mensBack:"notaEnEdicion",numPost:localStorage.numeroNotaEnEdicion,content:d}):(e.numNota||0===e.numNota)&&localStorage["postit"+e.numNota]?(localStorage["postit"+e.numNota]+=d,updateNotaLogin(e.numNota),localStorage.refrescaNota=e.numNota,await setAllLocalStorage(),sendMessage({mensBack:"refrescaNota"}),e.abrir&&irAnotaPopup(e.numNota)):(guardaPostitBackground(d,{height:0,numTablon:e.numTablon,sinMarco:!e.linkTexto&&!e.textoImagen}),e.abrir&&irAnotaPopup(parseInt(localStorage.totalPost)-1)),localStorage.removeItem("imageSave"),setAllLocalStorage()}e.videoBlob&&(videoBlob=e.videoBlob),e.capturaVideoResultado&&uploadBlob(videoBlob,e.capturaVideoResultado,e.textoVideo,e.abrir,e.numNota),e.empiezaSincroPeriodica&&empiezaSincroPeriodica(),e.acabaSincroPeriodica&&acabaSincroPeriodica(),e.cierraPopup&&(await getLocalStorage(),cierraPopup()),e.asignaNumeroTablon&&asignaNumeroTablon(e.tablonActual)}));var menuNotaLegible,notasWebMenu=[];function creaNotaWeb(e,a,t){t?creaPopupNota(localStorage.totalPost,!1,!0,!0,!0,300,300,100,100,a.id,e.pageUrl):chrome.permissions.request({permissions:["tabs"],origins:["http://*/*","https://*/*"]},(function(t){t&&creaPopupNota(localStorage.totalPost,!1,!0,!0,!0,300,300,100,100,a.id,e.pageUrl),notasWebMenu[a.id]=e.menuItemId}))}function creaNotaSeleccionWeb(e,a){chrome.permissions.request({permissions:["tabs"],origins:["http://*/*","https://*/*"]},(function(e){e&&chrome.scripting.executeScript({target:{tabId:a.id},files:["injectSelect.js"]})}))}function creaNotaImgWeb(e,a){chrome.permissions.request({permissions:["tabs"],origins:["http://*/*","https://*/*"]},(function(t){if(t){var o='<img src="'+e.srcUrl+'" alt="'+e.pageUrl+' " width="100%" />',n=new Image;n.onload=function(){guardaPostitBackground(o,{menuItemId:0,height:n.height,width:n.width,nuevaNotaWeb:!0,url:e.pageUrl,left:100,top:100}),inyectaNotas(a.id)},n.src=e.srcUrl}}))}function guardaLegible(e,a){chrome.permissions.request({permissions:["tabs"],origins:["http://*/*","https://*/*"]},(function(t){t&&(chrome.scripting.executeScript({target:{tabId:a.id},files:["lib/JSDOMParser.js","lib/Readability.js","injectReadability.js"]}),menuNotaLegible=e.menuItemId)}))}function asignaNumeroTablon(e){tablonActual=e}async function capturaAreaPantalla(e,a){await getLocalStorage();let t=[];a&&a.url||(t=await getCurrentTab());var o={format:"jpeg",quality:isUserConnected()?CALIDAD_CAPTURAS_PANTALLA.logged:CALIDAD_CAPTURAS_PANTALLA.local};chrome.tabs.captureVisibleTab(null,o,(function(e){var o={imagen:e,url:a&&a.url||t[0]&&t[0].url};localStorage.capturaPantalla=JSON.stringify(o),setLocalStorage(["capturaPantalla"]),chrome.tabs.create({url:"cropScreen.html"})}))}function getCurrentTab(){return new Promise((e=>{let a={active:!0,currentWindow:!0};try{chrome.tabs.query(a,(a=>{e(a)}))}catch(a){console.log(a),e([])}}))}function capturaAreaPantallaEntera(e,a){chrome.permissions.request({permissions:["desktopCapture"]},(function(e){if(e){const e=a?a.url:"";chrome.windows.create({url:chrome.runtime.getURL("recordScreen.html?capture=image&url="+e),type:"popup",width:575,height:520})}}))}function capturaVideoPantalla(e,a){chrome.permissions.request({permissions:["desktopCapture"]},(function(e){if(e){const e=a?a.url:"";chrome.windows.create({url:chrome.runtime.getURL("recordScreen.html?capture=video&url="+e),type:"popup",width:575,height:520})}}))}function uploadBlob(e,a,t,o,n){var i=new FormData;i.append("video-blob",e),i.append("video-filename","video.webm"),localStorage.id_usuario&&i.append("id_usuario",localStorage.id_usuario),$.ajax({url:"https://www.noteboardapp.com/api/subirAwsVideo.php",type:"POST",data:i,processData:!1,contentType:!1,success:function(e){chrome.runtime.sendMessage({videoUploadEnd:!0});var i=JSON.parse(e),r=`<video controls src="https://noteboardapp.s3.amazonaws.com/${i.urlFile}" width="100%" height="100%"></video>`;t&&(r=`${t}</br>${r}`),(n||0===n)&&localStorage["postit"+n]?(localStorage["postit"+n]+=r,"auto"==localStorage["width"+n]&&(localStorage["width"+n]="500"),updateNotaLogin(n),localStorage.refrescaNota=n,sendMessage({mensBack:"refrescaNota"}),o&&irAnotaPopup(n)):(guardaPostitBackground(r,{numTablon:a,width:600,sinMarco:!t}),o&&irAnotaPopup(parseInt(localStorage.totalPost)-1)),o&&irAnotaPopup(parseInt(localStorage.totalPost)-1),isUserConnected()||sumaEspacioServidor(i.videoSize),setAllLocalStorage()},error:function(e,a,t){console.log("Error:"+JSON.stringify(t))}})}function isChromeExtension(){return document.URL.indexOf("chrome-extension")>-1}function isEdgeExtension(){return document.URL.indexOf(EDGE_ID_DEV)>-1||document.URL.indexOf(EDGE_ID_PRO)>-1}function isEdgePro(){return document.URL.indexOf(EDGE_ID_PRO)>-1}function isChromePro(){return document.URL.indexOf(CHROME_ID_PRO)>-1}function isEdgeBrowser(){return navigator.userAgent.toLowerCase().indexOf("edg")>-1}function isMobile(){return/iphone|ipod|ipad|android|ie|blackberry|fennec/.test(navigator.userAgent.toLowerCase())}function isIOS(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function isSmallScreen(){return window.innerWidth<=1e3}function isDemoUser(e){return!(isChromeExtension()||isEdgeExtension())&&DEMO_USERS.indexOf(localStorage.id_usuario)>-1&&!(e&&"6"===tablonActual&&esTablonKanban()&&"0"===localStorage["columnaKanban"+e]||e&&isBugsIdeasUser()&&("0"===localStorage["columnaKanban"+e]||"1"===localStorage["columnaKanban"+e]))}function isBugsIdeasUser(){return!(isChromeExtension()||isEdgeExtension())&&"615023"===localStorage.id_usuario}function isKanbanBugsBoard(){return isDemoUser()&&"6"===tablonActual&&esTablonKanban()||isBugsIdeasUser()}if(chrome.runtime.setUninstallURL("https://www.noteboardapp.com/uninstallext"),!isChromeExtension()){var chrome=chrome||{};chrome.permissions={},chrome.permissions.request=function(e,a){console.log(e),a&&a(!0)},chrome.permissions.contains=function(e,a){console.log(e),a&&a(!0)},chrome.i18n={},chrome.i18n.getMessage=function(e){return getMessage(e)},chrome.runtime={onMessage:{addListener:function(e){window.addEventListener("storage",(function(a){if("eventMessage"==a.key)try{console.log(localStorage.eventMessage),e(JSON.parse(localStorage.eventMessage))}catch(e){console.log(e)}}),!1),document.addEventListener("NoteBoardMessage",(a=>{e(a.detail)}))}},sendMessage:function(e){e={...e,noCache:(new Date).getTime()},localStorage.setItem("eventMessage",JSON.stringify(e)),document.dispatchEvent(new CustomEvent("NoteBoardMessage",{detail:{...e}}))},getURL:e=>(!isChromeExtension()&&e.indexOf("popup2.html")>-1&&(e=e.replace(".html",".php")),e),setUninstallURL:()=>{}},chrome.action={setBadgeText:()=>{},setTitle:()=>{},onClicked:{addListener:()=>{}}},chrome.windows={getAll:function(e){},onRemoved:{addListener:e=>{$(window).on("unload",(function(){e()}))}},create:function(e,a){var t=`toolbar=yes,scrollbars=yes,resizable=yes,top=${e.top},left=${e.left},width=${e.width},height=${e.height}`;window.open(e.url,"_blank",t).onload=a},update:(e,{width:a,height:t})=>{console.log(e),console.log(a),console.log(t)},getCurrent:()=>{}},chrome.tabs={create:function(e){window.open(e.url,"_blank")},onUpdated:{addListener:()=>{}},onRemoved:{addListener:()=>{}},onCreated:{addListener:()=>{}}},chrome.alarms={create:()=>{},onAlarm:{addListener:()=>{}}},chrome.extension={getBackgroundPage:function(){return{asignaNumeroTablon:asignaNumeroTablon,errorConexion:errorConexion,empiezaSincroPeriodica:empiezaSincroPeriodica,cierraPopup:cierraPopup,irAnotaPopup:irAnotaPopup}}},chrome.commands={onCommand:{addListener:()=>{}}},chrome.contextMenus={removeAll:()=>{},onClicked:{addListener:()=>{}}},getLocalStorage=async function(){return new Promise((e=>{e()}))},setAllLocalStorage=async function(){return new Promise((e=>{e()}))},setLocalStorage=async function(){return new Promise((e=>{e()}))}}function getServerUrl(){return isChromeExtension()?"https:/www.noteboardapp.com/":""}function isMovilApp(){return!1}function HayEspacios(e){return e.indexOf(" ")>-1}function cambiaContador(){var e=0;switch(null!=localStorage.contador&&"undefined"!=localStorage.contador||(localStorage.contador="1"),localStorage.contador){case"1":for(i=0;i<localStorage.totalPost;i++)(null!=localStorage["tablon"+i]&&"undefined"!=localStorage["tablon"+i]||1!=tablonActual)&&localStorage["tablon"+i]!=tablonActual||e++;break;case"2":e=localStorage.totalPost;break;case"3":e=0}e>0?chrome.action.setBadgeText({text:String(e)}):chrome.action.setBadgeText({text:""}),actualizaNombreTablon(tablonActual)}function refrescaNota(e){if(!esBackground())if(esPopup())$(".selector-varios").remove(),$(".textoNB").html(localStorage["postit"+e]);else{var a=$("#postit"+e).index();$("#postit"+e).remove(),muestraPostit(e,a),esTablonKanban()&&refrescaKanban(),refreshConnections(),hightlightCode()}}function muestraTodasLasNotas(){for(var e=localStorage.totalPost-1;e>=0;e--)muestraPostit(e);hazKanbanSortable(),refreshConnections(),hightlightCode()}function refrescaPantalla(e,a,t){if(!esBackground()&&!esPopup()){quitaZoomNotas(),e||muestraPaneles2(!1,!1),$(".sharePanel").remove(),a?$(".postitNB:not(#postitnuevo)").remove():$(".postitNB:not(#postitnuevo)").each((function(){var e=$(this).attr("data-numpost");parseInt(e)>=parseInt(localStorage.totalPost)&&$(this).remove()})),esTablonKanban()?inicializaKanban():borraKanban();for(var o=localStorage.totalPost-1;o>=0;o--)!a&&localStorage["editando"+o]&&e&&tinyMCE.get("textAreaEdit"+o)&&tinyMCE.get("textAreaEdit"+o).remove(),localStorage["editando"+o]&&!e||t&&$("#texto"+o).html()==localStorage["postit"+o]||($("#postit"+o).remove(),muestraPostit(o));esTabCompartido(tablonActual)?trataTablonComp():inicializaFriendsBot(),hazKanbanSortable(),refrescaKanban(),refrescaOrdenacion(),deslizaPostVisibles(null,!0),detectColorContrastBackground().then((()=>{refreshConnections(),$(".columna").css("borderColor",defaultColorContrastBackground)})),null==localStorage["fondo"+tablonActual]||"NaN"==localStorage["fondo"+tablonActual]||cambioTablon.sliding||cambiaFondoNum(localStorage["fondo"+tablonActual]),$(".ajaxloader").remove(),$("#Postits").imagesLoaded((function(){cambiaIcono()})),hightlightCode(),!e&&compruebaLimites(),cambiaIcono(),cambiaContador()}}function deslizaPostVisibles(e,a){var t=$(".paneles2").innerHeight()>10&&$(".paneles2").innerHeight()||$(".botones").innerHeight()||localStorage.previousHeight;t>10?localStorage.previousHeight=t:t=localStorage.previousHeight;var o=esTablonKanban()?30:0;if("down"==e)var n="+="+t+"px";else n="-="+t+"px";if(a){var i=parseInt($(".paneles2").innerHeight()+$(".titulo-kanban").height()+70+o)+"px";$("#canvasDiv").css("top",i)}else if($("#canvasDiv").animate({top:n}),esTablonKanban())$(".columna-wrapper").animate({"padding-top":n},(function(){$(".columna").height(window.innerHeight-$(".botones").height()-$(".titulo-kanban").height()-30)}));else for(var r=0;r<localStorage.totalPost;r++)(null!=localStorage["tablon"+r]&&"undefined"!=localStorage["tablon"+r]||1!=tablonActual)&&localStorage["tablon"+r]!=tablonActual||$("#postit"+r).animate({top:n});isSmallScreen()&&(compruebaCanvasPosEnMovil(500),compruebaCanvasPosEnMovil(2e3))}function muestraVotar(){if(isChromeExtension()){var e=isEdgeExtension()?"escribeReviewEdge":"escribeReview";"false"!=localStorage[e]&&sweetAlert({type:"info",text:chrome.i18n.getMessage(e),confirmText:chrome.i18n.getMessage("noMostrarMas"),cancel:!0,cancelText:chrome.i18n.getMessage("votar"),successCallback:function(){localStorage[e]="false"},cancelCallback:function(){isEdgeExtension()?window.open("https://microsoftedge.microsoft.com/addons/detail/note-board-sticky-notes/ehnmbncdeiinoaojbfjldmghkhjhlkli","_newtab"):window.open("https://chrome.google.com/webstore/detail/note-board/goficmpcgcnombioohjcgdhbaloknabb/reviews","_newtab")}})}}function pidePermiso(e,a){sweetAlert({text:chrome.i18n.getMessage(e),successCallback:function(){permisoOrigenes(a)}})}function permisoOrigenes(e){chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(function(a){a?(e&&creaFondo(),console.log("concedido")):console.log("no concedido")}))}function pidePermisoImagenes(e,a,t){"false"!=localStorage[e]&&sweetAlert({text:chrome.i18n.getMessage(e),successCallback:function(){permisoOrigenesImagenes(a,t)}})}function permisoOrigenesImagenes(e,a){chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(function(t){t?(abreFormularioAnexa(e,a),console.log("concedido")):console.log("no concedido")}))}function sendMessage(e){chrome.runtime.sendMessage(e)}function listenMessage(e,a){chrome.runtime.onMessage.addListener((function(t,o){for(var n in t)n==e&&a(t,o)}))}function formateaFecha(e){var a="",t=("0"+e.getFullYear()).slice(-2),o=("0"+parseInt(e.getMonth()+1)).slice(-2),n=("0"+e.getDate()).slice(-2);return a=idiomaEsp(navigator.language)?n+"-"+o+"-"+t:o+"-"+n+"-"+t,a+=" "+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}function idiomaEsp(e){return"es"==navigator.language||"ca"==navigator.language||"es-419"==navigator.language||"es-ES"==navigator.language}function buscarText(e){var a=new Array,t=document.createElement("div"),o=0;if(0!=e.indexOf(">")&&0!=e.indexOf("<")||(o=parseInt(e.substr(1))),o)for(var n=0==e.indexOf(">"),i=0;i<localStorage.totalPost;i++)"0"!=localStorage["tablon"+i]&&(n&&difFechas(localStorage["fecha"+i])>o&&a.push(i),!n&&difFechas(localStorage["fecha"+i])<o&&a.push(i));else for(i=0;i<localStorage.totalPost;i++){t.innerHTML=localStorage["postit"+i],t.innerText.toLowerCase().indexOf(e.toLowerCase())>-1&&a.push(i)}return a}function ponAlFrente(e,a){if(-1==e.target.className.indexOf("mce_")&&-1==e.target.className.indexOf("inplace")&&"calendar"!=e.target.className){var t=maxZindex();$("#postit"+a).css("z-index",t+1)}}function ponAlFrentePost(e){var a=maxZindex();$("#postit"+e).css("z-index",a+1)}function maxZindex(e=""){var a=10;return $(".postitNB:not(#postit"+e+")").each((function(e){var t=$(this);"postitnuevo"!=t.attr("id")&&"auto"!=t.css("z-index")&&a<parseInt(t.css("z-index"))&&(a=parseInt(t.css("z-index")))})),a}function colorLuminance(e,a){(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),a=a||0;var t,o,n="#";for(o=0;o<3;o++)t=parseInt(e.substr(2*o,2),16),n+=("00"+(t=Math.round(Math.min(Math.max(0,t+t*a),255)).toString(16))).substr(t.length);return n}function esColorOscuro(e){return"white"===getContrastYIQ(e)}function getContrastYIQ(e){return(299*parseInt(e.substr(0,2),16)+587*parseInt(e.substr(2,2),16)+114*parseInt(e.substr(4,2),16))/1e3>=65?"black":"white"}function youtube_parser(e){var a=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);if(a&&11==a[7].length)return a[7];console.log("Url incorrecta")}function pausecomp(e){var a=new Date,t=null;do{t=new Date}while(t-a<e)}function validaURL(e){return/https?:\/\/(www\.)?[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi.test(e)}var imgs=new Array;function preloadImages(e){e=e||tablonActual;for(var a=0;a<localStorage.totalPost;a++)if(esNotaVisibleEnTablon(a,e)){imgs[a]=void 0;var t=document.createElement("DIV");t.innerHTML=localStorage["postit"+a];var o=t.querySelectorAll("img:not(.link-upload-img)");if(o.length>0&&(imgs[a]=new Image,imgs[a].src=o[0].src),localStorage["postit"+a]&&localStorage["postit"+a].indexOf('src="http://www.youtube.com/embed')>-1){var n=localStorage["postit"+a].indexOf('src="http://www.youtube.com')+5,i=localStorage["postit"+a].indexOf('"',n),r=localStorage["postit"+a].substring(n,i);imgs[a]=new Image,imgs[a].src="http://img.youtube.com/vi/"+youtube_parser(r)+"/0.jpg"}}}function closePaneles(e){"paneles"!=e&&($(".paneles").fadeOut(),$("#panelBotDiv").css({"box-shadow":"0 0 0px black inset"})),"searchPanel"!=e&&($(".searchPanel").fadeOut(),$("#searchBot").css({"box-shadow":"0 0 0px black inset"})),"fondos"!=e&&($(".fondos").fadeOut(),$("#cambFondo").css({"box-shadow":"0 0 0px black inset"})),"nicksComp"!=e&&($(".nicksComp").fadeOut(),$("#compBot").css({"box-shadow":"0 0 0px black inset"})),"panelFuentes"!=e&&($(".panelFuentes").fadeOut(),$("#cambF").css({"box-shadow":"0 0 0px black inset"}))}function mirarSiCerrar(e){$(".searchPanel").is(":visible")&&-1==numPostSearch&&0==$(e).closest(".searchPanel").length&&($(".searchPanel").fadeOut(),$("#searchBot").css({"box-shadow":"0 0 0px black inset"}),$(".searchResult").remove()),$(".fondos").is(":visible")&&0==$(e).closest(".fondos").length&&($(".fondos").fadeOut(),$("#cambFondo").css({"box-shadow":"0 0 0px black inset"})),$(".nicksComp").is(":visible")&&0==$(e).closest(".nicksComp").length&&($(".nicksComp").fadeOut(),$("#compBot").css({"box-shadow":"0 0 0px black inset"})),$(".panelFuentes").is(":visible")&&0==$(e).closest(".panelFuentes").length&&($(".panelFuentes").fadeOut(),$("#cambF").css({"box-shadow":"0 0 0px black inset"}))}function algunoPublico(){for(var e=1;e<=localStorage.numTablones;e++)if("true"==localStorage["publico"+e])return!0;return!1}function nombreTablon(e=tablonActual){return-999==e?chrome.i18n.getMessage("tablonWeb"):0==e?chrome.i18n.getMessage("papelera"):(null!=localStorage["tab"+e+"Label"]&&"undefined"!=localStorage["tab"+e+"Label"]&&""!=localStorage["tab"+e+"Label"]||(localStorage["tab"+e+"Label"]=chrome.i18n.getMessage("tablon")+e),localStorage["tab"+e+"Label"])}function ordenTablon(e){return null!=localStorage["ordenTablon"+e]&&"undefined"!=localStorage["ordenTablon"+e]?localStorage["ordenTablon"+e]:e}function wrapText(e,a){var t,o=new RegExp(a.replace(/[\\^$*+.?[\]{}()|]/,"\\$&"),"i"),n=[];e.normalize();for(var i=e.firstChild;null!=i;){if(i.nodeType==Node.TEXT_NODE){t="string"==typeof i.textContent?i.textContent:i.innerText;var r=o.exec(t);if(null!=r){var l=document.createDocumentFragment();r.index>0&&l.appendChild(document.createTextNode(r.input.substr(0,r.index)));var s=document.createElement("span");s.className="spanNoteBoard",s.appendChild(document.createTextNode(r[0])),l.appendChild(s),r.index+r[0].length<r.input.length&&l.appendChild(document.createTextNode(r.input.substr(r.index+r[0].length))),i.parentNode.replaceChild(l,i),i=s}}else if(i.nodeType==Node.ELEMENT_NODE&&null!=i.firstChild){n.push(i),i=i.firstChild;continue}for(;null!=i&&null==i.nextSibling;)i=n.pop();null!=i&&(i=i.nextSibling)}}function isValidDate(e){return e&&"undefined"!==e}function difFechas(e,a,t){if(!isValidDate(e)||a&&!isValidDate(a))return 0;try{if(e.indexOf("/")&&(e=e.replace(/\//g,"-")),1==e.indexOf("-")&&(e="0"+e),4==e.indexOf("-",3)&&(e=e.substr(0,3)+"0"+e.substr(3)),2==e.indexOf("-")){var o=e;e=idiomaEsp(navigator.language)?e.substr(6)+"-"+e.substr(3,2)+"-"+e.substr(0,2):e.substr(6)+"-"+e.substr(0,2)+"-"+e.substr(3,2)}t=t||"days";var n=36e5,i=24*n;e=new Date(e);var r=(a=a?new Date(a):new Date)-e;if(isNaN(r)){e=idiomaEsp(navigator.language)?o.substr(6)+"-"+o.substr(0,2)+"-"+o.substr(3,2):o.substr(6)+"-"+o.substr(3,2)+"-"+o.substr(0,2);r=a-(e=new Date(e))}if(isNaN(r))return NaN;switch(t){case"years":return a.getFullYear()-e.getFullYear();case"months":return 12*a.getFullYear()+a.getMonth()-(12*e.getFullYear()+e.getMonth());case"weeks":return Math.floor(r/6048e5);case"days":return Math.floor(r/i);case"hours":return Math.floor(r/n);case"minutes":return Math.floor(r/6e4);case"seconds":return Math.floor(r/1e3);default:return}}catch(e){return console.log(e),0}}function clickImgSelecEdit(e){$(this).parent().parent().find(".selectorPins").slideToggle();var a=$(this).parent().parent().find(".subSelectorPins");a.length>0&&a.is(":visible")&&a.slideUp()}function clickImgSelec(e,a){if(a>=0){var t=$("#postit"+a);$this=$(e.target)}else{t=$("#postitnuevo");$this=$(this)}var o=t.find(".pinImgSelec").index(e.target),n=$this.closest(".selectorPins").parent().find(".subSelectorPins");if(0==o&&t.find(".pinImg").remove(),0==o||$this.closest(".selectorPins").parent().find(".tipoPins"+o).length>0)n.slideUp((function(){$(this).remove()}));else{n.slideUp((function(){$(this).remove()}));for(var i='<div class="subSelectorPins tipoPins'+o+'" data-tipopin="'+o+'" data-postit="'+t.attr("id")+'">',r=1;r<=7;r++)i+='<img class="subPinImgSelec" src="appimg/pushpins/pushpin'+o+r+'.png">';i+="</div>",$this.closest(".selectorPins").after(i),$this.closest(".selectorPins").parent().find(".subSelectorPins").slideDown(),$(".subPinImgSelec").on("click",subClickImgSelec)}}function subClickImgSelec(e){var a=$(this).closest(".subSelectorPins").data("tipopin"),t=$(this).closest(".subSelectorPins").data("postit"),o=$("#"+t).find(".subPinImgSelec").index(e.target)+1;$("#"+t+" .pinImg").remove(),o>0&&$("#"+t).append('<img class="pinImg" data-pushpin="'+a+o+'" src="appimg/pushpins/pushpin'+a+o+'.png" />'),$(this).parent().parent().find(".pinImgSelec:first-child").attr("src","appimg/pushpins/pushpin"+a+o+".png")}function esTablonNotasWeb(e=tablonActual){return-999==e}function esTablonPapelera(e=tablonActual){return 0==e}function salSiPapelera(){return!!esTablonPapelera()&&(sweetAlert({type:"error",text:chrome.i18n.getMessage("salSiPapelera"),cancel:!1}),!0)}function inicializaPapelera(){esTablonPapelera()?($("#papelera").css({"box-shadow":"0 0 50px black inset"}),$("#botonVaciarPapelera").show()):($("#papelera").css({"box-shadow":"0 0 0px black inset"}),$("#botonVaciarPapelera").hide());for(var e=0;e<localStorage.totalPost;e++)if("0"==localStorage["tablon"+e])return void $("#papelera").find("img").attr("src","appimg/papeleraLlena.png");$("#papelera").find("img").attr("src","appimg/papelera.png"),$("#botonVaciarPapelera").hide()}function vaciarPapelera(e,a){if(a)vaciarPapeleraConfirmado(a);else{var t=chrome.i18n.getMessage("confirmarPapelera");idiomaEsp(navigator.language)&&(t="¿"+t),sweetAlert({type:"question",text:t,cancel:!0,successCallback:vaciarPapeleraConfirmado})}}function vaciarPapeleraConfirmado(e){for(var a=new Array,t=0;t<localStorage.totalPost;)"0"==localStorage["tablon"+t]&&(!e||difFechas(localStorage["fecha"+t])>e)?(isUserConnected()&&a.push(localStorage["treeId"+t]),borrarConfirmado(t,!1,!0)):t++;isUserConnected()&&a.length>0&&borraListaNotas(a)}function tirarPostitPapelera(e,a){if("nuevopost"!=e){muestraAyudaSnackbar("tiraPapelera"),$("#papelera").find("img").attr("src","appimg/papeleraLlena.png");var t=$("#postit"+e);borrarCalendar(e),t.css("z-index","998998998"),t.animate({top:"50",left:"50",zoom:"0",opacity:"0.3"},800,(function(){t.remove(),a&&a()})),sendRealTime(e,{delete:!0})}}function moverPostitTablon(e,a,t){var o=$("#postit"+e);o.css("z-index","998998998"),-999==a&&0==$("#tabPa2"+a).length&&muestraPaneles2(),esTablonCompartido(a)&&sendRealTime(e,{create:!0},a),esTablonCompartido(tablonActual)&&sendRealTime(e,{delete:!0},tablonActual),o.animate({top:$("#tabPa2"+a).offset().top,left:$("#tabPa2"+a).offset().left,opacity:"0.2"},400,(function(e){o.remove(),t&&t(),refrescaOrdenacion()}))}function notaEnPapelera(e){return"0"==localStorage["tablon"+e]}function borrarConfirmado(e,a,t){var o=localStorage["tablon"+e];for($(".sharePanel").remove(),!isUserConnected()||t||esNotaCompartida(e)||deleteNoteLogin(e),isUserConnected()||esNotaCompartida(e)||compruebaBorrarImagen(localStorage["postit"+e]),$("#postit"+e).remove(),borrarCalendar(e),borraPopupConfirmado(e),localStorage.totalPost--,i=e;i<localStorage.totalPost;i++)localStorage["postit"+i]=localStorage["postit"+(i+1)],localStorage["tipoA"+i]=localStorage["tipoA"+(i+1)],localStorage["tablon"+i]=localStorage["tablon"+(i+1)],localStorage["X"+i]=localStorage["X"+(i+1)],localStorage["Y"+i]=localStorage["Y"+(i+1)],localStorage["width"+i]=localStorage["width"+(i+1)],localStorage["height"+i]=localStorage["height"+(i+1)],localStorage["treeId"+i]=localStorage["treeId"+(i+1)],localStorage["fecha"+i]=localStorage["fecha"+(i+1)],localStorage["calendar"+i]=localStorage["calendar"+(i+1)],localStorage["sinMarco"+i]=localStorage["sinMarco"+(i+1)],null!=localStorage["updated"+(i+1)]?(localStorage["updated"+i]=localStorage["updated"+(i+1)],localStorage.removeItem("updated"+(i+1))):localStorage.removeItem("updated"+i),null!=localStorage["rotacion"+(i+1)]?(localStorage["rotacion"+i]=localStorage["rotacion"+(i+1)],localStorage.removeItem("rotacion"+(i+1))):localStorage.removeItem("rotacion"+i),null!=localStorage["pushpin"+(i+1)]?(localStorage["pushpin"+i]=localStorage["pushpin"+(i+1)],localStorage.removeItem("pushpin"+(i+1))):localStorage.removeItem("pushpin"+i),null!=localStorage["notaWeb"+(i+1)]?(localStorage["notaWeb"+i]=localStorage["notaWeb"+(i+1)],localStorage.removeItem("notaWeb"+(i+1))):localStorage.removeItem("notaWeb"+i),null!=localStorage["userComp"+(i+1)]?(localStorage["userComp"+i]=localStorage["userComp"+(i+1)],localStorage["nickComp"+i]=localStorage["nickComp"+(i+1)],localStorage.removeItem("userComp"+(i+1)),localStorage.removeItem("nickComp"+(i+1))):(localStorage.removeItem("userComp"+i),localStorage.removeItem("nickComp"+i)),null!=localStorage["errorConexion"+(i+1)]?(localStorage["errorConexion"+i]=localStorage["errorConexion"+(i+1)],localStorage.removeItem("errorConexion"+(i+1))):localStorage.removeItem("errorConexion"+i),null!=localStorage["columnaKanban"+(i+1)]?(localStorage["columnaKanban"+i]=localStorage["columnaKanban"+(i+1)],localStorage.removeItem("columnaKanban"+(i+1))):localStorage.removeItem("columnaKanban"+i),null!=localStorage["connections"+(i+1)]?(localStorage["connections"+i]=localStorage["connections"+(i+1)],localStorage.removeItem("connections"+(i+1))):localStorage.removeItem("connections"+i),null!=localStorage["minimizado"+(i+1)]?(localStorage["minimizado"+i]=localStorage["minimizado"+(i+1)],localStorage.removeItem("minimizado"+(i+1))):localStorage.removeItem("minimizado"+i),null!=imgs[i+1]?imgs[i]=imgs[i+1]:imgs[i]=void 0;updateConnectionsBorrado(e),refrescaPantalla(!1,!0),localStorage.removeItem("postit"+localStorage.totalPost),localStorage.removeItem("tablon"+localStorage.totalPost),localStorage.removeItem("tipoA"+localStorage.totalPost),localStorage.removeItem("X"+localStorage.totalPost),localStorage.removeItem("Y"+localStorage.totalPost),localStorage.removeItem("width"+localStorage.totalPost),localStorage.removeItem("height"+localStorage.totalPost),localStorage.removeItem("treeId"+localStorage.totalPost),localStorage.removeItem("fecha"+localStorage.totalPost),localStorage.removeItem("updated"+localStorage.totalPost),localStorage.removeItem("calendar"+localStorage.totalPost),localStorage.removeItem("sinMarco"+localStorage.totalPost),localStorage.removeItem("userComp"+localStorage.totalPost),localStorage.removeItem("nickComp"+localStorage.totalPost),localStorage.removeItem("errorConexion"+localStorage.totalPost),localStorage.removeItem("rotacion"+localStorage.totalPost),localStorage.removeItem("pushpin"+localStorage.totalPost),localStorage.removeItem("notaWeb"+localStorage.totalPost),localStorage.removeItem("columnaKanban"+localStorage.totalPost),localStorage.removeItem("connections"+localStorage.totalPost),imgs[localStorage.totalPost]=void 0,"0"!=o||esBackground()||inicializaPapelera(),"function"==typeof aplicaMasonry&&(preloadImages(),aplicaMasonry()),cambiaIcono(),cambiaContador()}function compruebaBorrarImagen(e){if(e){var a=e.indexOf("https://www.noteboardapp.com/users/");a>-1&&borrarImagen(e.substring(a,e.indexOf(".",a+30)+4)),(a=e.indexOf("https://noteboardapp.s3.amazonaws.com/users/"))>-1&&borrarFicherosAws(e,!0)}}function esNotaWeb(e){return null!=localStorage["notaWeb"+e]}function notaPerteneceUrl(e,a){if(!localStorage["notaWeb"+e])return!1;var t=localStorage["notaWeb"+e].split("||");return t[0].endsWith("/*")?getHostFromUrl(t[0]).replace(/(^\w+:|^)\/\//,"")==getHostFromUrl(a).replace(/(^\w+:|^)\/\//,""):t[0].replace(/(^\w+:|^)\/\//,"")==a.replace(/(^\w+:|^)\/\//,"")}function urlDeNotaWeb(e){return localStorage["notaWeb"+e]?localStorage["notaWeb"+e].split("||")[0]:""}function algunaNotaWeb(){for(var e=0;e<localStorage.totalPost;e++)if("-999"==localStorage["tablon"+e])return!0;return!1}function getPosicionNotaWeb(e){if(localStorage["notaWeb"+e]){var a=localStorage["notaWeb"+e].split("||");return{x:a[1],y:a[2]}}}function setPosicionNotaWeb(e,a,t){if(localStorage["notaWeb"+e]){var o=localStorage["notaWeb"+e].split("||");o[1]=a,o[2]=t,localStorage["notaWeb"+e]=o.join("||")}}function setUrlNotaWeb(e,a){if(localStorage["notaWeb"+e]){var t=localStorage["notaWeb"+e].split("||");t[0]=a,localStorage["notaWeb"+e]=t.join("||")}}async function modificaNotaWeb(e){var a=e.numPost;e.width&&(localStorage["width"+a]=e.width),e.height&&!tieneNotaAlturaAuto(a)&&(localStorage["height"+a]=e.height),e.left&&setPosicionNotaWeb(a,e.left,e.top),e.url&&setUrlNotaWeb(a,e.url),isUserConnected()&&updateNotaLogin(a),await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})}async function borraNotaWeb(e){var a=e.numPost;localStorage["tablon"+a]=0;var t=new Date;idiomaEsp(navigator.language)?localStorage["fecha"+a]=t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear():localStorage["fecha"+a]=t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear(),isUserConnected()&&updateNotaLogin(a),await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})}async function adjuntaHtmlWeb(e){var a=e.numPost,t=e.html;localStorage["postit"+a]+="<br>"+compruebaVideos(t),"auto"==localStorage["width"+a]&&(localStorage["width"+a]=$("#postit"+a).width()),$("#postit"+a).remove(),isUserConnected()&&updateNotaLogin(a),getCalendarMail(a)&&crearRegistroMail(a),await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})}function cierraVentana(){setTimeout((function(){window.close()}),3e3)}function puntoEnPostit(e,a,t){var o=$("#postit"+e);if(!o.is(":visible"))return!1;var n=parseInt(localStorage["X"+e]),i=parseInt(localStorage["Y"+e]),r=o.width(),l=o.height();return n<=a&&a<=n+r&&i<=t&&t<=i+l}function webkitBrowser(){return navigator.userAgent.toLowerCase().indexOf("webkit")>-1}function elementoEncima(e,a){var t=e.height()||30,o=e.offset().top,n=e.offset().left,i=o+t,r=n+e.width(),l=a.offset().top,s=a.offset().left,c=l+a.height(),d=s+a.width();return!(i<l||o>c||r<s||n>d)}function inicializaTema(e){(e||"default"==localStorage.seleccionTema)&&$("body").removeClass("metal piedra marmol lava colorNegro colorGris colorBlanco colorAzul colorVerde"),localStorage.seleccionTema&&("colorGris"!=localStorage.seleccionTema||e)&&"default"!=localStorage.seleccionTema&&($("body").addClass(localStorage.seleccionTema),$(".paneles2").css({"background-position":"right top"}),"colorBlanco"==localStorage.seleccionTema&&$(".boardsSwitch").css("filter","invert(1)"))}function ponTooltipPaneles2(){$(".tabPaneles2").each((function(){var e=$(this).attr("id").substr(6);"+"!=e&&$(this).tooltipster({content:'<div class="contenedor-tablon-tooltip"><div class="borrar-tablon-tooltip" id="borraTabToo'+e+'"><img src="appimg/removeWhite.png"></div><canvas id="canvasTooltip'+e+'" class="canvas-tooltip" width="125" height="100"></canvas></div>',contentCloning:!1,contentAsHTML:!0,theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:100,functionReady:function(){dibujaMaqueta("canvasTooltip"+e,e,125,100),$("#canvasTooltip"+e).off().on("click",(function(){clickTablon(null,!1,e)})),$("#borraTabToo"+e).off().on("click",(function(){borraTablon(e)})),$(".borrar-tablon-tooltip").attr("title",chrome.i18n.getMessage("borraTablon"))},interactive:!0})}))}function compruebaNotasWeb(){if(!isChromeExtension())return!1;for(var e=!1,a=0;a<localStorage.totalPost;a++)if(esNotaWeb(a)){e=!0;break}e&&(document.URL.indexOf("popup.html")>0||document.URL.indexOf("options.html")>0?chrome.permissions.contains({permissions:["tabs"],origins:["http://*/*","https://*/*"]},(function(e){e||sweetAlert({text:chrome.i18n.getMessage("notasWebPermisos"),successCallback:function(){chrome.permissions.request({permissions:["tabs"],origins:["http://*/*","https://*/*"]},(function(e){e&&console.log("aceptado")}))},cancel:!1,type:"warning"})})):sendMessage({mensBack:"compruebaNotasWeb"}))}function checkOverflow(e){var a=e.style.overflow;a&&"visible"!==a||(e.style.overflow="hidden");var t=e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight;return e.style.overflow=a,t}function postitNoVisibleEntero(e){return checkOverflow(document.getElementById("texto"+e))}function compruebaPostitDebajoDeOtros(){"true"==localStorage["masonry"+tablonActual]&&0===$(".pinnedNB").length||$(".postitNB").each((function(){var e=parseInt($(this).attr("id").substr(6));x=parseInt(localStorage["X"+e]),y=parseInt(localStorage["Y"+e]),widthPost=$("#postit"+e).width(),heightPost=$("#postit"+e).height(),$(".postitNB").each((function(){var a=parseInt($(this).attr("id").substr(6));if(a!=e&&puntoEnPostit(a,x,y)&&puntoEnPostit(a,x+widthPost,y)&&puntoEnPostit(a,x,y+heightPost)&&puntoEnPostit(a,x+widthPost,y+heightPost)){var t=maxZindex();$("#postit"+e).css("z-index",t+1)}}))}))}function limpiaNombreTablon(e){return e.replace(/\\/g,"").replace(/\"/g,"")}function clearSelection(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){window.getSelection().removeAllRanges()}}function creaTablonTemporal(){$("#postits-temp").remove(),cambioTablon.sliding=!0;var e=$("#Postits"),a=$(".tablonPostits");cambioTablon.haciaDerecha?e.after('<div class="Postits" id="Postits" ></div>'):e.before('<div class="Postits" id="Postits" ></div>'),e.removeAttr("id").addClass("postits-temp").attr("id","postits-temp").removeClass("Postits"),cambioTablon.haciaDerecha?(e.css("overflow","auto"),e.width(window.innerWidth)):($("#Postits").css("overflow","auto"),e.width(window.innerWidth)),$("#Postits").width(window.innerWidth),a.width(a.width()+window.innerWidth),a.width(a.width()+window.innerWidth+100),$(".postitNB",e).removeAttr("id").removeClass("postitNB"),cambioTablon.haciaDerecha||$(window).scrollLeft(window.innerWidth)}function borraTablonTemporal(e){var a=cambioTablon.haciaDerecha?window.innerWidth:0;esTablonOrdenado()&&ajustaNotasYPadding(),$("html").animate({scrollLeft:a,scrollTop:0},800,(function(){$("#postits-temp").remove(),$(".tablonPostits").width($("#Postits").width()),$("#Postits").css("overflow","visible").width(window.innerWidth),detectColorContrastBackground().then((()=>{refreshConnections(),$(".columna").css("borderColor",defaultColorContrastBackground)})),cambioTablon.sliding=!1,compruebaLimites(),window.scrollTo(0,0),cambiaIcono(!0),compruebaCanvasPosEnMovil(100),$("#Postits").css("background-image",""),cambiaFondoNum(localStorage["fondo"+e])}))}function elementInViewport(e){for(var a=e.offsetTop,t=e.offsetLeft,o=e.offsetWidth,n=e.offsetHeight;e.offsetParent;)a+=(e=e.offsetParent).offsetTop,t+=e.offsetLeft;return a>=window.pageYOffset&&t>=window.pageXOffset&&a+n<=window.pageYOffset+window.innerHeight&&t+o<=window.pageXOffset+window.innerWidth}function compruebaMinimapa(){hideMinimapa?($("#canvasMaqueta").hide(),$("#maquetaPant").hide()):($("#canvasMaqueta").show(),$("#maquetaPant").show())}function actualizaNombreTablon(e){document.getElementById("nombreTablon")&&(e=e||tablonActual||localStorage.tablonActual,document.getElementById("nombreTablon").innerText=`${nombreTablon(e)} - ${cuentaNotas(e)}`)}function cuentaNotas(e){for(var a=0,t=0;t<localStorage.totalPost;t++)esNotaVisibleEnTablon(t,e)&&a++;return a}function checkMaxLocalStorage(){try{return localStorage.pruebaMaximoAlcanzado="test".repeat(100),localStorage.removeItem("pruebaMaximoAlcanzado"),!0}catch(e){return!1}}function getLocalStorageSize(){return JSON.stringify(localStorage).length}function guardaTextoEnNota(e,a){try{localStorage["postit"+e]=a}catch(e){getLocalStorageSize()+a.length>524e4&&sweetAlert({type:"error",text:chrome.i18n.getMessage("noMasEspacio")}),console.log(e)}}function detectColorBackground(e){var a=document.createElement("img"),t=document.getElementById("Postits"),o=t.currentStyle||window.getComputedStyle(t,!1);o.backgroundImage.indexOf("://")>-1&&-1==o.backgroundImage.indexOf("noise")?(a.src=o.backgroundImage.slice(4,-1).replace(/"/g,""),a.onload=function(){$.adaptiveBackground.run({selector:a,success:function(a,t){e(colourBrightness(t.color))}})}):e(colourBrightness(o.backgroundColor))}function colourBrightness(e){var a=e.substring(4,e.length-1).replace(/ /g,"").split(",");return Math.round((299*parseInt(a[0])+587*parseInt(a[1])+114*parseInt(a[2]))/1e3)>125?"#333":"white"}jQuery.fn.sortElements=function(){var e=[].sort;return function(a,t){t=t||function(){return this};var o=this.map((function(){var e=t.call(this),a=e.parentNode,o=a.insertBefore(document.createTextNode(""),e.nextSibling);return function(){if(a===this)throw new Error("You can't sort elements if any one is a descendant of another.");a.insertBefore(this,o),a.removeChild(o)}}));return e.call(this,a).each((function(e){o[e].call(t.call(this))}))}}();var defaultColorContrastBackground="#333";function detectColorContrastBackground(){let e;return e=new Promise(((e,a)=>{detectColorBackground((a=>{e(defaultColorContrastBackground=a)}))})),e}function getRandomNumber(e,a){return Math.floor(Math.random()*(a+1-e))+e}function iniLocalStorageCaptureData(){localStorage.removeItem("imageSave"),localStorage.removeItem("capturaPantalla"),localStorage.removeItem("capturaVideo")}function isUserConnected(){return"true"==localStorage.sincroLogin}function resizeWindow(e,a,t){isChromeExtension()?chrome.runtime.sendMessage({resizeWindow:{winId:e,width:a,height:t}}):window.resizeTo(a,t)}function getRandomNoteType(){return TIPOS_NOTAS_RANDOM[getRandomNumber(0,TIPOS_NOTAS_RANDOM.length-1)]}function esBackground(){return document.URL.indexOf("background")>0}function traduceLiteralesHtml(){document.querySelectorAll("[data-locale]").forEach((e=>{e.innerText=chrome.i18n.getMessage(e.dataset.locale)}))}function tieneNotaAlturaAuto(e){return"auto"==localStorage["height"+e]}function getAlturaNota(e){return tieneNotaAlturaAuto(e)?$("#postit"+e)?.height()||(()=>{const a=localStorage["postit"+e].length/2;return 300>a?300:a})():parseInt(localStorage["height"+e])}function restaurarMedidasAutoNota(e){$("#postit"+e).height("auto"),$("#texto"+e).css("maxHeight","calc(95vh - 90px)")}function getBoardNumberParam(){return new URL(window.location.href).searchParams.get("boardNumber")}function setNewTab(e,a){localStorage["new-tab"]=JSON.stringify({numTab:e,hideBar:a})}function getNewTab(){let e=!1;if(localStorage["new-tab"])try{e=JSON.parse(localStorage["new-tab"])}catch(e){console.log(e)}return e}function getGridData(){var e=!1;if(localStorage["grid-drag"])try{e={x:localStorage["grid-drag"].split("x")[0],y:localStorage["grid-drag"].split("x")[1]}}catch(e){console.log(e)}return e}function addNopubli(){$noPubli=$("#cansadoAnun"),$noPubli.length&&($noPubli.html(chrome.i18n.getMessage("quitaAnuncios")),$noPubli.on("click",(()=>muestraMensajeHaztePremium())))}function isWebNotesBoard(e=tablonActual){return-999==e}function isFunction(e){return!(!e||"function"!=typeof e)}function addScalable(){isMobile()&&document.querySelector("meta[name=viewport]").setAttribute("content","width=device-width, initial-scale=1, user-scalable=yes")}function removeScalable(){isMobile()&&document.querySelector("meta[name=viewport]").setAttribute("content","width=device-width, initial-scale=1, user-scalable=no")}function getHashUrl(e){return e.substr(e.indexOf("#")+1)}function getLocaleDate(e){if(!e)return;const a=e.split("-");return new Date(a[1]+"/"+a[0]+"/"+a[2]).toLocaleDateString(navigator.language,{year:"numeric",month:"long",day:"numeric"})}function topBarHasBoards(){return localStorage.showTabs===TOP_BAR.BOARDS}function isServiceWorker(){return"ServiceWorkerGlobalScope"in self&&self instanceof ServiceWorkerGlobalScope}var posCompartidas=new Array;function inicializaLocalStorage(){for(var e=1;e<=localStorage.numTablones;e++)localStorage.removeItem("tab"+e+"Label"),localStorage.removeItem("publico"+e),localStorage.removeItem("ordenTablon"+e),localStorage.removeItem("masonry"+e),localStorage.removeItem("tablonKanban"+e);var a=0;localStorage.removeItem("treeId10000");for(e=0;e<localStorage.totalPost;e++)esNotaCompartida(e)&&guardaPosCompartido(e),null==localStorage["errorConexion"+e]&&null!=localStorage["treeId"+e]||null==localStorage["postit"+e]||(null==localStorage["treeId"+e]&&(localStorage["errorConexion"+e]="create"),e>a&&(muevePostit(e,a),localStorage.removeItem("errorConexion"+e)),a++,clearInterval(intervalErrorConexion),intervalErrorConexion=setInterval(intentaConexion,1e4)),null!=localStorage["errorConexion"+e]&&e==a-1||(localStorage.removeItem("postit"+e),localStorage.removeItem("tablon"+e),localStorage.removeItem("tipoA"+e),localStorage.removeItem("X"+e),localStorage.removeItem("Y"+e),localStorage.removeItem("width"+e),localStorage.removeItem("height"+e),localStorage.removeItem("treeId"+e),localStorage.removeItem("fecha"+e),localStorage.removeItem("updated"+e),localStorage.removeItem("calendar"+e),localStorage.removeItem("sinMarco"+e),localStorage.removeItem("userComp"+e),localStorage.removeItem("nickComp"+e),localStorage.removeItem("rotacion"+e),localStorage.removeItem("pushpin"+e),localStorage.removeItem("notaWeb"+e),localStorage.removeItem("columnaKanban"+e),localStorage.removeItem("connections"+e),localStorage.removeItem("minimizado"+e));localStorage.totalPost=a}function muevePostit(e,a){localStorage["postit"+a]=localStorage["postit"+e],localStorage["tipoA"+a]=localStorage["tipoA"+e],localStorage["tablon"+a]=localStorage["tablon"+e],localStorage["X"+a]=localStorage["X"+e],localStorage["Y"+a]=localStorage["Y"+e],localStorage["width"+a]=localStorage["width"+e],localStorage["height"+a]=localStorage["height"+e],localStorage["treeId"+a]=localStorage["treeId"+e],localStorage["fecha"+a]=localStorage["fecha"+e],localStorage["updated"+a]=localStorage["updated"+e],localStorage["calendar"+a]=localStorage["calendar"+e],localStorage["sinMarco"+a]=localStorage["sinMarco"+e],null!=localStorage["userComp"+e]?(localStorage["userComp"+a]=localStorage["userComp"+e],localStorage["nickComp"+a]=localStorage["nickComp"+e]):(localStorage.removeItem("userComp"+a),localStorage.removeItem("nickComp"+a)),null!=localStorage["errorConexion"+e]?localStorage["errorConexion"+a]=localStorage["errorConexion"+e]:localStorage.removeItem("errorConexion"+a),null!=localStorage["rotacion"+e]?localStorage["rotacion"+a]=localStorage["rotacion"+e]:localStorage.removeItem("rotacion"+a),null!=localStorage["pushpin"+e]?localStorage["pushpin"+a]=localStorage["pushpin"+e]:localStorage.removeItem("pushpin"+a),null!=localStorage["notaWeb"+e]?localStorage["notaWeb"+a]=localStorage["notaWeb"+e]:localStorage.removeItem("notaWeb"+a),null!=localStorage["columnaKanban"+e]?localStorage["columnaKanban"+a]=localStorage["columnaKanban"+e]:localStorage.removeItem("columnaKanban"+a),null!=localStorage["connections"+e]?localStorage["connections"+a]=localStorage["connections"+e]:localStorage.removeItem("connections"+a),null!=localStorage["minimizado"+e]?localStorage["minimizado"+a]=localStorage["minimizado"+e]:localStorage.removeItem("minimizado"+a)}function obtenerNickPublico(){var e=getServerUrl()+"api/obtenNickPublico.php";e+="?id_usuario="+localStorage.id_usuario,$.ajax({type:"GET",url:e,cache:!1,success:function(e){var a=JSON.parse(e);a.isSuccess&&(localStorage.nickPublico=a.nickPublico)},error:function(e,a,t){console.log(a)}})}function logoutUsuario(){localStorage.removeItem("id_usuario"),localStorage.removeItem("token"),localStorage.removeItem("sincroLogin"),localStorage.removeItem("nick"),localStorage.removeItem("confirmado"),localStorage.removeItem("fbToken"),localStorage.removeItem("fbId"),localStorage.removeItem("googleId"),localStorage.sincroLogin=!1,document.getElementById("logoutForm").style.display="none",document.getElementById("loginForm").style.display="block"}function grabaNotaLogin(e){if(!isDemoUser(e)){if(e<1e4){"undefined"!=localStorage["tablon"+e]&&null!=localStorage["tablon"+e]||(localStorage["tablon"+e]=1),null!=localStorage["sinMarco"+e]&&"undefined"!=localStorage["sinMarco"+e]||(localStorage["sinMarco"+e]="false");var a={tipoA:localStorage["tipoA"+e],X:localStorage["X"+e],Y:localStorage["Y"+e],postit:localStorage["postit"+e],width:localStorage["width"+e],height:localStorage["height"+e],fecha:localStorage["fecha"+e],tablon:localStorage["tablon"+e],calendar:localStorage["calendar"+e],sinMarco:localStorage["sinMarco"+e],rotacion:localStorage["rotacion"+e],pushpin:localStorage["pushpin"+e],notaWeb:localStorage["notaWeb"+e],columnaKanban:localStorage["columnaKanban"+e],connections:localStorage["connections"+e],minimizado:localStorage["minimizado"+e]}}else{for(var t=new Array,o=new Array,n=new Array,i=new Array,r=new Array,l=new Array,s=1;s<=localStorage.numTablones;s++)null==localStorage["tab"+s+"Label"]&&(localStorage["tab"+s+"Label"]="undefined"),t.push(localStorage["tab"+s+"Label"]),o.push(localStorage["fondo"+s]),"true"==localStorage["publico"+s]?n.push(1):n.push(0),"true"==localStorage["masonry"+s]?r.push(1):r.push(0),i.push(ordenTablon(s)),localStorage["tablonKanban"+s]?l.push(localStorage["tablonKanban"+s]):l.push("");var c={tabLabels:t,tabBgs:o,tabPublico:n,tabOrden:i,tabMasonry:r,fuente:localStorage.fuente,size:localStorage.size,tabKanban:l};a={tipoA:TIPO_NOTA.TABLONES,X:0,Y:0,postit:JSON.stringify(c),width:0,height:0,rotacion:"",fecha:"",tablon:0,calendar:"",sinMarco:!1,pushpin:"",notaWeb:""}}var d="id_usuario="+localStorage.id_usuario;d+="&token="+localStorage.token,d+="&nota="+encodeURIComponent(JSON.stringify(a)),d+="&sid="+localStorage.sid,$.ajax({type:"POST",url:getServerUrl()+"api/createNote.php",data:d,cache:!1,success:function(t){var o=JSON.parse(t);o.isSuccess?(null!=localStorage["errorConexion"+e]&&(localStorage.removeItem("errorConexion"+e),e<1e4&&(localStorage.refrescaNota=e,sendMessage({mensBack:"refrescaNota"}))),localStorage["treeId"+e]=o.idNota,sendRealTime(e,{create:!0},localStorage["tablon"+e]),$("#postit"+e).length>0&&$("#postit"+e).attr("data-treeid",o.idNota),o.espacio&&(localStorage.espacio=o.espacio),1e4!=e||!registrando&&"true"!=localStorage.nuevoReg||(localStorage.removeItem("nuevoReg"),registrando=!1,chrome.tabs.create({url:GO_PREMIUM_URL+"?sessionId="+localStorage.sessionId}),modalInstance.close()),e<1e4&&localStorage["postit"+e].indexOf("data:image/")>0&&null!=o.postit&&(localStorage["postit"+e]=o.postit.replace(/<\/p>n<p>/gm,"</p>\n<p>"),refrescaNota(e))):(console.log("OK "+o.error),sendReportError(localStorage.id_usuario,e,encodeURIComponent(JSON.stringify(a))))},error:function(a,t,o){404===a.status?manageConnectionError(e,"create"):localStorage.removeItem("errorConexion"+e)}})}}function manageConnectionError(e,a,t=!0){esBackground()?errorConexion(e,a):(sendMessage({menstoBack:"errorConexion",numPost:e,operacion:a}),t&&muestraAyuda("mensErrorConexion"))}function updateNotaMemo(e){isUserConnected()&&updateNotaLoginMemo(e)}function updateNotaLoginMemo(e){e<1e4?(localStorage["updated"+e]="true",sendRealTime(e,localStorage["tablon"+e])):updateNotaLogin(e)}function updateNotaLogin(e){if(!isDemoUser(e)&&isUserConnected()){if("undefined"!=localStorage["tablon"+e]&&null!=localStorage["tablon"+e]||(localStorage["tablon"+e]=1),e<1e4){null!=localStorage["sinMarco"+e]&&"undefined"!=localStorage["sinMarco"+e]||(localStorage["sinMarco"+e]="false");var a={tipoA:localStorage["tipoA"+e],X:localStorage["X"+e],Y:localStorage["Y"+e],postit:localStorage["postit"+e],width:localStorage["width"+e],height:localStorage["height"+e],fecha:localStorage["fecha"+e],tablon:localStorage["tablon"+e],calendar:localStorage["calendar"+e],sinMarco:localStorage["sinMarco"+e],rotacion:localStorage["rotacion"+e],pushpin:localStorage["pushpin"+e],notaWeb:localStorage["notaWeb"+e],columnaKanban:localStorage["columnaKanban"+e],connections:localStorage["connections"+e],minimizado:localStorage["minimizado"+e]};sendRealTime(e,localStorage["tablon"+e])}else{for(var t=new Array,o=new Array,n=new Array,i=new Array,r=new Array,l=new Array,s=1;s<=localStorage.numTablones;s++)null==localStorage["tab"+s+"Label"]&&(localStorage["tab"+s+"Label"]="undefined"),t.push(localStorage["tab"+s+"Label"]),o.push(localStorage["fondo"+s]),"true"==localStorage["publico"+s]?n.push(1):n.push(0),"true"==localStorage["masonry"+s]?r.push(1):r.push(0),i.push(ordenTablon(s)),localStorage["tablonKanban"+s]?l.push(localStorage["tablonKanban"+s]):l.push("");var c={tabLabels:t,tabBgs:o,tabPublico:n,tabOrden:i,tabMasonry:r,fuente:localStorage.fuente,size:localStorage.size,tabKanban:l};a={tipoA:TIPO_NOTA.TABLONES,X:0,Y:0,postit:JSON.stringify(c),width:0,height:0,fecha:"",tablon:0,calendar:"",pushpin:"",sinMarco:!1}}if(localStorage["updated"+e]="false",null==localStorage["userComp"+e]||"R"==localStorage["userComp"+e])var d=localStorage.id_usuario,u="false";else d=localStorage["userComp"+e],u="true";var g="id_usuario="+d;g+="&token="+localStorage.token,g+="&id_nota="+localStorage["treeId"+e],g+="&nota="+encodeURIComponent(JSON.stringify(a)),g+="&sid="+localStorage.sid,g+="&compartido="+u,$.ajax({type:"POST",url:getServerUrl()+"api/updateNote.php",data:g,cache:!1,success:function(t){var o=JSON.parse(t);o.isSuccess?(o.espacio&&(localStorage.espacio=o.espacio),null!=localStorage["errorConexion"+e]&&(localStorage.removeItem("errorConexion"+e),e<1e4&&(localStorage.refrescaNota=e,sendMessage({mensBack:"refrescaNota"}))),e<1e4&&localStorage["postit"+e].indexOf("data:image/")>0&&null!=o.postit&&(localStorage["postit"+e]=o.postit.replace(/<\/p>n<p>/gm,"</p>\n<p>"),refrescaNota(e))):(console.log("OK "+o.error),sendReportError(localStorage.id_usuario,e,encodeURIComponent(JSON.stringify(a))))},error:function(a,t,o){404===a.status?manageConnectionError(e,"update"):localStorage.removeItem("errorConexion"+e)}})}}function deleteNoteLogin(e){if(!isDemoUser()){var a="id_usuario="+localStorage.id_usuario;a+="&token="+localStorage.token,a+="&id_nota="+localStorage["treeId"+e],a+="&sid="+localStorage.sid,$.ajax({type:"POST",url:getServerUrl()+"api/deleteNote.php",data:a,cache:!1,success:function(e){var a=JSON.parse(e);a.isSuccess?a.espacio&&(localStorage.espacio=a.espacio):console.log("OK "+a.error)},error:function(e,a,t){console.log(a)}})}}function borraListaNotas(e){if(!isDemoUser()){var a="id_usuario="+localStorage.id_usuario;a+="&token="+localStorage.token,a+="&listaNotas="+encodeURIComponent(JSON.stringify(e)),a+="&sid="+localStorage.sid,$.ajax({type:"POST",url:getServerUrl()+"api/deleteListNotes.php",data:a,cache:!1,success:function(e){var a=JSON.parse(e);a.isSuccess?a.espacio&&(localStorage.espacio=a.espacio):console.log("OK "+a.error)},error:function(e,a,t){console.log(a)}})}}function borrarImagen(e){var a="imgUrl="+encodeURIComponent(e);$.ajax({type:"POST",url:getServerUrl()+"api/deleteImage.php",data:a,cache:!1,success:function(e){if(!isUserConnected())try{restaEspacioServidor(JSON.parse(e).spaceFiles)}catch(e){console.log(e)}},error:function(e,a,t){console.log(a)}})}function borrarFicherosAws(e,a){if(e&&-1!=e.indexOf("noteboardapp")){var t="ficheros="+encodeURIComponent(e);$.ajax({type:"POST",url:getServerUrl()+"api/borraFichAws.php",data:t,cache:!1,success:function(e){if(a&&!isUserConnected())try{restaEspacioServidor(JSON.parse(e).spaceFiles)}catch(e){console.log(e)}}})}}let getNotesTry=0;async function sincronizaLogin(e,a,t){esBackground()&&!localStorage.id_usuario&&await getLocalStorage();var o=getServerUrl()+"api/getNotes2.php";const n=new URLSearchParams;n.append("id_usuario",localStorage.id_usuario),n.append("token",localStorage.token);try{n.append("stackTrace",(new Error).stack),n.append("getNotesTry",getNotesTry)}catch(e){console.log(e)}fetch(o,{method:"POST",cache:"no-cache",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n}).then((o=>{if(!o.ok)throw getNotesTry<3&&(getNotesTry++,setTimeout((function(){sincronizaLogin(e,a,t)}),1e4*getNotesTry)),new Error("Network response was not ok");return o.json()})).then((async function(o){getNotesTry=0;var n=o;n.isSuccess&&(localStorage.sid=n.sid,localStorage.confirmado=n.confirmado,localStorage.publicCount=n.publicCount,null!=n.invitaciones?recibeInvitaciones(n.invitaciones):localStorage.removeItem("invitaciones"),null!=n.invEnviadas?recibeInvEnviadas(n.invEnviadas):localStorage.removeItem("invEnviadas"),e?a&&"function"==typeof muestraPostit?cargaNotasAdd(n,a,t):(cargaNotasAdd(n,!1,t),esBackground()&&await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})):(inicializaLocalStorage(),cargaNotas(n,a,t),esBackground()&&await setAllLocalStorage(),sendMessage({mensBack:"muestraNotas"})),null!=n.comparticiones?recibeComparticiones(n.comparticiones):localStorage.removeItem("comparticiones"),vaciarPapelera({},30),compruebaPopups(),muestraPops(),!esBackground()&&($(".updateButton").is(":visible")||$("#progress").is(":visible")||$("#black_overlay-web-app").is(":visible"))&&(refrescaPantalla(!1,!0),refrescaOrdenacion(),$(".updateButton").find(".ajaxloader").remove()),esBackground()?(chrome.contextMenus.removeAll(initializeMenus),miraAgenda(),await setAllLocalStorage()):(sendMessage({menstoBack:"cambioMenu"}),muestraPaneles2(!1,!0),$("#black_overlay-web-app").fadeOut(400)),compruebaNotasWeb())})).catch((e=>{console.error("Error:",e)}))}function cargaNotas(e,a,t){var o=0;e.mail&&(localStorage.mail=e.mail),e.espacio&&(localStorage.espacio=e.espacio),e.premium&&(localStorage.premium=e.premium);let n=0;for(;e[n];){if(null!=e[n].postit)if(e[n].tipoA!=TIPO_NOTA.TABLONES){var i=localStorage.totalPost;localStorage["tipoA"+i]=e[n].tipoA,localStorage["X"+i]=e[n].X,localStorage["Y"+i]=e[n].Y,localStorage["postit"+i]=e[n].postit,localStorage["width"+i]=e[n].width,localStorage["height"+i]="0"==e[n].height?"auto":e[n].height,localStorage["fecha"+i]=e[n].fecha,localStorage["treeId"+i]=e[n].id_nota,localStorage["tablon"+i]=e[n].tablon,localStorage["calendar"+i]=e[n].calendar,localStorage["sinMarco"+i]="1"==e[n].sinMarco,e[n].rotacion&&(localStorage["rotacion"+i]=e[n].rotacion),e[n].pushpin&&(localStorage["pushpin"+i]=e[n].pushpin),e[n].notaWeb&&(localStorage["notaWeb"+i]=e[n].notaWeb),e[n].columnaKanban&&(localStorage["columnaKanban"+i]=e[n].columnaKanban),e[n].connections&&(localStorage["connections"+i]=e[n].connections),e[n].minimizado&&"0"!=e[n].minimizado&&(localStorage["minimizado"+i]="1"==e[n].minimizado),parseInt(e[n].tablon)>o&&"-999"!=e[n].tablon&&(o=parseInt(e[n].tablon)),null!=e[n].permisos&&("RW"==e[n].permisos?localStorage["userComp"+i]=e[n].userComp:localStorage["userComp"+i]="R",localStorage["nickComp"+i]=e[n].nickComp,recuperaPosCompartido(i)),localStorage.totalPost++}else{localStorage.treeId10000=e[n].id_nota;try{var r=JSON.parse(e[n].postit)}catch(a){try{r=JSON.parse(e[n].postit.replace("\\",""))}catch(e){console.log(e);r={tabLabels:[]}}}var l=r.tabLabels.length,s=localStorage.numTablones;if(null==localStorage.errorConexion10000||l>s){for(var c=1;c<=l;c++)localStorage["tab"+c+"Label"]=r.tabLabels[c-1],localStorage["fondo"+c]=r.tabBgs[c-1],null!=r.tabPublico&&1==r.tabPublico[c-1]?localStorage["publico"+c]="true":localStorage["publico"+c]="false",null!=r.tabMasonry&&1==r.tabMasonry[c-1]?localStorage["masonry"+c]="true":localStorage["masonry"+c]="false",null!=r.tabOrden&&(localStorage["ordenTablon"+c]=r.tabOrden[c-1]),null!=r.tabKanban&&r.tabKanban[c-1]&&"null"!=r.tabKanban[c-1]&&(localStorage["tablonKanban"+c]=r.tabKanban[c-1]);localStorage.removeItem("errorConexion10000")}else clearInterval(intervalErrorConexion),intervalErrorConexion=setInterval(intentaConexion,1e4),l=s;localStorage.numTablones=l}n++}if(o>localStorage.numTablones){for(var d=parseInt(localStorage.numTablones);d<o;d++)null!=localStorage["fondo"+(d+1)]&&"undefined"!=localStorage["fondo"+(d+1)]||(localStorage["fondo"+(d+1)]=0);localStorage.numTablones=o}a&&sendMessage({mensBack:"muestraNotas"}),t?muestraNotasAlCompartir():inicializaInvitaciones(),localStorage.totalPost>0&&(cambiaIcono(),cambiaContador()),("-999"!=localStorage.tablonActual||!algunaNotaWeb())&&parseInt(localStorage.tablonActual)>parseInt(localStorage.numTablones)&&(localStorage.tablonActual=localStorage.numTablones)}function cargaNotasAdd(e,a,t){for(var o=localStorage.totalPost,n=new Array,i=!1,r=0,l=0;l<o;l++)n[l]=!1;e.mail&&(localStorage.mail=e.mail),e.espacio&&(localStorage.espacio=e.espacio),e.premium&&(localStorage.premium=e.premium);let s=0;for(;e[s];){if(null!=e[s].postit)if(e[s].tipoA!=TIPO_NOTA.TABLONES){var c=!1;for(l=0;l<o;l++)localStorage["postit"+l]==e[s].postit&&(n[l]=!0,c=!0);if(!c){var d=localStorage.totalPost;localStorage["tipoA"+d]=e[s].tipoA,localStorage["X"+d]=e[s].X,localStorage["Y"+d]=e[s].Y,localStorage["postit"+d]=e[s].postit,localStorage["width"+d]=e[s].width,localStorage["height"+d]="0"==e[s].height?"auto":e[s].height,localStorage["fecha"+d]=e[s].fecha,localStorage["tablon"+d]=e[s].tablon,localStorage["treeId"+d]=e[s].id_nota,localStorage["calendar"+d]=e[s].calendar,localStorage["sinMarco"+d]="1"==e[s].sinMarco,e[s].rotacion&&(localStorage["rotacion"+d]=e[s].rotacion),e[s].pushpin&&(localStorage["pushpin"+d]=e[s].pushpin),e[s].notaWeb&&(localStorage["notaWeb"+d]=e[s].notaWeb),e[s].columnaKanban&&(localStorage["columnaKanban"+d]=e[s].columnaKanban),e[s].connections&&(localStorage["connections"+d]=e[s].connections),e[s].minimizado&&"0"!=e[s].minimizado&&(localStorage["minimizado"+d]="1"==e[s].minimizado),parseInt(e[s].tablon)>r&&"-999"!=e[s].tablon&&(r=parseInt(e[s].tablon)),null!=e[s].permisos&&("RW"==e[s].permisos?localStorage["userComp"+d]=e[s].userComp:localStorage["userComp"+d]="R",localStorage["nickComp"+d]=e[s].nickComp,recuperaPosCompartido(d)),localStorage.totalPost++,a&&muestraPostit(d)}}else{localStorage.treeId10000=e[s].id_nota;try{var u=JSON.parse(e[s].postit)}catch(a){try{u=JSON.parse(e[s].postit.replace("\\",""))}catch(e){console.log(e);u={tabLabels:[]}}}var g=u.tabLabels.length,p=localStorage.numTablones;if(null==localStorage.errorConexion10000||g>p){for(var m=1;m<=g;m++)localStorage["tab"+m+"Label"]=u.tabLabels[m-1],localStorage["fondo"+m]=u.tabBgs[m-1],null!=u.tabPublico&&1==u.tabPublico[m-1]?localStorage["publico"+m]="true":localStorage["publico"+m]="false",null!=u.tabMasonry&&1==u.tabMasonry[m-1]?localStorage["masonry"+m]="true":localStorage["masonry"+m]="false",null!=u.tabOrden&&(localStorage["ordenTablon"+m]=u.tabOrden[m-1]),null!=u.tabKanban&&u.tabKanban[m-1]&&"null"!=u.tabKanban[m-1]&&(localStorage["tablonKanban"+m]=u.tabKanban[m-1]);localStorage.removeItem("errorConexion10000")}else clearInterval(intervalErrorConexion),intervalErrorConexion=setInterval(intentaConexion,1e4),g=p;(null==localStorage.numTablones||g>localStorage.numTablones)&&(localStorage.numTablones=g),i=!0}s++}if(localStorage.totalPost>0&&(cambiaIcono(),cambiaContador()),r>localStorage.numTablones){for(l=parseInt(localStorage.numTablones);l<r;l++)null!=localStorage["fondo"+(l+1)]&&"undefined"!=localStorage["fondo"+(l+1)]||(localStorage["fondo"+(l+1)]=0);localStorage.numTablones=r}addNotasNuevas(n,o,i),inicializaInvitaciones(),esTabCompartido(localStorage.tablonActual)?trataTablonComp():inicializaFriendsBot(),a&&refrescaPantalla(!1,!0)}function addNotasNuevas(e,a,t){if(!isDemoUser()){for(var o=new Array,n=0,i=0;i<a;i++)if(!e[i]){"undefined"!=localStorage["tablon"+i]&&null!=localStorage["tablon"+i]||(localStorage["tablon"+i]=1),null!=localStorage["sinMarco"+i]&&"undefined"!=localStorage["sinMarco"+i]||(localStorage["sinMarco"+i]="false");var r={tipoA:localStorage["tipoA"+i],X:localStorage["X"+i],Y:localStorage["Y"+i],postit:localStorage["postit"+i],width:localStorage["width"+i],height:localStorage["height"+i],fecha:localStorage["fecha"+i],tablon:localStorage["tablon"+i],calendar:localStorage["calendar"+i],sinMarco:localStorage["sinMarco"+i],rotacion:localStorage["rotacion"+i],pushpin:localStorage["pushpin"+i],notaWeb:localStorage["notaWeb"+i],columnaKanban:localStorage["columnaKanban"+i],connections:localStorage["connections"+i],minimizado:localStorage["minimizado"+i]};localStorage["updated"+i]="false",o[n]=r,n++}if(n>0){var l="id_usuario="+localStorage.id_usuario;l+="&token="+localStorage.token,l+="&listaNotas="+encodeURIComponent(JSON.stringify(o)),numIntentos=0,llamadaCreate(l,e,a,t)}else t?updateNotaLoginMemo(1e4):grabaNotaLogin(1e4)}}var numIntentos,numIntentosMod;function llamadaCreate(e,a,t,o){$.ajax({type:"POST",url:getServerUrl()+"api/createListNotes.php",data:e,cache:!1,success:function(e){var n=JSON.parse(e),i=0;if(n.isSuccess){n.espacio&&(localStorage.espacio=n.espacio);for(var r=0;r<t;r++)a[r]||(localStorage["treeId"+r]=n.idNota[i],addTreeIdPopup(n.idNota[i],r),addTreeIdConnection(n.idNota[i],r),addTreeIdKanban(n.idNota[i],r),$("#postit"+r).attr("data-treeId",n.idNota[i]),localStorage["postit"+r].indexOf("data:image/")>0&&null!=n.postit[i]&&(localStorage["postit"+r]=n.postit[i].replace(/<\/p>n<p>/gm,"</p>\n<p>"),refrescaNota(r)),i++);o?updateNotaLoginMemo(1e4):grabaNotaLogin(1e4)}else localStorage.sincroLogin=!1},error:function(e,o,n){console.log("Error llamadaCreate");for(var i=0;i<t;i++)a[i]||(manageConnectionError(i,"create",!1),errorConexion(i,"create"));muestraAyuda("mensErrorConexion")}})}function grabaModificaciones(){if(!isDemoUser()){for(var e=new Array,a=!1,t=0,o=0;o<localStorage.totalPost;o++)if("true"==localStorage["updated"+o]){if(a=!0,"undefined"!=localStorage["tablon"+o]&&null!=localStorage["tablon"+o]||(localStorage["tablon"+o]=1),null==localStorage["userComp"+o]||"R"==localStorage["userComp"+o])var n=localStorage.id_usuario;else n=localStorage["userComp"+o];null!=localStorage["sinMarco"+o]&&"undefined"!=localStorage["sinMarco"+o]||(localStorage["sinMarco"+o]="false");var i={id_nota:localStorage["treeId"+o],tipoA:localStorage["tipoA"+o],X:localStorage["X"+o],Y:localStorage["Y"+o],postit:localStorage["postit"+o],width:localStorage["width"+o],height:localStorage["height"+o],fecha:localStorage["fecha"+o],tablon:localStorage["tablon"+o],calendar:localStorage["calendar"+o],sinMarco:localStorage["sinMarco"+o],rotacion:localStorage["rotacion"+o],pushpin:localStorage["pushpin"+o],usuario:n,notaWeb:localStorage["notaWeb"+o],columnaKanban:localStorage["columnaKanban"+o],connections:localStorage["connections"+o],minimizado:localStorage["minimizado"+o]};localStorage["updated"+o]="false",e[t]=i,t++}if("true"==localStorage.updated10000){var r=new Array,l=new Array,s=new Array,c=new Array,d=new Array,u=new Array;for(o=1;o<=localStorage.numTablones;o++)null==localStorage["tab"+o+"Label"]&&(localStorage["tab"+o+"Label"]="undefined"),r.push(localStorage["tab"+o+"Label"]),l.push(localStorage["fondo"+o]),"true"==localStorage["publico"+o]?s.push(1):s.push(0),"true"==localStorage["masonry"+o]?d.push(1):d.push(0),c.push(ordenTablon(o)),localStorage["tablonKanban"+o]?u.push(localStorage["tablonKanban"+o]):u.push("");var g={tabLabels:r,tabBgs:l,tabPublico:s,tabOrden:c,tabMasonry:d,fuente:localStorage.fuente,size:localStorage.size,tabKanban:u};i={id_nota:localStorage.treeId10000,tipoA:TIPO_NOTA.TABLONES,X:0,Y:0,rotacion:"",postit:JSON.stringify(g),width:0,height:0,fecha:"",tablon:0,calendar:"",pushpin:"",sinMarco:!1,usuario:localStorage.id_usuario};e[t]=i,a=!0,localStorage.updated10000="false"}if(a){var p="id_usuario="+localStorage.id_usuario;p+="&token="+localStorage.token,p+="&listaNotas="+encodeURIComponent(JSON.stringify(e)),p+="&sid="+localStorage.sid,numIntentosMod=0,llamadaUpdate(p)}}}function llamadaUpdate(e){$.ajax({type:"POST",url:getServerUrl()+"api/updateListNotes4.php",data:e,cache:!1,success:function(e){var a=JSON.parse(e);a.isSuccess||console.log("Error:  "+a.error)},error:function(a,t,o){console.log(a),console.log("Error UpdateList"),++numIntentosMod<8?(console.log("Intento otra vez..."+numIntentosMod),setTimeout((function(){llamadaUpdate(e)}),1e4)):console.log("No quedan intentos, mala suerte")}})}function sendReportError(e,a,t){var o="id_usuario="+e;o+="&numPost="+a,o+="&nota="+t,o+="&localStorage="+escape(JSON.stringify(localStorage)),o+="&navigator="+encodeURIComponent(navigator.userAgent+"-"+navigator.platform+"-"+navigator.cookieEnabled+"-"+navigator.language),o+="&origen=extensión",$.ajax({type:"POST",url:getServerUrl()+"api/sendReport.php",data:o,cache:!1,success:function(e){},error:function(e,a,t){console.log(a)}})}function sendReportErrorGetNotes(){var e="stackTrace="+(new Error).stack;e+="&version="+chrome.runtime.getManifest().version,e+="&navigator="+encodeURIComponent(navigator.userAgent+"-"+navigator.platform+"-"+navigator.cookieEnabled+"-"+navigator.language),e+="&origen=extensión",$.ajax({type:"POST",url:getServerUrl()+"api/sendReportTrace.php",data:e,cache:!1,success:function(e){},error:function(e,a,t){console.log(a)}})}var intervalErrorConexion=0;function errorConexion(e,a){null==localStorage["errorConexion"+e]&&(localStorage["errorConexion"+e]=a,localStorage.refrescaNota=e,sendMessage({mensBack:"refrescaNota"}),clearInterval(intervalErrorConexion),intervalErrorConexion=setInterval(intentaConexion,1e4))}function intentaConexion(){var e=!1;if(isUserConnected()){for(var a=0;a<localStorage.totalPost;a++)e=reintentarSiError(a)||e;(e=reintentarSiError(1e4)||e)||clearInterval(intervalErrorConexion)}else clearInterval(intervalErrorConexion)}function reintentarSiError(e){var a=!1;if(null!=localStorage["errorConexion"+e])switch(a=!0,localStorage["errorConexion"+e]){case"create":grabaNotaLogin(e);break;case"update":e<1e4&&yaExisteNota(e)?grabaNotaLogin(e):updateNotaLogin(e)}return a}function yaExisteNota(e){for(var a=localStorage["treeId"+e],t=0;t<localStorage.totalPost;t++)if(a==localStorage["treeId"+t]&&t!=e)return!0;return!1}function esPopup(){return document.URL.indexOf("popup2.")>-1}function esPopupNotaWeb(){return document.URL.indexOf("popup2.")>-1&&document.URL.indexOf("abreEditando=true")>-1}function numeroNota(){return document.URL.indexOf("&")>-1?document.URL.substring(document.URL.indexOf("?numPost")+9,document.URL.indexOf("&")):document.URL.substr(document.URL.indexOf("?numPost")+9)}function abreEditando(){return document.URL.indexOf("abreEditando=true")>-1}function notaWeb(){return document.URL.indexOf("notaWeb=true")>-1}function nuevaNota(){return document.URL.indexOf("nuevaNota=true")>-1}function paramUrl(){return document.URL.indexOf("url=")>-1?document.URL.substring(document.URL.indexOf("url=")+4):""}function getHostFromUrl(e){try{const a=new URL(e);return`${a.protocol}//${a.hostname}/`}catch(a){return console.log(a),e}}function paramTabId(){return document.URL.indexOf("tabId=")>-1?document.URL.substring(document.URL.indexOf("tabId=")+6,document.URL.lastIndexOf("&")):""}async function creaPopupNota(e,a,t,o,n,i,r,l,s,c,d){esBackground()&&await getLocalStorage(),document.URL.indexOf("popup.html")>-1&&webkitBrowser()&&chrome.permissions.request({permissions:["background"]});var u=existePopup(e);if(a&&u)a&&chrome.windows.update(u,{drawAttention:!0});else{if(i=i||200,r=r||200,t=t||!1,o=o||!1,n=n||!1,c=c||0,d=d||"",l&&s)var g=l,p=s;else{if($("#postit"+e)?.length>0)var m=$("#postit"+e).width()+10,h=$("#postit"+e).height()+40;else m="auto"!=localStorage["width"+e]?parseInt(localStorage["width"+e]):450,h=getAlturaNota(e);if("true"==localStorage["sinMarco"+e])g=Math.round(m),p=Math.round(h-5);else g=Math.round(m+24),p=Math.round(h+50)}if(i=parseInt(i),r=parseInt(r),screen.height&&p>screen.height&&(p=screen.height-100),localStorage["treeId"+e]&&"undefined"!=localStorage["treeId"+e])var b=localStorage["treeId"+e];else b=0;var f={url:chrome.runtime.getURL("popup2.html?numPost="+e+"&abreEditando="+t+"&notaWeb="+o+"&nuevaNota="+n+"&tabId="+c+"&url="+d),top:i,left:r,width:g,height:p,type:"popup"};chrome.windows.create(f,(function(t){if(isChromeExtension()){if(t.height=500,localStorage.popups)var n=JSON.parse(localStorage.popups);else n=new Array;n.push({winId:t.id,numPost:e,width:g,height:p,X:r,Y:i,treeId:b,notaWeb:o,tabId:c}),localStorage.popups=JSON.stringify(n),a&&chrome.windows.update(t.id,{drawAttention:!0}),esBackground()&&setLocalStorage(["popups"])}}))}}function muestraPops(){chrome.windows.getAll((function(e){if(localStorage.popups)for(var a=JSON.parse(localStorage.popups),t=0;t<a.length;t++)if(-1==JSON.stringify(e).indexOf('"id":'+a[t].winId)){var o={url:chrome.runtime.getURL("popup2.html?numPost="+a[t].numPost),top:a[t].Y,left:a[t].X,width:a[t].width,height:a[t].height,type:"popup"};!function(e){chrome.windows.create(o,(async function(a){var t=JSON.parse(localStorage.popups);t[e].winId=a.id,localStorage.popups=JSON.stringify(t),esBackground()&&await setLocalStorage(["popups"])}))}(t)}}))}function borraPopupConfirmado(e){if(localStorage.popups){for(var a=JSON.parse(localStorage.popups),t=new Array,o=0;o<a.length;o++)a[o].numPost==e&&(t.push(o),sendMessage({unpopup:"unpopup",winId:a[o].winId})),a[o]&&a[o].numPost>e&&a[o].numPost--;for(o=0;o<t.length;o++)a.splice(t[o],1);localStorage.popups=JSON.stringify(a)}}function borraPopupWindow(e){if(localStorage.popups)for(var a=JSON.parse(localStorage.popups),t=0;t<a.length;t++)if(a[t].winId==e)return a[t].notaWeb&&a[t].tabId&&chrome.tabs.sendMessage(a[t].tabId,{muestraNotas:"muestraNotas"}),a.splice(t,1),localStorage.popups=JSON.stringify(a),void setLocalStorage(["popups"])}function compruebaPopups(){if(localStorage.popups){for(var e=JSON.parse(localStorage.popups),a=new Array,t=0;t<e.length;t++)if(0!=e[t].treeId&&e[t].treeId!=localStorage["treeId"+e[t].numPost]){for(var o=0;o<localStorage.totalPost&&e[t].treeId!=localStorage["treeId"+o];)o++;e[t].treeId==localStorage["treeId"+o]?e[t].numPost=o:(a.push(t),chrome.windows.remove(e[t].winId))}for(t=0;t<a.length;t++)e.splice(a[t],1);localStorage.popups=JSON.stringify(e)}}function addTreeIdPopup(e,a){if(localStorage.popups){for(var t=JSON.parse(localStorage.popups),o=0;o<t.length;o++)t[o].numPost==a&&(t[o].treeId=e);localStorage.popups=JSON.stringify(t)}}function getPopupData(e){if(isChromeExtension()){if(!localStorage.popups)return{width:0,height:0};for(var a=JSON.parse(localStorage.popups),t=0;t<a.length;t++)if(a[t].winId==e)return{width:a[t].width,height:a[t].height,X:a[t].X,Y:a[t].Y}}return{width:window.innerWidth,height:window.innerHeight,X:window.screenX,Y:window.screenY}}function setPopupPos(e,a,t){if(localStorage.popups)for(var o=JSON.parse(localStorage.popups),n=0;n<o.length;n++)if(o[n].winId==e)return o[n].X=a,o[n].Y=t,void(localStorage.popups=JSON.stringify(o))}function setPopupSize(e,a,t){if(localStorage.popups)for(var o=JSON.parse(localStorage.popups),n=0;n<o.length;n++)if(o[n].winId==e)return o[n].width=a,o[n].height=t,void(localStorage.popups=JSON.stringify(o))}function existePopup(e){if(!localStorage.popups)return!1;for(var a=JSON.parse(localStorage.popups),t=0;t<a.length;t++)if(a[t].numPost==e)return a[t].winId;return!1}const KB=1024,MB=1048576,GO_PREMIUM_URL="https://www.noteboardapp.com/subscribe",PREVIOUS_PREMIUM_USER_CODE="1",PREMIUM_USER_CODE="2",MAX_BOARDS_ALLOWED=7,MAX_USER_SPACE={FREE:50*MB,PRE_PREMIUM:100*MB,PREMIUM:300*MB},EXT_DEV_URL="ajadj/popup.html#premium";function isPrePremiumUser(){return"1"===localStorage.premium}function isNewPremiumUser(){return"2"===localStorage.premium}function isPremiumUser(){return isPrePremiumUser()||isNewPremiumUser()||isDevUser()}function setPremiumUser(){localStorage.premium="2"}function isDevUser(){return document.URL.includes(EXT_DEV_URL)}function getMaxUSerSpace(){var e=MAX_USER_SPACE.FREE;return(isPrePremiumUser()||isDevUser())&&(e=MAX_USER_SPACE.PRE_PREMIUM),isNewPremiumUser()&&(e=MAX_USER_SPACE.PREMIUM),e}function getMaxUSerSpaceKB(){return parseInt(getMaxUSerSpace()/KB)}function getMaxUSerSpaceMB(){return parseInt(getMaxUSerSpace()/MB)}function getUserSpacePercent(){var e=localStorage.espacio||0;return parseInt(e)/getMaxUSerSpace()}function getUserSpaceKb(){if(!localStorage.espacio)return 0;var e=parseInt(localStorage.espacio);return Number.isInteger(e)||(localStorage.removeItem("espacio"),e=0,calculaEspacioUsuarioLocal()),parseInt(e/KB)}function getUserSpaceKbMB(){var e=getUserSpaceKb();return e>KB?parseFloat(e/KB).toFixed(2):e+" Kb"}function userHasSpace(){return getUserSpaceKb()<=getMaxUSerSpaceKB()}function muestraMensajeNohayEspacio(){sweetAlert({text:chrome.i18n.getMessage("noMoreSpace"),confirmText:chrome.i18n.getMessage("goPremium"),cancelText:chrome.i18n.getMessage("cancelar"),successCallback:()=>{window.open(GO_PREMIUM_URL,"_blank")},type:"info"}),localStorage.removeItem("muestraEspacio")}function muestraMensajeHaztePremium(e){sweetAlert({text:e||chrome.i18n.getMessage("opcionPremium"),confirmText:chrome.i18n.getMessage("goPremium"),cancelText:chrome.i18n.getMessage("cancelar"),successCallback:()=>{window.open(GO_PREMIUM_URL,"_blank")},type:"info"})}function getPremiumRibbon(){return isPremiumUser()?'\n    <div class="ribbon-wrap">\n      <span class="ribbon">PREMIUM</span>\n    </div>\n  ':`\n    <div class="ribbon-wrap">\n      <a href="${GO_PREMIUM_URL}" title="${chrome.i18n.getMessage("haztePremium")}"><span class="ribbon">PREMIUM</span></a>\n    </div>\n  `}function calculaEspacioUsuarioLocal(){chrome.permissions.contains({origins:["http://www.noteboardapp.com/"]},(function(e){if(e){for(var a=[],t=0;t<localStorage.totalPost;t++)a.push(localStorage["postit"+t]);for(t=1;t<=localStorage.numTablones;t++)localStorage["fondo"+t].indexOf("http")>-1&&a.push(localStorage["fondo"+t]);var o="listaNotas="+encodeURIComponent(JSON.stringify(a));$.ajax({type:"POST",url:getServerUrl()+"api/getUserFilesSpace.php",data:o,cache:!1,success:function(e){localStorage.espacio=JSON.parse(e).size},error:function(e,a,t){console.log(e)}})}}))}function sumaEspacioServidor(e){localStorage.espacio?localStorage.espacio=parseInt(localStorage.espacio)+e:localStorage.espacio=e}function restaEspacioServidor(e){localStorage.espacio?localStorage.espacio=parseInt(localStorage.espacio)-e:localStorage.espacio=0,parseInt(localStorage.espacio)<0&&localStorage.removeItem("espacio")}async function getPremiumSubscriptionHtml(){var e="";if(isNewPremiumUser())try{var a=await getPremiumSubscriptionData();a.subscription&&(idiomaEsp(navigator.language)?(e=a.subsCancelled?"<h3>Usuario Premium activo</h3>":`\n              <h3>Subscripción ${"M"==a.subsType?"mensual":"anual"} activa</h3>\n            `,e+=`\n            <div><span class="titulo-tabla-subs">Fecha inicio: </span>${a.subsIniDate}</div>\n          `,a.subsCancelled?e+=`\n              <div><span class="titulo-tabla-subs">Fecha fin: </span>${a.subsEndDate}</div>\n              <p><b>Subscripción anulada</b> el dia ${a.subsCancelDate}, no se cobrarán más pagos.<br>La cuenta Premium seguirá activa hasta el dia ${a.subsEndDate}.</p>\n            `:(e+=`<div><span class='titulo-tabla-subs'>Fecha próximo pago: </span>${a.subsEndDate}</div>`,a.subsPayment&&(e+=`<div><span class='titulo-tabla-subs'>Importe próximo pago: </span>${a.subsPayment} ${a.qurrencySign}</div>`),a.stripe?e+="<p>Puedes anular la subscripción en cualquier momento con el siguiente botón que te llevará a una pantalla de Stripe para gestionar tu subscripción o tus datos de pago. Tu cuenta seguirá siendo Premium hasta que finalice el periodo pagado</p>\n              <button class='waves-effect waves-light red btn manage-stripe' type='submit' id='buttonUnsubscribeCard'>\n                <i class=\"medium material-icons\">credit_card</i>\n                <span>Anular subscripción</span>\n              </button>":e+="<p>Puedes anular la subscripción en cualquier momento con el siguiente botón que te llevará a tu cuenta de Paypal. Tu cuenta seguirá siendo Premium hasta que finalice el periodo pagado</p>\n                <button class='waves-effect waves-light red btn' type='submit' id='buttonUnsubscribe'><span>Anular subscripción</span></button>")):(e=a.subsCancelled?"<h3>Premium user active</h3>":`\n              <h3>Active ${"M"==a.subsType?"monthly":"annual"} subscription</h3>\n            `,e+=`\n            <div><span class="titulo-tabla-subs">Start date: </span>${a.subsIniDate}</div>\n          `,a.subsCancelled?e+=`\n              <div><span class="titulo-tabla-subs">End date: </span>${a.subsEndDate}</div>\n              <p>Subscription canceled the day ${a.subsCancelDate}, no more payments will be collected.<br>The Premium account will remain active until the day ${a.subsEndDate}.</p>\n            `:(e+=`<div><span class='titulo-tabla-subs'>Next payment date: </span>${a.subsEndDate}</div>`,a.subsPayment&&(e+=`<div><span class='titulo-tabla-subs'>Next payment amount: </span>${a.subsPayment} ${a.qurrencySign}</div>`),a.stripe?e+="<p>You can unsubscribe at any time with the following button that will take you to a Stripe screen to manage your subscription or your payment details. Your account will remain Premium until the paid period ends</p>\n              <button class='waves-effect waves-light red btn manage-stripe' type='submit' id='buttonUnsubscribeCard'>\n                <i class=\"medium material-icons\">credit_card</i>\n                <span>Manage subscription</span>\n              </button>":e+="<p>You can unsubscribe at any time with the following button that will take you to your Paypal account. Your account will remain Premium until the paid period ends</p>\n              <button class='waves-effect waves-light red btn' type='submit' id='buttonUnsubscribe'><span>Unsubscribe</span></button>")))}catch(e){console.log(e)}else e=idiomaEsp(navigator.language)?"\n        <h3>Subscripción no activa</h3>\n        <button class='waves-effect waves-light green btn subscribe-info' type='button'><span><a href=\"https://www.noteboardapp.com/subscribe\" target=\"_blank\">Ver ventajas con subscripción</a></span></button>\n      ":"\n        <h3>Subscription not active</h3>\n        <button class='waves-effect waves-light green btn subscribe-info' type='button'><span><a href=\"https://www.noteboardapp.com/subscribe\" target=\"_blank\">See benefits with subscription</a></span></button>\n      ";return e}function getPremiumSubscriptionData(){return new Promise(((e,a)=>{var t="id_usuario="+localStorage.id_usuario;t+="&token="+localStorage.token,$.ajax({type:"GET",url:getServerUrl()+"api/getUserSubscription.php",data:t,cache:!1,success:function(a){const t=JSON.parse(a);t.subsIniDate=getLocaleDate(t.subsIniDate),t.subsEndDate=getLocaleDate(t.subsEndDate),t.subsCancelDate=getLocaleDate(t.subsCancelDate),e(t)},error:function(e,t,o){console.log(e),a()}})}))}function addBoardPremiumAllowed(){const e=isAddBoardPremiumAllowed();return!e&&muestraMensajeHaztePremium(chrome.i18n.getMessage("tablonesPremium")),e}function isAddBoardPremiumAllowed(){return isPremiumUser()||parseInt(localStorage.numTablones)<7}function gotoManageStripe(){$("#buttonUnsubscribeCard i").addClass("loader");var e="id_usuario="+localStorage.id_usuario;e+="&token="+localStorage.token,$.ajax({type:"POST",url:"https://www.noteboardapp.com/creditcard/createCustomerPortal.php",data:e,cache:!1,success:function(e){resp=JSON.parse(e),chrome.tabs.create({url:resp.url})},error:function(e,a,t){console.log(a)},complete:function(){$("#buttonUnsubscribeCard i").removeClass("loader")}})}function compruebaVideos(e){return e.indexOf("link-upload-file")>-1||"false"==localStorage.automaticEmbed?e:(e.indexOf("youtube.com/watch")>-1&&(e=transformYoutubeLinks(e)),-1==(e=convert_vimeo(e=convert_twitch(e=convert_video_url(e)))).indexOf("<iframe")&&(e=e.replace(/(https?:\/\/\S*?\.pdf)/g,'<iframe src="$1" width="500" height="400"></iframe>')),e=e.replace(new RegExp('src="//',"g"),'src="https://'))}function convert_Amazon(e){for(var a,t=0,o=0,n=0;e.indexOf('<a href="https://www.amazon.com',n)>-1&&-1==e.indexOf("tag=",n+10)&&t<10;)t++,o=e.indexOf('<a href="https://www.amazon.com',n),n=e.indexOf('"',o+27),a=e.substring(o,n),e=a.indexOf("?")>-1?e.substring(0,n)+"&tag=notboa-20"+e.substring(n):e.substring(0,n)+"?tag=notboa-20"+e.substring(n);for(t=0,n=0;e.indexOf('<a href="https://www.amazon.es',n)>-1&&-1==e.indexOf("tag=",n+10)&&t<10;)t++,o=e.indexOf('<a href="https://www.amazon.es',n),n=e.indexOf('"',o+27),a=e.substring(o,n),e=a.indexOf("?")>-1?e.substring(0,n)+"&tag=notboa-21"+e.substring(n):e.substring(0,n)+"?tag=notboa-21"+e.substring(n);for(t=0,n=0;e.indexOf('<a href="https://www.amazon.co.uk',n)>-1&&-1==e.indexOf("tag=",n+10)&&t<10;)t++,o=e.indexOf('<a href="https://www.amazon.co.uk',n),n=e.indexOf('"',o+27),a=e.substring(o,n),e=a.indexOf("?")>-1?e.substring(0,n)+"&tag=wwwnoteboarda-21"+e.substring(n):e.substring(0,n)+"?tag=wwwnoteboarda-21"+e.substring(n);return e}function createYoutubeEmbed(e){return'<iframe width="420" height="345" src="https://www.youtube.com/embed/'+e+'" frameborder="0" allowfullscreen></iframe><br/>'}function transformYoutubeLinks(e){if(!e)return e;const a=this,t=/(?:)<a([^>]+)>(.+?)<\/a>/g,o=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([^& \n<]+)(?:[^ \n<]+)?/g;let n=e;const i=e.match(/(https?:\/\/)?(www\.)?(youtube\.com\/watch\?v=|youtu\.be\/)([^& \n<]+)(?:[^ \n<]+)?/g);if(i&&i.length>0){const l=e.match(t);if(l&&l.length>0)for(var r=0;r<l.length;r++)n=n.replace(l[r],"#placeholder"+r+"#");for(r=0;r<i.length;r++){let e=i[r].split(o);n=n.replace(i[r],a.createYoutubeEmbed(e[1]))}if(l&&l.length>0)for(r=0;r<l.length;r++)n=n.replace("#placeholder"+r+"#",l[r])}return n}function convert_vimeo(e){var a=/(?:http?s?:\/\/)?(?:www\.)?(?:vimeo\.com)\/?(\S+)/g;if(a.test(e))e=e.replace(a,'<iframe width="420" height="345" src="https://player.vimeo.com/video/$1" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>');return e}function convert_twitch(e){var a=/(?:http?s?:\/\/)?(?:www\.)?(?:twitch\.tv)\/?(\S+)/g;if(a.test(e))e=e.replace(a,'<iframe src="https://player.twitch.tv/?channel=$1&!autoplay" frameborder="0" allowfullscreen="true" scrolling="no" height="378" width="620"></iframe>');return e}function convert_video_url(e){var a=/([-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?(?:webm|mp4|ogv))/gi;if(a.test(e)&&-1===e.indexOf("<video"))e=e.replace(a,'<video controls="" loop="" controls src="$1" width="100%" height="350"></video>');return e}function iframeWidth(e){var a=0;return $("#texto"+e+" iframe").each((function(){var e=$(this).attr("src");null!=e&&(e.indexOf("youtube.com/embed")>-1||e.indexOf("spotify.com")>-1||e.toLowerCase().indexOf(".pdf")>-1)&&(a=$(this).width())})),a}function isIframeEmbeded(e){return e.indexOf("www.youtube.com/embed")>-1||e.indexOf("<iframe")>-1&&(e.toLowerCase().indexOf(".pdf")>-1||e.indexOf(!1))||e.indexOf("<video")>-1}function resizeIframes(e,a,t){$("#texto"+e+" iframe").each((function(){var e=$(this).attr("src");null!=e&&(e.indexOf("youtube.com/embed")>-1||e.indexOf("embed/video")>-1)?($(this).width(a),$(this).height(.5625*a)):$(this).height()>50&&($(this).width(a),$(this).height(t)),null!=e&&(e.toLowerCase().indexOf(".pdf")>-1||e.indexOf("https://view.officeapps.live.com")>-1||e.indexOf("https://docs.google.com/viewer")>-1||e.indexOf("https://view.officeapps.live.com")>-1)&&($(this).width("100%"),$(this).height(t))})),$("#texto"+e+" video").each((function(){$(this).width("100%"),1==$("#texto"+e+" video").length&&$(this).on("loadedmetadata",(function(){var t=$(this)[0].videoHeight/$(this)[0].videoWidth;$("#texto"+e+" video").height(a*t),$("#texto"+e).height($("#texto"+e).height()-10)})),$(this).height(.5625*a)}))}function esVideo(e){return e.indexOf("<video")>-1}function changeIframesToLink(e){try{if(e.includes('class="iframeUploadFile"')&&e.includes("view.officeapps.live.com")){for(var a=/<iframe class=\"iframeUploadFile\" src="([^"]+)".*?<\/iframe>/g,t=a.exec(e),o=e;t;)o=o.replace(t[0],`<a href="${t[1]}">${t[1]}</a></br>`),t=a.exec(e);e=o}}catch(e){console.log(e)}return e}function searchCode(e){let a,t=0;for(;e.indexOf("```")>-1;){a=e.indexOf("```"),t=e.indexOf("```",a+1),-1===t&&(t=e.length);let o="javascript";e.toLowerCase().indexOf("html")>-1&&(o="html"),e.toLowerCase().indexOf("java ")>-1&&(o="java"),e.toLowerCase().indexOf("css")>-1&&(o="css"),e.toLowerCase().indexOf("php")>-1&&(o="php"),e.toLowerCase().indexOf("python")>-1&&(o="python"),e.toLowerCase().indexOf("sql")>-1&&(o="sql");const n=Prism.languages[o]||Prism.languages.javascript;e=`${e.substring(0,a)}\n           <pre class="language-${o}"><code class="language-${o}">${Prism.highlight(e.substring(a+4,t),n,o)}\n           </code></pre>${e.substring(t+4)}`}return e}function hightlightCode(){Prism.hooks.add("before-highlight",(function(e){e.code=e.element.innerText})),Prism&&Prism.highlightAll()}function showCalendar(e){var a=obtenerFormularioCalendar();abrirPantallaModal(a,{onOpenStart:function(){inicializaCalendar(e)},width:600,maxHeight:"500px",minHeight:"480px",dialogElement:"dialog-calendar"})}function inicializaCalendar(e){var a=getCalendarDate(e);a?($("#crear-aviso").hide(),$("#modificar-aviso").show(),$("#borrar-aviso").show()):($("#crear-aviso").show(),$("#modificar-aviso").hide(),$("#borrar-aviso").hide()),$("#borrar-aviso").off().on("click",(function(){borrarCalendar(e),modalInstance.close()})),$("#crear-aviso, #modificar-aviso").off().on("click",(function(){crearCalendar(e),modalInstance.close()}));var t=a||new Date;$("#datepicker").val(t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes()),jQuery("#datepicker").datetimepicker({format:"d.m.Y H:i",inline:!0,step:5,minDate:0,dayOfWeekStart:1}),$.datetimepicker.setLocale(window.navigator.language||navigator.browserLanguage),getCalendarPopup(e)||null==localStorage["calendar"+e]||$("#popupCalendarCheck").prop("checked",!1),getCalendarPeriodicidad(e)&&$("#periodicidad").val(getCalendarPeriodicidad(e)),getCalendarMail(e)&&$("#popupMailCheck").prop("checked",!0),$("#popupMailCheck").on("click",(function(){ocultaFormularioCalendar(),abreFormMail(e),compruebaCheckMail()})),compruebaCheckMail(),$("#dialog-calendar .tooltipstered").tooltipster({theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:150,zIndex:100000001})}function ocultaFormularioCalendar(){$("#dialog-calendar").hide()}function muestraFormularioCalendar(){$("#dialog-calendar").show()}function compruebaCheckMail(){$("#popupMailCheck").is(":checked")?$("#popupCalendarCheck").removeAttr("disabled"):($("#popupCalendarCheck").prop("checked",!0),$("#popupCalendarCheck").attr("disabled",!0))}function crearCalendar(e){var a=$("#datepicker").datetimepicker("getValue");setCalendarDate(e,a),$("#popupCalendarCheck").is(":checked")?setCalendarPopup(e,!0):setCalendarPopup(e,!1),grabaNotaCalendar(e),$("#periodicidad").val()||getCalendarPeriodicidad(e)?setCalendarPeriodicidad(e,$("#periodicidad").val()):getCalendarPush(e)&&(borraPush(e),setCalendarPush(e,"")),$("#popupMailCheck").is(":checked")?crearRegistroMail(e):getCalendarMail(e)&&(borraMail(e),setCalendarMail(e,"")),$("#calendar"+e).css("opacity","1"),$("#calendar"+e).tooltipster("content",chrome.i18n.getMessage("aviso")+formateaFecha(a))}function borrarCalendar(e){null!=localStorage["calendar"+e]&&""!=localStorage["calendar"+e]&&"undefined"!=localStorage["calendar"+e]&&(""!=getCalendarPush(e)&&borraPush(e),getCalendarMail(e)&&borraMail(e),localStorage.removeItem("calendar"+e),grabaNotaCalendar(e));$("#calendar"+e).length>0&&($("#calendar"+e).css("opacity","0.5"),$("#calendar"+e).tooltipster("content",chrome.i18n.getMessage("programaAviso")))}function setCalendar(e,a,t){var o=localStorage["calendar"+e];if(o&&-1==o.indexOf("{")&&(o=convierteFormatoViejo(o,e)),o&&"undefined"!=o)n=JSON.parse(o);else var n={};""==t||0==t?delete n[a]:n[a]=t,localStorage["calendar"+e]=JSON.stringify(n),grabaNotaCalendar(e)}function getCalendar(e,a){var t,o=localStorage["calendar"+e];if(o&&-1==o.indexOf("{")&&(o=convierteFormatoViejo(o,e)),!o||"undefined"==o)return"";try{t=JSON.parse(o)[a]||""}catch(e){t=""}return t}function getCalendarDate(e){var a=getCalendar(e,"fechaHora");return a&&(a=new Date(a)),a}function setCalendarDate(e,a){setCalendar(e,"fechaHora",a.toString())}function getCalendarPeriodicidad(e){var a=getCalendar(e,"peri");return"0"==a&&(a=""),a}function setCalendarPeriodicidad(e,a){setCalendar(e,"peri",a)}function getCalendarPopup(e){return getCalendar(e,"popup")}function setCalendarPopup(e,a){setCalendar(e,"popup",a)}function getCalendarNotifica(e){return getCalendar(e,"noti")}function setCalendarNotifica(e,a){setCalendar(e,"noti",a)}function getCalendarPush(e){return getCalendar(e,"idPush")}function setCalendarPush(e,a){setCalendar(e,"idPush",a)}function getCalendarMail(e){return getCalendar(e,"idMail")}function setCalendarMail(e,a){setCalendar(e,"idMail",a)}function grabaNotaCalendar(e){isUserConnected()&&updateNotaLoginMemo(e)}function actualizaFechaCalendar(e){var a=getCalendarPeriodicidad(e);if(a){var t=new Date,o=getCalendarDate(e),n=o.getHours(),i=o.getMinutes(),r=o.getDate();switch(a){case"1":o.setDate(o.getDate()+1);break;case"2":5==(new Date).getDay()?o.setDate(o.getDate()+3):o.setDate(o.getDate()+1);break;case"7":o.setDate(o.getDate()+7);break;case"30":o.setMonth(o.getMonth()+1)}o<t&&(o.setTime(t),o.setHours(n),o.setMinutes(i),"30"==a&&o.setDate(r)),setCalendarDate(e,o)}}function convierteFormatoViejo(e,a){if("undefined"==e)return localStorage.removeItem("calendar"+a),{};var t={};try{t.fechaHora=new Date(e.substr(0,16)),(e.length>16||"||popup"!=e.substr(16))&&"||"!=e.substring(16,1)&&(idPush=parseInt(e.substr(17,4)),Number.isInteger(idPush)&&(t.idPush=idPush),idMail=e.split("||")[1],"popup"==idMail&&(idMail=""),Number.isInteger(parseInt(idMail))&&(t.idMail=idMail))}catch(e){console.log(e)}return JSON.stringify(t)}function contieneComp(e,a){for(var t=0;t<a.length;t++)if(a[t].id_usuarioComp==e.id_usuarioComp&&a[t].tabComp==e.tabComp&&a[t].permisos==e.permisos)return!0;return!1}function invitacionesPorTratar(){if(null==localStorage.invitaciones)return 0;for(var e=JSON.parse(localStorage.invitaciones),a=0,t=0;t<e.length;t++)e[t].tratada||a++;return a}function yaCompartido(e,a){if(null==localStorage.comparticiones)return!1;for(var t=JSON.parse(localStorage.comparticiones),o=0;o<t.length;o++)if(t[o].nickComp==e&&t[o].tabComp==a)return!0;return!1}function esTabCompartido(e=tablonActual){if(null==localStorage.comparticiones||!isUserConnected())return!1;for(var a=JSON.parse(localStorage.comparticiones),t=0;t<a.length;t++)if(a[t].tabComp==e)return!0;return!1}function getTablonCompartidoLocal(e){if(!localStorage.comparticiones||!isUserConnected())return-1;for(var a=JSON.parse(localStorage.comparticiones),t=0;t<a.length;t++)if(a[t].tabCompRemoto==e)return a[t].tabComp;return-1}function esNotaCompartida(e){return!!localStorage["userComp"+e]}function borraComparticion(e){for(var a=JSON.parse(localStorage.comparticiones),t=0;t<a.length;t++)a[t].tabComp==e&&a.splice(t,1);localStorage.comparticiones=JSON.stringify(a)}function selectDeTablones(e,a){var t='<select id="listaTablones">';e?"0"!=tablonActual&&(t+='<option orden="'+ordenTablon(tablonActual)+'" value="'+tablonActual+'">'+nombreTablon(tablonActual)+"</option>"):t+='<option value="'+(parseInt(localStorage.numTablones)+1)+'">'+chrome.i18n.getMessage("labelAdd")+"</option>";for(var o=1;o<=localStorage.numTablones;o++)e&&o==tablonActual||(t+='<option orden="'+ordenTablon(o)+'" value="'+o+'">'+nombreTablon(o)+"</option>");return esNotaWeb(a)&&(t+='<option value="-999">'+nombreTablon(-999)+"</option>"),t+="</select>"}function listaTablones(e=!1,a=!1){var t,o=[];a&&o.push({text:chrome.i18n.getMessage("ultimoTablonActual"),value:0,orden:0,selected:!0}),e&&o.push({text:chrome.i18n.getMessage("labelAdd"),value:parseInt(localStorage.numTablones)+1});for(var n=1;n<=localStorage.numTablones;n++)o.push({text:nombreTablon(n),value:n,orden:parseInt(ordenTablon(n)),selected:0!=tablonActual||a?tablonActual==n:1==n});return algunaNotaWeb()&&o.push({text:nombreTablon(-999),value:"-999",orden:9999,selected:"-999"==tablonActual}),o.sort((t="orden",(e,a)=>e[t]>a[t]?1:a[t]>e[t]?-1:0))}function tablaInvitacionesEnviadas(){var e="";if(null==localStorage.invEnviadas)return e;var a=JSON.parse(localStorage.invEnviadas);if(0==a.length)return e;e="<table>",e+="<tr>",e+="<th>"+chrome.i18n.getMessage("tablon")+"</th>",e+="<th>"+chrome.i18n.getMessage("user")+"</th>",e+="<th>"+chrome.i18n.getMessage("permisos")+"</th>",e+="<th>"+chrome.i18n.getMessage("anular")+"</th>",e+="</th>";for(var t=0;t<a.length;t++)e+='<tr id="lineaInv'+t+'" title="'+a[t].mensaje+'">',null!=localStorage["tab"+a[t].tablon+"Label"]&&"undefined"!=localStorage["tab"+a[t].tablon+"Label"]?e+="<td>"+localStorage["tab"+a[t].tablon+"Label"]+"</td>":e+="<td>"+chrome.i18n.getMessage("tablon")+a[t].tablon+"</td>",""!=a[t].user?e+="<td>"+a[t].user+"</td>":a[t].mail.indexOf("@")>0?e+="<td>"+a[t].mail+"</td>":e+="<td>Facebook</td>",e+="<td>"+chrome.i18n.getMessage(a[t].permisos)+"</td>",e+='<td><button class="anulInvBut waves-effect waves-light btn-small teal lighten-2" id="anulInv'+t+'">'+chrome.i18n.getMessage("anularBot")+"</button></td>",e+="</tr>";return e+="</table>"}function addInvEnviadas(e,a,t,o,n){if(null==localStorage.invEnviadas)var i=new Array;else i=JSON.parse(localStorage.invEnviadas);var r={mail:e.indexOf("@")>-1?e:"",mensaje:o,permisos:n,tablon:t,user:-1==e.indexOf("@")?e:"",id_usuario2:a};i.push(r),localStorage.invEnviadas=JSON.stringify(i)}function eliminaCompartidos(){for(var e=0;e<localStorage.totalPost;)null!=localStorage["userComp"+e]?borrarConfirmado(e,!0):e++;localStorage.removeItem("comparticiones"),localStorage.removeItem("invitaciones"),localStorage.removeItem("invEnviadas"),inicializaFriendsBot()}function showAjaxGif(){$("#black_overlay").show()}function hideAjaxGif(){$("#black_overlay").hide()}function guardaPosCompartido(e){posCompartidas["X"+localStorage["treeId"+e]]=localStorage["X"+e],posCompartidas["Y"+localStorage["treeId"+e]]=localStorage["Y"+e]}function recuperaPosCompartido(e){null!=posCompartidas["X"+localStorage["treeId"+e]]&&(localStorage["X"+e]=posCompartidas["X"+localStorage["treeId"+e]],localStorage["Y"+e]=posCompartidas["Y"+localStorage["treeId"+e]])}var intervalInv;function inicializaInvitaciones(){invitacionesPorTratar()&&($("#invitacionesBot").show(),$("#compBot").attr("title",chrome.i18n.getMessage("compartir")),$("#invitacionesBot").attr("title",chrome.i18n.getMessage("invitacionesBot")),intervalInv=setInterval(parpadeaBotonInv,300))}function muestraNotasAlCompartir(){refrescaPantalla(null,!0),inicializaInvitaciones(),esTabCompartido(tablonActual)?trataTablonComp():inicializaFriendsBot(),muestraPaneles2(),cambiaIcono(),cambiaContador()}function esTablonCompartido(e){if(!isUserConnected()||!localStorage.comparticiones)return!1;for(var a=JSON.parse(localStorage.comparticiones),t=0;t<a.length&&a[t].tabComp!=e;)t++;return t<a.length}function getTablonCompartido(e){if(!isUserConnected()||!localStorage.comparticiones)return!1;for(var a=JSON.parse(localStorage.comparticiones),t=0;t<a.length&&a[t].tabComp!=e;)t++;return t<a.length&&a[t]}function comparteTablon(){if(!salSiPapelera())if(isUserConnected()){var e=obtenerFormularioInvitar();$("#listaTablones option").sortElements((function(e,a){return parseInt($(e).attr("orden"))>parseInt($(a).attr("orden"))?1:-1})),abrirPantallaModal(e,{onOpenStart:function(){$("#enviar-compartir").off().on("click",compartir),$("#pedir-url").off().on("click",pedirUrlCompartir)},height:700})}else muestraAdvertenciaLogin("hayQueLoguearse")}function compartir(){if(!isDemoUser()){var e=$("#userInvitado").val();if(""==e)return $("#userInvitado").focus(),void(idiomaEsp(navigator.language)?muestraMensajeModal("Informa el usuario al que quieres invitar por favor"):muestraMensajeModal("Informs the user that you want to invite please"));if(e!=localStorage.nick)if(-1==e.indexOf("@")&&yaCompartido(e,parseInt($("#listaTablones").val())))idiomaEsp(navigator.language)?muestraMensajeModal("Tablón ya compartido con "+e):muestraMensajeModal("Board already shared with "+e);else if(e.indexOf("@")>-1&&!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\D{2,4})+$/.test(e))idiomaEsp(navigator.language)?muestraMensajeModal("Mail con formato incorrecto"):muestraMensajeModal("Wrong mail");else{muestraMensajeModal(""),$("#enviar-compartir i").addClass("loader");var a=$("#onlyRead").is(":checked")?"R":"RW",t="id_usuario="+localStorage.id_usuario;t+="&token="+localStorage.token,t+="&permisos="+a,t+="&userInvitado="+encodeURIComponent(e),t+="&nombreInvitador="+encodeURIComponent($("#nombreInvitador").val()),t+="&tablon="+parseInt($("#listaTablones").val()),t+="&textoCompartir="+encodeURIComponent($("#textoCompartir").val()),$.ajax({type:"POST",url:getServerUrl()+"api/invitar.php",data:t,cache:!1,success:function(t){var o=JSON.parse(t);$("#mensError").html(o.mens),o.isSuccess&&(addInvEnviadas(e,o.id_usuarioInv,parseInt($("#listaTablones").val()),$("#textoCompartir").val(),a),$("#dialog-confirm").fadeOut(1e3,(function(){modalInstance.close()})))},error:function(e,a,t){console.log(a)},complete:function(){$("#enviar-compartir i").removeClass("loader")}})}else idiomaEsp(navigator.language)?muestraMensajeModal("No puedes compartir contigo mismo, escribe el nombre de usuario o mail del usuario al que quieres invitar"):muestraMensajeModal("You can not share with yourself, type the user name or mail the user you want to invite")}}function pedirUrlCompartir(){if(!isDemoUser()){$("#pedir-url i").addClass("loader");var e="id_usuario="+localStorage.id_usuario;e+="&tablon="+parseInt($("#listaTablones").val()),e+="&permisos="+($("#onlyRead").is(":checked")?"R":"RW"),$.ajax({type:"POST",url:getServerUrl()+"api/getUrlShare.php",data:e,cache:!1,success:function(e){var a=JSON.parse(e);a.isSuccess?($("#url-generada").val(a.url),document.getElementById("url-generada").select(),document.execCommand("copy"),window.getSelection().empty()):muestraMensajeModal(chrome.i18n.getMessage("errorShareUrl"))},error:function(e,a,t){muestraMensajeModal(chrome.i18n.getMessage("errorShareUrl"))},complete:function(){$("#pedir-url i").removeClass("loader")}})}}function anularInvitacion(){var e=parseInt($(this).attr("id").substr(7)),a=JSON.parse(localStorage.invEnviadas),t="id_usuario1="+localStorage.id_usuario;t+="&id_usuario2="+a[e].id_usuario2,t+="&mail2="+a[e].mail,t+="&tablon1="+a[e].tablon,$.ajax({type:"POST",url:getServerUrl()+"api/anularInv.php",data:t,cache:!1,success:function(a){var t=JSON.parse(a);if(t.isSuccess){var o=JSON.parse(localStorage.invEnviadas);o.splice(e,1),localStorage.invEnviadas=JSON.stringify(o),0==o.length?$("#tablaInvEnviadas").fadeOut():$("#lineaInv"+e).fadeOut((function(){$("#contenedorTabla").html(tablaInvitacionesEnviadas())}))}else alert(t.error)},error:function(e,a,t){console.log(a)}})}function recibeInvitaciones(e){for(var a=0;a<e.length;a++)e.tratada=!1,e.aceptada=!1;localStorage.invitaciones=JSON.stringify(e)}function recibeInvEnviadas(e){localStorage.invEnviadas=JSON.stringify(e)}function recibeComparticiones(e){for(var a=[],t=0;t<e.length;t++)contieneComp(e[t],a)||(a.push(e[t]),e[t].tabKanban&&(localStorage["tablonKanban"+e[t].tabComp]=JSON.stringify(e[t].tabKanban)));localStorage.comparticiones=JSON.stringify(a)}function muestraInvitaciones(){if(clearInterval(intervalInv),$("#invitacionesBot").css("background","linear-gradient(bottom, #E3B752 6%, #FFDC73 35%, #FFFF96 73%)"),invitacionesPorTratar()>0){var e=JSON.parse(localStorage.invitaciones),a='<div class="invitaciones">';a+='<div id="listaInv"><ul>';for(var t=0;t<e.length;t++)e[t].tratada||(a+='<li id="invitacion'+t+'">',a+=chrome.i18n.getMessage("user")+":<p> "+e[t].user,a+=' - <a href="mailto:'+e[t].mail+'">'+e[t].mail+"</a></p><br>",a+=chrome.i18n.getMessage("mensaje")+":<p> "+e[t].mensaje+"</p><br>","RW"==e[t].permisos?a+=chrome.i18n.getMessage("permisos")+": <p>"+chrome.i18n.getMessage("escLec")+"</p><br>":a+=chrome.i18n.getMessage("permisos")+": <p>"+chrome.i18n.getMessage("lec")+"</p><br>",a+=`<div class="input-field"><p>${chrome.i18n.getMessage("eligeTablonDestino")}</p>\n            <div class="input-field">\n              ${getSelectHtml({id:"listaTablones",label:chrome.i18n.getMessage("elijeDestino"),options:listaTablones(isAddBoardPremiumAllowed())})}\n            </div>\n          </div>`,a+='<button type="button" class="rechazarInv btn waves-effect waves-light red lighten-2" id="rechazarInv'+t+'">'+chrome.i18n.getMessage("rechazar")+"</button>",a+='<button type="button" class="aceptarInv accept-btn btn waves-effect waves-light" id="aceptarInv'+t+'">'+chrome.i18n.getMessage("aceptar")+"</button>",a+="<hr></li>");a+='</ul></div><div id="ajaxAnswer"></div></div>',$("#dialog-confirm").attr("title",chrome.i18n.getMessage("extName")),$("#dialog-confirm").html(a),$("#listaTablones option").sortElements((function(e,a){return parseInt($(e).attr("orden"))>parseInt($(a).attr("orden"))?1:-1})),abrirPantallaModal(a,{onOpenStart:function(){$("#enviar-compartir").on("click",compartir),$(".aceptarInv").on("click",aceptarInv),$(".rechazarInv").on("click",rechazarInv)},header:{title:chrome.i18n.getMessage("invitacionesPend")},buttons:{cancelButton:!0},height:580})}}function aceptarInv(){if(!isDemoUser()){var e=parseInt($(this).attr("id").substr(10)),a=JSON.parse(localStorage.invitaciones),t="id_usuario1="+a[e].id_usuario1;t+="&id_usuario2="+localStorage.id_usuario,t+="&nick1="+a[e].user,t+="&nick2="+localStorage.nick,t+="&tablon1="+a[e].tablon,t+="&tablon2="+$("#listaTablones").val(),t+="&token="+a[e].token,$("#ajaxAnswer").html('<img src="appimg/ajax-loader.gif"/>'),$.ajax({type:"POST",url:getServerUrl()+"api/aceptarInv.php",data:t,cache:!1,success:function(a){var t=JSON.parse(a);if(t.isSuccess){var o=JSON.parse(localStorage.invitaciones);o[e].tratada=!0,o[e].aceptada=!0,localStorage.invitaciones=JSON.stringify(o),parseInt($("#listaTablones").val())>parseInt(localStorage.numTablones)?(addBoard(),sweetAlert({type:"info",text:chrome.i18n.getMessage("newSharedBoard",[nombreTablon($("#listaTablones").val()),o[e].user]),cancel:!1,successCallback:function(){clickTablon(null,!1,$("#listaTablones").val())}})):sweetAlert({type:"info",text:chrome.i18n.getMessage("sharedBoard",[nombreTablon($("#listaTablones").val()),o[e].user]),cancel:!1}),localStorage.sincPeriodico="true",sendMessage({empiezaSincroPeriodica:!0}),grabaModificaciones(),sincronizaLogin(!1,!0,!0),0==invitacionesPorTratar()?($("#dialog-confirm").fadeOut(1400,(function(){modalInstance.close()})),$("#invitacionesBot").hide()):$("#invitacion"+e).remove()}else $("#ajaxAnswer").html(t.error);$("#ajaxAnswer").html("")},error:function(e,a,t){console.log(a)}})}}function rechazarInv(){var e=parseInt($(this).attr("id").substr(11)),a=JSON.parse(localStorage.invitaciones),t="id_usuario1="+a[e].id_usuario1;t+="&id_usuario2="+localStorage.id_usuario,t+="&nick1="+a[e].user,t+="&nick2="+localStorage.nick,t+="&tablon1="+a[e].tablon,t+="&token="+a[e].token,$.ajax({type:"POST",url:getServerUrl()+"api/rechazarInv.php",data:t,cache:!1,success:function(a){var t=JSON.parse(a);if(t.isSuccess){var o=JSON.parse(localStorage.invitaciones);o[e].tratada=!0,o[e].aceptada=!1,localStorage.invitaciones=JSON.stringify(o),0==invitacionesPorTratar()?($("#dialog-confirm").fadeOut(1400,(function(){modalInstance.close()})),$("#invitacionesBot").hide()):$("#invitacion"+e).remove()}else alert(t.error)},error:function(e,a,t){console.log(a)}})}function updateCompartido(e,a){if(!isDemoUser()){for(var t=JSON.parse(localStorage.comparticiones),o=0;o<t.length;o++)t[o].tabComp==e&&(t[o].tabComp=a);localStorage.comparticiones=JSON.stringify(t);var n="id_usuario="+localStorage.id_usuario;n+="&numTablon="+e,n+="&numNuevo="+a,$.ajax({type:"POST",url:getServerUrl()+"api/updateCompartir.php",data:n,cache:!1,success:function(e){var a=JSON.parse(e);a.isSuccess?console.log("success"):alert(a.error)},error:function(e,a,t){console.log(a)}})}}function deleteTablonCompartido(e,a){if(!isDemoUser()){var t="id_usuario="+localStorage.id_usuario;t+="&numTablon="+e,$.ajax({type:"POST",url:getServerUrl()+"api/deleteTablonCompartido.php",data:t,cache:!1,success:function(e){var a=JSON.parse(e);a.isSuccess?inicializaFriendsBot():alert(a.error)},error:function(e,a,t){console.log(a)}})}}function borrarCompartir(){var e=$(this).attr("id").substr(14);sweetAlert({text:chrome.i18n.getMessage("confirmarCompartirTab"),successCallback:function(){borrarCompartirConfirmado(e)},type:"warning"})}function borrarCompartirConfirmado(e){if(!isDemoUser()){var a=JSON.parse(localStorage.comparticiones),t="id_usuario="+localStorage.id_usuario;t+="&idUserComp="+a[e].id_usuarioComp,t+="&numTablon="+a[e].tabComp;var o=a[e].tabComp;$.ajax({type:"POST",url:getServerUrl()+"api/deleteCompartir.php",data:t,cache:!1,success:function(a){var t=JSON.parse(a);if(t.isSuccess){var n=JSON.parse(localStorage.comparticiones);n.splice(e,1),localStorage.comparticiones=JSON.stringify(n),esTabCompartido(o)?muestraUsuariosComp(null,!0):inicializaFriendsBot(),grabaModificaciones(),sincronizaLogin(!1,!0,!0),0==n.length&&localStorage.removeItem("comparticiones")}else console.log(t.error)},error:function(e,a,t){console.log(a)}})}}var registrando,postitChange,numParp=0;function parpadeaBotonInv(){numParp++,"rgb(231, 91, 44)"==$("#invitacionesBot").css("background-color")?$("#invitacionesBot").css("background","linear-gradient(bottom, #E3B752 6%, #FFDC73 35%, #FFFF96 73%)"):$("#invitacionesBot").css("background","#E75B2C"),30==numParp&&(clearInterval(intervalInv),$("#invitacionesBot").css("background",""),$("#invitacionesBot").css("background-color",""))}function inicializaFriendsBot(){$("#friendsBot").hide(),$(".nicksComp").hide()}function trataTablonComp(){$("#friendsBot").show()}function muestraUsuariosComp(e,a){if(a||!$(".nicksComp").is(":visible")){for(var t='<div id="usuariosComp">'+chrome.i18n.getMessage("compartidoCon")+"</div>",o=JSON.parse(localStorage.comparticiones),n=0;n<o.length;n++)o[n].tabComp==tablonActual&&(t+='<div class="nickComp" id="nick'+n+'">'+o[n].nickComp,t+='<img class="borraCompartir" id="borraCompartir'+n+'"src="appimg/removeWhite.png">',t+='<label class="permCompartir">'+chrome.i18n.getMessage(o[n].permisos)+" </label>",t+="</div>");$(".nicksComp").html(t),$("#borraCompartir").attr("title",chrome.i18n.getMessage("borraCompartir")),$(".borraCompartir").on("click",borrarCompartir);var i=$("#friendsBot").position().left+$(".nicksComp").width();$(".nicksComp").css({top:$("#friendsBot").height(),left:i>window.innerWidth?$("#friendsBot").position().left-(i+10-window.innerWidth):$("#friendsBot").position().left}),$(".nicksComp").fadeIn()}else $(".nicksComp").fadeOut();e&&e.stopPropagation(),closePaneles("nicksComp")}function mostrarDatosUsuario(){abrirPantallaModal(obtenerFormularioProfile(),{height:700,onOpenStart:function(){getPremiumSubscriptionHtml().then((e=>{$(".progress-profile").remove(),$(".datos-subs").append(e),$("#buttonUnsubscribe").on("click",(function(){chrome.tabs.create({url:"https://www.paypal.com/cgi-bin/webscr?cmd=_subscr-find&alias=XL85U4ZKY8C6E"})})),$("#buttonUnsubscribeCard").on("click",(function(){gotoManageStripe()}))}));var e=mdc.linearProgress.MDCLinearProgress;(new e(document.getElementById("mdc-linear-progress")).progress=getUserSpacePercent(),isUserConnected())?($("#profile-desconectar-borrar").on("click",(function(){logoutIni(),modalInstance.close()})),$("#profile-desconectar").on("click",(function(){logout(),modalInstance.close()}))):(new e(document.getElementById("mdc-linear-progress-local")).progress=getLocalStorageSize()/KB/5117.1875,$("#buttonBorrarNotas").off().on("click",borrarTodoConfirm),$("#buttonBorrarNotasFicheros").off().on("click",borrarTodoFicherosConfirm));$(".icono-ayuda").tooltipster({theme:["tooltipster-noir","tooltipster-noir-customized"],side:"right",delay:150,zIndex:99999999,maxWidth:300})}})}function updateLoginData(){isUserConnected()?($(this).append('<img class="ajaxloader" src="appimg/ajax-loader.gif" width="75">'),grabaModificaciones(),sincronizaLogin(!1,!0)):muestraAdvertenciaLogin("registrateParaSincro")}function loginModal(e){abrirPantallaModal(obtenerLoginForm(),{height:700,onOpenStart:function(){if(e?($("#campos-log").hide(),$("#campos-reg").show()):($("#campos-log").show(),$("#campos-reg").hide()),isUserConnected())$("#profile-desconectar-borrar").on("click",(function(){logoutIni(),modalInstance.close()})),$("#profile-desconectar").on("click",(function(){logout(),modalInstance.close()}));else{$("#buttonGoogle").off().on("click",(function(){$("#buttonGoogle").attr("disabled",!0),chrome.permissions.request({permissions:["identity","identity.email"]},(async function(e){if(!leidaPolitica())return $("#buttonGoogle").attr("disabled",!1),!1;var a=await decideSiBorrarNotas();if(a&&"close"==a.dismiss)return $("#buttonGoogle").attr("disabled",!1),!1;loginLocalGoogle()}))})),$("#buttonSubmit").off().on("click",(function(){return chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(async function(e){if(e)if($("#campos-log").is(":visible")){var a=await decideSiBorrarNotas();if(a&&"close"==a.dismiss)return!1;loginUsuario((function(){""==$("#mensaje-modal").html()&&(localStorage.sincroLogin=!0,sincroAceptada2(),$("#fb-login").unbind("click"),modalInstance.close())}))}else registraUsuario();else muestraMensajeModal(chrome.i18n.getMessage("loginSinPermisos"))})),!1})),$("#buttonRegistro, .alterna-form").off().on("click",(function(){return muestraMensajeModal(""),$("#campos-reg").is(":visible")?($("#campos-log").slideDown(),$("#campos-reg").slideUp(),$("#buttonSubmit span").text("Login"),$("#buttonRegistro").text(chrome.i18n.getMessage("irRegistro"))):($("#campos-log").slideUp(),$("#campos-reg").slideDown(),$("#buttonRegistro").text(chrome.i18n.getMessage("irLogin")),$("#buttonSubmit span").text(chrome.i18n.getMessage("registro"))),!1})),$("#fb-login").off().on("click",(async function(){if(!leidaPolitica())return!1;var e=await decideSiBorrarNotas();if(e&&"close"==e.dismiss)return!1;loginFacebook(),listenMessage("mensBack",(function(e,a){if("loginFbSuccess"==e.mensBack){e.mensBack="";var t=obtenerBotonLogin();$("#loginBot").html(t),$("#fb-login").unbind("click"),modalInstance.close()}}))})),$("#fb-login").attr("title",chrome.i18n.getMessage("facebookLoginAviso")),$("#buttonBorrarNotas").off().on("click",borrarTodoConfirm),$("#buttonBorrarNotasFicheros").off().on("click",borrarTodoFicherosConfirm),$("#fb-login").tooltipster({theme:["tooltipster-noir","tooltipster-noir-customized"],side:"top",delay:100,zIndex:1e9});try{grecaptcha.render("recaptcha-container",{sitekey:"6LdU1v0mAAAAAHcCNxXVZt8KL0CXj1YHjT3nM8_4"})}catch(e){console.log(e)}}}})}function borrarTodoConfirm(){sweetAlert({text:chrome.i18n.getMessage("confirmarBorrado"),successCallback:function(){logoutIniConfirmado(),modalInstance.close()},confirmButtonClass:"btn waves-effect waves-light red lighten-2 left",confirmText:chrome.i18n.getMessage("borrar")})}function borrarTodoFicherosConfirm(){sweetAlert({text:chrome.i18n.getMessage("confirmarBorradoTodoFicheros"),successCallback:function(){deleteAllServerFiles(),logoutIniConfirmado(),modalInstance.close()},confirmButtonClass:"btn waves-effect waves-light red lighten-2 left",confirmText:chrome.i18n.getMessage("borrar")})}function leidaPolitica(){return muestraMensajeModal(""),!($("#campos-reg").is(":visible")&&!$("#leida-politica").is(":checked"))||(idiomaEsp(navigator.language)?muestraMensajeModal("No has leido la política de privacidad"):muestraMensajeModal("You have not read the privacy policy"),document.getElementById("leida-politica").focus(),!1)}async function decideSiBorrarNotas(){if(parseInt(localStorage.totalPost)>0){var e=await Swal.fire({type:"warning",html:chrome.i18n.getMessage("existenNotas"),confirmButtonText:chrome.i18n.getMessage("borrarNotasConectar"),confirmButtonClass:"btn waves-effect waves-light red lighten-2 left",cancelButtonText:chrome.i18n.getMessage("anyadirNotas"),cancelButtonClass:"btn waves-effect waves-light grey darken-1",showCancelButton:!0,showCloseButton:!0,backdrop:"rgba(0,0,0,0.7)",buttonsStyling:!1});e&&!e.dismiss&&logoutIniConfirmado()}return e}function sincroAceptada2(e){localStorage.sincroLogin=!0;var a=obtenerBotonLogin();$("#loginBot").html(a),e||(sincronizaLogin(!0,!0),cambiaIcono(),cambiaContador(),setInterval(grabaModisPorsiaca,1e4))}function logout(e){localStorage.sincroLogin=!1,localStorage.removeItem("id_usuario"),localStorage.removeItem("premium");var a=obtenerBotonLogin();$("#loginBot").html(a),isUserConnected()&&sendMessage({mensBack:"acabaSincroPeriodica"}),e||eliminaCompartidos(),localStorage.sincroLogin=!1,localStorage.removeItem("fbToken"),localStorage.removeItem("fbId"),localStorage.removeItem("googleId")}function logoutIni(){sweetAlert({text:chrome.i18n.getMessage("confirmarLogout"),confirmText:chrome.i18n.getMessage("desconectarBorrar"),successCallback:logoutIniConfirmado,type:"question"})}function deleteAllServerFiles(){if(!isUserConnected())for(var e=0;e<localStorage.totalPost;e++)compruebaBorrarImagen(localStorage["postit"+e])}function logoutIniConfirmado(){if(logout(!0),$(".postitNB:not(#postitnuevo)").remove(),"false"==localStorage.escribeReview)var e=!0;if("false"==localStorage.modoLectura)var a=!0;if("false"==localStorage.programaAgenda)var t=!0;if("false"==localStorage.ayudaNuevaNota)var o=!0;if("false"==localStorage.ayudaEditarNota)var n=!0;localStorage.clear(),e&&(localStorage.escribeReview="false"),a&&(localStorage.modoLectura="false"),t&&(localStorage.programaAgenda="false"),o&&(localStorage.ayudaNuevaNota="false"),n&&(localStorage.ayudaEditarNota="false"),tablonActual=VALORES_POR_DEFECTO.TABLONACTUAL,localStorage.tablonActual=VALORES_POR_DEFECTO.TABLONACTUAL,localStorage.upgrade52="true",localStorage.numTablones=5,localStorage.masonry0="true",localStorage.fondo1=VALORES_POR_DEFECTO.FONDO,localStorage.fondo2=VALORES_POR_DEFECTO.FONDO,localStorage.fondo3=VALORES_POR_DEFECTO.FONDO,localStorage.fondo4=VALORES_POR_DEFECTO.FONDO,localStorage.fondo5=VALORES_POR_DEFECTO.FONDO,localStorage.fuente=VALORES_POR_DEFECTO.FUENTE,localStorage.size=VALORES_POR_DEFECTO.FONT_SIZE,localStorage.sincroLogin=!1,localStorage.fullScreen=!0,localStorage.showTabs=TOP_BAR.BOARDS,localStorage.totalPost="0",localStorage.reabriendoEditor="false",localStorage.seleccionTema=VALORES_POR_DEFECTO.TEMA,localStorage.espacio=0,borraKanban(),inicializaTema(),cambiaIcono(),cambiaContador(),cambiaFondoNum(VALORES_POR_DEFECTO.FONDO),muestraPaneles2(),sendMessage({menstoBack:"cambioMenu"}),sendMessage({mensBack:"seleccionTemaMod"})}function loginUsuario(e){return""==document.getElementById("nick").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Falta informar nombre de usuario"):muestraMensajeModal("Username empty"),document.getElementById("nick").focus(),!1):HayEspacios(document.getElementById("nick").value)?(idiomaEsp(navigator.language)?muestraMensajeModal("No se permiten espacios en el nombre de usuario"):muestraMensajeModal("Username without spaces please"),document.getElementById("nick").focus(),!1):""==document.getElementById("pwd").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Falta informar password"):muestraMensajeModal("Password empty"),document.getElementById("pwd").focus(),!1):HayEspacios(document.getElementById("pwd").value)?(idiomaEsp(navigator.language)?muestraMensajeModal("Hay espacios en el password"):muestraMensajeModal("Password without spaces please"),document.getElementById("pwd").focus(),!1):($("#mensaje-modal").html(""),void chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(function(a){a&&login(e)})))}function login(e){$("#buttonSubmit i").addClass("loader");var a="nick="+encodeURIComponent(document.getElementById("nick").value);a+="&pass="+encodeURIComponent(document.getElementById("pwd").value),a+="&g-recaptcha-response= "+document.querySelector(".g-recaptcha-response")?.value,a+="&sid="+localStorage.sid,$.ajax({type:"POST",url:"https://www.noteboardapp.com/api/login2.php",data:a,cache:!1,success:function(a){var t=JSON.parse(a);t.isSuccess?(localStorage.id_usuario=t.id_usuario,localStorage.token=t.token,localStorage.sincroLogin=!0,localStorage.nick=t.nick,localStorage.nickPublico=t.nickPublico,localStorage.confirmado=t.confirmado,e?e():(muestraMensajeModal("logged"),document.getElementById("logoutForm").style.display="block",document.getElementById("loginForm").style.display="none",document.getElementById("loginNombre").innerHTML="Login "+localStorage.nick)):muestraMensajeModal(t.error)},error:function(e,a,t){muestraMensajeModal("ERROR "+a)},complete:function(){$("#buttonSubmit i").removeClass("loader")}})}function registraUsuario(){return""==document.getElementById("signup").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Falta informar nombre de usuario"):muestraMensajeModal("Username empty"),document.getElementById("signup").focus(),!1):HayEspacios(document.getElementById("signup").value)?(idiomaEsp(navigator.language)?muestraMensajeModal("No se permiten espacios en el nombre de usuario"):muestraMensajeModal("Username without spaces please"),document.getElementById("signup").focus(),!1):-1!=document.getElementById("signup").value.indexOf("@")?(idiomaEsp(navigator.language)?muestraMensajeModal("No puedes usar '@' en el nombre de usuario"):muestraMensajeModal("Don't use '@' in username please"),document.getElementById("signup").focus(),!1):""==document.getElementById("pwds").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Falta informar password"):muestraMensajeModal("Password empty"),document.getElementById("pwds").focus(),!1):HayEspacios(document.getElementById("pwds").value)?(idiomaEsp(navigator.language)?muestraMensajeModal("Hay espacios en el password"):muestraMensajeModal("Password without spaces please"),document.getElementById("pwds").focus(),!1):""==document.getElementById("pwds2").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Falta informar confirmacion de password"):muestraMensajeModal("Password confirmation empty"),document.getElementById("pwds2").focus(),!1):document.getElementById("pwds").value!=document.getElementById("pwds2").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Passwords diferentes"):muestraMensajeModal("Passwords not equal"),document.getElementById("pwds2").focus(),!1):""==document.getElementById("email").value?(idiomaEsp(navigator.language)?muestraMensajeModal("Falta informar email"):muestraMensajeModal("Mail empty"),document.getElementById("email").focus(),!1):/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\D{2,4})+$/.test(document.getElementById("email").value)?!!leidaPolitica()&&void chrome.permissions.request({origins:["https://www.noteboardapp.com/"]},(function(e){if(e){$("#buttonSubmit i").addClass("loader");var a="nick="+encodeURIComponent(document.getElementById("signup").value);a+="&password="+encodeURIComponent(document.getElementById("pwds").value),a+="&email="+encodeURIComponent(document.getElementById("email").value),$.ajax({type:"POST",url:"https://www.noteboardapp.com/api/registraUsuarioApi.php",data:a,timeout:2e4,cache:!1,success:function(e){var a=JSON.parse(e);a.isSuccess?(registrando=!0,localStorage.id_usuario=a.id_usuario,localStorage.token=a.token,localStorage.nick=a.nick,localStorage.nickPublico=a.nickPublico,localStorage.sincroLogin=!0,localStorage.sincPeriodico=!1,localStorage.sessionId=a.sessionId,sincronizaLogin(!0,!1),sincroAceptada2(!0)):muestraMensajeModal(a.mens)},error:function(e,a,t){console.log(a)},complete:function(){$("#buttonSubmit i").removeClass("loader")}})}})):(idiomaEsp(navigator.language)?muestraMensajeModal("Mail incorrecto"):muestraMensajeModal("Mail not correct"),document.getElementById("email").focus(),!1)}function enviaPassword(){if(""==document.getElementById("nick").value)return idiomaEsp(navigator.language)?muestraMensajeModal("Informa el nombre de usuario o mail"):muestraMensajeModal("Fill username or mail please"),document.getElementById("nick").focus(),!1;var e="nick="+encodeURIComponent(document.getElementById("nick").value);$.ajax({type:"POST",url:"https://www.noteboardapp.com/cambiaPass.php",data:e,timeout:2e4,cache:!1,success:function(e){"OK"!=$.trim(e)?muestraMensajeModal("ERROR! "+e):idiomaEsp(navigator.language)?muestraMensajeModal("Mail enviado para cambiar el password"):muestraMensajeModal("Mail sent to change the password")},error:function(e,a,t){console.log(a)}})}function loginFb(e,a,t){var o="nick="+encodeURIComponent(e);o+="&fbId="+encodeURIComponent(a),o+="&fbToken="+encodeURIComponent(t),$.ajax({type:"POST",url:"https://www.noteboardapp.com/api/loginFb.php",cache:!1,data:o,success:async function(e){if("<"!=e[0]){var a=JSON.parse(e);a.isSuccess&&(localStorage.id_usuario=a.id_usuario,localStorage.token=a.token,localStorage.nick=a.nick,localStorage.nickPublico=a.nickPublico,localStorage.sincroLogin=!0,localStorage.confirmado=a.confirmado,localStorage.nuevoReg=a.nuevoReg,localStorage.sessionId=a.sessionId,localStorage.profilePicture=a.picture,await setAllLocalStorage(),sendMessage({mensBack:"loginFbSuccess"}),sincronizaLogin(!0,!0),cambiaIcono(),cambiaContador())}},error:function(e,a,t){muestraMensajeModal("ERROR "+a)}})}function obtenerBotonLogin(){if(isUserConnected()){if(null!=localStorage.fbId){var e='<div class="profilePicture right">';e+=`<img src="${localStorage.profilePicture}">`,e+="</div>",e+='<div class="profileInfo right">',e+=localStorage.nick,e+="</div>"}else if(null!=localStorage.googleId)e=`<div class="profilePicture right">\n                    <img src="${localStorage.profilePicture}">\n                  </div>\n                  <div class="profileInfo right">${localStorage.nick}</div>`;else e=`\n        <div class="profileInfo right">${localStorage.nick}</div>\n      `;$("#loginBot").removeClass("no-logged")}else{e=`<div>${chrome.i18n.getMessage("loginBot")}</div>`;$("#loginBot").attr("title",chrome.i18n.getMessage("loginBot")).addClass("no-logged")}return e}function loginLocalGoogle(){if(isEdgeBrowser()){const e=chrome.identity.getRedirectURL("oauth2");let a;a=isEdgeExtension()?isEdgePro()?GOOGLE_CLIENT_ID_EDGE_PRO:GOOGLE_CLIENT_ID_EDGE_DEV:GOOGLE_CLIENT_ID_CHROME_PRO;const t=["openid","profile","email"];let o="https://accounts.google.com/o/oauth2/auth";o+=`?client_id=${a}`,o+="&response_type=token",o+=`&redirect_uri=${encodeURIComponent(e)}`,o+=`&scope=${encodeURIComponent(t.join(" "))}`,chrome.identity.launchWebAuthFlow({interactive:!0,url:o},identityCallback)}else chrome.identity.getAuthToken({interactive:!0},identityCallback)}function identityCallback(e){if(e){if(0===e.indexOf("https://")){e=e.replace("#","?");var a=new URL(e);searchParams=new URLSearchParams(a.search),e=searchParams.get("access_token")}$.ajax({type:"GET",beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+e)},url:`https://www.googleapis.com/oauth2/v1/userinfo?alt=json&token=${e}`,cache:!1,success:function(a){loginGoogle(e,a.id,a.name,a.picture)}})}}function loginGoogle(e,a,t,o){var n="auth_token="+encodeURIComponent(e);n+="&google_id="+encodeURIComponent(a),n+="&name="+encodeURIComponent(t),$.ajax({type:"POST",url:"https://www.noteboardapp.com/api/loginGoogle.php",cache:!1,data:n,success:function(e){if(console.log(e),"<"!=e[0]){var t=JSON.parse(e);if(t.isSuccess&&(localStorage.id_usuario=t.id_usuario,localStorage.token=t.token,localStorage.nick=t.nick,localStorage.nickPublico=t.nickPublico,localStorage.sincroLogin=!0,localStorage.confirmado=t.confirmado,localStorage.nuevoReg=t.nuevoReg,localStorage.sessionId=t.sessionId,localStorage.googleId=a,localStorage.profilePicture=o,sincronizaLogin(!0,!0),$("#loginBot").html(obtenerBotonLogin()),cambiaIcono(),cambiaContador(),modalInstance.close(),t.nuevoReg&&t.email&&t.email.indexOf("_repe")>-1)){if(idiomaEsp(navigator.language))var n=`Se ha creado una cuenta nueva con el login de Google. Ya tenías una cuenta con password asociada a tu gmail con\n              el usuario <b>${t.id_usuario_repe}</b>. <br>Si en realidad querias acceder a la otra cuenta identificate con ese usuario y tu password.`;else n=`A new account has been created with the Google login. You already had an account with password and\n              your gmail with the user <b>${t.id_usuario_repe}</b>, <br>If you really wanted to access to the other account, login with\n              that username and your password.`;sweetAlert({text:n})}}},error:function(e,a,t){muestraMensajeModal("ERROR "+a)}})}function muestraAdvertenciaLogin(e){abrirPantallaModal(chrome.i18n.getMessage(e),{buttons:{cancelButton:!0,list:[{text:chrome.i18n.getMessage("login"),callback:function(){modalInstance.close(),loginModal()}},{text:chrome.i18n.getMessage("registro"),color:"red lighten-2",callback:function(){modalInstance.close(),loginModal(!0)}}]},height:350,width:500,icon:"error",center:!0})}function getWelcomeNote(){return idiomaEsp(navigator.language)?'\n    <p><span style="font-size: x-large; color: #000080;">&iexcl;Bienvenido a Tabl&oacute;n de Notas!</span><br /><br />Con esta extensi&oacute;n podr&aacute;s organizar tus notas, guardar contenido web en ellas y verlas en otro dispositivo si las tienes sincronizadas con la opci&oacute;n de login.</p>\n    <ul>\n    <li>Los tablones tienen el tamaño que quieras, puedes agrandarlos hacia la derecha o hacía abajo simplemente arrastrando las notas hacía ese lado.</li>\n    <li>Manteniendo pulsada la tecla <strong>SHIFT</strong> podr&aacute;s seleccionar texto de las notas.</li>\n    <li>Manteniendo pulsada la tecla <strong>CTRL</strong> podr&aacute;s seleccionar varias notas para moverlas a la vez. Tambi&eacute;n puedes mantener pulsado el bot&oacute;n derecho del rat&oacute;n para dibujar un cuadrado para seleccionar las notas contenidas en &eacute;l.</li>\n    <li>Haz doble click en los nombres de Tabl&oacute;n para renombrar.</li>\n    </ul>\n    <p><br /><strong>Botones generales</strong><br /><br /></p>\n    <table style="height: 988px;" border="1">\n    <tbody>\n    <tr style="height: 22px;">\n    <td style="height: 22px; width: 94px;">\n    <div class="iconHelp" style="z-index: 559;"><img src="appimg/papeleraLlena.png" alt="" width="30" height="35" />Papelera</div>\n    </td>\n    <td style="height: 22px; width: 554px;"><span style="font-size: small;">Aqu&iacute; puedes acceder a las notas borradas. Las notas se borran definitivamente de la papelera a los 30 dias.</span></td>\n    </tr>\n    <tr style="height: 70px;">\n    <td style="height: 70px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 559;"><img src="appimg/font.png" alt="" />Fuente</div>\n    </td>\n    <td style="height: 70px; width: 554px;"><span style="font-size: small;">Cambia la fuente por defecto. Con + y - puedes cambiar el tama&ntilde;o de la fuente por defecto.</span></td>\n    </tr>\n    <tr style="height: 70px;">\n    <td style="height: 70px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 560;"><img src="appimg/background.png" alt="" />Fondo</div>\n    </td>\n    <td style="height: 70px; width: 554px;"><span style="font-size: small;">Cambia el fondo del panel actual. Al final hay una opci&oacute;n para usar una imagen propia.</span></td>\n    </tr>\n    <tr style="height: 70px;">\n    <td style="height: 70px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 562;"><img src="appimg/share.png" alt="" />Compartir</div>\n    </td>\n    <td style="height: 70px; width: 554px;"><span style="font-size: small;">Usa este bot&oacute;n para compartir tablones con amigos</span></td>\n    </tr>\n    <tr style="height: 70px;">\n    <td style="height: 70px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 563;"><img src="appimg/search.png" alt="" />Buscar</div>\n    </td>\n    <td style="height: 70px; width: 554px;"><span style="font-size: small;">Con la lupa puedes buscar una nota escribiendo una palabra de su contenido</span></td>\n    </tr>\n    <tr style="height: 70px;">\n    <td style="height: 70px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 564;"><img src="appimg/publish.png" alt="" />Publicar</div>\n    </td>\n    <td style="height: 70px; width: 554px;"><span style="font-size: small;">Con esta opci&oacute;n puedes hacer p&uacute;blico el tabl&oacute;n activo. Cualquiera podr&aacute; ver tus tablones p&uacute;blicos, sin posibilidad de modificaci&oacute;n, desde una web con una URL asignada a tu usuario.</span></td>\n    </tr>\n    <tr style="height: 60px;">\n    <td style="height: 60px; width: 94px;">\n    <div class="iconHelp" style="z-index: 564;"><img src="appimg/slides.png" alt="" width="30" height="31" /></div>\n    <div class="iconHelp" style="z-index: 564;">Presentaci&oacute;n</div>\n    </td>\n    <td style="height: 60px; width: 554px;"><span style="font-size: small;">Activar el modo presentaci&oacute;n de notas como diapositivas</span></td>\n    </tr>\n    <tr style="height: 60px;">\n    <td style="height: 60px; width: 94px;">\n    <div class="iconHelp" style="z-index: 564;">\n    <div class="iconHelp" style="z-index: 564;"><img src="appimg/masonry.png" alt="" width="30" height="31" /></div>\n    <div class="iconHelp" style="z-index: 564;">Ordenar</div>\n    </div>\n    </td>\n    <td style="height: 60px; width: 554px;"><span style="font-size: small;">Ordenaci&oacute;n autom&aacute;tica de las notas</span></td>\n    </tr>\n    <tr style="height: 66px;">\n    <td style="height: 66px; width: 94px;">\n    <div class="iconHelp" style="z-index: 564;">\n    <div><em class="material-icons">view_week</em></div>\n    Kanban</div>\n    </td>\n    <td style="height: 66px; width: 554px;"><span style="font-size: small;">&nbsp;Tablones Kanban</span></td>\n    </tr>\n    <tr style="height: 70px;">\n    <td style="height: 70px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 554;"><img src="appimg/newnote.png" alt="" />Nueva</div>\n    </td>\n    <td style="height: 70px; width: 554px;"><span style="font-size: small;">Crea una nueva nota haz doble click en el fondo o usa este bot&oacute;n<br /><br /></span></td>\n    </tr>\n    <tr style="height: 73px;">\n    <td style="height: 73px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 555;"><img src="appimg/clip.png" alt="" width="44" height="44" />Anexa</div>\n    </td>\n    <td style="height: 73px; width: 554px;"><span style="font-size: small;">&nbsp;Sube un fichero de cualquier tipo para crear una nota con &eacute;l</span></td>\n    </tr>\n    <tr style="height: 37px;">\n    <td style="width: 94px; height: 37px;">\n    <div class="iconHelp" style="z-index: 555;"><img src="appimg/sticker.png" alt="" width="30" height="30" />Stickers</div>\n    </td>\n    <td style="width: 554px; height: 37px;"><span style="font-size: small;">Biblioteca de stickers para a&ntilde;adir a los tablones</span></td>\n    </tr>\n    <tr style="height: 37px;">\n    <td style="width: 94px; height: 37px;">\n    <div class="iconHelp" style="z-index: 555;">\n    <div><em class="material-icons">power</em></div>\n    Plugins</div>\n    </td>\n    <td style="width: 554px; height: 37px;"><span style="font-size: small;">Biblioteca de plugins para a&ntilde;adir a los tablones. Un plugin es una nota con diversas funcionalidades (calendario, reloj.. etc)&nbsp;</span></td>\n    </tr>\n    <tr style="height: 59px;">\n    <td style="width: 94px; height: 59px;">\n    <div class="iconHelp" style="z-index: 555;">\n    <div><img src="appimg/floppy.png" alt="" width="30" height="30" /></div>\n    <div>Backup</div>\n    </div>\n    </td>\n    <td style="width: 554px; height: 59px;"><span style="font-size: small;">Creaci&oacute;n y restauraci&oacute;n de copia de seguridad en fichero</span></td>\n    </tr>\n    <tr style="height: 59px;">\n    <td style="width: 94px; height: 59px;">\n    <div class="iconHelp" style="z-index: 555;">\n    <div><img src="appimg/options.png" alt="" width="30" height="30" /></div>\n    <div>Opciones</div>\n    </div>\n    </td>\n    <td style="width: 554px; height: 59px;"><span style="font-size: small;">Opciones de configuraci&oacute;n</span></td>\n    </tr>\n    <tr style="height: 51px;">\n    <td style="height: 51px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 556;"><img src="appimg/login.png" alt="" />Datos Usuario</div>\n    </td>\n    <td style="height: 51px; width: 554px;"><span style="font-size: small; line-height: 19px;">Datos de usuario, notas totales, espacio utilizado.. etc</span></td>\n    </tr>\n    <tr style="height: 44px;">\n    <td style="width: 94px; height: 44px;">\n    <div class="iconHelp" style="z-index: 556;">Login/Registro</div>\n    </td>\n    <td style="width: 554px; height: 44px;"><span style="font-size: small; line-height: 19px;">Haz login o registrate con tu usuario/password o con Facebook o Google para poder sincronizar las notas de otras instalaciones.</span></td>\n    </tr>\n    </tbody>\n    </table>\n    <p><br /><br /><strong>Botones de cada nota</strong><br /><br /></p>\n    <table style="height: 478px; width: 425px;" border="1">\n    <tbody>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/rotate.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Arrastrando el icono la nota rotar&aacute; sobre s&iacute; misma.</span></td>\n    </tr>\n    <tr style="height: 54px;">\n    <td style="width: 33px; height: 54px;">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/zoomIn.png" alt="" width="20" height="20" /></span><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/zoomOut.png" alt="" width="20" height="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 54px;"><span style="font-size: small;">&nbsp;Maximizar a pantalla completa o minimizar una nota</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/clipNegro.png" alt="" width="30" height="30" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Anexar un fichero a una nota</span></td>\n    </tr>\n    <tr style="height: 22px;">\n    <td style="width: 33px; height: 22px;">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/connect.png" alt="" width="20" height="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 22px;"><span style="font-size: small;">Conectar una nota con otra</span></td>\n    </tr>\n    <tr style="height: 22px;">\n    <td style="width: 33px; height: 22px;">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><em class="material-icons tooltip tooltipstered">content_paste</em></span></div>\n    </td>\n    <td style="width: 392px; height: 22px;"><span style="font-size: small;">Copiar al portapales el contenido de una nota</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><em class="material-icons tooltip tooltipstered"><img id="imgPaint" class="imgBut" src="appimg/duplicar.png" alt="" width="20" height="20" /></em></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Clonar una nota</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;" align="center">\n    <div style="width: 30px; z-index: 569;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/newtab.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Crea una ventana popup con la nota</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;" align="center">\n    <div style="width: 30px; z-index: 568;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/share2.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Compartir el contenido de la nota</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;" align="center">\n    <div style="width: 20px; z-index: 567;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/calendar.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Programar un aviso</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;" align="center">\n    <div style="width: 20px; z-index: 566;"><span style="font-size: small;"><img class="imgBut" src="appimg/tab.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Para mover la nota a otro tabl&oacute;n.</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;" align="center">\n    <div style="width: 20px; z-index: 566;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/pencil.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Para editar la nota, tambi&eacute;n puedes hacer doble click en el contenido.</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;" align="center">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/remove.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">&nbsp;Borra la nota</span></td>\n    </tr>\n    </tbody>\n    </table>\n    ':'<p><span style="color: #000080; font-size: x-large;">Welcome to Note Board!</span><br /><br />With this application you can organize your notes and view them on any other device.</p>\n    <ul>\n    <li>The boards have the size you want, you can enlarge them to the right or down simply by dragging the notes to that side.</li>\n    <li>By holding down the SHIFT key you can select text from the notes.</li>\n    <li>By holding down the CTRL key you can select several notes to move them at the same time. You can also press and hold the right mouse button to draw a square to select the notes contained in it.</li>\n    <li>Double click on the names of Plank to rename.</li>\n    </ul>\n    <p><br /><strong>Buttons</strong><br /><br /></p>\n    <table style="height: 1010px;" border="1">\n    <tbody>\n    <tr style="height: 22px;">\n    <td style="height: 22px; width: 94px;">\n    <div class="iconHelp" style="z-index: 559;"><img src="appimg/papeleraLlena.png" alt="" width="30" height="35" />Bin</div>\n    </td>\n    <td style="height: 22px; width: 554px;"><span style="font-size: 10pt;">Here you can access the deleted notes. The notes are permanently deleted from the bin after 30 days.</span></td>\n    </tr>\n    <tr style="height: 70px;">\n    <td style="height: 70px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 559;"><img src="appimg/font.png" alt="" />Font</div>\n    </td>\n    <td style="height: 70px; width: 554px;"><span style="font-size: small; line-height: 19px;">You can change the default font. With + and - &nbsp;(beside the Font Button) you can change the size of the default font.</span></td>\n    </tr>\n    <tr style="height: 70px;">\n    <td style="height: 70px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 560;"><img src="appimg/background.png" alt="" />Background</div>\n    </td>\n    <td style="height: 70px; width: 554px;"><span style="font-size: small;"><span style="font-size: small; line-height: 19px;">Changes the background of the current panel. At the end there is an option to use your own image.</span></span></td>\n    </tr>\n    <tr style="height: 70px;">\n    <td style="height: 70px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 562;"><img src="appimg/share.png" alt="" />Share</div>\n    </td>\n    <td style="height: 70px; width: 554px;"><span style="font-size: small; line-height: 19px;">Use this button to share boards with friends.</span></td>\n    </tr>\n    <tr style="height: 70px;">\n    <td style="height: 70px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 563;"><img src="appimg/search.png" alt="" />Search</div>\n    </td>\n    <td style="height: 70px; width: 554px;"><span style="font-size: small; line-height: 19px;">With a magnifying glass you can find a note by writing a word of content</span></td>\n    </tr>\n    <tr style="height: 70px;">\n    <td style="height: 70px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 564;"><img src="appimg/publish.png" alt="" />Publish</div>\n    </td>\n    <td style="height: 70px; width: 554px;"><span style="font-size: small;">Change a board to public or private . When board\'s visibility is set to public, it is viewable by anyone, but nobody will be able to change the contents of the board except yourself.</span></td>\n    </tr>\n    <tr style="height: 60px;">\n    <td style="height: 60px; width: 94px;">\n    <div class="iconHelp" style="z-index: 564;"><img src="appimg/slides.png" alt="" width="30" height="31" /></div>\n    <div class="iconHelp" style="z-index: 564;">Presentation</div>\n    </td>\n    <td style="height: 60px; width: 554px;"><span style="font-size: 10pt;">Activate the presentation mode of notes as slides</span></td>\n    </tr>\n    <tr style="height: 60px;">\n    <td style="height: 60px; width: 94px;">\n    <div class="iconHelp" style="z-index: 564;">\n    <div class="iconHelp" style="z-index: 564;"><img src="appimg/masonry.png" alt="" width="30" height="31" /></div>\n    <div class="iconHelp" style="z-index: 564;">Sort</div>\n    </div>\n    </td>\n    <td style="height: 60px; width: 554px;"><span style="font-size: small;">Automatic sort</span></td>\n    </tr>\n    <tr style="height: 66px;">\n    <td style="height: 66px; width: 94px;">\n    <div class="iconHelp" style="z-index: 564;">\n    <div><em class="material-icons">view_week</em></div>\n    Kanban</div>\n    </td>\n    <td style="height: 66px; width: 554px;"><span style="font-size: small;">&nbsp;Kanban boards</span></td>\n    </tr>\n    <tr style="height: 22px;">\n    <td style="width: 94px; height: 22px;">\n    <div class="iconHelp" style="z-index: 564;">\n    <div><img src="appimg/newnote.png" alt="" />New note</div>\n    </div>\n    </td>\n    <td style="width: 554px; height: 22px;"><span style="font-size: small;">T<span style="font-size: small; line-height: 19px;">o create a new note double-click on the background or on this button</span></span></td>\n    </tr>\n    <tr style="height: 73px;">\n    <td style="height: 73px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 555;"><img src="appimg/clip.png" alt="" width="44" height="44" />Attach</div>\n    </td>\n    <td style="height: 73px; width: 554px;"><span style="font-size: small;">&nbsp;Upload a file and create a note with it.</span></td>\n    </tr>\n    <tr style="height: 37px;">\n    <td style="width: 94px; height: 37px;">\n    <div class="iconHelp" style="z-index: 555;"><img src="appimg/sticker.png" alt="" width="30" height="30" />Stickers</div>\n    </td>\n    <td style="width: 554px; height: 37px;"><span style="font-size: 10pt;">Stickers library to add to the boards</span></td>\n    </tr>\n    <tr style="height: 37px;">\n    <td style="width: 94px; height: 37px;">\n    <div class="iconHelp" style="z-index: 555;">\n    <div><em class="material-icons">power</em></div>\n    Plugins</div>\n    </td>\n    <td style="width: 554px; height: 37px;"><span style="font-size: 10pt;">Library of plugins to add to the boards. A plugin is a note with various functionalities (calendar, clock .. etc)</span></td>\n    </tr>\n    <tr style="height: 59px;">\n    <td style="width: 94px; height: 59px;">\n    <div class="iconHelp" style="z-index: 555;">\n    <div><img src="appimg/floppy.png" alt="" width="30" height="30" /></div>\n    <div>Backup</div>\n    </div>\n    </td>\n    <td style="width: 554px; height: 59px;"><span style="font-size: 10pt;">Creation and restoration of file backup</span></td>\n    </tr>\n    <tr style="height: 59px;">\n    <td style="width: 94px; height: 59px;">\n    <div class="iconHelp" style="z-index: 555;">\n    <div><img src="appimg/options.png" alt="" width="30" height="30" /></div>\n    <div>Opciones</div>\n    </div>\n    </td>\n    <td style="width: 554px; height: 59px;"><span style="font-size: small;">Configuration options</span></td>\n    </tr>\n    <tr style="height: 51px;">\n    <td style="height: 51px; width: 94px;" align="center">\n    <div class="iconHelp" style="z-index: 556;"><img src="appimg/login.png" alt="" />Profile data</div>\n    </td>\n    <td style="height: 51px; width: 554px;"><span style="font-size: small; line-height: 19px;">User data, server spaces, number of notes...</span></td>\n    </tr>\n    <tr style="height: 44px;">\n    <td style="width: 94px; height: 44px;">\n    <div class="iconHelp" style="z-index: 556;">Login/Register</div>\n    </td>\n    <td style="width: 554px; height: 44px;"><span style="font-size: 10pt;">Login or register with your username / password or with Facebook or Google to be able to synchronize the notes of other facilities.</span></td>\n    </tr>\n    </tbody>\n    </table>\n    <p><br /><br /><strong>Botones de cada nota</strong><br /><br /></p>\n    <table style="height: 478px; width: 425px;" border="1">\n    <tbody>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/rotate.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Drag the icon to rotate the note.</span></td>\n    </tr>\n    <tr style="height: 54px;">\n    <td style="width: 33px; height: 54px;">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/zoomIn.png" alt="" width="20" height="20" /></span><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/zoomOut.png" alt="" width="20" height="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 54px;"><span style="font-size: small;"> Maximize to full screen or minimize a note</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/clipNegro.png" alt="" width="30" height="30" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Attach a file to a note</span></td>\n    </tr>\n    <tr style="height: 22px;">\n    <td style="width: 33px; height: 22px;">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/connect.png" alt="" width="20" height="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 22px;"><span style="font-size: small;">Connect a note with another</span></td>\n    </tr>\n    <tr style="height: 22px;">\n    <td style="width: 33px; height: 22px;">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><em class="material-icons tooltip tooltipstered">content_paste</em></span></div>\n    </td>\n    <td style="width: 392px; height: 22px;"><span style="font-size: 10pt;">Copy the contents of a note to the clipboard</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><em class="material-icons tooltip tooltipstered"><img id="imgPaint" class="imgBut" src="appimg/duplicar.png" alt="" width="20" height="20" /></em></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Clone a note</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;" align="center">\n    <div style="width: 30px; z-index: 569;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/newtab.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Open a popup window with a note</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;" align="center">\n    <div style="width: 30px; z-index: 568;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/share2.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;">\n    <div style="width: 30px; z-index: 184;">&nbsp;</div>\n    <span style="font-size: small;">Share the note Content</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;" align="center">\n    <div style="width: 20px; z-index: 567;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/calendar.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;">Schedule a reminder</td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;" align="center">\n    <div style="width: 20px; z-index: 566;"><span style="font-size: small;"><img class="imgBut" src="appimg/tab.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Move a note to a board.</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;" align="center">\n    <div style="width: 20px; z-index: 566;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/pencil.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;">Edit a note. You can double click in the content too.</span></td>\n    </tr>\n    <tr style="height: 27px;">\n    <td style="width: 33px; height: 27px;" align="center">\n    <div style="width: 20px; z-index: 565;"><span style="font-size: small;"><img id="imgPaint" class="imgBut" src="appimg/remove.png" alt="" width="20" /></span></div>\n    </td>\n    <td style="width: 392px; height: 27px;"><span style="font-size: small;"> Delete a note.</span></td>\n    </tr>\n    </tbody>\n    </table>\n    '}function initRealTime(){if("undefined"!=typeof firebase&&isPremiumUser()){if(0===firebase.apps.length){firebase.initializeApp({apiKey:"AIzaSyAX48wcrExFdN--o728Pdrc8CPED_SdQ0E",authDomain:"note-board-web.firebaseapp.com",databaseURL:"https://note-board-web.firebaseio.com",projectId:"note-board-web",storageBucket:"note-board-web.appspot.com",messagingSenderId:"1053127044847"});firebase.database()}else firebase.database().goOnline()}}function checkBoardRealTime(e){if("undefined"!=typeof firebase&&isPremiumUser())try{esTablonCompartido(e)?(initRealTime(),listenRealTime(e)):firebase.apps.length>0&&(firebase.database().goOffline(),postitChange&&postitChange.off())}catch(e){console.log(e)}}function sendRealTime(e,a,t=tablonActual){if("undefined"!=typeof firebase&&isPremiumUser()&&isUserConnected()&&esTablonCompartido(t)&&localStorage["treeId"+e])try{(t!=tablonActual&&!esTablonCompartido(tablonActual)||esBackground()&&checkBoardRealTime(t))&&initRealTime();for(var o=(a=a||{}).texto||localStorage["postit"+e],n=JSON.parse(localStorage.comparticiones),i=0;i<n.length;i++)if(n[i].tabComp==t){var r={postit:o,tipoA:localStorage["tipoA"+e],X:localStorage["X"+e],Y:localStorage["Y"+e],width:localStorage["width"+e]||0,height:localStorage["height"+e]||0,treeId:localStorage["treeId"+e]||0,fecha:localStorage["fecha"+e]||"",calendar:localStorage["calendar"+e]||"",sinMarco:localStorage["sinMarco"+e]||"",rotacion:localStorage["rotacion"+e]||"",pushpin:localStorage["pushpin"+e]||"",columnaKanban:localStorage["columnaKanban"+e]||"",connections:localStorage["connections"+e]||"",create:a.create||!1,delete:a.delete||!1,tabKanban:esTablonKanban(t)?localStorage["tablonKanban"+t]:""};a.create&&(r={...r,userComp:"RW"==n[i].permisos?localStorage.id_usuario:"R",nickComp:localStorage.nick}),firebase.database().ref("users/"+n[i].id_usuarioComp+"/board/"+n[i].tabCompRemoto+"/treeId/"+localStorage["treeId"+e]).set(r)}}catch(e){console.log(e)}}function listenRealTime(e){if("undefined"!=typeof firebase&&isPremiumUser()){var a=localStorage.id_usuario;postitChange&&postitChange.off(),(postitChange=firebase.database().ref("users/"+a+"/board/"+e)).on("value",(function(n){try{var i=n.val();if(!i)return;for(const n in i.treeId){var r=i.treeId[n];if(r.delete)t(r.treeId);else if(r.create){var l=localStorage.totalPost;o(r.treeId)||(informaLocalStorage(l,r,e),localStorage.totalPost++,muestraPostit(l))}else if(r&&r.treeId)for(var s=0;s<localStorage.totalPost;s++)if(localStorage["treeId"+s]==r.treeId){informaLocalStorage(s,r),estaEditorAbierto(s)?obtenEditor(s).setContent(localStorage["postit"+s]):refrescaNota(s);break}r.tabKanban&&(localStorage["tablonKanban"+e]=r.tabKanban),deleteRealTime(a,e,r.treeId)}}catch(e){console.log(e)}}))}function t(e){for(var a=0;a<localStorage.totalPost;a++)if(localStorage["treeId"+a]==e){borrarConfirmado(a);break}}function o(e){for(var a=0;a<localStorage.totalPost;a++)if(localStorage["treeId"+a]==e)return!0;return!1}}function informaLocalStorage(e,a,t){localStorage["postit"+e]=a.postit,localStorage["tipoA"+e]=a.tipoA,localStorage["X"+e]=a.X,localStorage["Y"+e]=a.Y,localStorage["width"+e]=a.width,localStorage["height"+e]=a.height,localStorage["sinMarco"+e]=a.sinMarco,localStorage["rotacion"+e]=a.rotacion,localStorage["pushpin"+e]=a.pushpin,localStorage["treeId"+e]=a.treeId,localStorage["columnaKanban"+e]=a.columnaKanban,a.connections&&(localStorage["connections"+e]=a.connections),a.create&&(localStorage["tablon"+e]=t,localStorage["userComp"+e]=a.userComp,localStorage["nickComp"+e]=a.nickComp)}function deleteRealTime(e,a,t){firebase.database().ref("users/"+e+"/board/"+a+"/treeId/"+t).remove()}function crearEditor(e,a){var t,o,n,i;restaurarMedidasAutoNota(e),n=notaTieneZoom(e)?window.innerHeight-200:window.innerHeight-250,null!=e?(t="textAreaEdit"+e,o=getAlturaNota(e)+210,esPopup()&&(o=window.innerHeight+300,n=screen.height-250)):(t="textoAnun",o=300),esTablonKanban()&&!notaTieneZoom(e)?(n=VALORES_POR_DEFECTO.KANBAN_HEIGHT-250,i="spellchecker paste autolink autoresize print save preview code searchreplace directionality visualblocks visualchars fullscreen image link media codesample table charmap hr pagebreak nonbreaking anchor insertdatetime advlist lists wordcount imagetools textpattern emoticons"):i="spellchecker paste autolink autoresize print save preview code searchreplace directionality visualblocks visualchars fullscreen image link media codesample table charmap hr pagebreak nonbreaking anchor insertdatetime advlist lists wordcount imagetools textpattern help emoticons";var r="formatselect | bold italic strikethrough forecolor backcolor | link | numlist bullist | removeformat | alignleft aligncenter alignright alignjustify | outdent indent | ltr rtl | hr | check | code";isMobile()&&(r=chrome.i18n.getMessage("aceptar")+" | "+chrome.i18n.getMessage("cancelar")+" | "+r),tinyMCE.init({mode:"exact",language:"es-ES"==navigator.language?"es":"en-US"==navigator.language?"":navigator.language,elements:t,statusbar:!1,relative_urls:!1,remove_script_host:!1,convert_urls:!1,width:"100%",plugins:i,imagetools_cors_hosts:["www.noteboardapp.com"],imagetools_toolbar:"rotateleft rotateright | flipv fliph | imageoptions editimage",imagetools_proxy:"https://www.noteboardapp.com/proxy.php",dialog_type:"modal",codesample_languages:[{text:"HTML/XML",value:"markup"},{text:"JavaScript",value:"javascript"},{text:"CSS",value:"css"},{text:"PHP",value:"php"},{text:"Ruby",value:"ruby"},{text:"Python",value:"python"},{text:"Java",value:"java"},{text:"C",value:"c"},{text:"C#",value:"csharp"},{text:"C++",value:"cpp"},{text:"Sql",value:"sql"},{text:"Json",value:"json"}],nonbreaking_force_tab:!0,contextmenu:"link copy paste",min_height:o,max_height:n,forced_root_block:"p",force_br_newlines:!0,browser_spellcheck:!0,force_p_newlines:!1,image_advtab:!0,paste_data_images:!0,init_instance_callback:a,toolbar_drawer:"sliding",toolbar:r,toolbar_items_size:"small",font_formats:"Kalam=Kalam,Arial;Droid Sans=Droid Sans,Arial;Architects Daughter=Architects Daughter,Arial;Quando=Quando,Arial;Indie Flower=Indie Flower,Arial;Andale Mono=andale mono,times;Balsamiq Sans=Balsamiq Sans,times;Quattrocento Sans=Quattrocento Sans,Arial;Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Roboto=roboto;Karla=karla;Montserrat=montserrat;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats",setup:function(a){a.on("init",(function(t){if(localStorage.numeroNotaEnEdicion=e||VALORES_POR_DEFECTO.NUEVA_NOTA,esPopup()||notaTieneZoom(e))try{ajustaTamanyoVentanaEditarPopup(e);var o=$(t.target.editorContainer).find("iframe");o.height(window.innerHeight-o.position().top-getEditorToolsHeight()),$(window).on("resize",(function(){o.height(window.innerHeight-o.position().top-getEditorToolsHeight())}))}catch(e){console.log(e)}a.on("Remove",(function(e){var a=numeroNotaEditando();a!=localStorage.numeroNotaEnEdicion&&0!=a?localStorage.numeroNotaEnEdicion=a:localStorage.removeItem("numeroNotaEnEdicion")})),a.on("ExecCommand",(function(e){switch(e.command.toLowerCase()){case"copy":case"cut":case"paste":chrome.permissions.request({permissions:["clipboardRead"]});break;case"mceImageRotateLeft":case"mceImageRotateRight":case"mceImageFlipVertical":case"mceImageFlipHorizontal":case"mceEditImage":chrome.permissions.contains({origins:["https://www.noteboardapp.com/"]},(function(e){e||pidePermisoParaEditarImagenes()}))}}))})),a.on("Change",(function(a){(e||0===e)&&(localStorage["editando"+e]=a.level.content,sendRealTime(e,{texto:a.level.content}))})),a.ui.registry.addButton("check",{icon:"checkmark",tooltip:"checkbox",onAction:function(){a.insertContent('<input class="noteBoardCheck" type="checkbox"/>'),null!=e?cambiaAparenciaEditor(buscarTipo("postit"+e),"textAreaEdit"+e):cambiaAparenciaEditor(buscarTipo("postitnuevo"),"postitnuevo")}}),isMobile()&&(a.ui.registry.addButton(chrome.i18n.getMessage("aceptar"),{text:chrome.i18n.getMessage("aceptar"),title:chrome.i18n.getMessage("aceptar"),onAction:function(){"textoAnun"==a.id?$("#postitnuevo .inplace_save").click():$("#postit"+parseInt(a.id.substr(12))+" .inplace_save").click()}}),a.ui.registry.addButton(chrome.i18n.getMessage("cancelar"),{text:chrome.i18n.getMessage("cancelar"),title:chrome.i18n.getMessage("cancelar"),onAction:function(){"textoAnun"==a.id?$("#postitnuevo .inplace_cancel").click():$("#postit"+parseInt(a.id.substr(12))+" .inplace_cancel").click()}})),activaTooltipsEditor()},save_enablewhendirty:!1,save_onsavecallback:e=>{"textoAnun"==e.id?$("#postitnuevo .inplace_save").click():$("#postit"+parseInt(e.id.substr(12))+" .inplace_save").click()},content_css:"https://fonts.googleapis.com/css?family=Kalam|Montserrat|Indie+Flower|Droid+Sans|Architects+Daughter|Balsamiq+Sans|Quando|Quattrocento+Sans|Roboto|Karla",content_style:"p {margin: 0}"})}function getEditorToolsHeight(){return $(".selectorColor").height()+$(".tox-menubar").height()+$(".tox-toolbar").height()+100}function ajustaTamanyoVentanaEditarPopup(e){if(esPopup()){const t=100;var a=$("#postit"+e).outerWidth()>700?$("#postit"+e).outerWidth():700;resizeWindow(winId,a+30,$(".inplace_save").position().top+t<screen.height?$(".inplace_save").position().top+t:screen.height-t)}}function activarMod(){for(var e=0;e<localStorage.totalPost;e++)(null!=localStorage["tablon"+e]&&"undefined"!=localStorage["tablon"+e]||1!=tablonActual)&&localStorage["tablon"+e]!=tablonActual||""!=localStorage["editando"+e]&&null!=localStorage["editando"+e]&&"undefined"!=localStorage["editando"+e]&&$("#texto"+e).trigger("openEditor")}function editandoAlgunaNota(){return!1!==numeroNotaEditando()}function numeroNotaEditando(){for(var e=document.createElement("div"),a=0;a<localStorage.totalPost;a++)if(((null==localStorage["tablon"+a]||"undefined"==localStorage["tablon"+a])&&1==tablonActual||localStorage["tablon"+a]==tablonActual)&&(e.innerHTML=localStorage["editando"+a],""!=localStorage["editando"+a]&&null!=localStorage["editando"+a]&&"undefined"!=localStorage["editando"+a]&&""!=e.innerText))return a;return!1}function oscarGuardaContenido(e,a){"textoAnun"==e?localStorage.editando=a:localStorage["editando"+e.substr(12)]=a}function pidePermisoParaEditarImagenes(){sweetAlert({text:chrome.i18n.getMessage("permisoEditarImagenes"),successCallback:function(){chrome.permissions.request({origins:["https://www.noteboardapp.com/"]})},type:"warning"})}function estaEditorAbierto(e){return!!tinyMCE.get("textAreaEdit"+e)}function hayEdicionNuevaNotaPendiente(){if(document.URL.indexOf("newTab")>-1)return!1;var e={innertext:""};return localStorage.editando&&((e=document.createElement("div")).innerHTML=localStorage.editando),""!=localStorage.editando&&null!=localStorage.editando&&"undefined"!=localStorage.editando&&""!=e.innerText}function obtenEditor(e){return e===VALORES_POR_DEFECTO.NUEVA_NOTA&&tinyMCE.get("textoAnun")||tinyMCE.get("textAreaEdit"+e)}function activaTooltipsEditor(){var e={theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:150};$(".idtransparente2").attr("title",chrome.i18n.getMessage("colorTransparente")).tooltipster(e),$(".notepadBut").attr("title",chrome.i18n.getMessage("colorNotepad")).tooltipster(e),$(".customColor2").attr("title",chrome.i18n.getMessage("colorCustom")).tooltipster(e)}function activaTooltipsEditorNuevaNota(){if(!$("#idtransparente").hasClass("tooltipstered")){var e={theme:["tooltipster-noir","tooltipster-noir-customized"],side:"bottom",delay:150};$("#idtransparente").attr("title",chrome.i18n.getMessage("colorTransparente")).tooltipster(e),$("#notepad").attr("title",chrome.i18n.getMessage("colorNotepad")).tooltipster(e),$("#customColor").attr("title",chrome.i18n.getMessage("colorCustom")).tooltipster(e)}}function addContentToEditor(e,a){var t=obtenEditor(e);t&&(t.insertContent(a),t.setContent(t.getContent().replace(/(\r\n|\n|\r)/gm,""),{format:"html"}))}function algunEditorAbierto(){return $('iframe[id^="textAre"]').length>0||$("#postitnuevo").is(":visible")}function aceptaEdicion(){$("#postitnuevo").is(":visible")?$(".inplace_save").click():$(".inplace_save:not(.nuevo_save)").click()}function initializeNewPostit(){if(0==$("#postitnuevo").length){var e=getNewPostit();$(".tablonPostits").append(e),document.getElementById("aceptar").innerText=chrome.i18n.getMessage("aceptar"),document.getElementById("borrar").innerText=chrome.i18n.getMessage("cancelar"),$("#botonborNuevo").on("click",borraPostitNuevo),$("#idblanco").on("click",(function(){cambioPostit(TIPO_NOTA.BLANCO,"postitnuevo")})),$("#idamarillo").on("click",(function(){cambioPostit(TIPO_NOTA.AMARILLO,"postitnuevo")})),$("#idverde").on("click",(function(){cambioPostit(TIPO_NOTA.VERDE,"postitnuevo")})),$("#idlila").on("click",(function(){cambioPostit(TIPO_NOTA.LILA,"postitnuevo")})),$("#idnaranja").on("click",(function(){cambioPostit(TIPO_NOTA.AMARILLO2,"postitnuevo")})),$("#idrosa").on("click",(function(){cambioPostit(TIPO_NOTA.ROSA,"postitnuevo")})),$("#idrojo").on("click",(function(){cambioPostit(TIPO_NOTA.ROJO,"postitnuevo")})),$("#idazul").on("click",(function(){cambioPostit(TIPO_NOTA.AZUL,"postitnuevo")})),$("#idtransparente").on("click",(function(){cambioPostit(TIPO_NOTA.TRANSPARENTE,"postitnuevo")})),$("#notepad").on("click",(function(){cambioPostit(TIPO_NOTA.LIBRETA,"postitnuevo")})),$("#sinMarcoNuevo").click((function(){$("#postitnuevo").toggleClass("postitSinMarco"),$("#textoAnun").height("auto")})),$(".sinMarcoLabel").text(chrome.i18n.getMessage("sinMarco")),$("#aceptar").on("click",guardaPostit),$("#borrar").on("click",borraPostitNuevo),$("#customColor").ColorPicker({onSubmit:function(e,a,t,o){$(o).val(a),$(o).ColorPickerHide()},onBeforeShow:function(e,a,t,o){$(this).ColorPickerSetColor("#0000ff")},onChange:function(e,a,t,o){$("#customColor").css("background-color","#"+a),cambioPostit(a,"postitnuevo")}}).bind("keyup",(function(){$(this).ColorPickerSetColor(this.value)})),$("#postitnuevo").resizable({minHeight:200,minWidth:390,resize:function(e,a){resizeEditor(e)}}),$(".postit0").draggable({distance:5,cancel:".inplace_save,.inplace_cancel",stack:".anuncios div",containment:".Postits"}),activaTooltipsEditorNuevaNota()}}function cierraPostitNuevo(){$("#postitnuevo").addClass("scale-down-center"),setTimeout((function(){$("#postitnuevo").hide(),$("#postitnuevo").removeClass("scale-down-center").removeClass("scale-up-center")}),150)}var DEFAULT_KANBAN=["Todo","Doing","Done"];function muestraDialogoKanban(){salSiPapelera()||abrirPantallaModal(obtenerFormularioKanban(),{onOpenStart:function(){var e={data:crearTagData(getKanbanList()),placeholder:"Introduce más Columnas",secondaryPlaceholder:"+Tag",limit:8};M.Chips.init(document.getElementById("chips"),e),$("#quitar-kanban").off().on("click",quitarTablonKanban),$("#aceptar-kanban").off().on("click",hazTablonKanban),$(".chips").sortable()},height:"60%",minHeight:380,maxHeight:450,maxWidth:750})}function crearTagData(e){return e.map((e=>({tag:e})))}function getKanbanList(e=tablonActual){var a=[];try{if(esTablonKanban(tablonActual))a=JSON.parse(localStorage["tablonKanban"+e]).kanbanList;else a=DEFAULT_KANBAN}catch(e){console.log(e)}return a}function getKanbanWidths(e=tablonActual){var a=[];try{if(esTablonKanban(e))a=JSON.parse(localStorage["tablonKanban"+e]).widths}catch(e){console.log(e)}return a}function quitarTablonKanban(){localStorage.removeItem("tablonKanban"+tablonActual),modalInstance.close(),quitarColumnaKanbanPostis(tablonActual),borraKanban(),refrescaPantalla(),grabaTablones()}function hazTablonKanban(e){if(isPremiumUser()){var a=getSortedChipsData();localStorage["tablonKanban"+tablonActual]=JSON.stringify({kanbanList:a,kanbanOrder:[]}),modalInstance.close(),inicializaKanban(),refrescaPantalla(),grabaTablones()}else muestraMensajeHaztePremium()}function getSortedChipsData(){var e=[];return $("#chips").find("i").remove(),$(".chip").each((function(){e.push($(this).text())})),e}function esTablonKanban(e=tablonActual){return!esPopup()&&!!localStorage["tablonKanban"+e]}function esTablonKanbanCompartido(e=tablonActual){var a=getTablonCompartido(e);return a&&a.tabKanban}function inicializaKanban(){if(esTablonKanban()){$("#kanbanBot").addClass("selected"),quitaMasonry(),$(".columna-wrapper").remove();var e=getKanbanList(),a=e.length;quitaMasonry();for(var t=0;t<a;t++)$("#Postits").append(`\n      <div class="columna-wrapper">\n        <div class="titulo-kanban teal darken-3">\n          ${e[t]}\n          <span class="contenedor-contador-kanban">\n            - <span class="contador-kanban">${numeroNotasEnColumna(t)}</span>\n          </span>\n          <a class="add-kanba-note btn-floating btn-small waves-effect waves-light teal lighten-1 right mdc-elevation--z10"\n            data-col="${t}" title="${chrome.i18n.getMessage("addKanbanNote")}">\n            <i class="material-icons">add</i>\n          </a>\n        </div>\n        <div class="columna" data-colid = ${t} id="columna${t}"></div>\n      </div>\n    `);isChromeExtension()?$(".columna-wrapper").width(100/a-1+"%"):$(".columna-wrapper").width(100/a+"%");var o=getKanbanWidths();if(o){for(t=0;t<o.length;t++)o[t]&&$(".columna-wrapper").eq(t).width(o[t]);$("#Postits, .tablonPostits").width(getTotalWidth(o))}else $("#Postits, .tablonPostits").width(($(".columna-wrapper").width()+1)*a);$(".columna-wrapper").resizable({minWidth:400,resize:kanbanResize,stop:function(){grabaTablones(),muestraAyudaSnackbar("helpKanbanResize")}}),asignaPosicionTituloKanban(),$(".columna-wrapper").css("borderColor",defaultColorContrastBackground),$(".add-kanba-note").on("click",(function(e){muestraEditorNuevaNota(e.pageX-$(".columna").width(),e.pageY+$(".titulo-kanban ").height(),$(this).data("col"))})),$(".columna-wrapper .titulo-kanban").first().on("dblclick",mueveNotaRandom),$(".columna").off().on("scroll",(function(e){refreshConnections(),cambiaMaquetaPant(e)})),$(".columna-wrapper .ui-resizable-handle").on("dblclick",(function(e){borraWidths(),isChromeExtension()?$(".columna-wrapper").width(100/a-1+"%"):$(".columna-wrapper").width(100/a+"%"),refrescaKanban(),refreshConnections(),grabaTablones(),cambiaIcono(!1,!0)})),isKanbanBugsBoard()&&($(".add-kanba-note").hide(),$(".add-kanba-note")[0].style.display="block",$(".add-kanba-note")[1].style.display="block")}else $("#kanbanBot").removeClass("selected")}function borraKanban(){$(".columna").length>0&&$(".columna-wrapper").remove(),$("#kanbanBot").removeClass("selected")}function refrescaKanban(){if(esTablonKanban()&&!cambioTablon.sliding){if($(".columna").height(window.innerHeight-$(".botones").height()-$(".titulo-kanban").height()-30),$("#Postits").height(window.innerHeight),getKanbanWidths())getTotalWidth()<window.innerWidth?$(".tablonPostits").width(window.innerWidth):$(".tablonPostits").width(getTotalWidth()),isChromeExtension(),$(".tablonPostits").height(window.innerHeight).addClass("tablon-kanban");else isChromeExtension()?$(".tablonPostits").width(window.innerWidth-3).height(window.innerHeight-3).addClass("tablon-kanban"):$(".tablonPostits").width(window.innerWidth).height(window.innerHeight).addClass("tablon-kanban"),$("#Postits").width($(".tablonPostits").width()).width(($(".columna").width()+1)*$(".columna").length);$(".titulo-kanban").show(),$(".columna-wrapper").css("borderColor",defaultColorContrastBackground),refrescaContadoresKanban(),asignaPosicionTituloKanban(),ordenaPostitsKanban()}}function asignaPosicionTituloKanban(){const e=isMovilApp()?-5:5;$(".columna-wrapper").css("padding-top",$(".botones").height()+e)}function getMaxPostitWidth(){return parseInt($("#Postits").outerWidth()/$(".columna").length)-80}function getColumnPostit(e){return parseInt($("#postit"+e).closest(".columna").attr("data-colid"))}function getColumnPosition(e){return parseInt(e/($(".tablonPostits").width()/$(".columna").length))}function getLeftCoordColum(e){return parseInt($(".tablonPostits").outerWidth()/$(".columna").length*e)}function getKanbanColumnNumber(e=tablonActual){return getKanbanList(e).length}function quitarColumnaKanbanPostis(e=tablonActual){for(var a=0;a<localStorage.totalPost;a++)localStorage["tablon"+a]==e&&(localStorage.removeItem("columnaKanban"+a),isUserConnected()&&null==localStorage["userComp"+a]&&updateNotaLoginMemo(a))}function coordenadaXEnTablonKanban(e){var a=parseInt(localStorage["X"+e]),t=parseInt(localStorage["columnaKanban"+e]);if(getColumnPostit(e)!=t)a=t?getLeftCoordColum(t)+20:20;else{var o=$("#columna0").width();a+$("#postit"+e).outerWidth()>o*(t+1)&&(a=getLeftCoordColum(t)+20)}return a}function ajustaPostistSegunColumna(){if(esTablonKanban()){for(var e=0;e<localStorage.totalPost;e++)if(localStorage["tablon"+e]==tablonActual){var a=coordenadaXEnTablonKanban(e);a!=localStorage["X"+e]&&(localStorage["X"+e]=a,updateNotaMemo(e),$("#postit"+e).offset({left:a}))}refreshConnections()}}function refrescaContadoresKanban(){$(".titulo-kanban").each((function(e){$(this).find(".contador-kanban").text(numeroNotasEnColumna(e))}))}function numeroNotasEnColumna(e,a=tablonActual){for(var t=0,o=0;o<localStorage.totalPost;o++)localStorage["tablon"+o]==a&&localStorage["columnaKanban"+o]==e&&t++;return t}function dijujaLineasKanban(e,a,t,o=tablonActual){if(esTablonKanban(o)){e.fillStyle=defaultColorContrastBackground;var n=getKanbanList(o).length,i=getKanbanWidths(o);if(i)for(var r=getTotalWidth(i),l=0,s=0;s<n-1;s++)l+=t*i[s]/r,e.fillRect(l,0,1,a);else{var c=t/n;for(s=1;s<n;s++)e.fillRect(c*s,0,1,a)}}}function ajustaPostitsMaxWidth(e){$(".postitNB").each((function(){if($(this).attr("id")){var a=parseInt($(this).attr("id").substr(6));localStorage["width"+a]>e&&(localStorage["width"+a]=e,updateNotaMemo(a))}}))}function hazKanbanSortable(){$(".columna").sortable({handle:isMobile()&&".parteSuperior, .bordesup",connectWith:!isKanbanBugsBoard()&&".columna",items:".postitNB",start:function(e,a){removeConnections(),sortStart(e,a)},stop:function(e,a){sortEnd(e,a)},cancel:".editing-post, input",scroll:!0,opacity:.7,create:guardaPosicionesPostits})}function sortStart(e,a){$("#postit"+a.item[0].id.substr(6)).addClass("postitMoving")}function sortEnd(e,a){var t=a.item[0].id.substr(6);$("#postit"+t).removeClass("postitMoving");var o=topBarHasBoards()?$(".paneles2").height():0;localStorage["X"+t]=parseInt(a.offset.left),localStorage["Y"+t]=parseInt(a.offset.top-o),localStorage["columnaKanban"+t]=getColumnPostit(t),updateNotaMemo(t),$(".classTransparent").each((function(){var e=$(this).attr("id").substr(6);e!=t?(localStorage["columnaKanban"+e]=getColumnPostit(t),$("#postit"+e).remove(),muestraPostit(e),updateNotaMemo(e)):$(this).css("opacity","1")})),$(".classTransparent").removeClass("classTransparent"),refrescaContadoresKanban(),guardaOrdenKanban(),isUserConnected()&&esTabCompartido()&&sendRealTime(t,localStorage["tablon"+t]),refreshConnections(),cambiaIcono(!1,!0)}function guardaOrdenKanban(e=tablonActual){if(localStorage["tablonKanban"+e]){for(var a=JSON.parse(localStorage["tablonKanban"+e]),t=isUserConnected()?"data-treeid":"data-numpost",o=0;o<a.kanbanList.length;o++)a.kanbanOrder[o]=$("#columna"+o).sortable("toArray",{attribute:t});localStorage["tablonKanban"+e]=JSON.stringify(a),grabaTablones()}}function ordenaPostitsKanban(){if(localStorage["tablonKanban"+tablonActual]){var e=JSON.parse(localStorage["tablonKanban"+tablonActual]),a=isUserConnected()?"data-treeid":"data-numpost";function t(t,n){return e.kanbanOrder[o].indexOf($(t).attr(a))>e.kanbanOrder[o].indexOf($(n).attr(a))?1:-1}for(var o=0;o<e.kanbanList.length;o++)e.kanbanOrder[o]&&$("#columna"+o+" .postitNB").sortElements(t)}}function guardaPosicionesPostits(e){setTimeout((function(){$(e.target).find(".postitNB").each((function(){var e=$(this).attr("data-numpost"),a=parseInt($(this).position().left)+parseInt($(this).css("margin-left")),t=parseInt($(this).position().top);a==localStorage["X"+e]&&t==localStorage["Y"+e]||(localStorage["X"+e]=a,localStorage["Y"+e]=t)})),cambiaIcono(!1,!0)}),1e3)}function mueveNotaRandom(){var e=$("#columna0 .postitNB");if(0!=e.length){var a=$(e[getRandomNumber(0,e.length-1)]).data("numpost");localStorage["columnaKanban"+a]=1,refrescaNota(a)}}function addTreeIdKanban(e,a){try{for(var t=0;t<localStorage.numTablones;t++)if(localStorage["tablonKanban"+t]){var o=JSON.parse(localStorage["tablonKanban"+t]);o.kanbanOrder=JSON.parse(JSON.stringify(o.kanbanOrder).replace(`"${a}"`,`"${e}"`)),localStorage["tablonKanban"+t]=JSON.stringify(o)}}catch(e){console.log(e)}}function kanbanResize(e,a){guardaWidhtKanban($(e.target).index(),a.size.width),$("#Postits").width(getTotalWidth()),refreshConnections(),cambiaIcono(!1,!0)}function guardaWidhtKanban(e,a){if(localStorage["tablonKanban"+tablonActual]){var t=JSON.parse(localStorage["tablonKanban"+tablonActual]);t.widths||(t.widths=[]),$(".columna-wrapper").each((function(o){t.widths[o]=o===e?a:$(this).width(),$(this).width($(this).width())})),localStorage["tablonKanban"+tablonActual]=JSON.stringify(t)}}function getTotalWidth(e){var a=0;if(e=e||getKanbanWidths())for(var t of e)a+=t+1;return a}function getParcialWidthByColumn(e,a){e=e||getKanbanWidths();for(var t=0,o=0;o<e.length&&o<a;)t+=e[o]+1,o++;return t}function borraWidths(){if(esTablonKanban(tablonActual)){var e=JSON.parse(localStorage["tablonKanban"+tablonActual]);delete e.widths,localStorage["tablonKanban"+tablonActual]=JSON.stringify(e)}}function connectTool(e){if(1!==$(".postitNB").length)if(isConnectedTool())removeConnectTool();else{$(".postitNB:not(#postit"+e+")").each((function(){$(this).append('<div class="transparent-layer"></div>').append(getConnectToolHtml(e,$(this).attr("id").substr(6))).addClass("postit-overflow-visible")})),$(".connect-tool").each((function(){var e=$(this).closest(".postitNB");$(this).css({top:(e.height()-$(this).height())/2,left:(e.width()-$(this).width())/2})})),$(".connect-tool button").on("click",(function(){var a=$(this).closest(".postitNB"),t=a.attr("id").substr(6),o=a.find(".connect-tool-input").val();isConnected(e,t)?(removeConnection(e,t),changeConnectButtonText(t,chrome.i18n.getMessage("conectar")),refreshConnections()):(addConnection(e,t,o),drawConnection(e,t,null,o),changeConnectButtonText(t,chrome.i18n.getMessage("desconectar")))})),$(".connect-tool input").on("keyup",(function(a){var t=$(this).closest(".postitNB"),o=t.attr("id").substr(6),n=$(this).val();isConnected(e,o)?("Enter"===a.key&&removeConnectTool(),updateConnection(e,o,n),refreshConnections()):"Enter"===a.key&&(t.find(".connect-tool button").click(),removeConnectTool())})),$("body").off().on("click",(function(e){("Postits"==e.target.className||e.target.className.indexOf("columna")>-1)&&removeConnectTool()}))}else sweetAlert({type:"error",text:chrome.i18n.getMessage("connectionSoloUna"),cancel:!1})}function isConnectedTool(e){return e&&e.find(".connect-tool").length>0||!e&&$(".connect-tool").length>0}function removeConnectTool(){$(".connect-tool").remove(),$(".transparent-layer").remove(),$(".postitNB").removeClass("postit-overflow-visible")}function changeConnectButtonText(e,a){$("#postit"+e).find(".connect-tool button").text(a)}function getConnectToolHtml(e,a){var t=getConnection(e,a);return`<div class="connect-tool">\n      <button class="waves-effect waves-light btn" type="text">${t?chrome.i18n.getMessage("desconectar"):chrome.i18n.getMessage("conectar")}</button>\n      <input type="text" class="connect-tool-input" placeholder="${chrome.i18n.getMessage("escribeEtiqueta")}" value="${t&&t.tag?t.tag:""}">\n  </div>`}function isConnected(e,a){return getConnection(e,a)}function getConnection(e,a){if(!localStorage["connections"+e])return!1;for(var t=JSON.parse(localStorage["connections"+e]),o=0;o<t.length;o++)if(coincidenLosIds(t[o],a))return t[o];return!1}function coincidenLosIds(e,a){return e.id&&localStorage["treeId"+a]&&e.id==localStorage["treeId"+a]||a==e.num}function addConnection(e,a,t){var o;(o=localStorage["connections"+e]?JSON.parse(localStorage["connections"+e]):[]).push({num:a,id:localStorage["treeId"+a]||"",tag:t||""}),localStorage["connections"+e]=JSON.stringify(o),updateNotaMemo(e)}function updateConnection(e,a,t){var o=JSON.parse(localStorage["connections"+e]),n=getIndexConnection(o,a);n>=0&&(o[n].tag=t),localStorage["connections"+e]=JSON.stringify(o),updateNotaMemo(e)}function addTreeIdConnection(e,a){for(i=0;i<localStorage.totalPost;i++)if(localStorage["connections"+i]){var t=JSON.parse(localStorage["connections"+i]);t.forEach((t=>{t.num==a&&(t.id=e)})),localStorage["connections"+i]=JSON.stringify(t)}}function removeConnection(e,a){if(!localStorage["connections"+e])return!1;var t=JSON.parse(localStorage["connections"+e]),o=getIndexConnection(t,a);o>=0&&t.splice(o,1),localStorage["connections"+e]=JSON.stringify(t),updateNotaMemo(e)}function getIndexConnection(e,a){for(var t=0;t<e.length&&!coincidenLosIds(e[t],a);)t++;return t<e.length&&t}function updateConnectionsBorrado(e){for(i=0;i<localStorage.totalPost;i++)if(localStorage["connections"+i]){var a=JSON.parse(localStorage["connections"+i]);a=a.map((a=>(a.num>e&&(a.num=a.num-1),a))),localStorage["connections"+i]=JSON.stringify(a),updateNotaMemo(i)}}function refreshConnections(){for($(".leader-line").remove(),i=0;i<localStorage.totalPost;i++){if(localStorage["tablon"+i]==tablonActual&&localStorage["connections"+i])JSON.parse(localStorage["connections"+i]).forEach((e=>{drawConnection(i,e.num,e.id,e.tag)}))}}function removeConnections(){$(".leader-line").remove()}function borraConnectionsPostit(e){for(localStorage.removeItem("connections"+e),i=0;i<localStorage.totalPost;i++)if(localStorage["connections"+i]){for(var a=JSON.parse(localStorage["connections"+i]),t=!1,o=0;o<a.length;)coincidenLosIds(a[o],e)?(a.splice(o,1),t=!0):o++;t&&(localStorage["connections"+i]=JSON.stringify(a),updateNotaMemo(i))}}function drawConnection(e,a,t,o){var n=document.getElementById("postit"+e);if(t)var i=document.querySelector('.postitNB[data-treeid="'+t+'"]');else i=document.getElementById("postit"+a);n&&i&&(n.offsetLeft<i.offsetLeft?new LeaderLine({start:n,end:i,color:defaultColorContrastBackground,middleLabel:o?LeaderLine.pathLabel(o,{color:defaultColorContrastBackground,outlineColor:"none",fontWeight:600,backgroundColor:"white"}):""}):new LeaderLine({start:i,end:n,color:defaultColorContrastBackground,middleLabel:o?LeaderLine.pathLabel(o,{color:defaultColorContrastBackground,outlineColor:"none",fontWeight:600,backgroundColor:"white"}):"",startPlug:"arrow1",endPlug:"behind"}),changeZindexConnectionLastLine(e))}function changeZindexConnectionLastLine(e){$(".leader-line").last().css("z-index",$("#postit"+e).css("z-index"))}function isFloat(e){return e===+e&&e!==(0|e)}function isInteger(e){return e===+e&&e===(0|e)}function showConnections(){for(i=0;i<localStorage.totalPost;i++)if(localStorage["connections"+i]){var e=JSON.parse(localStorage["connections"+i]);console.log(e)}}$(document).ready((function(){$("#kanbanBot").on("click",muestraDialogoKanban)}));